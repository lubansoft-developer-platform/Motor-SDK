define(["./when-45f3d25d","./Check-34538dad","./Cartesian3-e69091b9","./Cartesian2-7a44370a","./BoundingSphere-bacc5cb6","./Matrix4-c65e6a1b","./RuntimeError-86da6af2","./Rectangle-c7d55cfa","./WebGLConstants-3660bc8f","./ComponentDatatype-86703c58","./GeometryAttribute-70b679fd","./PrimitiveType-30fa6f85","./Transforms-7d49a8ab","./GeometryAttributes-9d45f9e2","./IndexDatatype-e52361bd","./createTaskProcessorWorker","./GeometryOffsetAttribute-f755a5cb","./VertexFormat-a00562ee","./BoxGeometry-d5f69a01","./CylinderGeometryLibrary-fae5a922","./CylinderGeometry-e5757843","./EllipsoidGeometry-13e9bdb4","./Color-cbe4364d"],(function(e,t,a,n,r,i,o,d,s,c,f,l,u,h,b,p,y,g,v,x,C,m,I){"use strict";function k(e){this.offset=e.offset,this.count=e.count,this.color=e.color,this.batchIds=e.batchIds}var B=new a.Cartesian3,M=i.Matrix4.packedLength+a.Cartesian3.packedLength,w=i.Matrix4.packedLength+2,A=i.Matrix4.packedLength+a.Cartesian3.packedLength,O=a.Cartesian3.packedLength+1,L={modelMatrix:new i.Matrix4,boundingVolume:new r.BoundingSphere};function E(e,t){var n=t*M,r=a.Cartesian3.unpack(e,n,B);n+=a.Cartesian3.packedLength;var o=i.Matrix4.unpack(e,n,L.modelMatrix);i.Matrix4.multiplyByScale(o,r,o);var d=L.boundingVolume;return a.Cartesian3.clone(a.Cartesian3.ZERO,d.center),d.radius=Math.sqrt(3),L}function U(e,t){var n=t*w,r=e[n++],o=e[n++],d=a.Cartesian3.fromElements(r,r,o,B),s=i.Matrix4.unpack(e,n,L.modelMatrix);i.Matrix4.multiplyByScale(s,d,s);var c=L.boundingVolume;return a.Cartesian3.clone(a.Cartesian3.ZERO,c.center),c.radius=Math.sqrt(2),L}function G(e,t){var n=t*A,r=a.Cartesian3.unpack(e,n,B);n+=a.Cartesian3.packedLength;var o=i.Matrix4.unpack(e,n,L.modelMatrix);i.Matrix4.multiplyByScale(o,r,o);var d=L.boundingVolume;return a.Cartesian3.clone(a.Cartesian3.ZERO,d.center),d.radius=1,L}function S(e,t){var n=t*O,r=e[n++],o=a.Cartesian3.unpack(e,n,B),d=i.Matrix4.fromTranslation(o,L.modelMatrix);i.Matrix4.multiplyByUniformScale(d,r,d);var s=L.boundingVolume;return a.Cartesian3.clone(a.Cartesian3.ZERO,s.center),s.radius=1,L}var T=new a.Cartesian3;function V(t,n,o,d,s){if(e.defined(n)){for(var c=o.length,f=d.attributes.position.values,l=d.indices,u=t.positions,h=t.vertexBatchIds,b=t.indices,p=t.batchIds,y=t.batchTableColors,g=t.batchedIndices,v=t.indexOffsets,x=t.indexCounts,C=t.boundingVolumes,m=t.modelMatrix,B=t.center,M=t.positionOffset,w=t.batchIdIndex,A=t.indexOffset,O=t.batchedIndicesOffset,L=0;L<c;++L){var E=s(n,L),U=E.modelMatrix;i.Matrix4.multiply(m,U,U);for(var G=o[L],S=f.length,V=0;V<S;V+=3){var F=a.Cartesian3.unpack(f,V,T);i.Matrix4.multiplyByPoint(U,F,F),a.Cartesian3.subtract(F,B,F),a.Cartesian3.pack(F,u,3*M+V),h[w++]=G}for(var R=l.length,P=0;P<R;++P)b[A+P]=l[P]+M;var Z=L+O;g[Z]=new k({offset:A,count:R,color:I.Color.fromRgba(y[G]),batchIds:[G]}),p[Z]=G,v[Z]=A,x[Z]=R,C[Z]=r.BoundingSphere.transform(E.boundingVolume,U),M+=S/3,A+=R}t.positionOffset=M,t.batchIdIndex=w,t.indexOffset=A,t.batchedIndicesOffset+=c}}var F=new a.Cartesian3,R=new i.Matrix4;function P(e){var t=new Float64Array(e),n=0;a.Cartesian3.unpack(t,n,F),n+=a.Cartesian3.packedLength,i.Matrix4.unpack(t,n,R)}function Z(e){for(var t=e.length,a=0,n=0;n<t;++n)a+=I.Color.packedLength+3+e[n].batchIds.length;return a}function D(e,t,a){var n=a.length,i=2+n*r.BoundingSphere.packedLength+1+Z(t),o=new Float64Array(i),d=0;o[d++]=e,o[d++]=n;for(var s=0;s<n;++s)r.BoundingSphere.pack(a[s],o,d),d+=r.BoundingSphere.packedLength;var c=t.length;o[d++]=c;for(var f=0;f<c;++f){var l=t[f];I.Color.pack(l.color,o,d),d+=I.Color.packedLength,o[d++]=l.offset,o[d++]=l.count;var u=l.batchIds,h=u.length;o[d++]=h;for(var b=0;b<h;++b)o[d++]=u[b]}return o}function q(t,a){var n=e.defined(t.boxes)?new Float32Array(t.boxes):void 0,r=e.defined(t.boxBatchIds)?new Uint16Array(t.boxBatchIds):void 0,i=e.defined(t.cylinders)?new Float32Array(t.cylinders):void 0,o=e.defined(t.cylinderBatchIds)?new Uint16Array(t.cylinderBatchIds):void 0,d=e.defined(t.ellipsoids)?new Float32Array(t.ellipsoids):void 0,s=e.defined(t.ellipsoidBatchIds)?new Uint16Array(t.ellipsoidBatchIds):void 0,c=e.defined(t.spheres)?new Float32Array(t.spheres):void 0,f=e.defined(t.sphereBatchIds)?new Uint16Array(t.sphereBatchIds):void 0,l=e.defined(n)?r.length:0,u=e.defined(i)?o.length:0,h=e.defined(d)?s.length:0,p=e.defined(c)?f.length:0,y=v.BoxGeometry.getUnitBox(),g=C.CylinderGeometry.getUnitCylinder(),x=m.EllipsoidGeometry.getUnitEllipsoid(),I=y.attributes.position.values,k=g.attributes.position.values,B=x.attributes.position.values,M=I.length*l;M+=k.length*u,M+=B.length*(h+p);var w=y.indices,A=g.indices,O=x.indices,L=w.length*l;L+=A.length*u,L+=O.length*(h+p);var T=new Float32Array(M),Z=new Uint16Array(M/3),q=b.IndexDatatype.createTypedArray(M/3,L),W=l+u+h+p,_=new Uint16Array(W),N=new Array(W),Y=new Uint32Array(W),j=new Uint32Array(W),z=new Array(W);P(t.packedBuffer);var H={batchTableColors:new Uint32Array(t.batchTableColors),positions:T,vertexBatchIds:Z,indices:q,batchIds:_,batchedIndices:N,indexOffsets:Y,indexCounts:j,boundingVolumes:z,positionOffset:0,batchIdIndex:0,indexOffset:0,batchedIndicesOffset:0,modelMatrix:R,center:F};V(H,n,r,y,E),V(H,i,o,g,U),V(H,d,s,x,G),V(H,c,f,x,S);var J=D(q.BYTES_PER_ELEMENT,N,z);return a.push(T.buffer,Z.buffer,q.buffer),a.push(_.buffer,Y.buffer,j.buffer),a.push(J.buffer),{positions:T.buffer,vertexBatchIds:Z.buffer,indices:q.buffer,indexOffsets:Y.buffer,indexCounts:j.buffer,batchIds:_.buffer,packedBuffer:J.buffer}}var W=p(q);return W}));