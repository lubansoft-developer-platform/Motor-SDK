define(["exports","./when-45f3d25d","./Cartesian3-e69091b9","./Cartesian2-7a44370a","./Matrix4-c65e6a1b","./ComponentDatatype-86703c58","./GeometryAttribute-70b679fd","./PrimitiveType-30fa6f85","./Transforms-7d49a8ab","./GeometryAttributes-9d45f9e2","./GeometryPipeline-7ef9305b","./IndexDatatype-e52361bd","./arrayRemoveDuplicates-24a803e7","./ArcType-39be7a32","./EllipsoidRhumbLine-4bc7760a","./PolygonPipeline-d22f3330"],(function(e,t,r,i,n,a,o,s,u,l,h,c,f,p,d,y){"use strict";function g(){this._array=[],this._offset=0,this._length=0}Object.defineProperties(g.prototype,{length:{get:function(){return this._length}}}),g.prototype.enqueue=function(e){this._array.push(e),this._length++},g.prototype.dequeue=function(){if(0!==this._length){var e=this._array,t=this._offset,r=e[t];return e[t]=void 0,t++,t>10&&2*t>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,r}},g.prototype.peek=function(){if(0!==this._length)return this._array[this._offset]},g.prototype.contains=function(e){return-1!==this._array.indexOf(e)},g.prototype.clear=function(){this._array.length=this._offset=this._length=0},g.prototype.sort=function(e){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)};var m={computeHierarchyPackedLength:function(e){var i=0,n=[e];while(n.length>0){var a=n.pop();if(t.defined(a)){i+=2;var o=a.positions,s=a.holes;if(t.defined(o)&&(i+=o.length*r.Cartesian3.packedLength),t.defined(s))for(var u=s.length,l=0;l<u;++l)n.push(s[l])}}return i},packPolygonHierarchy:function(e,i,n){var a=[e];while(a.length>0){var o=a.pop();if(t.defined(o)){var s=o.positions,u=o.holes;if(i[n++]=t.defined(s)?s.length:0,i[n++]=t.defined(u)?u.length:0,t.defined(s))for(var l=s.length,h=0;h<l;++h,n+=3)r.Cartesian3.pack(s[h],i,n);if(t.defined(u))for(var c=u.length,f=0;f<c;++f)a.push(u[f])}}return n},unpackPolygonHierarchy:function(e,t){for(var i=e[t++],n=e[t++],a=new Array(i),o=n>0?new Array(n):void 0,s=0;s<i;++s,t+=r.Cartesian3.packedLength)a[s]=r.Cartesian3.unpack(e,t);for(var u=0;u<n;++u)o[u]=m.unpackPolygonHierarchy(e,t),t=o[u].startingIndex,delete o[u].startingIndex;return{positions:a,holes:o,startingIndex:t}}},v=new r.Cartesian3;function C(e,t,i,n){return r.Cartesian3.subtract(t,e,v),r.Cartesian3.multiplyByScalar(v,i/n,v),r.Cartesian3.add(e,v,v),[v.x,v.y,v.z]}m.subdivideLineCount=function(e,t,i){var n=r.Cartesian3.distance(e,t),a=n/i,o=Math.max(0,Math.ceil(r.CesiumMath.log2(a)));return Math.pow(2,o)};var I=new i.Cartographic,b=new i.Cartographic,T=new i.Cartographic,w=new r.Cartesian3;m.subdivideRhumbLineCount=function(e,t,i,n){var a=e.cartesianToCartographic(t,I),o=e.cartesianToCartographic(i,b),s=new d.EllipsoidRhumbLine(a,o,e),u=s.surfaceDistance/n,l=Math.max(0,Math.ceil(r.CesiumMath.log2(u)));return Math.pow(2,l)},m.subdivideLine=function(e,i,n,a){var o=m.subdivideLineCount(e,i,n),s=r.Cartesian3.distance(e,i),u=s/o;t.defined(a)||(a=[]);var l=a;l.length=3*o;for(var h=0,c=0;c<o;c++){var f=C(e,i,c*u,s);l[h++]=f[0],l[h++]=f[1],l[h++]=f[2]}return l},m.subdivideRhumbLine=function(e,i,n,a,o){var s=e.cartesianToCartographic(i,I),u=e.cartesianToCartographic(n,b),l=new d.EllipsoidRhumbLine(s,u,e),h=l.surfaceDistance/a,c=Math.max(0,Math.ceil(r.CesiumMath.log2(h))),f=Math.pow(2,c),p=l.surfaceDistance/f;t.defined(o)||(o=[]);var y=o;y.length=3*f;for(var g=0,m=0;m<f;m++){var v=l.interpolateUsingSurfaceDistance(m*p,T),C=e.cartographicToCartesian(v,w);y[g++]=C.x,y[g++]=C.y,y[g++]=C.z}return y};var x=new r.Cartesian3,E=new r.Cartesian3,N=new r.Cartesian3,_=new r.Cartesian3;m.scaleToGeodeticHeightExtruded=function(e,n,a,o,s,u){o=t.defaultValue(o,i.Ellipsoid.WGS84);var l=x,h=E,c=N,f=_;if(t.defined(e)&&t.defined(e.attributes)&&t.defined(e.attributes.position))for(var p=e.attributes.position.values,d=p.length/2,y=0;y<d;y+=3)r.Cartesian3.fromArray(p,y,c),u?(l=r.Cartesian3.UNIT_Z,f=c):(o.geodeticSurfaceNormal(c,l),f=o.scaleToGeodeticSurface(c,f)),h=r.Cartesian3.multiplyByScalar(l,a,h),h=r.Cartesian3.add(f,h,h),p[y+d]=h.x,p[y+1+d]=h.y,p[y+2+d]=h.z,s&&(f=r.Cartesian3.clone(c,f)),h=r.Cartesian3.multiplyByScalar(l,n,h),h=r.Cartesian3.add(f,h,h),p[y]=h.x,p[y+1]=h.y,p[y+2]=h.z;return e},m.polygonOutlinesFromHierarchy=function(e,i,n){var a,o,s,u=[],l=new g;l.enqueue(e);while(0!==l.length){var h=l.dequeue(),c=h.positions;if(i)for(s=c.length,a=0;a<s;a++)n.scaleToGeodeticSurface(c[a],c[a]);if(c=f.arrayRemoveDuplicates(c,r.Cartesian3.equalsEpsilon,!0),!(c.length<3)){var p=h.holes?h.holes.length:0;for(a=0;a<p;a++){var d=h.holes[a],y=d.positions;if(i)for(s=y.length,o=0;o<s;++o)n.scaleToGeodeticSurface(y[o],y[o]);if(y=f.arrayRemoveDuplicates(y,r.Cartesian3.equalsEpsilon,!0),!(y.length<3)){u.push(y);var m=0;for(t.defined(d.holes)&&(m=d.holes.length),o=0;o<m;o++)l.enqueue(d.holes[o])}}u.push(c)}}return u},m.polygonsFromHierarchy=function(e,i,n,a){var o=[],s=[],u=new g;u.enqueue(e);while(0!==u.length){var l,h,c,p=u.dequeue(),d=p.positions,m=p.holes;if(n&&t.defined(i))for(h=d.length,l=0;l<h;l++)a.scaleToGeodeticSurface(d[l],d[l]);if(d=f.arrayRemoveDuplicates(d,r.Cartesian3.equalsEpsilon,!0),!(d.length<3))if(c=i?i(d):[...d],t.defined(c)){var v=[],C=y.PolygonPipeline.computeWindingOrder2D(c);C===y.WindingOrder.CLOCKWISE&&(c.reverse(),d=d.slice().reverse());var I,b=d.slice(),T=t.defined(m)?m.length:0,w=[];for(l=0;l<T;l++){var x=m[l],E=x.positions;if(n)for(h=E.length,I=0;I<h;++I)a.scaleToGeodeticSurface(E[I],E[I]);if(E=f.arrayRemoveDuplicates(E,r.Cartesian3.equalsEpsilon,!0),!(E.length<3)){var N=i(E);if(t.defined(N)){C=y.PolygonPipeline.computeWindingOrder2D(N),C===y.WindingOrder.CLOCKWISE&&(N.reverse(),E=E.slice().reverse()),w.push(E),v.push(b.length),b=b.concat(E),c=c.concat(N);var _=0;for(t.defined(x.holes)&&(_=x.holes.length),I=0;I<_;I++)u.enqueue(x.holes[I])}}}o.push({outerRing:d,holes:w}),s.push({positions:b,positions2D:c,holes:v})}}return{hierarchy:o,polygons:s}};var P=new i.Cartesian2,A=new r.Cartesian3,M=new u.Quaternion,G=new n.Matrix3;m.computeBoundingRectangle=function(e,i,a,o,s){for(var l=u.Quaternion.fromAxisAngle(e,o,M),h=n.Matrix3.fromQuaternion(l,G),c=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,p=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,y=a.length,g=0;g<y;++g){var m=r.Cartesian3.clone(a[g],A);n.Matrix3.multiplyByVector(h,m,m);var v=i(m,P);t.defined(v)&&(c=Math.min(c,v.x),f=Math.max(f,v.x),p=Math.min(p,v.y),d=Math.max(d,v.y))}return s.x=c,s.y=p,s.width=f-c,s.height=d-p,s},m.computeBoundingRectanglePlaneMode=function(e,t){for(var r=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,o=e.length,s=0;s<o;++s){var u=e[s];r=Math.min(r,u.x),i=Math.max(i,u.x),n=Math.min(n,u.y),a=Math.max(a,u.y)}return t.x=r,t.y=n,t.width=i-r,t.height=a-n,t},m.createGeometryFromPositions=function(e,t,r,i,n,u){var l=y.PolygonPipeline.triangulate(t.positions2D,t.holes);l.length<3&&(l=[0,1,2]);var c=t.positions;if(i){for(var f=c.length,d=new Array(3*f),g=0,m=0;m<f;m++){var v=c[m];d[g++]=v.x,d[g++]=v.y,d[g++]=v.z}var C=new o.Geometry({attributes:{position:new o.GeometryAttribute({componentDatatype:a.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:d})},indices:l,primitiveType:s.PrimitiveType.TRIANGLES});return n.normal?h.GeometryPipeline.computeNormal(C):C}return u===p.ArcType.GEODESIC?y.PolygonPipeline.computeSubdivision(e,c,l,r):u===p.ArcType.RHUMB?y.PolygonPipeline.computeRhumbLineSubdivision(e,c,l,r):void 0};var L=[],S=new r.Cartesian3,D=new r.Cartesian3;m.computeWallGeometry=function(e,t,i,n,u){var h,f,d,y,g,v=e.length,C=0;if(n)for(f=3*v*2,h=new Array(2*f),d=0;d<v;d++)y=e[d],g=e[(d+1)%v],h[C]=h[C+f]=y.x,++C,h[C]=h[C+f]=y.y,++C,h[C]=h[C+f]=y.z,++C,h[C]=h[C+f]=g.x,++C,h[C]=h[C+f]=g.y,++C,h[C]=h[C+f]=g.z,++C;else{var I=r.CesiumMath.chordLength(i,t.maximumRadius),b=0;if(u===p.ArcType.GEODESIC)for(d=0;d<v;d++)b+=m.subdivideLineCount(e[d],e[(d+1)%v],I);else if(u===p.ArcType.RHUMB)for(d=0;d<v;d++)b+=m.subdivideRhumbLineCount(t,e[d],e[(d+1)%v],I);for(f=3*(b+v),h=new Array(2*f),d=0;d<v;d++){var T;y=e[d],g=e[(d+1)%v],u===p.ArcType.GEODESIC?T=m.subdivideLine(y,g,I,L):u===p.ArcType.RHUMB&&(T=m.subdivideRhumbLine(t,y,g,I,L));for(var w=T.length,x=0;x<w;++x,++C)h[C]=T[x],h[C+f]=T[x];h[C]=g.x,h[C+f]=g.x,++C,h[C]=g.y,h[C+f]=g.y,++C,h[C]=g.z,h[C+f]=g.z,++C}}v=h.length;var E=c.IndexDatatype.createTypedArray(v/3,v-6*e.length),N=0;for(v/=6,d=0;d<v;d++){var _=d,P=_+1,A=_+v,M=A+1;y=r.Cartesian3.fromArray(h,3*_,S),g=r.Cartesian3.fromArray(h,3*P,D),r.Cartesian3.equalsEpsilon(y,g,r.CesiumMath.EPSILON10,r.CesiumMath.EPSILON10)||(E[N++]=_,E[N++]=A,E[N++]=P,E[N++]=P,E[N++]=A,E[N++]=M)}return new o.Geometry({attributes:new l.GeometryAttributes({position:new o.GeometryAttribute({componentDatatype:a.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:h})}),indices:E,primitiveType:s.PrimitiveType.TRIANGLES})},e.PolygonGeometryLibrary=m}));