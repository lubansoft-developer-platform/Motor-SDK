define(["./when-45f3d25d","./Check-34538dad","./Cartesian3-eab74dc0","./Cartesian2-174fefc1","./BoundingSphere-9db3442e","./Transforms-3e7152f2","./Matrix4-22b96d31","./RuntimeError-86da6af2","./WebGLConstants-3660bc8f","./ComponentDatatype-86703c58","./GeometryAttribute-98a8cf59","./PrimitiveType-30fa6f85","./GeometryAttributes-9d45f9e2","./IndexDatatype-cb635cbc","./IntersectionTests-4fa5e272","./Plane-99a0ae01","./ArcType-39be7a32","./EllipsoidRhumbLine-de5cdc57","./EllipsoidGeodesic-96429ebd","./PolylinePipeline-579420a3","./Color-58642dcb"],(function(e,o,r,t,a,i,l,n,d,s,p,f,c,y,u,h,C,g,T,v,m){"use strict";function E(e,o,r,t,a,i,l){var n,d=v.PolylinePipeline.numberOfPoints(e,o,a),s=r.red,p=r.green,f=r.blue,c=r.alpha,y=t.red,u=t.green,h=t.blue,C=t.alpha;if(m.Color.equals(r,t)){for(n=0;n<d;n++)i[l++]=m.Color.floatToByte(s),i[l++]=m.Color.floatToByte(p),i[l++]=m.Color.floatToByte(f),i[l++]=m.Color.floatToByte(c);return l}var g=(y-s)/d,T=(u-p)/d,E=(h-f)/d,b=(C-c)/d,P=l;for(n=0;n<d;n++)i[P++]=m.Color.floatToByte(s+n*g),i[P++]=m.Color.floatToByte(p+n*T),i[P++]=m.Color.floatToByte(f+n*E),i[P++]=m.Color.floatToByte(c+n*b);return P}function b(a){a=e.defaultValue(a,e.defaultValue.EMPTY_OBJECT);var i=a.positions,l=a.colors,n=e.defaultValue(a.colorsPerVertex,!1);if(!e.defined(i)||i.length<2)throw new o.DeveloperError("At least two positions are required.");if(e.defined(l)&&(n&&l.length<i.length||!n&&l.length<i.length-1))throw new o.DeveloperError("colors has an invalid length.");this._positions=i,this._colors=l,this._colorsPerVertex=n,this._arcType=e.defaultValue(a.arcType,C.ArcType.GEODESIC),this._granularity=e.defaultValue(a.granularity,r.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=e.defaultValue(a.ellipsoid,t.Ellipsoid.WGS84),this._workerName="createSimplePolylineGeometry";var d=1+i.length*r.Cartesian3.packedLength;d+=e.defined(l)?1+l.length*m.Color.packedLength:1,this.packedLength=d+t.Ellipsoid.packedLength+3}b.pack=function(a,i,l){if(!e.defined(a))throw new o.DeveloperError("value is required");if(!e.defined(i))throw new o.DeveloperError("array is required");var n;l=e.defaultValue(l,0);var d=a._positions,s=d.length;for(i[l++]=s,n=0;n<s;++n,l+=r.Cartesian3.packedLength)r.Cartesian3.pack(d[n],i,l);var p=a._colors;for(s=e.defined(p)?p.length:0,i[l++]=s,n=0;n<s;++n,l+=m.Color.packedLength)m.Color.pack(p[n],i,l);return t.Ellipsoid.pack(a._ellipsoid,i,l),l+=t.Ellipsoid.packedLength,i[l++]=a._colorsPerVertex?1:0,i[l++]=a._arcType,i[l]=a._granularity,i},b.unpack=function(a,i,l){if(!e.defined(a))throw new o.DeveloperError("array is required");var n;i=e.defaultValue(i,0);var d=a[i++],s=new Array(d);for(n=0;n<d;++n,i+=r.Cartesian3.packedLength)s[n]=r.Cartesian3.unpack(a,i);d=a[i++];var p=d>0?new Array(d):void 0;for(n=0;n<d;++n,i+=m.Color.packedLength)p[n]=m.Color.unpack(a,i);var f=t.Ellipsoid.unpack(a,i);i+=t.Ellipsoid.packedLength;var c=1===a[i++],y=a[i++],u=a[i];return e.defined(l)?(l._positions=s,l._colors=p,l._ellipsoid=f,l._colorsPerVertex=c,l._arcType=y,l._granularity=u,l):new b({positions:s,colors:p,ellipsoid:f,colorsPerVertex:c,arcType:y,granularity:u})};var P=new Array(2),_=new Array(2),B={positions:P,height:_,ellipsoid:void 0,minDistance:void 0,granularity:void 0};function A(o,r){return e.defined(r)&&(o=b.unpack(o,r)),o._ellipsoid=t.Ellipsoid.clone(o._ellipsoid),b.createGeometry(o)}return b.createGeometry=function(o){var t,i,l,n,d,u=o._positions,h=o._colors,g=o._colorsPerVertex,T=o._arcType,b=o._granularity,A=o._ellipsoid,w=r.CesiumMath.chordLength(b,A.maximumRadius),k=e.defined(h)&&!g,D=u.length,G=0;if(T===C.ArcType.GEODESIC||T===C.ArcType.RHUMB){var L,V,x;T===C.ArcType.GEODESIC?(L=r.CesiumMath.chordLength(b,A.maximumRadius),V=v.PolylinePipeline.numberOfPoints,x=v.PolylinePipeline.generateArc):(L=b,V=v.PolylinePipeline.numberOfPointsRhumbLine,x=v.PolylinePipeline.generateRhumbArc);var S=v.PolylinePipeline.extractHeights(u,A),I=B;if(T===C.ArcType.GEODESIC?I.minDistance=w:I.granularity=b,I.ellipsoid=A,k){var R=0;for(t=0;t<D-1;t++)R+=V(u[t],u[t+1],L)+1;i=new Float64Array(3*R),n=new Uint8Array(4*R),I.positions=P,I.height=_;var O=0;for(t=0;t<D-1;++t){P[0]=u[t],P[1]=u[t+1],_[0]=S[t],_[1]=S[t+1];var M=x(I);if(e.defined(h)){var U=M.length/3;d=h[t];for(var q=0;q<U;++q)n[O++]=m.Color.floatToByte(d.red),n[O++]=m.Color.floatToByte(d.green),n[O++]=m.Color.floatToByte(d.blue),n[O++]=m.Color.floatToByte(d.alpha)}i.set(M,G),G+=M.length}}else if(I.positions=u,I.height=S,i=new Float64Array(x(I)),e.defined(h)){for(n=new Uint8Array(i.length/3*4),t=0;t<D-1;++t){var N=u[t],F=u[t+1],H=h[t],W=h[t+1];G=E(N,F,H,W,w,n,G)}var Y=h[D-1];n[G++]=m.Color.floatToByte(Y.red),n[G++]=m.Color.floatToByte(Y.green),n[G++]=m.Color.floatToByte(Y.blue),n[G++]=m.Color.floatToByte(Y.alpha)}}else{l=k?2*D-2:D,i=new Float64Array(3*l),n=e.defined(h)?new Uint8Array(4*l):void 0;var z=0,J=0;for(t=0;t<D;++t){var j=u[t];if(k&&t>0&&(r.Cartesian3.pack(j,i,z),z+=3,d=h[t-1],n[J++]=m.Color.floatToByte(d.red),n[J++]=m.Color.floatToByte(d.green),n[J++]=m.Color.floatToByte(d.blue),n[J++]=m.Color.floatToByte(d.alpha)),k&&t===D-1)break;r.Cartesian3.pack(j,i,z),z+=3,e.defined(h)&&(d=h[t],n[J++]=m.Color.floatToByte(d.red),n[J++]=m.Color.floatToByte(d.green),n[J++]=m.Color.floatToByte(d.blue),n[J++]=m.Color.floatToByte(d.alpha))}}var K=new c.GeometryAttributes;K.position=new p.GeometryAttribute({componentDatatype:s.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:i}),e.defined(h)&&(K.color=new p.GeometryAttribute({componentDatatype:s.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:4,values:n,normalize:!0})),l=i.length/3;var Q=2*(l-1),X=y.IndexDatatype.createTypedArray(l,Q),Z=0;for(t=0;t<l-1;++t)X[Z++]=t,X[Z++]=t+1;return new p.Geometry({attributes:K,indices:X,primitiveType:f.PrimitiveType.LINES,boundingSphere:a.BoundingSphere.fromPoints(u)})},A}));