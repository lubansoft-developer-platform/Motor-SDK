define(["exports","./when-45f3d25d","./Check-34538dad","./Cartesian3-e69091b9","./Cartesian2-7a44370a","./BoundingSphere-bacc5cb6","./Matrix4-c65e6a1b","./ComponentDatatype-86703c58","./GeometryAttribute-4777d9f4","./PrimitiveType-30fa6f85","./AttributeCompression-1e177d5e","./EncodedCartesian3-7b803d4a","./IndexDatatype-e52361bd","./IntersectionTests-e782669d","./Plane-18e7e6e4"],(function(e,t,r,i,a,n,o,s,u,p,d,l,v,f,m){"use strict";var y=new i.Cartesian3,c=new i.Cartesian3,h=new i.Cartesian3;function C(e,n,o,s,u){var p,d,l,v,f,m,C,b;if(r.Check.defined("point",e),r.Check.defined("p0",n),r.Check.defined("p1",o),r.Check.defined("p2",s),t.defined(u)||(u=new i.Cartesian3),t.defined(n.z)){if(i.Cartesian3.equalsEpsilon(e,n,i.CesiumMath.EPSILON14))return i.Cartesian3.clone(i.Cartesian3.UNIT_X,u);if(i.Cartesian3.equalsEpsilon(e,o,i.CesiumMath.EPSILON14))return i.Cartesian3.clone(i.Cartesian3.UNIT_Y,u);if(i.Cartesian3.equalsEpsilon(e,s,i.CesiumMath.EPSILON14))return i.Cartesian3.clone(i.Cartesian3.UNIT_Z,u);p=i.Cartesian3.subtract(o,n,y),d=i.Cartesian3.subtract(s,n,c),l=i.Cartesian3.subtract(e,n,h),v=i.Cartesian3.dot(p,p),f=i.Cartesian3.dot(p,d),m=i.Cartesian3.dot(p,l),C=i.Cartesian3.dot(d,d),b=i.Cartesian3.dot(d,l)}else{if(a.Cartesian2.equalsEpsilon(e,n,i.CesiumMath.EPSILON14))return i.Cartesian3.clone(i.Cartesian3.UNIT_X,u);if(a.Cartesian2.equalsEpsilon(e,o,i.CesiumMath.EPSILON14))return i.Cartesian3.clone(i.Cartesian3.UNIT_Y,u);if(a.Cartesian2.equalsEpsilon(e,s,i.CesiumMath.EPSILON14))return i.Cartesian3.clone(i.Cartesian3.UNIT_Z,u);p=a.Cartesian2.subtract(o,n,y),d=a.Cartesian2.subtract(s,n,c),l=a.Cartesian2.subtract(e,n,h),v=a.Cartesian2.dot(p,p),f=a.Cartesian2.dot(p,d),m=a.Cartesian2.dot(p,l),C=a.Cartesian2.dot(d,d),b=a.Cartesian2.dot(d,l)}u.y=C*m-f*b,u.z=v*b-f*m;var w=v*C-f*f;return 0!==u.y&&(u.y/=w),0!==u.z&&(u.z/=w),u.x=1-u.y-u.z,u}var b={calculateACMR:function(e){e=t.defaultValue(e,t.defaultValue.EMPTY_OBJECT);var i=e.indices,a=e.maximumIndex,n=t.defaultValue(e.cacheSize,24);if(!t.defined(i))throw new r.DeveloperError("indices is required.");var o=i.length;if(o<3||o%3!==0)throw new r.DeveloperError("indices length must be a multiple of three.");if(a<=0)throw new r.DeveloperError("maximumIndex must be greater than zero.");if(n<3)throw new r.DeveloperError("cacheSize must be greater than two.");if(!t.defined(a)){a=0;var s=0,u=i[s];while(s<o)u>a&&(a=u),++s,u=i[s]}for(var p=[],d=0;d<a+1;d++)p[d]=0;for(var l=n+1,v=0;v<o;++v)l-p[i[v]]>n&&(p[i[v]]=l,++l);return(l-n+1)/(o/3)},tipsify:function(e){e=t.defaultValue(e,t.defaultValue.EMPTY_OBJECT);var i,a=e.indices,n=e.maximumIndex,o=t.defaultValue(e.cacheSize,24);function s(e,t,r,a){while(t.length>=1){var n=t[t.length-1];if(t.splice(t.length-1,1),e[n].numLiveTriangles>0)return n}while(i<a){if(e[i].numLiveTriangles>0)return++i,i-1;++i}return-1}function u(e,t,r,i,a,n,o){var u,p=-1,d=-1,l=0;while(l<r.length){var v=r[l];i[v].numLiveTriangles&&(u=0,a-i[v].timeStamp+2*i[v].numLiveTriangles<=t&&(u=a-i[v].timeStamp),(u>d||-1===d)&&(d=u,p=v)),++l}return-1===p?s(i,n,e,o):p}if(!t.defined(a))throw new r.DeveloperError("indices is required.");var p=a.length;if(p<3||p%3!==0)throw new r.DeveloperError("indices length must be a multiple of three.");if(n<=0)throw new r.DeveloperError("maximumIndex must be greater than zero.");if(o<3)throw new r.DeveloperError("cacheSize must be greater than two.");var d=0,l=0,v=a[l],f=p;if(t.defined(n))d=n+1;else{while(l<f)v>d&&(d=v),++l,v=a[l];if(-1===d)return 0;++d}var m,y=[];for(m=0;m<d;m++)y[m]={numLiveTriangles:0,timeStamp:0,vertexTriangles:[]};l=0;var c=0;while(l<f)y[a[l]].vertexTriangles.push(c),++y[a[l]].numLiveTriangles,y[a[l+1]].vertexTriangles.push(c),++y[a[l+1]].numLiveTriangles,y[a[l+2]].vertexTriangles.push(c),++y[a[l+2]].numLiveTriangles,++c,l+=3;var h=0,C=o+1;i=1;var b,w,g,T,A=[],E=[],D=0,x=[],P=p/3,S=[];for(m=0;m<P;m++)S[m]=!1;while(-1!==h){A=[],w=y[h],T=w.vertexTriangles.length;for(var I=0;I<T;++I)if(c=w.vertexTriangles[I],!S[c]){S[c]=!0,l=c+c+c;for(var N=0;N<3;++N)g=a[l],A.push(g),E.push(g),x[D]=g,++D,b=y[g],--b.numLiveTriangles,C-b.timeStamp>o&&(b.timeStamp=C,++C),++l}h=u(a,o,A,y,C,E,d)}return x}},w={};function g(e,t,r,i,a){e[t++]=r,e[t++]=i,e[t++]=i,e[t++]=a,e[t++]=a,e[t]=r}function T(e){for(var t=e.length,r=t/3*6,i=v.IndexDatatype.createTypedArray(t,r),a=0,n=0;n<t;n+=3,a+=6)g(i,a,e[n],e[n+1],e[n+2]);return i}function A(e){var t=e.length;if(t>=3){var r=6*(t-2),i=v.IndexDatatype.createTypedArray(t,r);g(i,0,e[0],e[1],e[2]);for(var a=6,n=3;n<t;++n,a+=6)g(i,a,e[n-1],e[n],e[n-2]);return i}return new Uint16Array}function E(e){if(e.length>0){for(var t=e.length-1,r=6*(t-1),i=v.IndexDatatype.createTypedArray(t,r),a=e[0],n=0,o=1;o<t;++o,n+=6)g(i,n,a,e[o],e[o+1]);return i}return new Uint16Array}function D(e){var r={};for(var i in e)if(e.hasOwnProperty(i)&&t.defined(e[i])&&t.defined(e[i].values)){var a=e[i];r[i]=new u.GeometryAttribute({componentDatatype:a.componentDatatype,componentsPerAttribute:a.componentsPerAttribute,normalize:a.normalize,values:[]})}return r}function x(e,r,i){for(var a in r)if(r.hasOwnProperty(a)&&t.defined(r[a])&&t.defined(r[a].values))for(var n=r[a],o=0;o<n.componentsPerAttribute;++o)e[a].values.push(n.values[i*n.componentsPerAttribute+o])}w.toWireframe=function(e){if(!t.defined(e))throw new r.DeveloperError("geometry is required.");var i=e.indices;if(t.defined(i)){switch(e.primitiveType){case p.PrimitiveType.TRIANGLES:e.indices=T(i);break;case p.PrimitiveType.TRIANGLE_STRIP:e.indices=A(i);break;case p.PrimitiveType.TRIANGLE_FAN:e.indices=E(i);break;default:throw new r.DeveloperError("geometry.primitiveType must be TRIANGLES, TRIANGLE_STRIP, or TRIANGLE_FAN.")}e.primitiveType=p.PrimitiveType.LINES}return e},w.createLineSegmentsForVectors=function(e,i,a){if(i=t.defaultValue(i,"normal"),!t.defined(e))throw new r.DeveloperError("geometry is required.");if(!t.defined(e.attributes.position))throw new r.DeveloperError("geometry.attributes.position is required.");if(!t.defined(e.attributes[i]))throw new r.DeveloperError("geometry.attributes must have an attribute with the same name as the attributeName parameter, "+i+".");a=t.defaultValue(a,1e4);for(var o,d=e.attributes.position.values,l=e.attributes[i].values,v=d.length,f=new Float64Array(2*v),m=0,y=0;y<v;y+=3)f[m++]=d[y],f[m++]=d[y+1],f[m++]=d[y+2],f[m++]=d[y]+l[y]*a,f[m++]=d[y+1]+l[y+1]*a,f[m++]=d[y+2]+l[y+2]*a;var c=e.boundingSphere;return t.defined(c)&&(o=new n.BoundingSphere(c.center,c.radius+a)),new u.Geometry({attributes:{position:new u.GeometryAttribute({componentDatatype:s.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:f})},primitiveType:p.PrimitiveType.LINES,boundingSphere:o})},w.createAttributeLocations=function(e){if(!t.defined(e))throw new r.DeveloperError("geometry is required.");var i,a=["position","positionHigh","positionLow","position3DHigh","position3DLow","position2DHigh","position2DLow","pickColor","normal","st","tangent","bitangent","extrudeDirection","compressedAttributes"],n=e.attributes,o={},s=0,u=a.length;for(i=0;i<u;++i){var p=a[i];t.defined(n[p])&&(o[p]=s++)}for(var d in n)n.hasOwnProperty(d)&&!t.defined(o[d])&&(o[d]=s++);return o},w.reorderForPreVertexCache=function(e){if(!t.defined(e))throw new r.DeveloperError("geometry is required.");var i=u.Geometry.computeNumberOfVertices(e),a=e.indices;if(t.defined(a)){for(var n=new Int32Array(i),o=0;o<i;o++)n[o]=-1;var p,d=a,l=d.length,f=v.IndexDatatype.createTypedArray(i,l),m=0,y=0,c=0;while(m<l)p=n[d[m]],-1!==p?f[y]=p:(p=d[m],n[p]=c,f[y]=c,++c),++m,++y;e.indices=f;var h=e.attributes;for(var C in h)if(h.hasOwnProperty(C)&&t.defined(h[C])&&t.defined(h[C].values)){var b=h[C],w=b.values,g=0,T=b.componentsPerAttribute,A=s.ComponentDatatype.createTypedArray(b.componentDatatype,c*T);while(g<i){var E=n[g];if(-1!==E)for(var D=0;D<T;D++)A[T*E+D]=w[T*g+D];++g}b.values=A}}return e},w.reorderForPostVertexCache=function(e,i){if(!t.defined(e))throw new r.DeveloperError("geometry is required.");var a=e.indices;if(e.primitiveType===p.PrimitiveType.TRIANGLES&&t.defined(a)){for(var n=a.length,o=0,s=0;s<n;s++)a[s]>o&&(o=a[s]);e.indices=b.tipsify({indices:a,maximumIndex:o,cacheSize:i})}return e},w.fitToUnsignedShortIndices=function(e){if(!t.defined(e))throw new r.DeveloperError("geometry is required.");if(t.defined(e.indices)&&e.primitiveType!==p.PrimitiveType.TRIANGLES&&e.primitiveType!==p.PrimitiveType.LINES&&e.primitiveType!==p.PrimitiveType.POINTS)throw new r.DeveloperError("geometry.primitiveType must equal to PrimitiveType.TRIANGLES, PrimitiveType.LINES, or PrimitiveType.POINTS.");var a=[],n=u.Geometry.computeNumberOfVertices(e);if(t.defined(e.indices)&&n>=i.CesiumMath.SIXTY_FOUR_KILOBYTES){var o,s=[],d=[],l=0,v=D(e.attributes),f=e.indices,m=f.length;e.primitiveType===p.PrimitiveType.TRIANGLES?o=3:e.primitiveType===p.PrimitiveType.LINES?o=2:e.primitiveType===p.PrimitiveType.POINTS&&(o=1);for(var y=0;y<m;y+=o){for(var c=0;c<o;++c){var h=f[y+c],C=s[h];t.defined(C)||(C=l++,s[h]=C,x(v,e.attributes,h)),d.push(C)}l+o>=i.CesiumMath.SIXTY_FOUR_KILOBYTES&&(a.push(new u.Geometry({attributes:v,indices:d,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV})),s=[],d=[],l=0,v=D(e.attributes))}0!==d.length&&a.push(new u.Geometry({attributes:v,indices:d,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV}))}else a.push(e);return a};var P=new i.Cartesian3,S=new a.Cartographic;w.projectTo2D=function(e,a,o,p,d){if(!t.defined(e))throw new r.DeveloperError("geometry is required.");if(!t.defined(a))throw new r.DeveloperError("attributeName is required.");if(!t.defined(o))throw new r.DeveloperError("attributeName3D is required.");if(!t.defined(p))throw new r.DeveloperError("attributeName2D is required.");if(!t.defined(e.attributes[a]))throw new r.DeveloperError("geometry must have attribute matching the attributeName argument: "+a+".");if(e.attributes[a].componentDatatype!==s.ComponentDatatype.DOUBLE)throw new r.DeveloperError("The attribute componentDatatype must be ComponentDatatype.DOUBLE.");var l=e.attributes[a];d=t.defined(d)?d:new n.GeographicProjection;for(var v=d.ellipsoid,f=l.values,m=new Float64Array(f.length),y=0,c=0;c<f.length;c+=3){var h=i.Cartesian3.fromArray(f,c,P),C=v.cartesianToCartographic(h,S);if(!t.defined(C))throw new r.DeveloperError("Could not project point ("+h.x+", "+h.y+", "+h.z+") to 2D.");var b=d.project(C,P);m[y++]=b.x,m[y++]=b.y,m[y++]=b.z}return e.attributes[o]=l,e.attributes[p]=new u.GeometryAttribute({componentDatatype:s.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:m}),delete e.attributes[a],e};var I={high:0,low:0};w.encodeAttribute=function(e,i,a,n){if(!t.defined(e))throw new r.DeveloperError("geometry is required.");if(!t.defined(i))throw new r.DeveloperError("attributeName is required.");if(!t.defined(a))throw new r.DeveloperError("attributeHighName is required.");if(!t.defined(n))throw new r.DeveloperError("attributeLowName is required.");if(!t.defined(e.attributes[i]))throw new r.DeveloperError("geometry must have attribute matching the attributeName argument: "+i+".");if(e.attributes[i].componentDatatype!==s.ComponentDatatype.DOUBLE)throw new r.DeveloperError("The attribute componentDatatype must be ComponentDatatype.DOUBLE.");for(var o=e.attributes[i],p=o.values,d=p.length,v=new Float32Array(d),f=new Float32Array(d),m=0;m<d;++m)l.EncodedCartesian3.encode(p[m],I),v[m]=I.high,f[m]=I.low;var y=o.componentsPerAttribute;return e.attributes[a]=new u.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:y,values:v}),e.attributes[n]=new u.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:y,values:f}),delete e.attributes[i],e};var N=new i.Cartesian3;function O(e,r){if(t.defined(r))for(var a=r.values,n=a.length,s=0;s<n;s+=3)i.Cartesian3.unpack(a,s,N),o.Matrix4.multiplyByPoint(e,N,N),i.Cartesian3.pack(N,a,s)}function L(e,r){if(t.defined(r))for(var a=r.values,n=a.length,s=0;s<n;s+=3)i.Cartesian3.unpack(a,s,N),o.Matrix3.multiplyByVector(e,N,N),N=i.Cartesian3.normalize(N,N),i.Cartesian3.pack(N,a,s)}var z=new o.Matrix4,G=new o.Matrix3;function M(e,r){var i,a=e.length,n={},o=e[0][r].attributes;for(i in o)if(o.hasOwnProperty(i)&&t.defined(o[i])&&t.defined(o[i].values)){for(var p=o[i],d=p.values.length,l=!0,v=1;v<a;++v){var f=e[v][r].attributes[i];if(!t.defined(f)||p.componentDatatype!==f.componentDatatype||p.componentsPerAttribute!==f.componentsPerAttribute||p.normalize!==f.normalize){l=!1;break}d+=f.values.length}l&&(n[i]=new u.GeometryAttribute({componentDatatype:p.componentDatatype,componentsPerAttribute:p.componentsPerAttribute,normalize:p.normalize,values:s.ComponentDatatype.createTypedArray(p.componentDatatype,d)}))}return n}w.transformToWorldCoordinates=function(e){if(!t.defined(e))throw new r.DeveloperError("instance is required.");var i=e.modelMatrix;if(o.Matrix4.equals(i,o.Matrix4.IDENTITY))return e;var a=e.geometry.attributes;O(i,a.position),O(i,a.prevPosition),O(i,a.nextPosition),(t.defined(a.normal)||t.defined(a.tangent)||t.defined(a.bitangent))&&(o.Matrix4.inverse(i,z),o.Matrix4.transpose(z,z),o.Matrix4.getMatrix3(z,G),L(G,a.normal),L(G,a.tangent),L(G,a.bitangent));var s=e.geometry.boundingSphere;return t.defined(s)&&(e.geometry.boundingSphere=n.BoundingSphere.transform(s,i,s)),e.modelMatrix=o.Matrix4.clone(o.Matrix4.IDENTITY),e};var q=new i.Cartesian3;function R(e,a){var s,d,l,f,m=e.length,y=e[0].modelMatrix,c=t.defined(e[0][a].indices),h=e[0][a].primitiveType;for(d=1;d<m;++d){if(!o.Matrix4.equals(e[d].modelMatrix,y))throw new r.DeveloperError("All instances must have the same modelMatrix.");if(t.defined(e[d][a].indices)!==c)throw new r.DeveloperError("All instance geometries must have an indices or not have one.");if(e[d][a].primitiveType!==h)throw new r.DeveloperError("All instance geometries must have the same primitiveType.")}var C,b,w,g,T=M(e,a);for(s in T)if(T.hasOwnProperty(s))for(C=T[s].values,f=0,d=0;d<m;++d)for(b=e[d][a].attributes[s].values,w=b.length,l=0;l<w;++l)C[f++]=b[l];if(c){var A=0;for(d=0;d<m;++d)A+=e[d][a].indices.length;var E=u.Geometry.computeNumberOfVertices(new u.Geometry({attributes:T,primitiveType:p.PrimitiveType.POINTS})),D=v.IndexDatatype.createTypedArray(E,A),x=0,P=0;for(d=0;d<m;++d){var S=e[d][a].indices,I=S.length;for(f=0;f<I;++f)D[x++]=P+S[f];P+=u.Geometry.computeNumberOfVertices(e[d][a])}g=D}var N,O=new i.Cartesian3,L=0;for(d=0;d<m;++d){if(N=e[d][a].boundingSphere,!t.defined(N)){O=void 0;break}i.Cartesian3.add(N.center,O,O)}if(t.defined(O))for(i.Cartesian3.divideByScalar(O,m,O),d=0;d<m;++d){N=e[d][a].boundingSphere;var z=i.Cartesian3.magnitude(i.Cartesian3.subtract(N.center,O,q))+N.radius;z>L&&(L=z)}return new u.Geometry({attributes:T,indices:g,primitiveType:h,boundingSphere:t.defined(O)?new n.BoundingSphere(O,L):void 0})}w.combineInstances=function(e){if(!t.defined(e)||e.length<1)throw new r.DeveloperError("instances is required and must have length greater than zero.");for(var i=[],a=[],n=e.length,o=0;o<n;++o){var s=e[o];t.defined(s.geometry)?i.push(s):t.defined(s.westHemisphereGeometry)&&t.defined(s.eastHemisphereGeometry)&&a.push(s)}var u=[];return i.length>0&&u.push(R(i,"geometry")),a.length>0&&(u.push(R(a,"westHemisphereGeometry")),u.push(R(a,"eastHemisphereGeometry"))),u};var B=new i.Cartesian3,k=new i.Cartesian3,V=new i.Cartesian3,F=new i.Cartesian3;w.computeNormal=function(e){if(!t.defined(e))throw new r.DeveloperError("geometry is required.");if(!t.defined(e.attributes.position)||!t.defined(e.attributes.position.values))throw new r.DeveloperError("geometry.attributes.position.values is required.");if(!t.defined(e.indices))throw new r.DeveloperError("geometry.indices is required.");if(e.indices.length<2||e.indices.length%3!==0)throw new r.DeveloperError("geometry.indices length must be greater than 0 and be a multiple of 3.");if(e.primitiveType!==p.PrimitiveType.TRIANGLES)throw new r.DeveloperError("geometry.primitiveType must be PrimitiveType.TRIANGLES.");var a,n=e.indices,o=e.attributes,d=o.position.values,l=o.position.values.length/3,v=n.length,f=new Array(l),m=new Array(v/3),y=new Array(v);for(a=0;a<l;a++)f[a]={indexOffset:0,count:0,currentCount:0};var c=0;for(a=0;a<v;a+=3){var h=n[a],C=n[a+1],b=n[a+2],w=3*h,g=3*C,T=3*b;k.x=d[w],k.y=d[w+1],k.z=d[w+2],V.x=d[g],V.y=d[g+1],V.z=d[g+2],F.x=d[T],F.y=d[T+1],F.z=d[T+2],f[h].count++,f[C].count++,f[b].count++,i.Cartesian3.subtract(V,k,V),i.Cartesian3.subtract(F,k,F),m[c]=i.Cartesian3.cross(V,F,new i.Cartesian3),c++}var A,E=0;for(a=0;a<l;a++)f[a].indexOffset+=E,E+=f[a].count;for(c=0,a=0;a<v;a+=3){A=f[n[a]];var D=A.indexOffset+A.currentCount;y[D]=c,A.currentCount++,A=f[n[a+1]],D=A.indexOffset+A.currentCount,y[D]=c,A.currentCount++,A=f[n[a+2]],D=A.indexOffset+A.currentCount,y[D]=c,A.currentCount++,c++}var x=new Float32Array(3*l);for(a=0;a<l;a++){var P=3*a;if(A=f[a],i.Cartesian3.clone(i.Cartesian3.ZERO,B),A.count>0){for(c=0;c<A.count;c++)i.Cartesian3.add(B,m[y[A.indexOffset+c]],B);i.Cartesian3.equalsEpsilon(i.Cartesian3.ZERO,B,i.CesiumMath.EPSILON10)&&i.Cartesian3.clone(m[y[A.indexOffset]],B)}i.Cartesian3.equalsEpsilon(i.Cartesian3.ZERO,B,i.CesiumMath.EPSILON10)&&(B.z=1),i.Cartesian3.normalize(B,B),x[P]=B.x,x[P+1]=B.y,x[P+2]=B.z}return e.attributes.normal=new u.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:x}),e};var _=new i.Cartesian3,U=new i.Cartesian3,Y=new i.Cartesian3;w.computeTangentAndBitangent=function(e){if(!t.defined(e))throw new r.DeveloperError("geometry is required.");var a=e.attributes,n=e.indices;if(!t.defined(a.position)||!t.defined(a.position.values))throw new r.DeveloperError("geometry.attributes.position.values is required.");if(!t.defined(a.normal)||!t.defined(a.normal.values))throw new r.DeveloperError("geometry.attributes.normal.values is required.");if(!t.defined(a.st)||!t.defined(a.st.values))throw new r.DeveloperError("geometry.attributes.st.values is required.");if(!t.defined(n))throw new r.DeveloperError("geometry.indices is required.");if(n.length<2||n.length%3!==0)throw new r.DeveloperError("geometry.indices length must be greater than 0 and be a multiple of 3.");if(e.primitiveType!==p.PrimitiveType.TRIANGLES)throw new r.DeveloperError("geometry.primitiveType must be PrimitiveType.TRIANGLES.");var o,d,l,v,f=e.attributes.position.values,m=e.attributes.normal.values,y=e.attributes.st.values,c=e.attributes.position.values.length/3,h=n.length,C=new Array(3*c);for(o=0;o<C.length;o++)C[o]=0;for(o=0;o<h;o+=3){var b=n[o],w=n[o+1],g=n[o+2];d=3*b,l=3*w,v=3*g;var T=2*b,A=2*w,E=2*g,D=f[d],x=f[d+1],P=f[d+2],S=y[T],I=y[T+1],N=y[A+1]-I,O=y[E+1]-I,L=1/((y[A]-S)*O-(y[E]-S)*N),z=(O*(f[l]-D)-N*(f[v]-D))*L,G=(O*(f[l+1]-x)-N*(f[v+1]-x))*L,M=(O*(f[l+2]-P)-N*(f[v+2]-P))*L;C[d]+=z,C[d+1]+=G,C[d+2]+=M,C[l]+=z,C[l+1]+=G,C[l+2]+=M,C[v]+=z,C[v+1]+=G,C[v+2]+=M}var q=new Float32Array(3*c),R=new Float32Array(3*c);for(o=0;o<c;o++){d=3*o,l=d+1,v=d+2;var B=i.Cartesian3.fromArray(m,d,_),k=i.Cartesian3.fromArray(C,d,Y),V=i.Cartesian3.dot(B,k);i.Cartesian3.multiplyByScalar(B,V,U),i.Cartesian3.normalize(i.Cartesian3.subtract(k,U,k),k),q[d]=k.x,q[l]=k.y,q[v]=k.z,i.Cartesian3.normalize(i.Cartesian3.cross(B,k,k),k),R[d]=k.x,R[l]=k.y,R[v]=k.z}return e.attributes.tangent=new u.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:q}),e.attributes.bitangent=new u.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:R}),e};var Z=new a.Cartesian2,H=new i.Cartesian3,W=new i.Cartesian3,X=new i.Cartesian3,j=new a.Cartesian2;function J(e){if(t.defined(e.indices))return e;var i=u.Geometry.computeNumberOfVertices(e);if(i<3)throw new r.DeveloperError("The number of vertices must be at least three.");if(i%3!==0)throw new r.DeveloperError("The number of vertices must be a multiple of three.");for(var a=v.IndexDatatype.createTypedArray(i,i),n=0;n<i;++n)a[n]=n;return e.indices=a,e}function K(e){var t=u.Geometry.computeNumberOfVertices(e);if(t<3)throw new r.DeveloperError("The number of vertices must be at least three.");var i=v.IndexDatatype.createTypedArray(t,3*(t-2));i[0]=1,i[1]=0,i[2]=2;for(var a=3,n=3;n<t;++n)i[a++]=n-1,i[a++]=0,i[a++]=n;return e.indices=i,e.primitiveType=p.PrimitiveType.TRIANGLES,e}function Q(e){var t=u.Geometry.computeNumberOfVertices(e);if(t<3)throw new r.DeveloperError("The number of vertices must be at least 3.");var i=v.IndexDatatype.createTypedArray(t,3*(t-2));i[0]=0,i[1]=1,i[2]=2,t>3&&(i[3]=0,i[4]=2,i[5]=3);for(var a=6,n=3;n<t-1;n+=2)i[a++]=n,i[a++]=n-1,i[a++]=n+1,n+2<t&&(i[a++]=n,i[a++]=n+1,i[a++]=n+2);return e.indices=i,e.primitiveType=p.PrimitiveType.TRIANGLES,e}function $(e){if(t.defined(e.indices))return e;var i=u.Geometry.computeNumberOfVertices(e);if(i<2)throw new r.DeveloperError("The number of vertices must be at least two.");if(i%2!==0)throw new r.DeveloperError("The number of vertices must be a multiple of 2.");for(var a=v.IndexDatatype.createTypedArray(i,i),n=0;n<i;++n)a[n]=n;return e.indices=a,e}function ee(e){var t=u.Geometry.computeNumberOfVertices(e);if(t<2)throw new r.DeveloperError("The number of vertices must be at least two.");var i=v.IndexDatatype.createTypedArray(t,2*(t-1));i[0]=0,i[1]=1;for(var a=2,n=2;n<t;++n)i[a++]=n-1,i[a++]=n;return e.indices=i,e.primitiveType=p.PrimitiveType.LINES,e}function te(e){var t=u.Geometry.computeNumberOfVertices(e);if(t<2)throw new r.DeveloperError("The number of vertices must be at least two.");var i=v.IndexDatatype.createTypedArray(t,2*t);i[0]=0,i[1]=1;for(var a=2,n=2;n<t;++n)i[a++]=n-1,i[a++]=n;return i[a++]=t-1,i[a]=0,e.indices=i,e.primitiveType=p.PrimitiveType.LINES,e}function re(e){switch(e.primitiveType){case p.PrimitiveType.TRIANGLE_FAN:return K(e);case p.PrimitiveType.TRIANGLE_STRIP:return Q(e);case p.PrimitiveType.TRIANGLES:return J(e);case p.PrimitiveType.LINE_STRIP:return ee(e);case p.PrimitiveType.LINE_LOOP:return te(e);case p.PrimitiveType.LINES:return $(e)}return e}function ie(e,t){Math.abs(e.y)<i.CesiumMath.EPSILON6&&(e.y=t?-i.CesiumMath.EPSILON6:i.CesiumMath.EPSILON6)}function ae(e,t,r){if(0!==e.y&&0!==t.y&&0!==r.y)return ie(e,e.y<0),ie(t,t.y<0),void ie(r,r.y<0);var a,n=Math.abs(e.y),o=Math.abs(t.y),s=Math.abs(r.y);a=n>o?n>s?i.CesiumMath.sign(e.y):i.CesiumMath.sign(r.y):o>s?i.CesiumMath.sign(t.y):i.CesiumMath.sign(r.y);var u=a<0;ie(e,u),ie(t,u),ie(r,u)}w.compressVertices=function(e){if(!t.defined(e))throw new r.DeveloperError("geometry is required.");var n,o,p=e.attributes.extrudeDirection;if(t.defined(p)){var l=p.values;o=l.length/3;var v=new Float32Array(2*o),f=0;for(n=0;n<o;++n)i.Cartesian3.fromArray(l,3*n,H),i.Cartesian3.equals(H,i.Cartesian3.ZERO)?f+=2:(j=d.AttributeCompression.octEncodeInRange(H,65535,j),v[f++]=j.x,v[f++]=j.y);return e.attributes.compressedAttributes=new u.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:v}),delete e.attributes.extrudeDirection,e}var m=e.attributes.normal,y=e.attributes.st,c=t.defined(m),h=t.defined(y);if(!c&&!h)return e;var C,b,w,g,T=e.attributes.tangent,A=e.attributes.bitangent,E=t.defined(T),D=t.defined(A);c&&(C=m.values),h&&(b=y.values),E&&(w=T.values),D&&(g=A.values);var x=c?C.length:b.length,P=c?3:2;o=x/P;var S=o,I=h&&c?2:1;I+=E||D?1:0,S*=I;var N=new Float32Array(S),O=0;for(n=0;n<o;++n){h&&(a.Cartesian2.fromArray(b,2*n,Z),N[O++]=d.AttributeCompression.compressTextureCoordinates(Z));var L=3*n;c&&t.defined(w)&&t.defined(g)?(i.Cartesian3.fromArray(C,L,H),i.Cartesian3.fromArray(w,L,W),i.Cartesian3.fromArray(g,L,X),d.AttributeCompression.octPack(H,W,X,Z),N[O++]=Z.x,N[O++]=Z.y):(c&&(i.Cartesian3.fromArray(C,L,H),N[O++]=d.AttributeCompression.octEncodeFloat(H)),E&&(i.Cartesian3.fromArray(w,L,H),N[O++]=d.AttributeCompression.octEncodeFloat(H)),D&&(i.Cartesian3.fromArray(g,L,H),N[O++]=d.AttributeCompression.octEncodeFloat(H)))}return e.attributes.compressedAttributes=new u.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:I,values:N}),c&&delete e.attributes.normal,h&&delete e.attributes.st,D&&delete e.attributes.bitangent,E&&delete e.attributes.tangent,e};var ne=new i.Cartesian3;function oe(e,t,r,a){i.Cartesian3.add(e,i.Cartesian3.multiplyByScalar(i.Cartesian3.subtract(t,e,ne),e.y/(e.y-t.y),ne),r),i.Cartesian3.clone(r,a),ie(r,!0),ie(a,!1)}var se=new i.Cartesian3,ue=new i.Cartesian3,pe=new i.Cartesian3,de=new i.Cartesian3,le={positions:new Array(7),indices:new Array(9)};function ve(e,t,r){if(!(e.x>=0||t.x>=0||r.x>=0)){ae(e,t,r);var i=e.y<0,a=t.y<0,n=r.y<0,o=0;o+=i?1:0,o+=a?1:0,o+=n?1:0;var s=le.indices;1===o?(s[1]=3,s[2]=4,s[5]=6,s[7]=6,s[8]=5,i?(oe(e,t,se,pe),oe(e,r,ue,de),s[0]=0,s[3]=1,s[4]=2,s[6]=1):a?(oe(t,r,se,pe),oe(t,e,ue,de),s[0]=1,s[3]=2,s[4]=0,s[6]=2):n&&(oe(r,e,se,pe),oe(r,t,ue,de),s[0]=2,s[3]=0,s[4]=1,s[6]=0)):2===o&&(s[2]=4,s[4]=4,s[5]=3,s[7]=5,s[8]=6,i?a?n||(oe(r,e,se,pe),oe(r,t,ue,de),s[0]=0,s[1]=1,s[3]=0,s[6]=2):(oe(t,r,se,pe),oe(t,e,ue,de),s[0]=2,s[1]=0,s[3]=2,s[6]=1):(oe(e,t,se,pe),oe(e,r,ue,de),s[0]=1,s[1]=2,s[3]=1,s[6]=0));var u=le.positions;return u[0]=e,u[1]=t,u[2]=r,u.length=3,1!==o&&2!==o||(u[3]=se,u[4]=ue,u[5]=pe,u[6]=de,u.length=7),le}}function fe(e,r){var i=e.attributes;if(0!==i.position.values.length){for(var a in i)if(i.hasOwnProperty(a)&&t.defined(i[a])&&t.defined(i[a].values)){var o=i[a];o.values=s.ComponentDatatype.createTypedArray(o.componentDatatype,o.values)}var p=u.Geometry.computeNumberOfVertices(e);return e.indices=v.IndexDatatype.createTypedArray(p,e.indices),r&&(e.boundingSphere=n.BoundingSphere.fromVertices(i.position.values)),e}}function me(e){var r=e.attributes,i={};for(var a in r)if(r.hasOwnProperty(a)&&t.defined(r[a])&&t.defined(r[a].values)){var n=r[a];i[a]=new u.GeometryAttribute({componentDatatype:n.componentDatatype,componentsPerAttribute:n.componentsPerAttribute,normalize:n.normalize,values:[]})}return new u.Geometry({attributes:i,indices:[],primitiveType:e.primitiveType})}function ye(e,r,i){var a=t.defined(e.geometry.boundingSphere);r=fe(r,a),i=fe(i,a),t.defined(i)&&!t.defined(r)?e.geometry=i:!t.defined(i)&&t.defined(r)?e.geometry=r:(e.westHemisphereGeometry=r,e.eastHemisphereGeometry=i,e.geometry=void 0)}function ce(e,t){var r=new e,i=new e,a=new e;return function(n,o,s,u,p,d,l,v){var f=e.fromArray(p,n*t,r),m=e.fromArray(p,o*t,i),y=e.fromArray(p,s*t,a);e.multiplyByScalar(f,u.x,f),e.multiplyByScalar(m,u.y,m),e.multiplyByScalar(y,u.z,y);var c=e.add(f,m,f);e.add(c,y,c),v&&e.normalize(c,c),e.pack(c,d,l*t)}}var he=ce(o.Cartesian4,4),Ce=ce(i.Cartesian3,3),be=ce(a.Cartesian2,2),we=function(e,t,r,a,n,o,s){var u=n[e]*a.x,p=n[t]*a.y,d=n[r]*a.z;o[s]=u+p+d>i.CesiumMath.EPSILON6?1:0},ge=new i.Cartesian3,Te=new i.Cartesian3,Ae=new i.Cartesian3,Ee=new i.Cartesian3;function De(e,r,a,n,o,s,u,p,d,l,v,f,m,y,c,h){if(t.defined(s)||t.defined(u)||t.defined(p)||t.defined(d)||t.defined(l)||0!==y){var b=i.Cartesian3.fromArray(o,3*e,ge),w=i.Cartesian3.fromArray(o,3*r,Te),g=i.Cartesian3.fromArray(o,3*a,Ae),T=C(n,b,w,g,Ee);if(t.defined(s)&&Ce(e,r,a,T,s,f.normal.values,h,!0),t.defined(l)){var A,E=i.Cartesian3.fromArray(l,3*e,ge),D=i.Cartesian3.fromArray(l,3*r,Te),x=i.Cartesian3.fromArray(l,3*a,Ae);i.Cartesian3.multiplyByScalar(E,T.x,E),i.Cartesian3.multiplyByScalar(D,T.y,D),i.Cartesian3.multiplyByScalar(x,T.z,x),i.Cartesian3.equals(E,i.Cartesian3.ZERO)&&i.Cartesian3.equals(D,i.Cartesian3.ZERO)&&i.Cartesian3.equals(x,i.Cartesian3.ZERO)?(A=ge,A.x=0,A.y=0,A.z=0):(A=i.Cartesian3.add(E,D,E),i.Cartesian3.add(A,x,A),i.Cartesian3.normalize(A,A)),i.Cartesian3.pack(A,f.extrudeDirection.values,3*h)}if(t.defined(v)&&we(e,r,a,T,v,f.applyOffset.values,h),t.defined(u)&&Ce(e,r,a,T,u,f.tangent.values,h,!0),t.defined(p)&&Ce(e,r,a,T,p,f.bitangent.values,h,!0),t.defined(d)&&be(e,r,a,T,d,f.st.values,h),y>0)for(var P=0;P<y;P++){var S=m[P];xe(e,r,a,T,h,c[S],f[S])}}}function xe(e,t,r,i,a,n,o){var s=n.componentsPerAttribute,u=n.values,p=o.values;switch(s){case 4:he(e,t,r,i,u,p,a,!1);break;case 3:Ce(e,t,r,i,u,p,a,!1);break;case 2:be(e,t,r,i,u,p,a,!1);break;default:p[a]=u[e]*i.x+u[t]*i.y+u[r]*i.z}}function Pe(e,t,r,i,a,n){var o=e.position.values.length/3;if(-1!==a){var s=i[a],u=r[s];return-1===u?(r[s]=o,e.position.values.push(n.x,n.y,n.z),t.push(o),o):(t.push(u),u)}return e.position.values.push(n.x,n.y,n.z),t.push(o),o}var Se={position:!0,normal:!0,bitangent:!0,tangent:!0,st:!0,extrudeDirection:!0,applyOffset:!0};function Ie(e){var r=e.geometry,a=r.attributes,n=a.position.values,o=t.defined(a.normal)?a.normal.values:void 0,s=t.defined(a.bitangent)?a.bitangent.values:void 0,u=t.defined(a.tangent)?a.tangent.values:void 0,p=t.defined(a.st)?a.st.values:void 0,d=t.defined(a.extrudeDirection)?a.extrudeDirection.values:void 0,l=t.defined(a.applyOffset)?a.applyOffset.values:void 0,v=r.indices,f=[];for(var m in a)a.hasOwnProperty(m)&&!Se[m]&&t.defined(a[m])&&f.push(m);var y,c,h,C,b,w=f.length,g=me(r),T=me(r),A=[];A.length=n.length/3;var E=[];for(E.length=n.length/3,b=0;b<A.length;++b)A[b]=-1,E[b]=-1;var D=v.length;for(b=0;b<D;b+=3){var x=v[b],P=v[b+1],S=v[b+2],I=i.Cartesian3.fromArray(n,3*x),N=i.Cartesian3.fromArray(n,3*P),O=i.Cartesian3.fromArray(n,3*S),L=ve(I,N,O);if(t.defined(L)&&L.positions.length>3)for(var z=L.positions,G=L.indices,M=G.length,q=0;q<M;++q){var R=G[q],B=z[R];B.y<0?(y=T.attributes,c=T.indices,h=A):(y=g.attributes,c=g.indices,h=E),C=Pe(y,c,h,v,R<3?b+R:-1,B),De(x,P,S,B,n,o,u,s,p,d,l,y,f,w,a,C)}else t.defined(L)&&(I=L.positions[0],N=L.positions[1],O=L.positions[2]),I.y<0?(y=T.attributes,c=T.indices,h=A):(y=g.attributes,c=g.indices,h=E),C=Pe(y,c,h,v,b,I),De(x,P,S,I,n,o,u,s,p,d,l,y,f,w,a,C),C=Pe(y,c,h,v,b+1,N),De(x,P,S,N,n,o,u,s,p,d,l,y,f,w,a,C),C=Pe(y,c,h,v,b+2,O),De(x,P,S,O,n,o,u,s,p,d,l,y,f,w,a,C)}ye(e,T,g)}var Ne=m.Plane.fromPointNormal(i.Cartesian3.ZERO,i.Cartesian3.UNIT_Y),Oe=new i.Cartesian3,Le=new i.Cartesian3;function ze(e,r,a,n,o,s,u){if(t.defined(u)){var p=i.Cartesian3.fromArray(n,3*e,ge);i.Cartesian3.equalsEpsilon(p,a,i.CesiumMath.EPSILON10)?s.applyOffset.values[o]=u[e]:s.applyOffset.values[o]=u[r]}}function Ge(e){var r,a=e.geometry,n=a.attributes,o=n.position.values,s=t.defined(n.applyOffset)?n.applyOffset.values:void 0,u=a.indices,p=me(a),d=me(a),l=u.length,v=[];v.length=o.length/3;var m=[];for(m.length=o.length/3,r=0;r<v.length;++r)v[r]=-1,m[r]=-1;for(r=0;r<l;r+=2){var y,c=u[r],h=u[r+1],C=i.Cartesian3.fromArray(o,3*c,ge),b=i.Cartesian3.fromArray(o,3*h,Te);Math.abs(C.y)<i.CesiumMath.EPSILON6&&(C.y<0?C.y=-i.CesiumMath.EPSILON6:C.y=i.CesiumMath.EPSILON6),Math.abs(b.y)<i.CesiumMath.EPSILON6&&(b.y<0?b.y=-i.CesiumMath.EPSILON6:b.y=i.CesiumMath.EPSILON6);var w=p.attributes,g=p.indices,T=m,A=d.attributes,E=d.indices,D=v,x=f.IntersectionTests.lineSegmentPlane(C,b,Ne,Ae);if(t.defined(x)){var P=i.Cartesian3.multiplyByScalar(i.Cartesian3.UNIT_Y,5*i.CesiumMath.EPSILON9,Oe);C.y<0&&(i.Cartesian3.negate(P,P),w=d.attributes,g=d.indices,T=v,A=p.attributes,E=p.indices,D=m);var S=i.Cartesian3.add(x,P,Le);y=Pe(w,g,T,u,r,C),ze(c,h,C,o,y,w,s),y=Pe(w,g,T,u,-1,S),ze(c,h,S,o,y,w,s),i.Cartesian3.negate(P,P),i.Cartesian3.add(x,P,S),y=Pe(A,E,D,u,-1,S),ze(c,h,S,o,y,A,s),y=Pe(A,E,D,u,r+1,b),ze(c,h,b,o,y,A,s)}else{var I,N,O;C.y<0?(I=d.attributes,N=d.indices,O=v):(I=p.attributes,N=p.indices,O=m),y=Pe(I,N,O,u,r,C),ze(c,h,C,o,y,I,s),y=Pe(I,N,O,u,r+1,b),ze(c,h,b,o,y,I,s)}}ye(e,d,p)}var Me=new a.Cartesian2,qe=new a.Cartesian2,Re=new i.Cartesian3,Be=new i.Cartesian3,ke=new i.Cartesian3,Ve=new i.Cartesian3,Fe=new i.Cartesian3,_e=new i.Cartesian3,Ue=new o.Cartesian4;function Ye(e){for(var t=e.attributes,r=t.position.values,a=t.prevPosition.values,n=t.nextPosition.values,o=r.length,s=0;s<o;s+=3){var u=i.Cartesian3.unpack(r,s,Re);if(!(u.x>0)){var p=i.Cartesian3.unpack(a,s,Be);(u.y<0&&p.y>0||u.y>0&&p.y<0)&&(s-3>0?(a[s]=r[s-3],a[s+1]=r[s-2],a[s+2]=r[s-1]):i.Cartesian3.pack(u,a,s));var d=i.Cartesian3.unpack(n,s,ke);(u.y<0&&d.y>0||u.y>0&&d.y<0)&&(s+3<o?(n[s]=r[s+3],n[s+1]=r[s+4],n[s+2]=r[s+5]):i.Cartesian3.pack(u,n,s))}}}var Ze=5*i.CesiumMath.EPSILON9,He=i.CesiumMath.EPSILON6;function We(e){var r,n,s,u=e.geometry,p=u.attributes,d=p.position.values,l=p.prevPosition.values,v=p.nextPosition.values,m=p.expandAndWidth.values,y=t.defined(p.st)?p.st.values:void 0,c=t.defined(p.color)?p.color.values:void 0,h=me(u),C=me(u),b=!1,w=d.length/3;for(r=0;r<w;r+=4){var g=r,T=r+2,A=i.Cartesian3.fromArray(d,3*g,Re),E=i.Cartesian3.fromArray(d,3*T,Be);if(Math.abs(A.y)<He)for(A.y=He*(E.y<0?-1:1),d[3*r+1]=A.y,d[3*(r+1)+1]=A.y,n=3*g;n<3*g+12;n+=3)l[n]=d[3*r],l[n+1]=d[3*r+1],l[n+2]=d[3*r+2];if(Math.abs(E.y)<He)for(E.y=He*(A.y<0?-1:1),d[3*(r+2)+1]=E.y,d[3*(r+3)+1]=E.y,n=3*g;n<3*g+12;n+=3)v[n]=d[3*(r+2)],v[n+1]=d[3*(r+2)+1],v[n+2]=d[3*(r+2)+2];var D=h.attributes,x=h.indices,P=C.attributes,S=C.indices,I=f.IntersectionTests.lineSegmentPlane(A,E,Ne,Ve);if(t.defined(I)){b=!0;var N=i.Cartesian3.multiplyByScalar(i.Cartesian3.UNIT_Y,Ze,Fe);A.y<0&&(i.Cartesian3.negate(N,N),D=C.attributes,x=C.indices,P=h.attributes,S=h.indices);var O=i.Cartesian3.add(I,N,_e);D.position.values.push(A.x,A.y,A.z,A.x,A.y,A.z),D.position.values.push(O.x,O.y,O.z),D.position.values.push(O.x,O.y,O.z),D.prevPosition.values.push(l[3*g],l[3*g+1],l[3*g+2]),D.prevPosition.values.push(l[3*g+3],l[3*g+4],l[3*g+5]),D.prevPosition.values.push(A.x,A.y,A.z,A.x,A.y,A.z),D.nextPosition.values.push(O.x,O.y,O.z),D.nextPosition.values.push(O.x,O.y,O.z),D.nextPosition.values.push(O.x,O.y,O.z),D.nextPosition.values.push(O.x,O.y,O.z),i.Cartesian3.negate(N,N),i.Cartesian3.add(I,N,O),P.position.values.push(O.x,O.y,O.z),P.position.values.push(O.x,O.y,O.z),P.position.values.push(E.x,E.y,E.z,E.x,E.y,E.z),P.prevPosition.values.push(O.x,O.y,O.z),P.prevPosition.values.push(O.x,O.y,O.z),P.prevPosition.values.push(O.x,O.y,O.z),P.prevPosition.values.push(O.x,O.y,O.z),P.nextPosition.values.push(E.x,E.y,E.z,E.x,E.y,E.z),P.nextPosition.values.push(v[3*T],v[3*T+1],v[3*T+2]),P.nextPosition.values.push(v[3*T+3],v[3*T+4],v[3*T+5]);var L=a.Cartesian2.fromArray(m,2*g,Me),z=Math.abs(L.y);D.expandAndWidth.values.push(-1,z,1,z),D.expandAndWidth.values.push(-1,-z,1,-z),P.expandAndWidth.values.push(-1,z,1,z),P.expandAndWidth.values.push(-1,-z,1,-z);var G=i.Cartesian3.magnitudeSquared(i.Cartesian3.subtract(I,A,ke));if(G/=i.Cartesian3.magnitudeSquared(i.Cartesian3.subtract(E,A,ke)),t.defined(c)){var M=o.Cartesian4.fromArray(c,4*g,Ue),q=o.Cartesian4.fromArray(c,4*T,Ue),R=i.CesiumMath.lerp(M.x,q.x,G),B=i.CesiumMath.lerp(M.y,q.y,G),k=i.CesiumMath.lerp(M.z,q.z,G),V=i.CesiumMath.lerp(M.w,q.w,G);for(n=4*g;n<4*g+8;++n)D.color.values.push(c[n]);for(D.color.values.push(R,B,k,V),D.color.values.push(R,B,k,V),P.color.values.push(R,B,k,V),P.color.values.push(R,B,k,V),n=4*T;n<4*T+8;++n)P.color.values.push(c[n])}if(t.defined(y)){var F=a.Cartesian2.fromArray(y,2*g,Me),_=a.Cartesian2.fromArray(y,2*(r+3),qe),U=i.CesiumMath.lerp(F.x,_.x,G);for(n=2*g;n<2*g+4;++n)D.st.values.push(y[n]);for(D.st.values.push(U,F.y),D.st.values.push(U,_.y),P.st.values.push(U,F.y),P.st.values.push(U,_.y),n=2*T;n<2*T+4;++n)P.st.values.push(y[n])}s=D.position.values.length/3-4,x.push(s,s+2,s+1),x.push(s+1,s+2,s+3),s=P.position.values.length/3-4,S.push(s,s+2,s+1),S.push(s+1,s+2,s+3)}else{var Y,Z;for(A.y<0?(Y=C.attributes,Z=C.indices):(Y=h.attributes,Z=h.indices),Y.position.values.push(A.x,A.y,A.z),Y.position.values.push(A.x,A.y,A.z),Y.position.values.push(E.x,E.y,E.z),Y.position.values.push(E.x,E.y,E.z),n=3*r;n<3*r+12;++n)Y.prevPosition.values.push(l[n]),Y.nextPosition.values.push(v[n]);for(n=2*r;n<2*r+8;++n)Y.expandAndWidth.values.push(m[n]),t.defined(y)&&Y.st.values.push(y[n]);if(t.defined(c))for(n=4*r;n<4*r+16;++n)Y.color.values.push(c[n]);s=Y.position.values.length/3-4,Z.push(s,s+2,s+1),Z.push(s+1,s+2,s+3)}}b&&(Ye(C),Ye(h)),ye(e,C,h)}w.splitLongitude=function(e){if(!t.defined(e))throw new r.DeveloperError("instance is required.");var i=e.geometry,a=i.boundingSphere;if(t.defined(a)){var o=a.center.x-a.radius;if(o>0||n.BoundingSphere.intersectPlane(a,m.Plane.ORIGIN_ZX_PLANE)!==n.Intersect.INTERSECTING)return e}if(i.geometryType!==u.GeometryType.NONE)switch(i.geometryType){case u.GeometryType.POLYLINES:We(e);break;case u.GeometryType.TRIANGLES:Ie(e);break;case u.GeometryType.LINES:Ge(e);break}else re(i),i.primitiveType===p.PrimitiveType.TRIANGLES?Ie(e):i.primitiveType===p.PrimitiveType.LINES&&Ge(e);return e},e.GeometryPipeline=w}));