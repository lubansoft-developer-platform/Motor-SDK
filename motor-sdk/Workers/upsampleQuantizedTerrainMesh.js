define(["./when-45f3d25d","./Check-34538dad","./Cartesian3-eab74dc0","./Cartesian2-174fefc1","./BoundingSphere-37359cf8","./Transforms-6b57162d","./Matrix4-ed224189","./RuntimeError-86da6af2","./WebGLConstants-3660bc8f","./ComponentDatatype-86703c58","./GeometryAttribute-b1ed7c2e","./PrimitiveType-30fa6f85","./AttributeCompression-6e02a904","./IndexDatatype-cb635cbc","./IntersectionTests-a310845d","./Plane-87957166","./createTaskProcessorWorker","./AxisAlignedBoundingBox-804b7aeb","./EllipsoidTangentPlane-37f60f7a","./OrientedBoundingBox-f9a274cd","./EllipsoidRhumbLine-de5cdc57","./PolygonPipeline-b585c3c1","./materem-cccd3124","./EmWrapperManager-83011cae","./TerrainEncoding-2d0e3daf","./EmLBDeal-9210927a"],(function(e,n,r,t,i,f,a,u,o,s,h,l,d,c,g,B,p,m,v,C,w,b,y,x,E,A){"use strict";var M=32767,P=M/2|0,T=[],O=new t.Cartographic,I=new r.Cartesian3,S=[],W=[],H=[],R=[],k=[],D=new r.Cartesian3,L=new i.BoundingSphere,N=new C.OrientedBoundingBox,z=new t.Cartesian2,U=new r.Cartesian3;function V(n,r,t,i,f){var a=n.uBuffer.length,u=0,o=t[i]-t[f];Math.abs(o)>1e-9&&(u=t[i]/(t[i]-t[f]));var s=n.uBuffer[r[i]],h=n.vBuffer[r[i]],l=n.hBuffer[r[i]],d=n.uBuffer[r[f]],c=n.vBuffer[r[f]],g=n.hBuffer[r[f]];if(d=s+u*(d-s),c=h+u*(c-h),g=l+u*(g-l),n.uBuffer.push(d),n.vBuffer.push(c),n.hBuffer.push(g),e.defined(n.nBuffer)){var B=n.nBuffer[2*r[i]],p=n.nBuffer[2*r[i]+1],m=n.nBuffer[2*r[f]],v=n.nBuffer[2*r[f]+1];m=B+u*(m-B),v=p+u*(v-p),n.nBuffer.push(m),n.nBuffer.push(v)}return a}function j(e,n,r,t,i){var f=0,a=0,u=0,o=[];o.length=32;var s=function(){o[f]=V(e,n,r,u,a),f++},h=function(){o[f]=n[a],f++};if(t>0){a=t,u=a-1,s();while(a<i&&r[a]>=0)h(),a++;a<i?u=a-1:(a=0,u=i-1),s()}else{a=0;while(a<i&&r[a]>=0)h(),a++;u=a-1,s();while(a<i&&r[a]<0)a++;if(a<i){u=a-1,s();while(a<i&&r[a]>=0)h(),a++}else a=0,u=i-1,s()}i=f;for(let l=0;l<f;l++)n[l]=o[l];return i}function F(e,n,r,t){var i=0,f=0,a=-1,u=[];u.length=32;for(let o=0;o<r;o++){const r=n.uBuffer[t[o]],s=n.vBuffer[t[o]],h=n.hBuffer[t[o]];u[o]=r*e.x+s*e.y+h*e.z+e.w,u[o]>1e-9?(i++,a<0&&(a=o)):u[o]<-1e-9&&f++}return 0===i&&f>0?(r=0,r):i>=0&&0===f?r:j(n,t,u,a,r)}function G(e,n,r,t,i,f,u){var o=[new a.Cartesian4(1,0,0,-e),new a.Cartesian4(-1,0,0,r),new a.Cartesian4(0,1,0,-n),new a.Cartesian4(0,-1,0,t)];for(let a=0;a<4;a++)if(u=F(o[a],i,u,f),u<3)return u;return u}function X(n,r,t,i,f,a,u,o){var s=a.length/3,h=[];for(let e=0;e<s;++e){let u=3,o=[];if(o.length=32,o[0]=a[3*e],o[1]=a[3*e+1],o[2]=a[3*e+2],u=G(n,r,t,i,f,o,u),u>=3){let e=u-2;for(let n=1;n<=e;++n)h.push(o[0]),h.push(o[n]),h.push(o[n+1])}}var l=[],d=[];l.length=f.uBuffer.length,d.length=l.length;for(let e=0;e<l.length;e++)l[e]=!0,d[e]=-1;for(let e=0;e<h.length;e++)l[h[e]]=!1;for(let g=0,B=0;g<l.length;++g)l[g]||(d[g]=B,B++,u.uBuffer.push(f.uBuffer[g]),u.vBuffer.push(f.vBuffer[g]),u.hBuffer.push(f.hBuffer[g]),e.defined(f.nBuffer)&&(u.nBuffer.push(f.nBuffer[2*g]),u.nBuffer.push(f.nBuffer[2*g+1])));let c=h.length;for(let e=0;e<c;++e)o.push(d[h[e]])}function Z(n,f){var a=n.isEastChild,u=n.isNorthChild,o=a?P:0,s=a?M:P,h=u?P:0,l=u?M:P,d=S,g=W,B=H,p=k;d.length=0,g.length=0,B.length=0,p.length=0;var m=R;m.length=0;var v=n.vertices,w=n.indices;w=w.subarray(0,n.indexCountWithoutSkirts);var b,y,x,V,j,F=E.TerrainEncoding.clone(n.encoding),G=F.hasVertexNormals,Z=n.exaggeration,_=n.vertexCountWithoutSkirts,Y=n.minimumHeight,q=n.maximumHeight,J=new Array(_),K=new Array(_),Q=new Array(_),$=G?new Array(2*_):void 0,ee=20;for(y=0,x=0;y<_;++y,x+=2){var ne=F.decodeTextureCoordinates(v,y,z);if(b=F.decodeHeight(v,y)/Z,V=r.CesiumMath.clamp(ne.x*M|0,0,M),j=r.CesiumMath.clamp(ne.y*M|0,0,M),Q[y]=r.CesiumMath.clamp((b-Y)/(q-Y)*M|0,0,M),V<ee&&(V=0),j<ee&&(j=0),M-V<ee&&(V=M),M-j<ee&&(j=M),J[y]=V,K[y]=j,G){var re=F.getOctEncodedNormal(v,y,U);$[x]=re.x,$[x+1]=re.y}}var te={uBuffer:J,vBuffer:K,hBuffer:Q,nBuffer:$},ie={uBuffer:d,vBuffer:g,hBuffer:B,nBuffer:p};X(o,h,s,l,te,w,ie,m);var fe=a?-M:0,ae=u?-M:0,ue=[],oe=[],se=[],he=[],le=Number.MAX_VALUE,de=-le,ce=T;ce.length=0;var ge,Be=t.Ellipsoid.clone(n.ellipsoid),pe=t.Rectangle.clone(n.childRectangle),me=pe.north,ve=pe.south,Ce=pe.east,we=pe.west;if(Ce<we&&(Ce+=r.CesiumMath.TWO_PI),n.isPlaneMode){var be=n.projectionString,ye=n.dCenX,xe=n.dCenY,Ee=n.dCenZ;ge=new A.EmLBDeal;var Ae=ge.init(be,new r.Cartesian3(ye,xe,Ee));Ae||(ge.destroy(),ge=void 0)}for(y=0;y<d.length;++y)V=Math.round(d[y]),V<=o?(ue.push(y),V=0):V>=s?(se.push(y),V=M):V=2*V+fe,d[y]=V,j=Math.round(g[y]),j<=h?(oe.push(y),j=0):j>=l?(he.push(y),j=M):j=2*j+ae,g[y]=j,b=r.CesiumMath.lerp(Y,q,B[y]/M),b<le&&(le=b),b>de&&(de=b),B[y]=b,O.longitude=r.CesiumMath.lerp(we,Ce,V/M),O.latitude=r.CesiumMath.lerp(ve,me,j/M),O.height=b,Be.cartographicToCartesian(O,I),e.defined(ge)&&ge.computeCartesianToProj(I,!1,void 0,I),ce.push(I.x),ce.push(I.y),ce.push(I.z);var Me,Pe,Te=i.BoundingSphere.fromVertices(ce,r.Cartesian3.ZERO,3,L);if(e.defined(ge))Me=C.OrientedBoundingBox.fromPoints(Te.getCornerAry()),Pe=new r.Cartesian3;else{Me=C.OrientedBoundingBox.fromRectangle(pe,le,de,Be,N);var Oe=new E.EllipsoidalOccluder(Be);Pe=Oe.computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(Te.center,ce,3,Te.center,le,D)}var Ie=de-le,Se=new Uint16Array(d.length+g.length+B.length);for(y=0;y<d.length;++y)Se[y]=d[y];var We=d.length;for(y=0;y<g.length;++y)Se[We+y]=g[y];for(We+=g.length,y=0;y<B.length;++y)Se[We+y]=M*(B[y]-le)/Ie;var He,Re=c.IndexDatatype.createTypedArray(d.length,m);if(G){var ke=new Uint8Array(p);f.push(Se.buffer,Re.buffer,ke.buffer),He=ke.buffer}else f.push(Se.buffer,Re.buffer);return e.defined(ge)&&ge.destroy(),{vertices:Se.buffer,encodedNormals:He,indices:Re.buffer,minimumHeight:le,maximumHeight:de,westIndices:ue,southIndices:oe,eastIndices:se,northIndices:he,boundingSphere:Te,orientedBoundingBox:Me,horizonOcclusionPoint:Pe}}function _(n){var r=n.data,t=r.webAssemblyConfig;e.defined(t)&&x.EmWrapperManager.initWebAssembly(t.wasmBinaryFileES6).then((function(){self.onmessage=p(Z),self.postMessage(!0)}))}return _}));