define(["./when-45f3d25d","./Check-34538dad","./Cartesian3-e69091b9","./Cartesian2-7a44370a","./BoundingSphere-bacc5cb6","./Matrix4-c65e6a1b","./RuntimeError-86da6af2","./Rectangle-c7d55cfa","./WebGLConstants-3660bc8f","./ComponentDatatype-86703c58","./Transforms-68229cf3","./AttributeCompression-1e177d5e","./IndexDatatype-e52361bd","./IntersectionTests-e782669d","./Plane-18e7e6e4","./createTaskProcessorWorker","./EllipsoidTangentPlane-c9b5e9c5","./OrientedBoundingBox-1e79d8b2","./materem-f017d2c3","./EmWrapperManager-a482472d","./TerrainEncoding-eef38e10","./EmLBDeal-6bed9fb9"],(function(e,i,r,n,t,s,h,o,u,d,a,p,f,l,c,g,m,w,v,x,C,y){"use strict";var b={clipTriangleAtAxisAlignedThreshold:function(r,n,t,s,h,o){if(!e.defined(r))throw new i.DeveloperError("threshold is required.");if(!e.defined(n))throw new i.DeveloperError("keepAbove is required.");if(!e.defined(t))throw new i.DeveloperError("u0 is required.");if(!e.defined(s))throw new i.DeveloperError("u1 is required.");if(!e.defined(h))throw new i.DeveloperError("u2 is required.");var u,d,a;e.defined(o)?o.length=0:o=[],n?(u=t<r,d=s<r,a=h<r):(u=t>r,d=s>r,a=h>r);var p,f,l,c,g,m,w=u+d+a;return 1===w?u?(p=(r-t)/(s-t),f=(r-t)/(h-t),o.push(1),o.push(2),1!==f&&(o.push(-1),o.push(0),o.push(2),o.push(f)),1!==p&&(o.push(-1),o.push(0),o.push(1),o.push(p))):d?(l=(r-s)/(h-s),c=(r-s)/(t-s),o.push(2),o.push(0),1!==c&&(o.push(-1),o.push(1),o.push(0),o.push(c)),1!==l&&(o.push(-1),o.push(1),o.push(2),o.push(l))):a&&(g=(r-h)/(t-h),m=(r-h)/(s-h),o.push(0),o.push(1),1!==m&&(o.push(-1),o.push(2),o.push(1),o.push(m)),1!==g&&(o.push(-1),o.push(2),o.push(0),o.push(g))):2===w?u||t===r?d||s===r?a||h===r||(f=(r-t)/(h-t),l=(r-s)/(h-s),o.push(2),o.push(-1),o.push(0),o.push(2),o.push(f),o.push(-1),o.push(1),o.push(2),o.push(l)):(m=(r-h)/(s-h),p=(r-t)/(s-t),o.push(1),o.push(-1),o.push(2),o.push(1),o.push(m),o.push(-1),o.push(0),o.push(1),o.push(p)):(c=(r-s)/(t-s),g=(r-h)/(t-h),o.push(0),o.push(-1),o.push(1),o.push(0),o.push(c),o.push(-1),o.push(2),o.push(0),o.push(g)):3!==w&&(o.push(0),o.push(1),o.push(2)),o},computeBarycentricCoordinates:function(n,t,s,h,o,u,d,a,p){if(!e.defined(n))throw new i.DeveloperError("x is required.");if(!e.defined(t))throw new i.DeveloperError("y is required.");if(!e.defined(s))throw new i.DeveloperError("x1 is required.");if(!e.defined(h))throw new i.DeveloperError("y1 is required.");if(!e.defined(o))throw new i.DeveloperError("x2 is required.");if(!e.defined(u))throw new i.DeveloperError("y2 is required.");if(!e.defined(d))throw new i.DeveloperError("x3 is required.");if(!e.defined(a))throw new i.DeveloperError("y3 is required.");var f=s-d,l=d-o,c=u-a,g=h-a,m=1/(c*f+l*g),w=t-a,v=n-d,x=(c*v+l*w)*m,C=(-g*v+f*w)*m,y=1-x-C;return e.defined(p)?(p.x=x,p.y=C,p.z=y,p):new r.Cartesian3(x,C,y)},computeLineSegmentLineSegmentIntersection:function(r,t,s,h,o,u,d,a,p){i.Check.typeOf.number("x00",r),i.Check.typeOf.number("y00",t),i.Check.typeOf.number("x01",s),i.Check.typeOf.number("y01",h),i.Check.typeOf.number("x10",o),i.Check.typeOf.number("y10",u),i.Check.typeOf.number("x11",d),i.Check.typeOf.number("y11",a);var f=(d-o)*(t-u)-(a-u)*(r-o),l=(s-r)*(t-u)-(h-t)*(r-o),c=(a-u)*(s-r)-(d-o)*(h-t);if(0!==c){var g=f/c,m=l/c;return g>=0&&g<=1&&m>=0&&m<=1?(e.defined(p)||(p=new n.Cartesian2),p.x=r+g*(s-r),p.y=t+g*(h-t),p):void 0}}},B=32767,E=B/2|0,A=[],I=[],D=[],T=new n.Cartographic,M=new r.Cartesian3,O=[],z=[],k=[],N=[],V=[],q=new r.Cartesian3,R=new t.BoundingSphere,S=new w.OrientedBoundingBox,H=new n.Cartesian2,P=new r.Cartesian3;function F(i,s){var h=i.isEastChild,u=i.isNorthChild,d=h?E:0,a=h?B:E,p=u?E:0,l=u?B:E,c=O,g=z,m=k,v=V;c.length=0,g.length=0,m.length=0,v.length=0;var x=N;x.length=0;var F={},W=i.vertices,L=i.indices;L=L.subarray(0,i.indexCountWithoutSkirts);var X,Y,K,j,_,G=C.TerrainEncoding.clone(i.encoding),J=G.hasVertexNormals,Q=i.exaggeration,$=0,ee=i.vertexCountWithoutSkirts,ie=i.minimumHeight,re=i.maximumHeight,ne=new Array(ee),te=new Array(ee),se=new Array(ee),he=J?new Array(2*ee):void 0,oe=20;for(Y=0,K=0;Y<ee;++Y,K+=2){var ue=G.decodeTextureCoordinates(W,Y,H);if(X=G.decodeHeight(W,Y)/Q,j=r.CesiumMath.clamp(ue.x*B|0,0,B),_=r.CesiumMath.clamp(ue.y*B|0,0,B),se[Y]=r.CesiumMath.clamp((X-ie)/(re-ie)*B|0,0,B),j<oe&&(j=0),_<oe&&(_=0),B-j<oe&&(j=B),B-_<oe&&(_=B),ne[Y]=j,te[Y]=_,J){var de=G.getOctEncodedNormal(W,Y,P);he[K]=de.x,he[K+1]=de.y}(h&&j>=E||!h&&j<=E)&&(u&&_>=E||!u&&_<=E)&&(F[Y]=$,c.push(j),g.push(_),m.push(se[Y]),J&&(v.push(he[K]),v.push(he[K+1])),++$)}var ae=[];ae.push(new U),ae.push(new U),ae.push(new U);var pe,fe,le=[];for(le.push(new U),le.push(new U),le.push(new U),Y=0;Y<L.length;Y+=3){var ce=L[Y],ge=L[Y+1],me=L[Y+2],we=ne[ce],ve=ne[ge],xe=ne[me];ae[0].initializeIndexed(ne,te,se,he,ce),ae[1].initializeIndexed(ne,te,se,he,ge),ae[2].initializeIndexed(ne,te,se,he,me);var Ce=b.clipTriangleAtAxisAlignedThreshold(E,h,we,ve,xe,A);pe=0,pe>=Ce.length||(pe=le[0].initializeFromClipResult(Ce,pe,ae),pe>=Ce.length||(pe=le[1].initializeFromClipResult(Ce,pe,ae),pe>=Ce.length||(pe=le[2].initializeFromClipResult(Ce,pe,ae),fe=b.clipTriangleAtAxisAlignedThreshold(E,u,le[0].getV(),le[1].getV(),le[2].getV(),I),Z(c,g,m,v,x,F,fe,le,J),pe<Ce.length&&(le[2].clone(le[1]),le[2].initializeFromClipResult(Ce,pe,ae),fe=b.clipTriangleAtAxisAlignedThreshold(E,u,le[0].getV(),le[1].getV(),le[2].getV(),I),Z(c,g,m,v,x,F,fe,le,J)))))}var ye=h?-B:0,be=u?-B:0,Be=[],Ee=[],Ae=[],Ie=[],De=Number.MAX_VALUE,Te=-De,Me=D;Me.length=0;var Oe,ze=n.Ellipsoid.clone(i.ellipsoid),ke=o.Rectangle.clone(i.childRectangle),Ne=ke.north,Ve=ke.south,qe=ke.east,Re=ke.west;if(qe<Re&&(qe+=r.CesiumMath.TWO_PI),i.isPlaneMode){var Se=i.projectionString,He=i.dCenX,Pe=i.dCenY,Fe=i.dCenZ;Oe=new y.EmLBDeal;var Ue=Oe.init(Se,new r.Cartesian3(He,Pe,Fe));Ue||(Oe.destroy(),Oe=void 0)}for(Y=0;Y<c.length;++Y)j=Math.round(c[Y]),j<=d?(Be.push(Y),j=0):j>=a?(Ae.push(Y),j=B):j=2*j+ye,c[Y]=j,_=Math.round(g[Y]),_<=p?(Ee.push(Y),_=0):_>=l?(Ie.push(Y),_=B):_=2*_+be,g[Y]=_,X=r.CesiumMath.lerp(ie,re,m[Y]/B),X<De&&(De=X),X>Te&&(Te=X),m[Y]=X,T.longitude=r.CesiumMath.lerp(Re,qe,j/B),T.latitude=r.CesiumMath.lerp(Ve,Ne,_/B),T.height=X,ze.cartographicToCartesian(T,M),e.defined(Oe)&&Oe.computeCartesianToProj(M,void 0,M),Me.push(M.x),Me.push(M.y),Me.push(M.z);var We,Le,Xe=t.BoundingSphere.fromVertices(Me,r.Cartesian3.ZERO,3,R);if(e.defined(Oe))We=w.OrientedBoundingBox.fromPoints(Xe.getCornerAry()),Le=new r.Cartesian3;else{We=w.OrientedBoundingBox.fromRectangle(ke,De,Te,ze,S);var Ye=new C.EllipsoidalOccluder(ze);Le=Ye.computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(Xe.center,Me,3,Xe.center,De,q)}var Ke=Te-De,je=new Uint16Array(c.length+g.length+m.length);for(Y=0;Y<c.length;++Y)je[Y]=c[Y];var Ze=c.length;for(Y=0;Y<g.length;++Y)je[Ze+Y]=g[Y];for(Ze+=g.length,Y=0;Y<m.length;++Y)je[Ze+Y]=B*(m[Y]-De)/Ke;var _e,Ge=f.IndexDatatype.createTypedArray(c.length,x);if(J){var Je=new Uint8Array(v);s.push(je.buffer,Ge.buffer,Je.buffer),_e=Je.buffer}else s.push(je.buffer,Ge.buffer);return e.defined(Oe)&&Oe.destroy(),{vertices:je.buffer,encodedNormals:_e,indices:Ge.buffer,minimumHeight:De,maximumHeight:Te,westIndices:Be,southIndices:Ee,eastIndices:Ae,northIndices:Ie,boundingSphere:Xe,orientedBoundingBox:We,horizonOcclusionPoint:Le}}function U(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}U.prototype.clone=function(i){return e.defined(i)||(i=new U),i.uBuffer=this.uBuffer,i.vBuffer=this.vBuffer,i.heightBuffer=this.heightBuffer,i.normalBuffer=this.normalBuffer,i.index=this.index,i.first=this.first,i.second=this.second,i.ratio=this.ratio,i},U.prototype.initializeIndexed=function(e,i,r,n,t){this.uBuffer=e,this.vBuffer=i,this.heightBuffer=r,this.normalBuffer=n,this.index=t,this.first=void 0,this.second=void 0,this.ratio=void 0},U.prototype.initializeFromClipResult=function(e,i,r){var n=i+1;return-1!==e[i]?r[e[i]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=r[e[n]],++n,this.second=r[e[n]],++n,this.ratio=e[n],++n),n},U.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},U.prototype.isIndexed=function(){return e.defined(this.index)},U.prototype.getH=function(){return e.defined(this.index)?this.heightBuffer[this.index]:r.CesiumMath.lerp(this.first.getH(),this.second.getH(),this.ratio)},U.prototype.getU=function(){return e.defined(this.index)?this.uBuffer[this.index]:r.CesiumMath.lerp(this.first.getU(),this.second.getU(),this.ratio)},U.prototype.getV=function(){return e.defined(this.index)?this.vBuffer[this.index]:r.CesiumMath.lerp(this.first.getV(),this.second.getV(),this.ratio)};var W=new n.Cartesian2,L=-1,X=[new r.Cartesian3,new r.Cartesian3],Y=[new r.Cartesian3,new r.Cartesian3];function K(e,i){++L;var n=X[L],t=Y[L];return n=p.AttributeCompression.octDecode(e.first.getNormalX(),e.first.getNormalY(),n),t=p.AttributeCompression.octDecode(e.second.getNormalX(),e.second.getNormalY(),t),M=r.Cartesian3.lerp(n,t,e.ratio,M),r.Cartesian3.normalize(M,M),p.AttributeCompression.octEncode(M,i),--L,i}U.prototype.getNormalX=function(){return e.defined(this.index)?this.normalBuffer[2*this.index]:(W=K(this,W),W.x)},U.prototype.getNormalY=function(){return e.defined(this.index)?this.normalBuffer[2*this.index+1]:(W=K(this,W),W.y)};var j=[];function Z(i,r,n,t,s,h,o,u,d){if(0!==o.length){var a=0,p=0;while(p<o.length)p=j[a++].initializeFromClipResult(o,p,u);for(var f=0;f<a;++f){var l=j[f];if(l.isIndexed())l.newIndex=h[l.index],l.uBuffer=i,l.vBuffer=r,l.heightBuffer=n,d&&(l.normalBuffer=t);else{var c=l.getKey();if(e.defined(h[c]))l.newIndex=h[c];else{var g=i.length;i.push(l.getU()),r.push(l.getV()),n.push(l.getH()),d&&(t.push(l.getNormalX()),t.push(l.getNormalY())),l.newIndex=g,h[c]=g}}}3===a?(s.push(j[0].newIndex),s.push(j[1].newIndex),s.push(j[2].newIndex)):4===a&&(s.push(j[0].newIndex),s.push(j[1].newIndex),s.push(j[2].newIndex),s.push(j[0].newIndex),s.push(j[2].newIndex),s.push(j[3].newIndex))}}function _(i){var r=i.data,n=r.webAssemblyConfig;e.defined(n)&&x.EmWrapperManager.initWebAssembly(n.wasmBinaryFileES6).then((function(){self.onmessage=g(F),self.postMessage(!0)}))}return j.push(new U),j.push(new U),j.push(new U),j.push(new U),_}));