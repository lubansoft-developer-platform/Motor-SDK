define(["./when-45f3d25d","./Check-34538dad","./Cartesian3-eab74dc0","./Cartesian2-174fefc1","./BoundingSphere-9db3442e","./Transforms-3e7152f2","./Matrix4-22b96d31","./RuntimeError-86da6af2","./WebGLConstants-3660bc8f","./ComponentDatatype-86703c58","./GeometryAttribute-98a8cf59","./PrimitiveType-30fa6f85","./AttributeCompression-6e02a904","./IndexDatatype-cb635cbc","./IntersectionTests-4fa5e272","./Plane-99a0ae01","./createTaskProcessorWorker","./AxisAlignedBoundingBox-1aaa0e65","./EllipsoidTangentPlane-a1163ec8","./OrientedBoundingBox-b28ad40e","./EllipsoidRhumbLine-de5cdc57","./PolygonPipeline-05839d65","./materem-cccd3124","./EmWrapperManager-83011cae","./TerrainEncoding-a14495f9","./EmLBDeal-3bb2b5fa"],(function(e,i,r,n,t,s,h,o,u,d,a,p,f,l,c,g,m,w,v,x,C,y,b,B,A,E){"use strict";var I={clipTriangleAtAxisAlignedThreshold:function(r,n,t,s,h,o){if(!e.defined(r))throw new i.DeveloperError("threshold is required.");if(!e.defined(n))throw new i.DeveloperError("keepAbove is required.");if(!e.defined(t))throw new i.DeveloperError("u0 is required.");if(!e.defined(s))throw new i.DeveloperError("u1 is required.");if(!e.defined(h))throw new i.DeveloperError("u2 is required.");var u,d,a;e.defined(o)?o.length=0:o=[],n?(u=t<r,d=s<r,a=h<r):(u=t>r,d=s>r,a=h>r);var p,f,l,c,g,m,w=u+d+a;return 1===w?u?(p=(r-t)/(s-t),f=(r-t)/(h-t),o.push(1),o.push(2),1!==f&&(o.push(-1),o.push(0),o.push(2),o.push(f)),1!==p&&(o.push(-1),o.push(0),o.push(1),o.push(p))):d?(l=(r-s)/(h-s),c=(r-s)/(t-s),o.push(2),o.push(0),1!==c&&(o.push(-1),o.push(1),o.push(0),o.push(c)),1!==l&&(o.push(-1),o.push(1),o.push(2),o.push(l))):a&&(g=(r-h)/(t-h),m=(r-h)/(s-h),o.push(0),o.push(1),1!==m&&(o.push(-1),o.push(2),o.push(1),o.push(m)),1!==g&&(o.push(-1),o.push(2),o.push(0),o.push(g))):2===w?u||t===r?d||s===r?a||h===r||(f=(r-t)/(h-t),l=(r-s)/(h-s),o.push(2),o.push(-1),o.push(0),o.push(2),o.push(f),o.push(-1),o.push(1),o.push(2),o.push(l)):(m=(r-h)/(s-h),p=(r-t)/(s-t),o.push(1),o.push(-1),o.push(2),o.push(1),o.push(m),o.push(-1),o.push(0),o.push(1),o.push(p)):(c=(r-s)/(t-s),g=(r-h)/(t-h),o.push(0),o.push(-1),o.push(1),o.push(0),o.push(c),o.push(-1),o.push(2),o.push(0),o.push(g)):3!==w&&(o.push(0),o.push(1),o.push(2)),o},computeBarycentricCoordinates:function(n,t,s,h,o,u,d,a,p){if(!e.defined(n))throw new i.DeveloperError("x is required.");if(!e.defined(t))throw new i.DeveloperError("y is required.");if(!e.defined(s))throw new i.DeveloperError("x1 is required.");if(!e.defined(h))throw new i.DeveloperError("y1 is required.");if(!e.defined(o))throw new i.DeveloperError("x2 is required.");if(!e.defined(u))throw new i.DeveloperError("y2 is required.");if(!e.defined(d))throw new i.DeveloperError("x3 is required.");if(!e.defined(a))throw new i.DeveloperError("y3 is required.");var f=s-d,l=d-o,c=u-a,g=h-a,m=1/(c*f+l*g),w=t-a,v=n-d,x=(c*v+l*w)*m,C=(-g*v+f*w)*m,y=1-x-C;return e.defined(p)?(p.x=x,p.y=C,p.z=y,p):new r.Cartesian3(x,C,y)},computeLineSegmentLineSegmentIntersection:function(r,t,s,h,o,u,d,a,p){i.Check.typeOf.number("x00",r),i.Check.typeOf.number("y00",t),i.Check.typeOf.number("x01",s),i.Check.typeOf.number("y01",h),i.Check.typeOf.number("x10",o),i.Check.typeOf.number("y10",u),i.Check.typeOf.number("x11",d),i.Check.typeOf.number("y11",a);var f=(d-o)*(t-u)-(a-u)*(r-o),l=(s-r)*(t-u)-(h-t)*(r-o),c=(a-u)*(s-r)-(d-o)*(h-t);if(0!==c){var g=f/c,m=l/c;return g>=0&&g<=1&&m>=0&&m<=1?(e.defined(p)||(p=new n.Cartesian2),p.x=r+g*(s-r),p.y=t+g*(h-t),p):void 0}}},D=32767,T=D/2|0,M=[],O=[],z=[],k=new n.Cartographic,N=new r.Cartesian3,V=[],q=[],P=[],R=[],S=[],H=new r.Cartesian3,F=new t.BoundingSphere,U=new x.OrientedBoundingBox,W=new n.Cartesian2,L=new r.Cartesian3;function X(i,s){var h=i.isEastChild,o=i.isNorthChild,u=h?T:0,d=h?D:T,a=o?T:0,p=o?D:T,f=V,c=q,g=P,m=S;f.length=0,c.length=0,g.length=0,m.length=0;var w=R;w.length=0;var v={},C=i.vertices,y=i.indices;y=y.subarray(0,i.indexCountWithoutSkirts);var b,B,X,K,j,G=A.TerrainEncoding.clone(i.encoding),Z=G.hasVertexNormals,_=i.exaggeration,J=0,$=i.vertexCountWithoutSkirts,ee=i.minimumHeight,ie=i.maximumHeight,re=new Array($),ne=new Array($),te=new Array($),se=Z?new Array(2*$):void 0,he=20;for(B=0,X=0;B<$;++B,X+=2){var oe=G.decodeTextureCoordinates(C,B,W);if(b=G.decodeHeight(C,B)/_,K=r.CesiumMath.clamp(oe.x*D|0,0,D),j=r.CesiumMath.clamp(oe.y*D|0,0,D),te[B]=r.CesiumMath.clamp((b-ee)/(ie-ee)*D|0,0,D),K<he&&(K=0),j<he&&(j=0),D-K<he&&(K=D),D-j<he&&(j=D),re[B]=K,ne[B]=j,Z){var ue=G.getOctEncodedNormal(C,B,L);se[X]=ue.x,se[X+1]=ue.y}(h&&K>=T||!h&&K<=T)&&(o&&j>=T||!o&&j<=T)&&(v[B]=J,f.push(K),c.push(j),g.push(te[B]),Z&&(m.push(se[X]),m.push(se[X+1])),++J)}var de=[];de.push(new Y),de.push(new Y),de.push(new Y);var ae,pe,fe=[];for(fe.push(new Y),fe.push(new Y),fe.push(new Y),B=0;B<y.length;B+=3){var le=y[B],ce=y[B+1],ge=y[B+2],me=re[le],we=re[ce],ve=re[ge];de[0].initializeIndexed(re,ne,te,se,le),de[1].initializeIndexed(re,ne,te,se,ce),de[2].initializeIndexed(re,ne,te,se,ge);var xe=I.clipTriangleAtAxisAlignedThreshold(T,h,me,we,ve,M);ae=0,ae>=xe.length||(ae=fe[0].initializeFromClipResult(xe,ae,de),ae>=xe.length||(ae=fe[1].initializeFromClipResult(xe,ae,de),ae>=xe.length||(ae=fe[2].initializeFromClipResult(xe,ae,de),pe=I.clipTriangleAtAxisAlignedThreshold(T,o,fe[0].getV(),fe[1].getV(),fe[2].getV(),O),Q(f,c,g,m,w,v,pe,fe,Z),ae<xe.length&&(fe[2].clone(fe[1]),fe[2].initializeFromClipResult(xe,ae,de),pe=I.clipTriangleAtAxisAlignedThreshold(T,o,fe[0].getV(),fe[1].getV(),fe[2].getV(),O),Q(f,c,g,m,w,v,pe,fe,Z)))))}var Ce=h?-D:0,ye=o?-D:0,be=[],Be=[],Ae=[],Ee=[],Ie=Number.MAX_VALUE,De=-Ie,Te=z;Te.length=0;var Me,Oe=n.Ellipsoid.clone(i.ellipsoid),ze=n.Rectangle.clone(i.childRectangle),ke=ze.north,Ne=ze.south,Ve=ze.east,qe=ze.west;if(Ve<qe&&(Ve+=r.CesiumMath.TWO_PI),i.isPlaneMode){var Pe=i.projectionString,Re=i.dCenX,Se=i.dCenY,He=i.dCenZ;Me=new E.EmLBDeal;var Fe=Me.init(Pe,new r.Cartesian3(Re,Se,He));Fe||(Me.destroy(),Me=void 0)}for(B=0;B<f.length;++B)K=Math.round(f[B]),K<=u?(be.push(B),K=0):K>=d?(Ae.push(B),K=D):K=2*K+Ce,f[B]=K,j=Math.round(c[B]),j<=a?(Be.push(B),j=0):j>=p?(Ee.push(B),j=D):j=2*j+ye,c[B]=j,b=r.CesiumMath.lerp(ee,ie,g[B]/D),b<Ie&&(Ie=b),b>De&&(De=b),g[B]=b,k.longitude=r.CesiumMath.lerp(qe,Ve,K/D),k.latitude=r.CesiumMath.lerp(Ne,ke,j/D),k.height=b,Oe.cartographicToCartesian(k,N),e.defined(Me)&&Me.computeCartesianToProj(N,!1,void 0,N),Te.push(N.x),Te.push(N.y),Te.push(N.z);var Ue,We,Le=t.BoundingSphere.fromVertices(Te,r.Cartesian3.ZERO,3,F);if(e.defined(Me))Ue=x.OrientedBoundingBox.fromPoints(Le.getCornerAry()),We=new r.Cartesian3;else{Ue=x.OrientedBoundingBox.fromRectangle(ze,Ie,De,Oe,U);var Xe=new A.EllipsoidalOccluder(Oe);We=Xe.computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(Le.center,Te,3,Le.center,Ie,H)}var Ye=De-Ie,Ke=new Uint16Array(f.length+c.length+g.length);for(B=0;B<f.length;++B)Ke[B]=f[B];var je=f.length;for(B=0;B<c.length;++B)Ke[je+B]=c[B];for(je+=c.length,B=0;B<g.length;++B)Ke[je+B]=D*(g[B]-Ie)/Ye;var Ge,Ze=l.IndexDatatype.createTypedArray(f.length,w);if(Z){var _e=new Uint8Array(m);s.push(Ke.buffer,Ze.buffer,_e.buffer),Ge=_e.buffer}else s.push(Ke.buffer,Ze.buffer);return e.defined(Me)&&Me.destroy(),{vertices:Ke.buffer,encodedNormals:Ge,indices:Ze.buffer,minimumHeight:Ie,maximumHeight:De,westIndices:be,southIndices:Be,eastIndices:Ae,northIndices:Ee,boundingSphere:Le,orientedBoundingBox:Ue,horizonOcclusionPoint:We}}function Y(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}Y.prototype.clone=function(i){return e.defined(i)||(i=new Y),i.uBuffer=this.uBuffer,i.vBuffer=this.vBuffer,i.heightBuffer=this.heightBuffer,i.normalBuffer=this.normalBuffer,i.index=this.index,i.first=this.first,i.second=this.second,i.ratio=this.ratio,i},Y.prototype.initializeIndexed=function(e,i,r,n,t){this.uBuffer=e,this.vBuffer=i,this.heightBuffer=r,this.normalBuffer=n,this.index=t,this.first=void 0,this.second=void 0,this.ratio=void 0},Y.prototype.initializeFromClipResult=function(e,i,r){var n=i+1;return-1!==e[i]?r[e[i]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=r[e[n]],++n,this.second=r[e[n]],++n,this.ratio=e[n],++n),n},Y.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},Y.prototype.isIndexed=function(){return e.defined(this.index)},Y.prototype.getH=function(){return e.defined(this.index)?this.heightBuffer[this.index]:r.CesiumMath.lerp(this.first.getH(),this.second.getH(),this.ratio)},Y.prototype.getU=function(){return e.defined(this.index)?this.uBuffer[this.index]:r.CesiumMath.lerp(this.first.getU(),this.second.getU(),this.ratio)},Y.prototype.getV=function(){return e.defined(this.index)?this.vBuffer[this.index]:r.CesiumMath.lerp(this.first.getV(),this.second.getV(),this.ratio)};var K=new n.Cartesian2,j=-1,G=[new r.Cartesian3,new r.Cartesian3],Z=[new r.Cartesian3,new r.Cartesian3];function _(e,i){++j;var n=G[j],t=Z[j];return n=f.AttributeCompression.octDecode(e.first.getNormalX(),e.first.getNormalY(),n),t=f.AttributeCompression.octDecode(e.second.getNormalX(),e.second.getNormalY(),t),N=r.Cartesian3.lerp(n,t,e.ratio,N),r.Cartesian3.normalize(N,N),f.AttributeCompression.octEncode(N,i),--j,i}Y.prototype.getNormalX=function(){return e.defined(this.index)?this.normalBuffer[2*this.index]:(K=_(this,K),K.x)},Y.prototype.getNormalY=function(){return e.defined(this.index)?this.normalBuffer[2*this.index+1]:(K=_(this,K),K.y)};var J=[];function Q(i,r,n,t,s,h,o,u,d){if(0!==o.length){var a=0,p=0;while(p<o.length)p=J[a++].initializeFromClipResult(o,p,u);for(var f=0;f<a;++f){var l=J[f];if(l.isIndexed())l.newIndex=h[l.index],l.uBuffer=i,l.vBuffer=r,l.heightBuffer=n,d&&(l.normalBuffer=t);else{var c=l.getKey();if(e.defined(h[c]))l.newIndex=h[c];else{var g=i.length;i.push(l.getU()),r.push(l.getV()),n.push(l.getH()),d&&(t.push(l.getNormalX()),t.push(l.getNormalY())),l.newIndex=g,h[c]=g}}}3===a?(s.push(J[0].newIndex),s.push(J[1].newIndex),s.push(J[2].newIndex)):4===a&&(s.push(J[0].newIndex),s.push(J[1].newIndex),s.push(J[2].newIndex),s.push(J[0].newIndex),s.push(J[2].newIndex),s.push(J[3].newIndex))}}function $(i){var r=i.data,n=r.webAssemblyConfig;e.defined(n)&&B.EmWrapperManager.initWebAssembly(n.wasmBinaryFileES6).then((function(){self.onmessage=m(X),self.postMessage(!0)}))}return J.push(new Y),J.push(new Y),J.push(new Y),J.push(new Y),$}));