define(["./when-45f3d25d","./Check-34538dad","./Cartesian3-ef6ea826","./Cartesian2-a652b463","./BoundingSphere-038d5fbc","./Transforms-c8a82813","./Matrix4-f54b529f","./RuntimeError-86da6af2","./WebGLConstants-3660bc8f","./ComponentDatatype-d28c2e26","./GeometryAttribute-dfebcc43","./PrimitiveType-30fa6f85","./AttributeCompression-20de7c5b","./IndexDatatype-6d2070e9","./IntersectionTests-b186d985","./Plane-a0c58786","./createTaskProcessorWorker","./AxisAlignedBoundingBox-9187558e","./EllipsoidTangentPlane-dd3d1016","./OrientedBoundingBox-91354f3d","./EllipsoidRhumbLine-0c6cd7c8","./PolygonPipeline-28c8c9d7","./materem-cccd3124","./EmWrapperManager-83011cae","./TerrainEncoding-c24a22bc","./EmLBDeal-6e17a961"],(function(e,n,r,t,f,i,a,u,o,s,h,l,d,c,g,B,p,m,v,C,b,w,y,x,E,A){"use strict";var M=[],P=new t.Cartographic,T=new r.Cartesian3,O=[],I=[],S=[],W=[],H=[],R=new r.Cartesian3,k=new f.BoundingSphere,D=new C.OrientedBoundingBox,L=new t.Cartesian2,N=new r.Cartesian3;function z(n,r,t,f,i){var a=0,u=0,o=0,s=[];s.length=32;var h=function(){s[a]=function(n,r,t,f,i){var a=n.uBuffer.length,u=0,o=t[f]-t[i];Math.abs(o)>1e-9&&(u=t[f]/(t[f]-t[i]));var s=n.uBuffer[r[f]],h=n.vBuffer[r[f]],l=n.hBuffer[r[f]],d=n.uBuffer[r[i]],c=n.vBuffer[r[i]],g=n.hBuffer[r[i]];if(d=s+u*(d-s),c=h+u*(c-h),g=l+u*(g-l),n.uBuffer.push(d),n.vBuffer.push(c),n.hBuffer.push(g),e.defined(n.nBuffer)){var B=n.nBuffer[2*r[f]],p=n.nBuffer[2*r[f]+1],m=n.nBuffer[2*r[i]],v=n.nBuffer[2*r[i]+1];m=B+u*(m-B),v=p+u*(v-p),n.nBuffer.push(m),n.nBuffer.push(v)}return a}(n,r,t,o,u),a++},l=function(){s[a]=r[u],a++};if(f>0){for(o=(u=f)-1,h();u<i&&t[u]>=0;)l(),u++;u<i?o=u-1:(u=0,o=i-1),h()}else{for(u=0;u<i&&t[u]>=0;)l(),u++;for(o=u-1,h();u<i&&t[u]<0;)u++;if(u<i)for(o=u-1,h();u<i&&t[u]>=0;)l(),u++;else u=0,o=i-1,h()}i=a;for(let e=0;e<a;e++)r[e]=s[e];return i}function U(e,n,r,t){var f=0,i=0,a=-1,u=[];u.length=32;for(let o=0;o<r;o++){const r=n.uBuffer[t[o]],s=n.vBuffer[t[o]],h=n.hBuffer[t[o]];u[o]=r*e.x+s*e.y+h*e.z+e.w,u[o]>1e-9?(f++,a<0&&(a=o)):u[o]<-1e-9&&i++}return 0===f&&i>0?r=0:f>=0&&0===i?r:z(n,t,u,a,r)}function V(e,n,r,t,f,i,u){var o=[new a.Cartesian4(1,0,0,-e),new a.Cartesian4(-1,0,0,r),new a.Cartesian4(0,1,0,-n),new a.Cartesian4(0,-1,0,t)];for(let a=0;a<4;a++)if((u=U(o[a],f,u,i))<3)return u;return u}function j(n,i){var a=n.isEastChild,u=n.isNorthChild,o=a?16383:0,s=a?32767:16383,h=u?16383:0,l=u?32767:16383,d=O,g=I,B=S,p=H;d.length=0,g.length=0,B.length=0,p.length=0;var m=W;m.length=0;var v=n.vertices,b=n.indices;b=b.subarray(0,n.indexCountWithoutSkirts);var w,y,x,z,U,j=E.TerrainEncoding.clone(n.encoding),F=j.hasVertexNormals,G=n.exaggeration,X=n.vertexCountWithoutSkirts,Z=n.minimumHeight,_=n.maximumHeight,Y=new Array(X),q=new Array(X),J=new Array(X),K=F?new Array(2*X):void 0;for(y=0,x=0;y<X;++y,x+=2){var Q=j.decodeTextureCoordinates(v,y,L);if(w=j.decodeHeight(v,y)/G,z=r.CesiumMath.clamp(32767*Q.x|0,0,32767),U=r.CesiumMath.clamp(32767*Q.y|0,0,32767),J[y]=r.CesiumMath.clamp((w-Z)/(_-Z)*32767|0,0,32767),z<20&&(z=0),U<20&&(U=0),32767-z<20&&(z=32767),32767-U<20&&(U=32767),Y[y]=z,q[y]=U,F){var $=j.getOctEncodedNormal(v,y,N);K[x]=$.x,K[x+1]=$.y}}!function(n,r,t,f,i,a,u,o){var s=a.length/3,h=[];for(let e=0;e<s;++e){let u=3,o=[];if(o.length=32,o[0]=a[3*e],o[1]=a[3*e+1],o[2]=a[3*e+2],u=V(n,r,t,f,i,o,u),u>=3){let e=u-2;for(let n=1;n<=e;++n)h.push(o[0]),h.push(o[n]),h.push(o[n+1])}}var l=[],d=[];l.length=i.uBuffer.length,d.length=l.length;for(let e=0;e<l.length;e++)l[e]=!0,d[e]=-1;for(let e=0;e<h.length;e++)l[h[e]]=!1;for(let g=0,B=0;g<l.length;++g)l[g]||(d[g]=B,B++,u.uBuffer.push(i.uBuffer[g]),u.vBuffer.push(i.vBuffer[g]),u.hBuffer.push(i.hBuffer[g]),e.defined(i.nBuffer)&&(u.nBuffer.push(i.nBuffer[2*g]),u.nBuffer.push(i.nBuffer[2*g+1])));let c=h.length;for(let e=0;e<c;++e)o.push(d[h[e]])}(o,h,s,l,{uBuffer:Y,vBuffer:q,hBuffer:J,nBuffer:K},b,{uBuffer:d,vBuffer:g,hBuffer:B,nBuffer:p},m);var ee=a?-32767:0,ne=u?-32767:0,re=[],te=[],fe=[],ie=[],ae=Number.MAX_VALUE,ue=-ae,oe=M;oe.length=0;var se,he=t.Ellipsoid.clone(n.ellipsoid),le=t.Rectangle.clone(n.childRectangle),de=le.north,ce=le.south,ge=le.east,Be=le.west;if(ge<Be&&(ge+=r.CesiumMath.TWO_PI),n.isPlaneMode){var pe=n.projectionString,me=n.dCenX,ve=n.dCenY,Ce=n.dCenZ;(se=new A.EmLBDeal).init(pe,new r.Cartesian3(me,ve,Ce))||(se.destroy(),se=void 0)}for(y=0;y<d.length;++y)(z=Math.round(d[y]))<=o?(re.push(y),z=0):z>=s?(fe.push(y),z=32767):z=2*z+ee,d[y]=z,(U=Math.round(g[y]))<=h?(te.push(y),U=0):U>=l?(ie.push(y),U=32767):U=2*U+ne,g[y]=U,(w=r.CesiumMath.lerp(Z,_,B[y]/32767))<ae&&(ae=w),w>ue&&(ue=w),B[y]=w,P.longitude=r.CesiumMath.lerp(Be,ge,z/32767),P.latitude=r.CesiumMath.lerp(ce,de,U/32767),P.height=w,he.cartographicToCartesian(P,T),e.defined(se)&&se.computeCartesianToProj(T,!1,void 0,T),oe.push(T.x),oe.push(T.y),oe.push(T.z);var be,we,ye=f.BoundingSphere.fromVertices(oe,r.Cartesian3.ZERO,3,k);e.defined(se)?(be=C.OrientedBoundingBox.fromPoints(ye.getCornerAry()),we=new r.Cartesian3):(be=C.OrientedBoundingBox.fromRectangle(le,ae,ue,he,D),we=new E.EllipsoidalOccluder(he).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(ye.center,oe,3,ye.center,ae,R));var xe=ue-ae,Ee=new Uint16Array(d.length+g.length+B.length);for(y=0;y<d.length;++y)Ee[y]=d[y];var Ae=d.length;for(y=0;y<g.length;++y)Ee[Ae+y]=g[y];for(Ae+=g.length,y=0;y<B.length;++y)Ee[Ae+y]=32767*(B[y]-ae)/xe;var Me,Pe=c.IndexDatatype.createTypedArray(d.length,m);if(F){var Te=new Uint8Array(p);i.push(Ee.buffer,Pe.buffer,Te.buffer),Me=Te.buffer}else i.push(Ee.buffer,Pe.buffer);return e.defined(se)&&se.destroy(),{vertices:Ee.buffer,encodedNormals:Me,indices:Pe.buffer,minimumHeight:ae,maximumHeight:ue,westIndices:re,southIndices:te,eastIndices:fe,northIndices:ie,boundingSphere:ye,orientedBoundingBox:be,horizonOcclusionPoint:we}}return function(n){var r=n.data.webAssemblyConfig;e.defined(r)&&x.EmWrapperManager.initWebAssembly(r.wasmBinaryFileES6).then((function(){self.onmessage=p(j),self.postMessage(!0)}))}}));