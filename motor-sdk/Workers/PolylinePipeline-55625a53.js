define(["exports","./when-45f3d25d","./Check-34538dad","./Cartesian3-e69091b9","./Cartesian2-7a44370a","./Matrix4-c65e6a1b","./IntersectionTests-63c9c281","./Plane-18e7e6e4","./EllipsoidRhumbLine-4bc7760a","./EllipsoidGeodesic-1d7258d7"],(function(a,e,r,t,i,n,o,s,c,u){"use strict";var l={getTriangleArea:function(a){let e=t.Cartesian3.subtract(a[0],a[1],new t.Cartesian3),r=t.Cartesian3.subtract(a[0],a[2],new t.Cartesian3),i=t.Cartesian3.cross(e,r,new t.Cartesian3);return.5*t.Cartesian3.magnitude(i)},numberOfPoints:function(a,e,r){var i=t.Cartesian3.distance(a,e);return Math.ceil(i/r)},numberOfPointsRhumbLine:function(a,e,r){var t=Math.pow(a.longitude-e.longitude,2)+Math.pow(a.latitude-e.latitude,2);return Math.ceil(Math.sqrt(t/(r*r)))}},h=new i.Cartographic;l.extractHeights=function(a,e){for(var r=a.length,t=new Array(r),i=0;i<r;i++){var n=a[i];t[i]=e.cartesianToCartographic(n,h).height}return t};var f=new n.Matrix4,C=new t.Cartesian3,d=new t.Cartesian3,g=new s.Plane(t.Cartesian3.UNIT_X,0),p=new t.Cartesian3,v=new s.Plane(t.Cartesian3.UNIT_X,0),m=new t.Cartesian3,w=new t.Cartesian3,T=[];function P(a,e,r){var t,i=T;if(i.length=a,e===r){for(t=0;t<a;t++)i[t]=e;return i}var n=r-e,o=n/a;for(t=0;t<a;t++){var s=e+t*o;i[t]=s}return i}var y=new i.Cartographic,A=new i.Cartographic,E=new t.Cartesian3,b=new t.Cartesian3,S=new t.Cartesian3,R=new u.EllipsoidGeodesic,D=new c.EllipsoidRhumbLine;function M(a,e,r,i,n,o,s,c){var u=i.scaleToGeodeticSurface(a,b),h=i.scaleToGeodeticSurface(e,S),f=l.numberOfPoints(a,e,r),C=i.cartesianToCartographic(u,y),d=i.cartesianToCartographic(h,A),g=P(f,n,o);R.setEndPoints(C,d);var p=R.surfaceDistance/f,v=c;C.height=n;var m=i.cartographicToCartesian(C,E);t.Cartesian3.pack(m,s,v),v+=3;for(var w=1;w<f;w++){var T=R.interpolateUsingSurfaceDistance(w*p,A);T.height=g[w],m=i.cartographicToCartesian(T,E),t.Cartesian3.pack(m,s,v),v+=3}return v}function x(a,e,r,i,n,o,s,u){var h=i.scaleToGeodeticSurface(a,b),f=i.scaleToGeodeticSurface(e,S),C=i.cartesianToCartographic(h,y),d=i.cartesianToCartographic(f,A),g=l.numberOfPointsRhumbLine(C,d,r),p=P(g,n,o);D.ellipsoid.equals(i)||(D=new c.EllipsoidRhumbLine(void 0,void 0,i)),D.setEndPoints(C,d);var v=D.surfaceDistance/g,m=u;C.height=n;var w=i.cartographicToCartesian(C,E);t.Cartesian3.pack(w,s,m),m+=3;for(var T=1;T<g;T++){var R=D.interpolateUsingSurfaceDistance(T*v,A);R.height=p[T],w=i.cartographicToCartesian(R,E),t.Cartesian3.pack(w,s,m),m+=3}return m}l.wrapLongitude=function(a,r){var i=[],c=[];if(e.defined(a)&&a.length>0){r=e.defaultValue(r,n.Matrix4.IDENTITY);var u=n.Matrix4.inverseTransformation(r,f),l=n.Matrix4.multiplyByPoint(u,t.Cartesian3.ZERO,C),h=t.Cartesian3.normalize(n.Matrix4.multiplyByPointAsVector(u,t.Cartesian3.UNIT_Y,d),d),T=s.Plane.fromPointNormal(l,h,g),P=t.Cartesian3.normalize(n.Matrix4.multiplyByPointAsVector(u,t.Cartesian3.UNIT_X,p),p),y=s.Plane.fromPointNormal(l,P,v),A=1;i.push(t.Cartesian3.clone(a[0]));for(var E=i[0],b=a.length,S=1;S<b;++S){var R=a[S];if(s.Plane.getPointDistance(y,E)<0||s.Plane.getPointDistance(y,R)<0){var D=o.IntersectionTests.lineSegmentPlane(E,R,T,m);if(e.defined(D)){var M=t.Cartesian3.multiplyByScalar(h,5e-9,w);s.Plane.getPointDistance(T,E)<0&&t.Cartesian3.negate(M,M),i.push(t.Cartesian3.add(D,M,new t.Cartesian3)),c.push(A+1),t.Cartesian3.negate(M,M),i.push(t.Cartesian3.add(D,M,new t.Cartesian3)),A=1}}i.push(t.Cartesian3.clone(a[S])),A++,E=R}c.push(A)}return{positions:i,lengths:c}},l.generateArc=function(a){e.defined(a)||(a={});var n=a.positions;if(!e.defined(n))throw new r.DeveloperError("options.positions is required.");var o=n.length,s=e.defaultValue(a.ellipsoid,i.Ellipsoid.WGS84),c=e.defaultValue(a.height,0),u=Array.isArray(c);if(o<1)return[];if(1===o){var h=s.scaleToGeodeticSurface(n[0],b);if(c=u?c[0]:c,0!==c){var f=s.geodeticSurfaceNormal(h,E);t.Cartesian3.multiplyByScalar(f,c,f),t.Cartesian3.add(h,f,h)}return[h.x,h.y,h.z]}var C=a.minDistance;if(!e.defined(C)){var d=e.defaultValue(a.granularity,t.CesiumMath.RADIANS_PER_DEGREE);C=t.CesiumMath.chordLength(d,s.maximumRadius)}var g,p=0;for(g=0;g<o-1;g++)p+=l.numberOfPoints(n[g],n[g+1],C);var v=3*(p+1),m=new Array(v),w=0;for(g=0;g<o-1;g++){var P=n[g],A=n[g+1],S=u?c[g]:c,R=u?c[g+1]:c;w=M(P,A,C,s,S,R,m,w)}T.length=0;var D=n[o-1],x=s.cartesianToCartographic(D,y);x.height=u?c[o-1]:c;var G=s.cartographicToCartesian(x,E);return t.Cartesian3.pack(G,m,v-3),m};var G=new i.Cartographic,N=new i.Cartographic;l.generateRhumbArc=function(a){e.defined(a)||(a={});var n=a.positions;if(!e.defined(n))throw new r.DeveloperError("options.positions is required.");var o=n.length,s=e.defaultValue(a.ellipsoid,i.Ellipsoid.WGS84),c=e.defaultValue(a.height,0),u=Array.isArray(c);if(o<1)return[];if(1===o){var h=s.scaleToGeodeticSurface(n[0],b);if(c=u?c[0]:c,0!==c){var f=s.geodeticSurfaceNormal(h,E);t.Cartesian3.multiplyByScalar(f,c,f),t.Cartesian3.add(h,f,h)}return[h.x,h.y,h.z]}var C,d,g=e.defaultValue(a.granularity,t.CesiumMath.RADIANS_PER_DEGREE),p=0,v=s.cartesianToCartographic(n[0],G);for(C=0;C<o-1;C++)d=s.cartesianToCartographic(n[C+1],N),p+=l.numberOfPointsRhumbLine(v,d,g),v=i.Cartographic.clone(d,G);var m=3*(p+1),w=new Array(m),P=0;for(C=0;C<o-1;C++){var A=n[C],S=n[C+1],R=u?c[C]:c,D=u?c[C+1]:c;P=x(A,S,g,s,R,D,w,P)}T.length=0;var M=n[o-1],I=s.cartesianToCartographic(M,y);I.height=u?c[o-1]:c;var k=s.cartographicToCartesian(I,E);return t.Cartesian3.pack(k,w,m-3),w},l.generateCartesianArc=function(a){for(var e=l.generateArc(a),r=e.length/3,i=new Array(r),n=0;n<r;n++)i[n]=t.Cartesian3.unpack(e,3*n);return i},l.generateCartesianRhumbArc=function(a){for(var e=l.generateRhumbArc(a),r=e.length/3,i=new Array(r),n=0;n<r;n++)i[n]=t.Cartesian3.unpack(e,3*n);return i},a.PolylinePipeline=l}));