define(["exports","./when-45f3d25d","./Check-34538dad","./Cartesian3-ef6ea826","./Cartesian2-a652b463","./BoundingSphere-038d5fbc","./Matrix4-f54b529f","./Plane-a0c58786"],(function(a,t,e,r,n,i,s,o){"use strict";var u={};function C(a,t,e){var n=a+t;return r.CesiumMath.sign(a)!==r.CesiumMath.sign(t)&&Math.abs(n/Math.max(Math.abs(a),Math.abs(t)))<e?0:n}u.computeDiscriminant=function(a,t,e){return t*t-4*a*e},u.computeRealRoots=function(a,t,e){var n;if(0===a)return 0===t?[]:[-e/t];if(0===t){if(0===e)return[0,0];var i=Math.abs(e),s=Math.abs(a);if(i<s&&i/s<r.CesiumMath.EPSILON14)return[0,0];if(i>s&&s/i<r.CesiumMath.EPSILON14)return[];if((n=-e/a)<0)return[];var o=Math.sqrt(n);return[-o,o]}if(0===e)return(n=-t/a)<0?[n,0]:[0,n];var u=C(t*t,-4*a*e,r.CesiumMath.EPSILON14);if(u<0)return[];var c=-.5*C(t,r.CesiumMath.sign(t)*Math.sqrt(u),r.CesiumMath.EPSILON14);return t>0?[c/a,e/c]:[e/c,c/a]};var c={};function l(a,t,e,r){var n,i,s=a,o=t/3,u=e/3,C=r,c=s*u,l=o*C,d=o*o,h=u*u,M=s*u-d,f=s*C-o*u,m=o*C-h,g=4*M*m-f*f;if(g<0){var v,p,w;d*l>=c*h?(v=s,p=M,w=-2*o*M+s*f):(v=C,p=m,w=-C*f+2*u*m);var S=-(w<0?-1:1)*Math.abs(v)*Math.sqrt(-g),R=(i=-w+S)/2,O=R<0?-Math.pow(-R,1/3):Math.pow(R,1/3),x=i===S?-O:-p/O;return n=p<=0?O+x:-w/(O*O+x*x+p),d*l>=c*h?[(n-o)/s]:[-C/(n+u)]}var P=M,y=-2*o*M+s*f,b=m,N=-C*f+2*u*m,I=Math.sqrt(g),q=Math.sqrt(3)/2,L=Math.abs(Math.atan2(s*I,-y)/3);n=2*Math.sqrt(-P);var E=Math.cos(L);i=n*E;var z=n*(-E/2-q*Math.sin(L)),W=i+z>2*o?i-o:z-o,B=s,T=W/B;L=Math.abs(Math.atan2(C*I,-N)/3);var U=-C,V=(i=(n=2*Math.sqrt(-b))*(E=Math.cos(L)))+(z=n*(-E/2-q*Math.sin(L)))<2*u?i+u:z+u,A=U/V,Z=-W*V-B*U,D=(u*Z-o*(W*U))/(-o*Z+u*(B*V));return T<=D?T<=A?D<=A?[T,D,A]:[T,A,D]:[A,T,D]:T<=A?[D,T,A]:D<=A?[D,A,T]:[A,D,T]}c.computeDiscriminant=function(a,t,e,r){var n=t*t,i=e*e;return 18*a*t*e*r+n*i-a*a*27*(r*r)-4*(a*i*e+n*t*r)},c.computeRealRoots=function(a,t,e,r){var n,i;if(0===a)return u.computeRealRoots(t,e,r);if(0===t){if(0===e){if(0===r)return[0,0,0];var s=(i=-r/a)<0?-Math.pow(-i,1/3):Math.pow(i,1/3);return[s,s,s]}return 0===r?0===(n=u.computeRealRoots(a,0,e)).Length?[0]:[n[0],0,n[1]]:l(a,0,e,r)}return 0===e?0===r?(i=-t/a)<0?[i,0,0]:[0,0,i]:l(a,t,0,r):0===r?0===(n=u.computeRealRoots(a,t,e)).length?[0]:n[1]<=0?[n[0],n[1],0]:n[0]>=0?[0,n[0],n[1]]:[n[0],0,n[1]]:l(a,t,e,r)};var d={};function h(a,t,e,n){var i=a*a,s=t-3*i/8,o=e-t*a/2+i*a/8,C=n-e*a/4+t*i/16-3*i*i/256,l=c.computeRealRoots(1,2*s,s*s-4*C,-o*o);if(l.length>0){var d=-a/4,h=l[l.length-1];if(Math.abs(h)<r.CesiumMath.EPSILON14){var M=u.computeRealRoots(1,s,C);if(2===M.length){var f,m=M[0],g=M[1];if(m>=0&&g>=0){var v=Math.sqrt(m),p=Math.sqrt(g);return[d-p,d-v,d+v,d+p]}if(m>=0&&g<0)return[d-(f=Math.sqrt(m)),d+f];if(m<0&&g>=0)return[d-(f=Math.sqrt(g)),d+f]}return[]}if(h>0){var w=Math.sqrt(h),S=(s+h-o/w)/2,R=(s+h+o/w)/2,O=u.computeRealRoots(1,w,S),x=u.computeRealRoots(1,-w,R);return 0!==O.length?(O[0]+=d,O[1]+=d,0!==x.length?(x[0]+=d,x[1]+=d,O[1]<=x[0]?[O[0],O[1],x[0],x[1]]:x[1]<=O[0]?[x[0],x[1],O[0],O[1]]:O[0]>=x[0]&&O[1]<=x[1]?[x[0],O[0],O[1],x[1]]:x[0]>=O[0]&&x[1]<=O[1]?[O[0],x[0],x[1],O[1]]:O[0]>x[0]&&O[0]<x[1]?[x[0],O[0],x[1],O[1]]:[O[0],x[0],O[1],x[1]]):O):0!==x.length?(x[0]+=d,x[1]+=d,x):[]}}return[]}function M(a,t,e,n){var i=a*a,s=-2*t,o=e*a+t*t-4*n,C=i*n-e*t*a+e*e,l=c.computeRealRoots(1,s,o,C);if(l.length>0){var d,h,M,f,m,g,v=l[0],p=t-v,w=p*p,S=a/2,R=p/2,O=w-4*n,x=w+4*Math.abs(n),P=i-4*v,y=i+4*Math.abs(v);if(v<0||O*y<P*x){var b=Math.sqrt(P);d=b/2,h=0===b?0:(a*R-e)/b}else{var N=Math.sqrt(O);d=0===N?0:(a*R-e)/N,h=N/2}0===S&&0===d?(M=0,f=0):r.CesiumMath.sign(S)===r.CesiumMath.sign(d)?f=v/(M=S+d):M=v/(f=S-d),0===R&&0===h?(m=0,g=0):r.CesiumMath.sign(R)===r.CesiumMath.sign(h)?g=n/(m=R+h):m=n/(g=R-h);var I=u.computeRealRoots(1,M,m),q=u.computeRealRoots(1,f,g);if(0!==I.length)return 0!==q.length?I[1]<=q[0]?[I[0],I[1],q[0],q[1]]:q[1]<=I[0]?[q[0],q[1],I[0],I[1]]:I[0]>=q[0]&&I[1]<=q[1]?[q[0],I[0],I[1],q[1]]:q[0]>=I[0]&&q[1]<=I[1]?[I[0],q[0],q[1],I[1]]:I[0]>q[0]&&I[0]<q[1]?[q[0],I[0],q[1],I[1]]:[I[0],q[0],I[1],q[1]]:I;if(0!==q.length)return q}return[]}function f(a,e){e=r.Cartesian3.clone(t.defaultValue(e,r.Cartesian3.ZERO)),r.Cartesian3.equals(e,r.Cartesian3.ZERO)||r.Cartesian3.normalize(e,e),this.origin=r.Cartesian3.clone(t.defaultValue(a,r.Cartesian3.ZERO)),this.direction=e}d.computeDiscriminant=function(a,t,e,r,n){var i=a*a,s=t*t,o=s*t,u=e*e,C=u*e,c=r*r,l=c*r,d=n*n;return s*u*c-4*o*l-4*a*C*c+18*a*t*e*l-27*i*c*c+i*a*256*(d*n)+n*(18*o*e*r-4*s*C+16*a*u*u-80*a*t*u*r-6*a*s*c+144*i*e*c)+d*(144*a*s*e-27*s*s-128*i*u-192*i*t*r)},d.computeRealRoots=function(a,t,e,n,i){if(Math.abs(a)<r.CesiumMath.EPSILON15)return c.computeRealRoots(t,e,n,i);var s=t/a,o=e/a,u=n/a,C=i/a,l=s<0?1:0;switch(l+=o<0?l+1:l,l+=u<0?l+1:l,l+=C<0?l+1:l){case 0:return h(s,o,u,C);case 1:case 2:return M(s,o,u,C);case 3:case 4:return h(s,o,u,C);case 5:return M(s,o,u,C);case 6:case 7:return h(s,o,u,C);case 8:return M(s,o,u,C);case 9:case 10:return h(s,o,u,C);case 11:return M(s,o,u,C);case 12:case 13:case 14:case 15:return h(s,o,u,C);default:return}},f.getIntersectWidthPlane=function(a,t){let e=r.Cartesian3.multiplyByScalar(t.normal,-t.distance,new r.Cartesian3);return f.getIntersectWidthPlaneNormalAndPosition(a,t.normal,e)},f.getIntersectWidthPlaneNormalAndPosition=function(a,t,e){if(Math.abs(r.Cartesian3.dot(t,a.direction))<r.Cartesian3.magnitude(t)*r.Cartesian3.magnitude(a.direction)*1e-6)return!1;let n=r.Cartesian3.subtract(e,a.origin,new r.Cartesian3),i=r.Cartesian3.dot(n,a.direction),s=r.Cartesian3.multiplyByScalar(a.direction,i,new r.Cartesian3);return r.Cartesian3.add(s,a.origin,s),s},f.clone=function(a,e){if(t.defined(a))return t.defined(e)?(e.origin=r.Cartesian3.clone(a.origin),e.direction=r.Cartesian3.clone(a.direction),e):new f(a.origin,a.direction)},f.getPoint=function(a,e,n){return t.defined(n)||(n=new r.Cartesian3),n=r.Cartesian3.multiplyByScalar(a.direction,e,n),r.Cartesian3.add(a.origin,n,n)};var m={rayPlane:function(a,e,n){t.defined(n)||(n=new r.Cartesian3);var i=a.origin,s=a.direction,o=e.normal,u=r.Cartesian3.dot(o,s);if(!(Math.abs(u)<r.CesiumMath.EPSILON15)){var C=(-e.distance-r.Cartesian3.dot(o,i))/u;if(!(C<0))return n=r.Cartesian3.multiplyByScalar(s,C,n),r.Cartesian3.add(i,n,n)}}},g=new r.Cartesian3,v=new r.Cartesian3,p=new r.Cartesian3,w=new r.Cartesian3,S=new r.Cartesian3;m.rayTriangleParametric=function(a,e,n,i,s){s=t.defaultValue(s,!1);var o,u,C,c,l,d=a.origin,h=a.direction,M=r.Cartesian3.subtract(n,e,g),f=r.Cartesian3.subtract(i,e,v),m=r.Cartesian3.cross(h,f,p),R=r.Cartesian3.dot(M,m);if(s){if(R<r.CesiumMath.EPSILON6)return;if(o=r.Cartesian3.subtract(d,e,w),(C=r.Cartesian3.dot(o,m))<0||C>R)return;if(u=r.Cartesian3.cross(o,M,S),(c=r.Cartesian3.dot(h,u))<0||C+c>R)return;l=r.Cartesian3.dot(f,u)/R}else{if(Math.abs(R)<r.CesiumMath.EPSILON6)return;var O=1/R;if(o=r.Cartesian3.subtract(d,e,w),(C=r.Cartesian3.dot(o,m)*O)<0||C>1)return;if(u=r.Cartesian3.cross(o,M,S),(c=r.Cartesian3.dot(h,u)*O)<0||C+c>1)return;l=r.Cartesian3.dot(f,u)*O}return l},m.rayTriangle=function(a,e,n,i,s,o){var u=m.rayTriangleParametric(a,e,n,i,s);if(t.defined(u)&&!(u<0))return t.defined(o)||(o=new r.Cartesian3),r.Cartesian3.multiplyByScalar(a.direction,u,o),r.Cartesian3.add(a.origin,o,o)};var R=new f;m.lineSegmentTriangle=function(a,e,n,i,s,o,u){var C=R;r.Cartesian3.clone(a,C.origin),r.Cartesian3.subtract(e,a,C.direction),r.Cartesian3.normalize(C.direction,C.direction);var c=m.rayTriangleParametric(C,n,i,s,o);if(!(!t.defined(c)||c<0||c>r.Cartesian3.distance(a,e)))return t.defined(u)||(u=new r.Cartesian3),r.Cartesian3.multiplyByScalar(C.direction,c,u),r.Cartesian3.add(C.origin,u,u)};var O={root0:0,root1:0};function x(a,e,n){t.defined(n)||(n=new i.Interval);var s=a.origin,o=a.direction,u=e.center,C=e.radius*e.radius,c=r.Cartesian3.subtract(s,u,p),l=function(a,t,e,r){var n=t*t-4*a*e;if(!(n<0)){if(n>0){var i=1/(2*a),s=Math.sqrt(n),o=(-t+s)*i,u=(-t-s)*i;return o<u?(r.root0=o,r.root1=u):(r.root0=u,r.root1=o),r}var C=-t/(2*a);if(0!==C)return r.root0=r.root1=C,r}}(r.Cartesian3.dot(o,o),2*r.Cartesian3.dot(o,c),r.Cartesian3.magnitudeSquared(c)-C,O);if(t.defined(l))return n.start=l.root0,n.stop=l.root1,n}m.raySphere=function(a,e,r){if(r=x(a,e,r),t.defined(r)&&!(r.stop<0))return r.start=Math.max(r.start,0),r};var P=new f;m.lineSegmentSphere=function(a,e,n,i){var s=P;r.Cartesian3.clone(a,s.origin);var o=r.Cartesian3.subtract(e,a,s.direction),u=r.Cartesian3.magnitude(o);if(r.Cartesian3.normalize(o,o),i=x(s,n,i),!(!t.defined(i)||i.stop<0||i.start>u))return i.start=Math.max(i.start,0),i.stop=Math.min(i.stop,u),i};var y=new r.Cartesian3,b=new r.Cartesian3;function N(a,t,e){var n=a+t;return r.CesiumMath.sign(a)!==r.CesiumMath.sign(t)&&Math.abs(n/Math.max(Math.abs(a),Math.abs(t)))<e?0:n}m.rayEllipsoid=function(a,t){var e,n,s,o,u,C=t.oneOverRadii,c=r.Cartesian3.multiplyComponents(C,a.origin,y),l=r.Cartesian3.multiplyComponents(C,a.direction,b),d=r.Cartesian3.magnitudeSquared(c),h=r.Cartesian3.dot(c,l);if(d>1){if(h>=0)return;var M=h*h;if(e=d-1,M<(s=(n=r.Cartesian3.magnitudeSquared(l))*e))return;if(M>s){o=h*h-s;var f=(u=-h+Math.sqrt(o))/n,m=e/u;return f<m?new i.Interval(f,m):{start:m,stop:f}}var g=Math.sqrt(e/n);return new i.Interval(g,g)}return d<1?(e=d-1,o=h*h-(s=(n=r.Cartesian3.magnitudeSquared(l))*e),u=-h+Math.sqrt(o),new i.Interval(0,u/n)):h<0?(n=r.Cartesian3.magnitudeSquared(l),new i.Interval(0,-h/n)):void 0};var I=new r.Cartesian3,q=new r.Cartesian3,L=new r.Cartesian3,E=new r.Cartesian3,z=new r.Cartesian3,W=new s.Matrix3,B=new s.Matrix3,T=new s.Matrix3,U=new s.Matrix3,V=new s.Matrix3,A=new s.Matrix3,Z=new s.Matrix3,D=new r.Cartesian3,k=new r.Cartesian3,F=new n.Cartographic;m.grazingAltitudeLocation=function(a,e){var n=a.origin,i=a.direction;if(!r.Cartesian3.equals(n,r.Cartesian3.ZERO)){var o=e.geodeticSurfaceNormal(n,I);if(r.Cartesian3.dot(i,o)>=0)return n}var C=t.defined(this.rayEllipsoid(a,e)),c=e.transformPositionToScaledSpace(i,I),l=r.Cartesian3.normalize(c,c),h=r.Cartesian3.mostOrthogonalAxis(c,E),M=r.Cartesian3.normalize(r.Cartesian3.cross(h,l,q),q),f=r.Cartesian3.normalize(r.Cartesian3.cross(l,M,L),L),m=W;m[0]=l.x,m[1]=l.y,m[2]=l.z,m[3]=M.x,m[4]=M.y,m[5]=M.z,m[6]=f.x,m[7]=f.y,m[8]=f.z;var g=s.Matrix3.transpose(m,B),v=s.Matrix3.fromScale(e.radii,T),p=s.Matrix3.fromScale(e.oneOverRadii,U),w=V;w[0]=0,w[1]=-i.z,w[2]=i.y,w[3]=i.z,w[4]=0,w[5]=-i.x,w[6]=-i.y,w[7]=i.x,w[8]=0;var S,R,O=s.Matrix3.multiply(s.Matrix3.multiply(g,p,A),w,A),x=s.Matrix3.multiply(s.Matrix3.multiply(O,v,Z),m,Z),P=s.Matrix3.multiplyByVector(O,n,z),y=function(a,t,e,n,i){var o,C=n*n,c=i*i,l=(a[s.Matrix3.COLUMN1ROW1]-a[s.Matrix3.COLUMN2ROW2])*c,h=i*(n*N(a[s.Matrix3.COLUMN1ROW0],a[s.Matrix3.COLUMN0ROW1],r.CesiumMath.EPSILON15)+t.y),M=a[s.Matrix3.COLUMN0ROW0]*C+a[s.Matrix3.COLUMN2ROW2]*c+n*t.x+e,f=c*N(a[s.Matrix3.COLUMN2ROW1],a[s.Matrix3.COLUMN1ROW2],r.CesiumMath.EPSILON15),m=i*(n*N(a[s.Matrix3.COLUMN2ROW0],a[s.Matrix3.COLUMN0ROW2])+t.z),g=[];if(0===m&&0===f){if(0===(o=u.computeRealRoots(l,h,M)).length)return g;var v=o[0],p=Math.sqrt(Math.max(1-v*v,0));if(g.push(new r.Cartesian3(n,i*v,i*-p)),g.push(new r.Cartesian3(n,i*v,i*p)),2===o.length){var w=o[1],S=Math.sqrt(Math.max(1-w*w,0));g.push(new r.Cartesian3(n,i*w,i*-S)),g.push(new r.Cartesian3(n,i*w,i*S))}return g}var R=m*m,O=f*f,x=m*f,P=l*l+O,y=2*(h*l+x),b=2*M*l+h*h-O+R,I=2*(M*h-x),q=M*M-R;if(0===P&&0===y&&0===b&&0===I)return g;var L=(o=d.computeRealRoots(P,y,b,I,q)).length;if(0===L)return g;for(var E=0;E<L;++E){var z=o[E],W=z*z,B=Math.max(1-W,0),T=Math.sqrt(B),U=(r.CesiumMath.sign(l)===r.CesiumMath.sign(M)?N(l*W+M,h*z,r.CesiumMath.EPSILON12):r.CesiumMath.sign(M)===r.CesiumMath.sign(h*z)?N(l*W,h*z+M,r.CesiumMath.EPSILON12):N(l*W+h*z,M,r.CesiumMath.EPSILON12))*N(f*z,m,r.CesiumMath.EPSILON15);U<0?g.push(new r.Cartesian3(n,i*z,i*T)):U>0?g.push(new r.Cartesian3(n,i*z,i*-T)):0!==T?(g.push(new r.Cartesian3(n,i*z,i*-T)),g.push(new r.Cartesian3(n,i*z,i*T)),++E):g.push(new r.Cartesian3(n,i*z,i*T))}return g}(x,r.Cartesian3.negate(P,I),0,0,1),b=y.length;if(b>0){for(var G=r.Cartesian3.clone(r.Cartesian3.ZERO,k),Y=Number.NEGATIVE_INFINITY,_=0;_<b;++_){S=s.Matrix3.multiplyByVector(v,s.Matrix3.multiplyByVector(m,y[_],D),D);var j=r.Cartesian3.normalize(r.Cartesian3.subtract(S,n,E),E),H=r.Cartesian3.dot(j,i);H>Y&&(Y=H,G=r.Cartesian3.clone(S,G))}var J=e.cartesianToCartographic(G,F);return Y=r.CesiumMath.clamp(Y,0,1),R=r.Cartesian3.magnitude(r.Cartesian3.subtract(G,n,E))*Math.sqrt(1-Y*Y),R=C?-R:R,J.height=R,e.cartographicToCartesian(J,new r.Cartesian3)}};var G=new r.Cartesian3;m.lineSegmentPlane=function(a,e,n,i){t.defined(i)||(i=new r.Cartesian3);var s=r.Cartesian3.subtract(e,a,G),o=n.normal,u=r.Cartesian3.dot(o,s);if(!(Math.abs(u)<r.CesiumMath.EPSILON6)){var C=r.Cartesian3.dot(o,a),c=-(n.distance+C)/u;if(!(c<0||c>1))return r.Cartesian3.multiplyByScalar(s,c,i),r.Cartesian3.add(a,i,i),i}},m.trianglePlaneIntersection=function(a,t,e,n){var i,s,o=n.normal,u=n.distance,C=r.Cartesian3.dot(o,a)+u<0,c=r.Cartesian3.dot(o,t)+u<0,l=r.Cartesian3.dot(o,e)+u<0,d=0;if(d+=C?1:0,d+=c?1:0,1!==(d+=l?1:0)&&2!==d||(i=new r.Cartesian3,s=new r.Cartesian3),1===d){if(C)return m.lineSegmentPlane(a,t,n,i),m.lineSegmentPlane(a,e,n,s),{positions:[a,t,e,i,s],indices:[0,3,4,1,2,4,1,4,3]};if(c)return m.lineSegmentPlane(t,e,n,i),m.lineSegmentPlane(t,a,n,s),{positions:[a,t,e,i,s],indices:[1,3,4,2,0,4,2,4,3]};if(l)return m.lineSegmentPlane(e,a,n,i),m.lineSegmentPlane(e,t,n,s),{positions:[a,t,e,i,s],indices:[2,3,4,0,1,4,0,4,3]}}else if(2===d){if(!C)return m.lineSegmentPlane(t,a,n,i),m.lineSegmentPlane(e,a,n,s),{positions:[a,t,e,i,s],indices:[1,2,4,1,4,3,0,3,4]};if(!c)return m.lineSegmentPlane(e,t,n,i),m.lineSegmentPlane(a,t,n,s),{positions:[a,t,e,i,s],indices:[2,0,4,2,4,3,1,3,4]};if(!l)return m.lineSegmentPlane(a,e,n,i),m.lineSegmentPlane(t,e,n,s),{positions:[a,t,e,i,s],indices:[0,1,4,0,4,3,2,3,4]}}},a.IntersectionTests=m,a.Ray=f}));