define(["exports","./when-45f3d25d","./Cartesian3-e69091b9","./Cartesian2-7a44370a","./Matrix4-c65e6a1b","./ComponentDatatype-86703c58","./GeometryAttribute-70b679fd","./PrimitiveType-30fa6f85","./Transforms-7d49a8ab","./GeometryAttributes-9d45f9e2","./GeometryPipeline-57d51dc8","./IndexDatatype-e52361bd","./arrayRemoveDuplicates-24a803e7","./ArcType-39be7a32","./EllipsoidRhumbLine-4bc7760a","./PolygonPipeline-d22f3330"],(function(e,t,i,r,n,a,o,s,u,l,h,c,f,p,d,y){"use strict";function g(){this._array=[],this._offset=0,this._length=0}Object.defineProperties(g.prototype,{length:{get:function(){return this._length}}}),g.prototype.enqueue=function(e){this._array.push(e),this._length++},g.prototype.dequeue=function(){if(0!==this._length){var e=this._array,t=this._offset,i=e[t];return e[t]=void 0,t++,t>10&&2*t>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,i}},g.prototype.peek=function(){if(0!==this._length)return this._array[this._offset]},g.prototype.contains=function(e){return-1!==this._array.indexOf(e)},g.prototype.clear=function(){this._array.length=this._offset=this._length=0},g.prototype.sort=function(e){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)};var v={computeHierarchyPackedLength:function(e){var r=0,n=[e];while(n.length>0){var a=n.pop();if(t.defined(a)){r+=2;var o=a.positions,s=a.holes;if(t.defined(o)&&(r+=o.length*i.Cartesian3.packedLength),t.defined(s))for(var u=s.length,l=0;l<u;++l)n.push(s[l])}}return r},packPolygonHierarchy:function(e,r,n){var a=[e];while(a.length>0){var o=a.pop();if(t.defined(o)){var s=o.positions,u=o.holes;if(r[n++]=t.defined(s)?s.length:0,r[n++]=t.defined(u)?u.length:0,t.defined(s))for(var l=s.length,h=0;h<l;++h,n+=3)i.Cartesian3.pack(s[h],r,n);if(t.defined(u))for(var c=u.length,f=0;f<c;++f)a.push(u[f])}}return n},unpackPolygonHierarchy:function(e,t){for(var r=e[t++],n=e[t++],a=new Array(r),o=n>0?new Array(n):void 0,s=0;s<r;++s,t+=i.Cartesian3.packedLength)a[s]=i.Cartesian3.unpack(e,t);for(var u=0;u<n;++u)o[u]=v.unpackPolygonHierarchy(e,t),t=o[u].startingIndex,delete o[u].startingIndex;return{positions:a,holes:o,startingIndex:t}}},m=new i.Cartesian3;function C(e,t,r,n){return i.Cartesian3.subtract(t,e,m),i.Cartesian3.multiplyByScalar(m,r/n,m),i.Cartesian3.add(e,m,m),[m.x,m.y,m.z]}v.subdivideLineCount=function(e,t,r){var n=i.Cartesian3.distance(e,t),a=n/r,o=Math.max(0,Math.ceil(i.CesiumMath.log2(a)));return Math.pow(2,o)};var b=new r.Cartographic,w=new r.Cartographic,T=new r.Cartographic,I=new i.Cartesian3;v.subdivideRhumbLineCount=function(e,t,r,n){var a=e.cartesianToCartographic(t,b),o=e.cartesianToCartographic(r,w),s=new d.EllipsoidRhumbLine(a,o,e),u=s.surfaceDistance/n,l=Math.max(0,Math.ceil(i.CesiumMath.log2(u)));return Math.pow(2,l)},v.subdivideLine=function(e,r,n,a){var o=v.subdivideLineCount(e,r,n),s=i.Cartesian3.distance(e,r),u=s/o;t.defined(a)||(a=[]);var l=a;l.length=3*o;for(var h=0,c=0;c<o;c++){var f=C(e,r,c*u,s);l[h++]=f[0],l[h++]=f[1],l[h++]=f[2]}return l},v.subdivideRhumbLine=function(e,r,n,a,o){var s=e.cartesianToCartographic(r,b),u=e.cartesianToCartographic(n,w),l=new d.EllipsoidRhumbLine(s,u,e),h=l.surfaceDistance/a,c=Math.max(0,Math.ceil(i.CesiumMath.log2(h))),f=Math.pow(2,c),p=l.surfaceDistance/f;t.defined(o)||(o=[]);var y=o;y.length=3*f;for(var g=0,v=0;v<f;v++){var m=l.interpolateUsingSurfaceDistance(v*p,T),C=e.cartographicToCartesian(m,I);y[g++]=C.x,y[g++]=C.y,y[g++]=C.z}return y};var x=new i.Cartesian3,E=new i.Cartesian3,P=new i.Cartesian3,A=new i.Cartesian3;v.scaleToGeodeticHeightExtruded=function(e,n,a,o,s){o=t.defaultValue(o,r.Ellipsoid.WGS84);var u=x,l=E,h=P,c=A;if(t.defined(e)&&t.defined(e.attributes)&&t.defined(e.attributes.position))for(var f=e.attributes.position.values,p=f.length/2,d=0;d<p;d+=3)i.Cartesian3.fromArray(f,d,h),o.geodeticSurfaceNormal(h,u),c=o.scaleToGeodeticSurface(h,c),l=i.Cartesian3.multiplyByScalar(u,a,l),l=i.Cartesian3.add(c,l,l),f[d+p]=l.x,f[d+1+p]=l.y,f[d+2+p]=l.z,s&&(c=i.Cartesian3.clone(h,c)),l=i.Cartesian3.multiplyByScalar(u,n,l),l=i.Cartesian3.add(c,l,l),f[d]=l.x,f[d+1]=l.y,f[d+2]=l.z;return e},v.polygonOutlinesFromHierarchy=function(e,r,n){var a,o,s,u=[],l=new g;l.enqueue(e);while(0!==l.length){var h=l.dequeue(),c=h.positions;if(r)for(s=c.length,a=0;a<s;a++)n.scaleToGeodeticSurface(c[a],c[a]);if(c=f.arrayRemoveDuplicates(c,i.Cartesian3.equalsEpsilon,!0),!(c.length<3)){var p=h.holes?h.holes.length:0;for(a=0;a<p;a++){var d=h.holes[a],y=d.positions;if(r)for(s=y.length,o=0;o<s;++o)n.scaleToGeodeticSurface(y[o],y[o]);if(y=f.arrayRemoveDuplicates(y,i.Cartesian3.equalsEpsilon,!0),!(y.length<3)){u.push(y);var v=0;for(t.defined(d.holes)&&(v=d.holes.length),o=0;o<v;o++)l.enqueue(d.holes[o])}}u.push(c)}}return u},v.polygonsFromHierarchy=function(e,r,n,a){var o=[],s=[],u=new g;u.enqueue(e);while(0!==u.length){var l,h,c=u.dequeue(),p=c.positions,d=c.holes;if(n)for(h=p.length,l=0;l<h;l++)a.scaleToGeodeticSurface(p[l],p[l]);if(p=f.arrayRemoveDuplicates(p,i.Cartesian3.equalsEpsilon,!0),!(p.length<3)){var v=r(p);if(t.defined(v)){var m=[],C=y.PolygonPipeline.computeWindingOrder2D(v);C===y.WindingOrder.CLOCKWISE&&(v.reverse(),p=p.slice().reverse());var b,w=p.slice(),T=t.defined(d)?d.length:0,I=[];for(l=0;l<T;l++){var x=d[l],E=x.positions;if(n)for(h=E.length,b=0;b<h;++b)a.scaleToGeodeticSurface(E[b],E[b]);if(E=f.arrayRemoveDuplicates(E,i.Cartesian3.equalsEpsilon,!0),!(E.length<3)){var P=r(E);if(t.defined(P)){C=y.PolygonPipeline.computeWindingOrder2D(P),C===y.WindingOrder.CLOCKWISE&&(P.reverse(),E=E.slice().reverse()),I.push(E),m.push(w.length),w=w.concat(E),v=v.concat(P);var A=0;for(t.defined(x.holes)&&(A=x.holes.length),b=0;b<A;b++)u.enqueue(x.holes[b])}}}o.push({outerRing:p,holes:I}),s.push({positions:w,positions2D:v,holes:m})}}}return{hierarchy:o,polygons:s}};var _=new r.Cartesian2,G=new i.Cartesian3,L=new u.Quaternion,M=new n.Matrix3;v.computeBoundingRectangle=function(e,r,a,o,s){for(var l=u.Quaternion.fromAxisAngle(e,o,L),h=n.Matrix3.fromQuaternion(l,M),c=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,p=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,y=a.length,g=0;g<y;++g){var v=i.Cartesian3.clone(a[g],G);n.Matrix3.multiplyByVector(h,v,v);var m=r(v,_);t.defined(m)&&(c=Math.min(c,m.x),f=Math.max(f,m.x),p=Math.min(p,m.y),d=Math.max(d,m.y))}return s.x=c,s.y=p,s.width=f-c,s.height=d-p,s},v.createGeometryFromPositions=function(e,t,i,r,n,u){var l=y.PolygonPipeline.triangulate(t.positions2D,t.holes);l.length<3&&(l=[0,1,2]);var c=t.positions;if(r){for(var f=c.length,d=new Array(3*f),g=0,v=0;v<f;v++){var m=c[v];d[g++]=m.x,d[g++]=m.y,d[g++]=m.z}var C=new o.Geometry({attributes:{position:new o.GeometryAttribute({componentDatatype:a.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:d})},indices:l,primitiveType:s.PrimitiveType.TRIANGLES});return n.normal?h.GeometryPipeline.computeNormal(C):C}return u===p.ArcType.GEODESIC?y.PolygonPipeline.computeSubdivision(e,c,l,i):u===p.ArcType.RHUMB?y.PolygonPipeline.computeRhumbLineSubdivision(e,c,l,i):void 0};var D=[],S=new i.Cartesian3,R=new i.Cartesian3;v.computeWallGeometry=function(e,t,r,n,u){var h,f,d,y,g,m=e.length,C=0;if(n)for(f=3*m*2,h=new Array(2*f),d=0;d<m;d++)y=e[d],g=e[(d+1)%m],h[C]=h[C+f]=y.x,++C,h[C]=h[C+f]=y.y,++C,h[C]=h[C+f]=y.z,++C,h[C]=h[C+f]=g.x,++C,h[C]=h[C+f]=g.y,++C,h[C]=h[C+f]=g.z,++C;else{var b=i.CesiumMath.chordLength(r,t.maximumRadius),w=0;if(u===p.ArcType.GEODESIC)for(d=0;d<m;d++)w+=v.subdivideLineCount(e[d],e[(d+1)%m],b);else if(u===p.ArcType.RHUMB)for(d=0;d<m;d++)w+=v.subdivideRhumbLineCount(t,e[d],e[(d+1)%m],b);for(f=3*(w+m),h=new Array(2*f),d=0;d<m;d++){var T;y=e[d],g=e[(d+1)%m],u===p.ArcType.GEODESIC?T=v.subdivideLine(y,g,b,D):u===p.ArcType.RHUMB&&(T=v.subdivideRhumbLine(t,y,g,b,D));for(var I=T.length,x=0;x<I;++x,++C)h[C]=T[x],h[C+f]=T[x];h[C]=g.x,h[C+f]=g.x,++C,h[C]=g.y,h[C+f]=g.y,++C,h[C]=g.z,h[C+f]=g.z,++C}}m=h.length;var E=c.IndexDatatype.createTypedArray(m/3,m-6*e.length),P=0;for(m/=6,d=0;d<m;d++){var A=d,_=A+1,G=A+m,L=G+1;y=i.Cartesian3.fromArray(h,3*A,S),g=i.Cartesian3.fromArray(h,3*_,R),i.Cartesian3.equalsEpsilon(y,g,i.CesiumMath.EPSILON10,i.CesiumMath.EPSILON10)||(E[P++]=A,E[P++]=G,E[P++]=_,E[P++]=_,E[P++]=G,E[P++]=L)}return new o.Geometry({attributes:new l.GeometryAttributes({position:new o.GeometryAttribute({componentDatatype:a.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:h})}),indices:E,primitiveType:s.PrimitiveType.TRIANGLES})},e.PolygonGeometryLibrary=v}));