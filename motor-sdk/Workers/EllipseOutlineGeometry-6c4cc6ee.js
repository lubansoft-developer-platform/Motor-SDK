define(["exports","./when-45f3d25d","./Check-34538dad","./Cartesian3-ef6ea826","./Cartesian2-a652b463","./BoundingSphere-038d5fbc","./ComponentDatatype-d28c2e26","./GeometryAttribute-dfebcc43","./PrimitiveType-30fa6f85","./GeometryAttributes-9d45f9e2","./IndexDatatype-6d2070e9","./GeometryOffsetAttribute-dae9c424","./EllipseGeometryLibrary-1073ad2a"],(function(e,t,i,r,a,n,o,s,l,u,d,p,f){"use strict";var c=new r.Cartesian3,m=new r.Cartesian3,h=new n.BoundingSphere,y=new n.BoundingSphere;function b(e){var i=(e=t.defaultValue(e,t.defaultValue.EMPTY_OBJECT)).center,n=t.defaultValue(e.ellipsoid,a.Ellipsoid.WGS84),o=e.semiMajorAxis,s=e.semiMinorAxis,l=t.defaultValue(e.granularity,r.CesiumMath.RADIANS_PER_DEGREE),u=t.defaultValue(e.height,0),d=t.defaultValue(e.extrudedHeight,u);this._center=r.Cartesian3.clone(i),this._semiMajorAxis=o,this._semiMinorAxis=s,this._ellipsoid=a.Ellipsoid.clone(n),this._rotation=t.defaultValue(e.rotation,0),this._height=Math.max(d,u),this._granularity=l,this._extrudedHeight=Math.min(d,u),this._numberOfVerticalLines=Math.max(t.defaultValue(e.numberOfVerticalLines,16),0),this._offsetAttribute=e.offsetAttribute,this._workerName="createEllipseOutlineGeometry"}b.packedLength=r.Cartesian3.packedLength+a.Ellipsoid.packedLength+8,b.pack=function(e,i,n){return n=t.defaultValue(n,0),r.Cartesian3.pack(e._center,i,n),n+=r.Cartesian3.packedLength,a.Ellipsoid.pack(e._ellipsoid,i,n),n+=a.Ellipsoid.packedLength,i[n++]=e._semiMajorAxis,i[n++]=e._semiMinorAxis,i[n++]=e._rotation,i[n++]=e._height,i[n++]=e._granularity,i[n++]=e._extrudedHeight,i[n++]=e._numberOfVerticalLines,i[n]=t.defaultValue(e._offsetAttribute,-1),i};var A=new r.Cartesian3,_=new a.Ellipsoid,g={center:A,ellipsoid:_,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,numberOfVerticalLines:void 0,offsetAttribute:void 0};b.unpack=function(e,i,n){i=t.defaultValue(i,0);var o=r.Cartesian3.unpack(e,i,A);i+=r.Cartesian3.packedLength;var s=a.Ellipsoid.unpack(e,i,_);i+=a.Ellipsoid.packedLength;var l=e[i++],u=e[i++],d=e[i++],p=e[i++],f=e[i++],c=e[i++],m=e[i++],h=e[i];return t.defined(n)?(n._center=r.Cartesian3.clone(o,n._center),n._ellipsoid=a.Ellipsoid.clone(s,n._ellipsoid),n._semiMajorAxis=l,n._semiMinorAxis=u,n._rotation=d,n._height=p,n._granularity=f,n._extrudedHeight=c,n._numberOfVerticalLines=m,n._offsetAttribute=-1===h?void 0:h,n):(g.height=p,g.extrudedHeight=c,g.granularity=f,g.rotation=d,g.semiMajorAxis=l,g.semiMinorAxis=u,g.numberOfVerticalLines=m,g.offsetAttribute=-1===h?void 0:h,new b(g))},b.createGeometry=function(e){if(!(e._semiMajorAxis<=0||e._semiMinorAxis<=0)){var i=e._height,a=e._extrudedHeight,b=!r.CesiumMath.equalsEpsilon(i,a,0,r.CesiumMath.EPSILON2);e._center=e._ellipsoid.scaleToGeodeticSurface(e._center,e._center);var A,_={center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:e._ellipsoid,rotation:e._rotation,height:i,granularity:e._granularity,numberOfVerticalLines:e._numberOfVerticalLines};if(b)_.extrudedHeight=a,_.offsetAttribute=e._offsetAttribute,A=function(e){var i=e.center,a=e.ellipsoid,l=e.semiMajorAxis,m=r.Cartesian3.multiplyByScalar(a.geodeticSurfaceNormal(i,c),e.height,c);h.center=r.Cartesian3.add(i,m,h.center),h.radius=l,m=r.Cartesian3.multiplyByScalar(a.geodeticSurfaceNormal(i,m),e.extrudedHeight,m),y.center=r.Cartesian3.add(i,m,y.center),y.radius=l;var b=f.EllipseGeometryLibrary.computeEllipsePositions(e,!1,!0).outerPositions,A=new u.GeometryAttributes({position:new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:f.EllipseGeometryLibrary.raisePositionsToHeight(b,e,!0)})});b=A.position.values;var _=n.BoundingSphere.union(h,y),g=b.length/3;if(t.defined(e.offsetAttribute)){var v=new Uint8Array(g);if(e.offsetAttribute===p.GeometryOffsetAttribute.TOP)v=p.arrayFill(v,1,0,g/2);else{var x=e.offsetAttribute===p.GeometryOffsetAttribute.NONE?0:1;v=p.arrayFill(v,x)}A.applyOffset=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:v})}var E=t.defaultValue(e.numberOfVerticalLines,16);E=r.CesiumMath.clamp(E,0,g/2);var M=d.IndexDatatype.createTypedArray(g,2*g+2*E);g/=2;var C,G,L=0;for(C=0;C<g;++C)M[L++]=C,M[L++]=(C+1)%g,M[L++]=C+g,M[L++]=(C+1)%g+g;if(E>0){var O=Math.min(E,g);G=Math.round(g/O);var S=Math.min(G*E,g);for(C=0;C<S;C+=G)M[L++]=C,M[L++]=C+g}return{boundingSphere:_,attributes:A,indices:M}}(_);else if(A=function(e){var t=e.center;m=r.Cartesian3.multiplyByScalar(e.ellipsoid.geodeticSurfaceNormal(t,m),e.height,m),m=r.Cartesian3.add(t,m,m);for(var i=new n.BoundingSphere(m,e.semiMajorAxis),a=f.EllipseGeometryLibrary.computeEllipsePositions(e,!1,!0).outerPositions,l=new u.GeometryAttributes({position:new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:f.EllipseGeometryLibrary.raisePositionsToHeight(a,e,!1)})}),p=a.length/3,c=d.IndexDatatype.createTypedArray(p,2*p),h=0,y=0;y<p;++y)c[h++]=y,c[h++]=(y+1)%p;return{boundingSphere:i,attributes:l,indices:c}}(_),t.defined(e._offsetAttribute)){var g=A.attributes.position.values.length,v=new Uint8Array(g/3),x=e._offsetAttribute===p.GeometryOffsetAttribute.NONE?0:1;p.arrayFill(v,x),A.attributes.applyOffset=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:v})}return new s.Geometry({attributes:A.attributes,indices:A.indices,primitiveType:l.PrimitiveType.LINES,boundingSphere:A.boundingSphere,offsetAttribute:e._offsetAttribute})}},e.EllipseOutlineGeometry=b}));