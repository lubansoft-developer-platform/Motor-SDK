define(["./when-45f3d25d","./Check-34538dad","./Cartesian3-ef6ea826","./Cartesian2-a652b463","./BoundingSphere-038d5fbc","./Transforms-c8a82813","./Matrix4-f54b529f","./RuntimeError-86da6af2","./WebGLConstants-3660bc8f","./AttributeCompression-20de7c5b","./IndexDatatype-6d2070e9","./IntersectionTests-b186d985","./Plane-a0c58786","./createTaskProcessorWorker","./AxisAlignedBoundingBox-9187558e","./EllipsoidTangentPlane-dd3d1016","./OrientedBoundingBox-91354f3d","./Color-44055af0"],(function(e,a,n,r,t,i,o,s,d,f,c,u,h,l,g,p,b,C){"use strict";var v=new n.Cartesian3,y=new r.Ellipsoid,I=new r.Rectangle,m={min:void 0,max:void 0,indexBytesPerElement:void 0};function w(e,a,n){var r=a.length,t=2+r*b.OrientedBoundingBox.packedLength+1+function(e){for(var a=e.length,n=0,r=0;r<a;++r)n+=C.Color.packedLength+3+e[r].batchIds.length;return n}(n),i=new Float64Array(t),o=0;i[o++]=e,i[o++]=r;for(var s=0;s<r;++s)b.OrientedBoundingBox.pack(a[s],i,o),o+=b.OrientedBoundingBox.packedLength;var d=n.length;i[o++]=d;for(var f=0;f<d;++f){var c=n[f];C.Color.pack(c.color,i,o),o+=C.Color.packedLength,i[o++]=c.offset,i[o++]=c.count;var u=c.batchIds,h=u.length;i[o++]=h;for(var l=0;l<h;++l)i[o++]=u[l]}return i}var x=new n.Cartesian3,A=new n.Cartesian3,B=new n.Cartesian3,E=new n.Cartesian3,N=new n.Cartesian3,T=new r.Cartographic,k=new r.Rectangle;return l((function(a,t){var i;!function(e){var a=new Float64Array(e),t=0;m.indexBytesPerElement=a[t++],m.min=a[t++],m.max=a[t++],n.Cartesian3.unpack(a,t,v),t+=n.Cartesian3.packedLength,r.Ellipsoid.unpack(a,t,y),t+=r.Ellipsoid.packedLength,r.Rectangle.unpack(a,t,I)}(a.packedBuffer),i=2===m.indexBytesPerElement?new Uint16Array(a.indices):new Uint32Array(a.indices);var o,s,d,u=new Uint16Array(a.positions),h=new Uint32Array(a.counts),l=new Uint32Array(a.indexCounts),g=new Uint32Array(a.batchIds),p=new Uint32Array(a.batchTableColors),L=new Array(h.length),O=v,U=y,P=I,S=m.min,F=m.max,R=a.minimumHeights,D=a.maximumHeights;e.defined(R)&&e.defined(D)&&(R=new Float32Array(R),D=new Float32Array(D));var M=u.length/2,_=u.subarray(0,M),G=u.subarray(M,2*M);f.AttributeCompression.zigZagDeltaDecode(_,G);var Y=new Float64Array(3*M);for(o=0;o<M;++o){var V=_[o],H=G[o],W=n.CesiumMath.lerp(P.west,P.east,V/32767),z=n.CesiumMath.lerp(P.south,P.north,H/32767),Z=r.Cartographic.fromRadians(W,z,0,T),j=U.cartographicToCartesian(Z,x);n.Cartesian3.pack(j,Y,3*o)}var q=h.length,J=new Array(q),K=new Array(q),Q=0,X=0;for(o=0;o<q;++o)J[o]=Q,K[o]=X,Q+=h[o],X+=l[o];var $,ee=new Float32Array(3*M*2),ae=new Uint16Array(2*M),ne=new Uint32Array(K.length),re=new Uint32Array(l.length),te=[],ie={};for(o=0;o<q;++o)d=p[o],e.defined(ie[d])?(ie[d].positionLength+=h[o],ie[d].indexLength+=l[o],ie[d].batchIds.push(o)):ie[d]={positionLength:h[o],indexLength:l[o],offset:0,indexOffset:0,batchIds:[o]};var oe=0,se=0;for(d in ie)if(ie.hasOwnProperty(d)){($=ie[d]).offset=oe,$.indexOffset=se;var de=2*$.positionLength,fe=2*$.indexLength+6*$.positionLength;oe+=de,se+=fe,$.indexLength=fe}var ce=[];for(d in ie)ie.hasOwnProperty(d)&&($=ie[d],ce.push({color:C.Color.fromRgba(parseInt(d)),offset:$.indexOffset,count:$.indexLength,batchIds:$.batchIds}));for(o=0;o<q;++o){var ue=($=ie[d=p[o]]).offset,he=3*ue,le=ue,ge=J[o],pe=h[o],be=g[o],Ce=S,ve=F;e.defined(R)&&e.defined(D)&&(Ce=R[o],ve=D[o]);var ye=Number.POSITIVE_INFINITY,Ie=Number.NEGATIVE_INFINITY,me=Number.POSITIVE_INFINITY,we=Number.NEGATIVE_INFINITY;for(s=0;s<pe;++s){var xe=n.Cartesian3.unpack(Y,3*ge+3*s,x);U.scaleToGeodeticSurface(xe,xe);var Ae=U.cartesianToCartographic(xe,T),Be=Ae.latitude,Ee=Ae.longitude;ye=Math.min(Be,ye),Ie=Math.max(Be,Ie),me=Math.min(Ee,me),we=Math.max(Ee,we);var Ne=U.geodeticSurfaceNormal(xe,A),Te=n.Cartesian3.multiplyByScalar(Ne,Ce,B),ke=n.Cartesian3.add(xe,Te,E);Te=n.Cartesian3.multiplyByScalar(Ne,ve,Te);var Le=n.Cartesian3.add(xe,Te,N);n.Cartesian3.subtract(Le,O,Le),n.Cartesian3.subtract(ke,O,ke),n.Cartesian3.pack(Le,ee,he),n.Cartesian3.pack(ke,ee,he+3),ae[le]=be,ae[le+1]=be,he+=6,le+=2}(P=k).west=me,P.east=we,P.south=ye,P.north=Ie,L[o]=b.OrientedBoundingBox.fromRectangle(P,S,F,U);var Oe=$.indexOffset,Ue=K[o],Pe=l[o];for(ne[o]=Oe,s=0;s<Pe;s+=3){var Se=i[Ue+s]-ge,Fe=i[Ue+s+1]-ge,Re=i[Ue+s+2]-ge;te[Oe++]=2*Se+ue,te[Oe++]=2*Fe+ue,te[Oe++]=2*Re+ue,te[Oe++]=2*Re+1+ue,te[Oe++]=2*Fe+1+ue,te[Oe++]=2*Se+1+ue}for(s=0;s<pe;++s){var De=s,Me=(s+1)%pe;te[Oe++]=2*De+1+ue,te[Oe++]=2*Me+ue,te[Oe++]=2*De+ue,te[Oe++]=2*De+1+ue,te[Oe++]=2*Me+1+ue,te[Oe++]=2*Me+ue}$.offset+=2*pe,$.indexOffset=Oe,re[o]=Oe-ne[o]}te=c.IndexDatatype.createTypedArray(ee.length/3,te);for(var _e=ce.length,Ge=0;Ge<_e;++Ge){for(var Ye=ce[Ge].batchIds,Ve=0,He=Ye.length,We=0;We<He;++We)Ve+=re[Ye[We]];ce[Ge].count=Ve}var ze=w(2===te.BYTES_PER_ELEMENT?c.IndexDatatype.UNSIGNED_SHORT:c.IndexDatatype.UNSIGNED_INT,L,ce);return t.push(ee.buffer,te.buffer,ne.buffer,re.buffer,ae.buffer,ze.buffer),{positions:ee.buffer,indices:te.buffer,indexOffsets:ne.buffer,indexCounts:re.buffer,batchIds:ae.buffer,packedBuffer:ze.buffer}}))}));