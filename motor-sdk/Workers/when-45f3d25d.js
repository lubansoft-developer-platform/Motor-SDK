define(["exports"],(function(n){"use strict";function r(n,r){return null!=n?n:r}var t,e;function u(n,r,t,e){return o(n).then(r,t,e)}function o(n){var r,t,e;return n instanceof i?r=n:s(n)?(t=f(),n.then((function(n){t.resolve(n)}),(function(n){t.reject(n)}),(function(n){t.progress(n)})),r=t.promise):(e=n,r=new i((function(n){try{return o(n?n(e):e)}catch(n){return c(n)}}))),r}function i(n){this.then=n}function c(n){return new i((function(r,t){try{return t?o(t(n)):c(n)}catch(n){return c(n)}}))}function f(){var n,r,t,e,u,s;return n=new i(h),r=[],t=[],e=function(n,e,u){var o,i;return o=f(),i="function"==typeof u?function(n){try{o.progress(u(n))}catch(n){o.progress(n)}}:function(n){o.progress(n)},r.push((function(r){r.then(n,e).then(o.resolve,o.reject,i)})),t.push(i),o.promise},u=function(n){return p(t,n),n},s=function(n){return n=o(n),e=n.then,s=o,u=g,p(r,n),t=r=void 0,n},{then:h,resolve:l,reject:a,progress:v,promise:n,resolver:{resolve:l,reject:a,progress:v}};function h(n,r,t){return e(n,r,t)}function l(n){return s(n)}function a(n){return s(c(n))}function v(n){return u(n)}}function s(n){return n&&"function"==typeof n.then}function h(n,r,t,e,o){return v(2,arguments),u(n,(function(n){var i,c,s,h,l,a,p,v,y,d;if(y=n.length>>>0,i=Math.max(0,Math.min(r,y)),s=[],c=y-i+1,h=[],l=f(),i)for(v=l.progress,p=function(n){h.push(n),--c||(a=p=g,l.reject(h))},a=function(n){s.push(n),--i||(a=p=g,l.resolve(s))},d=0;d<y;++d)d in n&&u(n[d],m,j,v);else l.resolve(s);return l.then(t,e,o);function j(n){p(n)}function m(n){a(n)}}))}function l(n,r,t,e){return v(1,arguments),a(n,y).then(r,t,e)}function a(n,r){return u(n,(function(n){var t,e,o,i,c,s;if(o=e=n.length>>>0,t=[],s=f(),o)for(i=function(n,e){u(n,r).then((function(n){t[e]=n,--o||s.resolve(t)}),s.reject)},c=0;c<e;c++)c in n?i(n[c],c):--o;else s.resolve(t);return s.promise}))}function p(n,r){for(var t,e=0;t=n[e++];)t(r)}function v(n,r){for(var t,e=r.length;e>n;)if(null!=(t=r[--e])&&"function"!=typeof t)throw new Error("arg "+e+" must be a function")}function g(){}function y(n){return n}r.EMPTY_OBJECT=Object.freeze({}),u.defer=f,u.resolve=o,u.reject=function(n){return u(n,c)},u.join=function(){return a(arguments,y)},u.all=l,u.map=a,u.reduce=function(n,r){var o=e.call(arguments,1);return u(n,(function(n){var e;return e=n.length,o[0]=function(n,t,o){return u(n,(function(n){return u(t,(function(t){return r(n,t,o,e)}))}))},t.apply(n,o)}))},u.any=function(n,r,t,e){return h(n,1,(function(n){return r?r(n[0]):n[0]}),t,e)},u.some=h,u.chain=function(n,r,t){var e=arguments.length>2;return u(n,(function(n){return n=e?t:n,r.resolve(n),n}),(function(n){return r.reject(n),c(n)}),r.progress)},u.isPromise=s,i.prototype={always:function(n,r){return this.then(n,n,r)},otherwise:function(n){return this.then(void 0,n)},yield:function(n){return this.then((function(){return n}))},spread:function(n){return this.then((function(r){return l(r,(function(r){return n.apply(void 0,r)}))}))}},e=[].slice,t=[].reduce||function(n){var r,t,e,u,o;if(o=0,u=(r=Object(this)).length>>>0,(t=arguments).length<=1)for(;;){if(o in r){e=r[o++];break}if(++o>=u)throw new TypeError}else e=t[1];for(;o<u;++o)o in r&&(e=n(e,r[o],o,r));return e},n.defaultValue=r,n.defined=function(n){return null!=n},n.when=u}));