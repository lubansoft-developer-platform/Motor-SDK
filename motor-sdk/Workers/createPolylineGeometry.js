define(["./when-45f3d25d","./Check-34538dad","./Cartesian3-e69091b9","./Cartesian2-7a44370a","./BoundingSphere-bacc5cb6","./Matrix4-c65e6a1b","./RuntimeError-86da6af2","./Rectangle-c7d55cfa","./WebGLConstants-3660bc8f","./ComponentDatatype-86703c58","./GeometryAttribute-4777d9f4","./PrimitiveType-30fa6f85","./Transforms-68229cf3","./GeometryAttributes-9d45f9e2","./IndexDatatype-e52361bd","./IntersectionTests-e782669d","./Plane-18e7e6e4","./VertexFormat-a00562ee","./arrayRemoveDuplicates-24a803e7","./ArcType-39be7a32","./EllipsoidRhumbLine-4bc7760a","./EllipsoidGeodesic-1d7258d7","./PolylinePipeline-8d0912d9","./Color-9b4b19f2"],(function(e,t,r,a,o,n,i,l,s,p,d,c,u,y,f,h,m,v,C,g,w,E,_,b){"use strict";var A=[];function P(e,t,r,a,o){var n,i=A;i.length=o;var l=r.red,s=r.green,p=r.blue,d=r.alpha,c=a.red,u=a.green,y=a.blue,f=a.alpha;if(b.Color.equals(r,a)){for(n=0;n<o;n++)i[n]=b.Color.clone(r);return i}var h=(c-l)/o,m=(u-s)/o,v=(y-p)/o,C=(f-d)/o;for(n=0;n<o;n++)i[n]=new b.Color(l+n*h,s+n*m,p+n*v,d+n*C);return i}function D(o){o=e.defaultValue(o,e.defaultValue.EMPTY_OBJECT);var n=o.positions,i=o.colors,l=e.defaultValue(o.width,1),s=e.defaultValue(o.colorsPerVertex,!1);if(!e.defined(n)||n.length<2)throw new t.DeveloperError("At least two positions are required.");if("number"!==typeof l)throw new t.DeveloperError("width must be a number");if(e.defined(i)&&(s&&i.length<n.length||!s&&i.length<n.length-1))throw new t.DeveloperError("colors has an invalid length.");this._positions=n,this._colors=i,this._width=l,this._colorsPerVertex=s,this._vertexFormat=v.VertexFormat.clone(e.defaultValue(o.vertexFormat,v.VertexFormat.DEFAULT)),this._arcType=e.defaultValue(o.arcType,g.ArcType.GEODESIC),this._granularity=e.defaultValue(o.granularity,r.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=a.Ellipsoid.clone(e.defaultValue(o.ellipsoid,a.Ellipsoid.WGS84)),this._workerName="createPolylineGeometry";var p=1+n.length*r.Cartesian3.packedLength;p+=e.defined(i)?1+i.length*b.Color.packedLength:1,this.packedLength=p+a.Ellipsoid.packedLength+v.VertexFormat.packedLength+4}D.pack=function(o,n,i){if(!e.defined(o))throw new t.DeveloperError("value is required");if(!e.defined(n))throw new t.DeveloperError("array is required");var l;i=e.defaultValue(i,0);var s=o._positions,p=s.length;for(n[i++]=p,l=0;l<p;++l,i+=r.Cartesian3.packedLength)r.Cartesian3.pack(s[l],n,i);var d=o._colors;for(p=e.defined(d)?d.length:0,n[i++]=p,l=0;l<p;++l,i+=b.Color.packedLength)b.Color.pack(d[l],n,i);return a.Ellipsoid.pack(o._ellipsoid,n,i),i+=a.Ellipsoid.packedLength,v.VertexFormat.pack(o._vertexFormat,n,i),i+=v.VertexFormat.packedLength,n[i++]=o._width,n[i++]=o._colorsPerVertex?1:0,n[i++]=o._arcType,n[i]=o._granularity,n};var T=a.Ellipsoid.clone(a.Ellipsoid.UNIT_SPHERE),x=new v.VertexFormat,k={positions:void 0,colors:void 0,ellipsoid:T,vertexFormat:x,width:void 0,colorsPerVertex:void 0,arcType:void 0,granularity:void 0};D.unpack=function(o,n,i){if(!e.defined(o))throw new t.DeveloperError("array is required");var l;n=e.defaultValue(n,0);var s=o[n++],p=new Array(s);for(l=0;l<s;++l,n+=r.Cartesian3.packedLength)p[l]=r.Cartesian3.unpack(o,n);s=o[n++];var d=s>0?new Array(s):void 0;for(l=0;l<s;++l,n+=b.Color.packedLength)d[l]=b.Color.unpack(o,n);var c=a.Ellipsoid.unpack(o,n,T);n+=a.Ellipsoid.packedLength;var u=v.VertexFormat.unpack(o,n,x);n+=v.VertexFormat.packedLength;var y=o[n++],f=1===o[n++],h=o[n++],m=o[n];return e.defined(i)?(i._positions=p,i._colors=d,i._ellipsoid=a.Ellipsoid.clone(c,i._ellipsoid),i._vertexFormat=v.VertexFormat.clone(u,i._vertexFormat),i._width=y,i._colorsPerVertex=f,i._arcType=h,i._granularity=m,i):(k.positions=p,k.colors=d,k.width=y,k.colorsPerVertex=f,k.arcType=h,k.granularity=m,new D(k))};var V=new r.Cartesian3,L=new r.Cartesian3,F=new r.Cartesian3,G=new r.Cartesian3;function R(t,r){return e.defined(r)&&(t=D.unpack(t,r)),t._ellipsoid=a.Ellipsoid.clone(t._ellipsoid),D.createGeometry(t)}return D.createGeometry=function(t){var a,n,i,l=t._width,s=t._vertexFormat,u=t._colors,h=t._colorsPerVertex,m=t._arcType,v=t._granularity,w=t._ellipsoid,E=C.arrayRemoveDuplicates(t._positions,r.Cartesian3.equalsEpsilon),D=E.length;if(!(D<2||l<=0)){if(m===g.ArcType.GEODESIC||m===g.ArcType.RHUMB){var T,x;m===g.ArcType.GEODESIC?(T=r.CesiumMath.chordLength(v,w.maximumRadius),x=_.PolylinePipeline.numberOfPoints):(T=v,x=_.PolylinePipeline.numberOfPointsRhumbLine);var k=_.PolylinePipeline.extractHeights(E,w);if(e.defined(u)){var R=1;for(a=0;a<D-1;++a)R+=x(E[a],E[a+1],T);var O=new Array(R),S=0;for(a=0;a<D-1;++a){var B=E[a],I=E[a+1],U=u[a],N=x(B,I,T);if(h&&a<R){var q=u[a+1],M=P(B,I,U,q,N),H=M.length;for(n=0;n<H;++n)O[S++]=M[n]}else for(n=0;n<N;++n)O[S++]=b.Color.clone(U)}O[S]=b.Color.clone(u[u.length-1]),u=O,A.length=0}E=m===g.ArcType.GEODESIC?_.PolylinePipeline.generateCartesianArc({positions:E,minDistance:T,ellipsoid:w,height:k}):_.PolylinePipeline.generateCartesianRhumbArc({positions:E,granularity:T,ellipsoid:w,height:k})}D=E.length;var W,Y=4*D-4,z=new Float64Array(3*Y),J=new Float64Array(3*Y),j=new Float64Array(3*Y),K=new Float32Array(2*Y),Q=s.st?new Float32Array(2*Y):void 0,X=e.defined(u)?new Uint8Array(4*Y):void 0,Z=0,$=0,ee=0,te=0;for(n=0;n<D;++n){var re,ae;0===n?(W=V,r.Cartesian3.subtract(E[0],E[1],W),r.Cartesian3.add(E[0],W,W)):W=E[n-1],r.Cartesian3.clone(W,F),r.Cartesian3.clone(E[n],L),n===D-1?(W=V,r.Cartesian3.subtract(E[D-1],E[D-2],W),r.Cartesian3.add(E[D-1],W,W)):W=E[n+1],r.Cartesian3.clone(W,G),e.defined(X)&&(re=0===n||h?u[n]:u[n-1],n!==D-1&&(ae=u[n]));var oe=0===n?2:0,ne=n===D-1?2:4;for(i=oe;i<ne;++i){r.Cartesian3.pack(L,z,Z),r.Cartesian3.pack(F,J,Z),r.Cartesian3.pack(G,j,Z),Z+=3;var ie=i-2<0?-1:1;if(K[$++]=i%2*2-1,K[$++]=ie*l,s.st&&(Q[ee++]=n/(D-1),Q[ee++]=Math.max(K[$-2],0)),e.defined(X)){var le=i<2?re:ae;X[te++]=b.Color.floatToByte(le.red),X[te++]=b.Color.floatToByte(le.green),X[te++]=b.Color.floatToByte(le.blue),X[te++]=b.Color.floatToByte(le.alpha)}}}var se=new y.GeometryAttributes;se.position=new d.GeometryAttribute({componentDatatype:p.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:z}),se.prevPosition=new d.GeometryAttribute({componentDatatype:p.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:J}),se.nextPosition=new d.GeometryAttribute({componentDatatype:p.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:j}),se.expandAndWidth=new d.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:K}),s.st&&(se.st=new d.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:Q})),e.defined(X)&&(se.color=new d.GeometryAttribute({componentDatatype:p.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:4,values:X,normalize:!0}));var pe=f.IndexDatatype.createTypedArray(Y,6*D-6),de=0,ce=0,ue=D-1;for(n=0;n<ue;++n)pe[ce++]=de,pe[ce++]=de+2,pe[ce++]=de+1,pe[ce++]=de+1,pe[ce++]=de+2,pe[ce++]=de+3,de+=4;return new d.Geometry({attributes:se,indices:pe,primitiveType:c.PrimitiveType.TRIANGLES,boundingSphere:o.BoundingSphere.fromPoints(E),geometryType:d.GeometryType.POLYLINES})}},R}));