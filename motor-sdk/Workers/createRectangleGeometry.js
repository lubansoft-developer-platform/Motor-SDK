define(["./when-45f3d25d","./Check-34538dad","./Cartesian3-ef6ea826","./Cartesian2-a652b463","./BoundingSphere-038d5fbc","./Transforms-c8a82813","./Matrix4-f54b529f","./RuntimeError-86da6af2","./WebGLConstants-3660bc8f","./ComponentDatatype-d28c2e26","./GeometryAttribute-dfebcc43","./PrimitiveType-30fa6f85","./GeometryAttributes-9d45f9e2","./AttributeCompression-20de7c5b","./GeometryPipeline-f4ca2db7","./EncodedCartesian3-f0b88724","./IndexDatatype-6d2070e9","./IntersectionTests-b186d985","./Plane-a0c58786","./GeometryOffsetAttribute-dae9c424","./VertexFormat-06aa4e32","./GeometryInstance-0849bfce","./EllipsoidRhumbLine-0c6cd7c8","./PolygonPipeline-28c8c9d7","./RectangleGeometryLibrary-1119b3bc"],(function(t,e,a,r,n,i,o,s,l,u,c,m,d,p,g,y,f,h,v,b,_,A,x,w,C){"use strict";var R=new a.Cartesian3,E=new a.Cartesian3,F=new a.Cartesian3,G=new a.Cartesian3,P=new r.Rectangle,V=new r.Cartesian2,L=new n.BoundingSphere,D=new n.BoundingSphere;function M(t,e){var a=new c.Geometry({attributes:new d.GeometryAttributes,primitiveType:m.PrimitiveType.TRIANGLES});return a.attributes.position=new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:e.positions}),t.normal&&(a.attributes.normal=new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.normals})),t.tangent&&(a.attributes.tangent=new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.tangents})),t.bitangent&&(a.attributes.bitangent=new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.bitangents})),a}var T=new a.Cartesian3,O=new a.Cartesian3;function N(t,e){var r=t._vertexFormat,n=t._ellipsoid,i=e.height,s=e.width,l=e.northCap,m=e.southCap,d=0,p=i,g=i,y=0;l&&(d=1,g-=1,y+=1),m&&(p-=1,g-=1,y+=1),y+=s*g;for(var h=r.position?new Float64Array(3*y):void 0,v=r.st?new Float32Array(2*y):void 0,b=0,_=0,A=R,x=V,w=Number.MAX_VALUE,P=Number.MAX_VALUE,L=-Number.MAX_VALUE,D=-Number.MAX_VALUE,T=d;T<p;++T)for(var O=0;O<s;++O)C.RectangleGeometryLibrary.computePosition(e,n,r.st,T,O,A,x),h[b++]=A.x,h[b++]=A.y,h[b++]=A.z,r.st&&(v[_++]=x.x,v[_++]=x.y,w=Math.min(w,x.x),P=Math.min(P,x.y),L=Math.max(L,x.x),D=Math.max(D,x.y));if(l&&(C.RectangleGeometryLibrary.computePosition(e,n,r.st,0,0,A,x),h[b++]=A.x,h[b++]=A.y,h[b++]=A.z,r.st&&(v[_++]=x.x,v[_++]=x.y,w=x.x,P=x.y,L=x.x,D=x.y)),m&&(C.RectangleGeometryLibrary.computePosition(e,n,r.st,i-1,0,A,x),h[b++]=A.x,h[b++]=A.y,h[b]=A.z,r.st&&(v[_++]=x.x,v[_]=x.y,w=Math.min(w,x.x),P=Math.min(P,x.y),L=Math.max(L,x.x),D=Math.max(D,x.y))),r.st&&(w<0||P<0||L>1||D>1))for(var N=0;N<v.length;N+=2)v[N]=(v[N]-w)/(L-w),v[N+1]=(v[N+1]-P)/(D-P);var S=function(t,e,r,n){var i=t.length,s=e.normal?new Float32Array(i):void 0,l=e.tangent?new Float32Array(i):void 0,u=e.bitangent?new Float32Array(i):void 0,c=0,m=G,d=F,p=E;if(e.normal||e.tangent||e.bitangent)for(var g=0;g<i;g+=3){var y=a.Cartesian3.fromArray(t,g,R),f=c+1,h=c+2;p=r.geodeticSurfaceNormal(y,p),(e.tangent||e.bitangent)&&(a.Cartesian3.cross(a.Cartesian3.UNIT_Z,p,d),o.Matrix3.multiplyByVector(n,d,d),a.Cartesian3.normalize(d,d),e.bitangent&&a.Cartesian3.normalize(a.Cartesian3.cross(p,d,m),m)),e.normal&&(s[c]=p.x,s[f]=p.y,s[h]=p.z),e.tangent&&(l[c]=d.x,l[f]=d.y,l[h]=d.z),e.bitangent&&(u[c]=m.x,u[f]=m.y,u[h]=m.z),c+=3}return M(e,{positions:t,normals:s,tangents:l,bitangents:u})}(h,r,n,e.tangentRotationMatrix),I=6*(s-1)*(g-1);l&&(I+=3*(s-1)),m&&(I+=3*(s-1));var k,H=f.IndexDatatype.createTypedArray(y,I),z=0,B=0;for(k=0;k<g-1;++k){for(var U=0;U<s-1;++U){var Y=z,q=Y+s,X=q+1,Q=Y+1;H[B++]=Y,H[B++]=q,H[B++]=Q,H[B++]=Q,H[B++]=q,H[B++]=X,++z}++z}if(l||m){var W,J,j=y-1,Z=y-1;if(l&&m&&(j=y-2),z=0,l)for(k=0;k<s-1;k++)J=(W=z)+1,H[B++]=j,H[B++]=W,H[B++]=J,++z;if(m)for(z=(g-1)*s,k=0;k<s-1;k++)J=(W=z)+1,H[B++]=W,H[B++]=Z,H[B++]=J,++z}return S.indices=H,r.st&&(S.attributes.st=new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:v})),S}function S(t,e,a,r,n){return t[e++]=r[a],t[e++]=r[a+1],t[e++]=r[a+2],t[e++]=n[a],t[e++]=n[a+1],t[e]=n[a+2],t}function I(t,e,a,r){return t[e++]=r[a],t[e++]=r[a+1],t[e++]=r[a],t[e]=r[a+1],t}var k=new _.VertexFormat;function H(e,r){var n,i=e._shadowVolume,o=e._offsetAttribute,s=e._vertexFormat,l=e._extrudedHeight,m=e._surfaceHeight,d=e._ellipsoid,p=r.height,y=r.width;if(i){var h=_.VertexFormat.clone(s,k);h.normal=!0,e._vertexFormat=h}var v=N(e,r);i&&(e._vertexFormat=s);var x=w.PolygonPipeline.scaleToGeodeticHeight(v.attributes.position.values,m,d,!1),C=(x=new Float64Array(x)).length,P=2*C,V=new Float64Array(P);V.set(x);var L=w.PolygonPipeline.scaleToGeodeticHeight(v.attributes.position.values,l,d);V.set(L,C),v.attributes.position.values=V;var D,H,z,B=s.normal?new Float32Array(P):void 0,U=s.tangent?new Float32Array(P):void 0,Y=s.bitangent?new Float32Array(P):void 0,q=s.st?new Float32Array(P/3*2):void 0;if(s.normal){for(H=v.attributes.normal.values,B.set(H),n=0;n<C;n++)H[n]=-H[n];B.set(H,C),v.attributes.normal.values=B}if(i){H=v.attributes.normal.values,s.normal||(v.attributes.normal=void 0);var X=new Float32Array(P);for(n=0;n<C;n++)H[n]=-H[n];X.set(H,C),v.attributes.extrudeDirection=new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:X})}var Q=t.defined(o);if(Q){var W=C/3*2,J=new Uint8Array(W);o===b.GeometryOffsetAttribute.TOP?J=b.arrayFill(J,1,0,W/2):(z=o===b.GeometryOffsetAttribute.NONE?0:1,J=b.arrayFill(J,z)),v.attributes.applyOffset=new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:J})}if(s.tangent){var j=v.attributes.tangent.values;for(U.set(j),n=0;n<C;n++)j[n]=-j[n];U.set(j,C),v.attributes.tangent.values=U}if(s.bitangent){var Z=v.attributes.bitangent.values;Y.set(Z),Y.set(Z,C),v.attributes.bitangent.values=Y}s.st&&(D=v.attributes.st.values,q.set(D),q.set(D,C/3*2),v.attributes.st.values=q);var K=v.indices,$=K.length,tt=C/3,et=f.IndexDatatype.createTypedArray(P/3,2*$);for(et.set(K),n=0;n<$;n+=3)et[n+$]=K[n+2]+tt,et[n+1+$]=K[n+1]+tt,et[n+2+$]=K[n]+tt;v.indices=et;var at=r.northCap,rt=r.southCap,nt=p,it=2,ot=0,st=4,lt=4;at&&(it-=1,nt-=1,ot+=1,st-=2,lt-=1),rt&&(it-=1,nt-=1,ot+=1,st-=2,lt-=1);var ut=2*((ot+=it*y+2*nt-st)+lt),ct=new Float64Array(3*ut),mt=i?new Float32Array(3*ut):void 0,dt=Q?new Uint8Array(ut):void 0,pt=s.st?new Float32Array(2*ut):void 0,gt=o===b.GeometryOffsetAttribute.TOP;Q&&!gt&&(z=o===b.GeometryOffsetAttribute.ALL?1:0,dt=b.arrayFill(dt,z));var yt,ft=0,ht=0,vt=0,bt=0,_t=y*nt;for(n=0;n<_t;n+=y)ct=S(ct,ft,yt=3*n,x,L),ft+=6,s.st&&(pt=I(pt,ht,2*n,D),ht+=4),i&&(vt+=3,mt[vt++]=H[yt],mt[vt++]=H[yt+1],mt[vt++]=H[yt+2]),gt&&(dt[bt++]=1,bt+=1);if(rt){var At=at?_t+1:_t;for(yt=3*At,n=0;n<2;n++)ct=S(ct,ft,yt,x,L),ft+=6,s.st&&(pt=I(pt,ht,2*At,D),ht+=4),i&&(vt+=3,mt[vt++]=H[yt],mt[vt++]=H[yt+1],mt[vt++]=H[yt+2]),gt&&(dt[bt++]=1,bt+=1)}else for(n=_t-y;n<_t;n++)ct=S(ct,ft,yt=3*n,x,L),ft+=6,s.st&&(pt=I(pt,ht,2*n,D),ht+=4),i&&(vt+=3,mt[vt++]=H[yt],mt[vt++]=H[yt+1],mt[vt++]=H[yt+2]),gt&&(dt[bt++]=1,bt+=1);for(n=_t-1;n>0;n-=y)ct=S(ct,ft,yt=3*n,x,L),ft+=6,s.st&&(pt=I(pt,ht,2*n,D),ht+=4),i&&(vt+=3,mt[vt++]=H[yt],mt[vt++]=H[yt+1],mt[vt++]=H[yt+2]),gt&&(dt[bt++]=1,bt+=1);if(at){var xt=_t;for(yt=3*xt,n=0;n<2;n++)ct=S(ct,ft,yt,x,L),ft+=6,s.st&&(pt=I(pt,ht,2*xt,D),ht+=4),i&&(vt+=3,mt[vt++]=H[yt],mt[vt++]=H[yt+1],mt[vt++]=H[yt+2]),gt&&(dt[bt++]=1,bt+=1)}else for(n=y-1;n>=0;n--)ct=S(ct,ft,yt=3*n,x,L),ft+=6,s.st&&(pt=I(pt,ht,2*n,D),ht+=4),i&&(vt+=3,mt[vt++]=H[yt],mt[vt++]=H[yt+1],mt[vt++]=H[yt+2]),gt&&(dt[bt++]=1,bt+=1);var wt=function(t,e,r){var n=t.length,i=e.normal?new Float32Array(n):void 0,o=e.tangent?new Float32Array(n):void 0,s=e.bitangent?new Float32Array(n):void 0,l=0,u=0,c=0,m=!0,d=G,p=F,g=E;if(e.normal||e.tangent||e.bitangent)for(var y=0;y<n;y+=6){var f=a.Cartesian3.fromArray(t,y,R),h=a.Cartesian3.fromArray(t,(y+6)%n,T);if(m){var v=a.Cartesian3.fromArray(t,(y+3)%n,O);a.Cartesian3.subtract(h,f,h),a.Cartesian3.subtract(v,f,v),g=a.Cartesian3.normalize(a.Cartesian3.cross(v,h,g),g),m=!1}a.Cartesian3.equalsEpsilon(h,f,a.CesiumMath.EPSILON10)&&(m=!0),(e.tangent||e.bitangent)&&(d=r.geodeticSurfaceNormal(f,d),e.tangent&&(p=a.Cartesian3.normalize(a.Cartesian3.cross(d,g,p),p))),e.normal&&(i[l++]=g.x,i[l++]=g.y,i[l++]=g.z,i[l++]=g.x,i[l++]=g.y,i[l++]=g.z),e.tangent&&(o[u++]=p.x,o[u++]=p.y,o[u++]=p.z,o[u++]=p.x,o[u++]=p.y,o[u++]=p.z),e.bitangent&&(s[c++]=d.x,s[c++]=d.y,s[c++]=d.z,s[c++]=d.x,s[c++]=d.y,s[c++]=d.z)}return M(e,{positions:t,normals:i,tangents:o,bitangents:s})}(ct,s,d);s.st&&(wt.attributes.st=new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:pt})),i&&(wt.attributes.extrudeDirection=new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:mt})),Q&&(wt.attributes.applyOffset=new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:dt}));var Ct,Rt,Et,Ft,Gt=f.IndexDatatype.createTypedArray(ut,6*ot);C=ct.length/3;var Pt=0;for(n=0;n<C-1;n+=2){Ft=((Ct=n)+2)%C;var Vt=a.Cartesian3.fromArray(ct,3*Ct,T),Lt=a.Cartesian3.fromArray(ct,3*Ft,O);a.Cartesian3.equalsEpsilon(Vt,Lt,a.CesiumMath.EPSILON10)||(Et=(2+(Rt=(Ct+1)%C))%C,Gt[Pt++]=Ct,Gt[Pt++]=Rt,Gt[Pt++]=Ft,Gt[Pt++]=Ft,Gt[Pt++]=Rt,Gt[Pt++]=Et)}return wt.indices=Gt,(wt=g.GeometryPipeline.combineInstances([new A.GeometryInstance({geometry:v}),new A.GeometryInstance({geometry:wt})]))[0]}var z=[new a.Cartesian3,new a.Cartesian3,new a.Cartesian3,new a.Cartesian3],B=new r.Cartographic,U=new r.Cartographic;function Y(t,e,a,n,i){if(0===a)return r.Rectangle.clone(t,i);var o=C.RectangleGeometryLibrary.computeOptions(t,e,a,0,P,B),s=o.height,l=o.width,u=z;return C.RectangleGeometryLibrary.computePosition(o,n,!1,0,0,u[0]),C.RectangleGeometryLibrary.computePosition(o,n,!1,0,l-1,u[1]),C.RectangleGeometryLibrary.computePosition(o,n,!1,s-1,0,u[2]),C.RectangleGeometryLibrary.computePosition(o,n,!1,s-1,l-1,u[3]),r.Rectangle.fromCartesianArray(u,n,i)}function q(e){var n=(e=t.defaultValue(e,t.defaultValue.EMPTY_OBJECT)).rectangle,i=t.defaultValue(e.height,0),o=t.defaultValue(e.extrudedHeight,i);this._rectangle=r.Rectangle.clone(n),this._granularity=t.defaultValue(e.granularity,a.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=r.Ellipsoid.clone(t.defaultValue(e.ellipsoid,r.Ellipsoid.WGS84)),this._surfaceHeight=Math.max(i,o),this._rotation=t.defaultValue(e.rotation,0),this._stRotation=t.defaultValue(e.stRotation,0),this._vertexFormat=_.VertexFormat.clone(t.defaultValue(e.vertexFormat,_.VertexFormat.DEFAULT)),this._extrudedHeight=Math.min(i,o),this._shadowVolume=t.defaultValue(e.shadowVolume,!1),this._workerName="createRectangleGeometry",this._offsetAttribute=e.offsetAttribute,this._rotatedRectangle=void 0,this._textureCoordinateRotationPoints=void 0}q.packedLength=r.Rectangle.packedLength+r.Ellipsoid.packedLength+_.VertexFormat.packedLength+7,q.pack=function(e,a,n){return n=t.defaultValue(n,0),r.Rectangle.pack(e._rectangle,a,n),n+=r.Rectangle.packedLength,r.Ellipsoid.pack(e._ellipsoid,a,n),n+=r.Ellipsoid.packedLength,_.VertexFormat.pack(e._vertexFormat,a,n),n+=_.VertexFormat.packedLength,a[n++]=e._granularity,a[n++]=e._surfaceHeight,a[n++]=e._rotation,a[n++]=e._stRotation,a[n++]=e._extrudedHeight,a[n++]=e._shadowVolume?1:0,a[n]=t.defaultValue(e._offsetAttribute,-1),a};var X=new r.Rectangle,Q=r.Ellipsoid.clone(r.Ellipsoid.UNIT_SPHERE),W={rectangle:X,ellipsoid:Q,vertexFormat:k,granularity:void 0,height:void 0,rotation:void 0,stRotation:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};q.unpack=function(e,a,n){a=t.defaultValue(a,0);var i=r.Rectangle.unpack(e,a,X);a+=r.Rectangle.packedLength;var o=r.Ellipsoid.unpack(e,a,Q);a+=r.Ellipsoid.packedLength;var s=_.VertexFormat.unpack(e,a,k);a+=_.VertexFormat.packedLength;var l=e[a++],u=e[a++],c=e[a++],m=e[a++],d=e[a++],p=1===e[a++],g=e[a];return t.defined(n)?(n._rectangle=r.Rectangle.clone(i,n._rectangle),n._ellipsoid=r.Ellipsoid.clone(o,n._ellipsoid),n._vertexFormat=_.VertexFormat.clone(s,n._vertexFormat),n._granularity=l,n._surfaceHeight=u,n._rotation=c,n._stRotation=m,n._extrudedHeight=d,n._shadowVolume=p,n._offsetAttribute=-1===g?void 0:g,n):(W.granularity=l,W.height=u,W.rotation=c,W.stRotation=m,W.extrudedHeight=d,W.shadowVolume=p,W.offsetAttribute=-1===g?void 0:g,new q(W))},q.computeRectangle=function(e,n){var i=(e=t.defaultValue(e,t.defaultValue.EMPTY_OBJECT)).rectangle,o=t.defaultValue(e.granularity,a.CesiumMath.RADIANS_PER_DEGREE),s=t.defaultValue(e.ellipsoid,r.Ellipsoid.WGS84);return Y(i,o,t.defaultValue(e.rotation,0),s,n)};var J=new o.Matrix3,j=new i.Quaternion,Z=new r.Cartographic;q.createGeometry=function(e){if(!a.CesiumMath.equalsEpsilon(e._rectangle.north,e._rectangle.south,a.CesiumMath.EPSILON10)&&!a.CesiumMath.equalsEpsilon(e._rectangle.east,e._rectangle.west,a.CesiumMath.EPSILON10)){var s=e._rectangle,l=e._ellipsoid,m=e._rotation,d=e._stRotation,p=e._vertexFormat,g=C.RectangleGeometryLibrary.computeOptions(s,e._granularity,m,d,P,B,U),y=J;if(0!==d||0!==m){var f=r.Rectangle.center(s,Z),h=l.geodeticSurfaceNormalCartographic(f,T);i.Quaternion.fromAxisAngle(h,-d,j),o.Matrix3.fromQuaternion(j,y)}else o.Matrix3.clone(o.Matrix3.IDENTITY,y);var v,_,A=e._surfaceHeight,x=e._extrudedHeight,R=!a.CesiumMath.equalsEpsilon(A,x,0,a.CesiumMath.EPSILON2);if(g.lonScalar=1/e._rectangle.width,g.latScalar=1/e._rectangle.height,g.tangentRotationMatrix=y,s=e._rectangle,R){v=H(e,g);var E=n.BoundingSphere.fromRectangle3D(s,l,A,D),F=n.BoundingSphere.fromRectangle3D(s,l,x,L);_=n.BoundingSphere.union(E,F)}else{if((v=N(e,g)).attributes.position.values=w.PolygonPipeline.scaleToGeodeticHeight(v.attributes.position.values,A,l,!1),t.defined(e._offsetAttribute)){var G=v.attributes.position.values.length,V=new Uint8Array(G/3),M=e._offsetAttribute===b.GeometryOffsetAttribute.NONE?0:1;b.arrayFill(V,M),v.attributes.applyOffset=new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:V})}_=n.BoundingSphere.fromRectangle3D(s,l,A)}return p.position||delete v.attributes.position,new c.Geometry({attributes:v.attributes,indices:v.indices,primitiveType:v.primitiveType,boundingSphere:_,offsetAttribute:e._offsetAttribute})}},q.createShadowVolume=function(t,e,a){var r=t._granularity,n=t._ellipsoid,i=e(r,n),o=a(r,n);return new q({rectangle:t._rectangle,rotation:t._rotation,ellipsoid:n,stRotation:t._stRotation,granularity:r,extrudedHeight:o,height:i,vertexFormat:_.VertexFormat.POSITION_ONLY,shadowVolume:!0})};var K=new r.Rectangle,$=[new r.Cartesian2,new r.Cartesian2,new r.Cartesian2],tt=new c.Matrix2,et=new r.Cartographic;return Object.defineProperties(q.prototype,{rectangle:{get:function(){return t.defined(this._rotatedRectangle)||(this._rotatedRectangle=Y(this._rectangle,this._granularity,this._rotation,this._ellipsoid)),this._rotatedRectangle}},textureCoordinateRotationPoints:{get:function(){return t.defined(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(t){if(0===t._stRotation)return[0,0,0,1,1,0];var e=r.Rectangle.clone(t._rectangle,K),a=t._granularity,n=t._ellipsoid,i=Y(e,a,t._rotation-t._stRotation,n,K),o=$;o[0].x=i.west,o[0].y=i.south,o[1].x=i.west,o[1].y=i.north,o[2].x=i.east,o[2].y=i.south;for(var s=t.rectangle,l=c.Matrix2.fromRotation(t._stRotation,tt),u=r.Rectangle.center(s,et),m=0;m<3;++m){var d=o[m];d.x-=u.longitude,d.y-=u.latitude,c.Matrix2.multiplyByVector(l,d,d),d.x+=u.longitude,d.y+=u.latitude,d.x=(d.x-s.west)/s.width,d.y=(d.y-s.south)/s.height}var p=o[0],g=o[1],y=o[2],f=new Array(6);return r.Cartesian2.pack(p,f),r.Cartesian2.pack(g,f,2),r.Cartesian2.pack(y,f,4),f}(this)),this._textureCoordinateRotationPoints}}}),function(e,a){return t.defined(a)&&(e=q.unpack(e,a)),e._ellipsoid=r.Ellipsoid.clone(e._ellipsoid),e._rectangle=r.Rectangle.clone(e._rectangle),q.createGeometry(e)}}));