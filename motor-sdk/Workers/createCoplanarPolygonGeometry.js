define(["./when-45f3d25d","./Check-34538dad","./Cartesian3-ef6ea826","./Cartesian2-a652b463","./BoundingSphere-038d5fbc","./Transforms-c8a82813","./Matrix4-f54b529f","./RuntimeError-86da6af2","./WebGLConstants-3660bc8f","./ComponentDatatype-d28c2e26","./GeometryAttribute-dfebcc43","./PrimitiveType-30fa6f85","./GeometryAttributes-9d45f9e2","./AttributeCompression-20de7c5b","./GeometryPipeline-f4ca2db7","./EncodedCartesian3-f0b88724","./IndexDatatype-6d2070e9","./IntersectionTests-b186d985","./Plane-a0c58786","./VertexFormat-06aa4e32","./GeometryInstance-0849bfce","./arrayRemoveDuplicates-e5b24eaf","./BoundingRectangle-13917389","./AxisAlignedBoundingBox-9187558e","./EllipsoidTangentPlane-dd3d1016","./OrientedBoundingBox-91354f3d","./CoplanarPolygonGeometryLibrary-ae493d00","./ArcType-39be7a32","./EllipsoidRhumbLine-0c6cd7c8","./PolygonPipeline-28c8c9d7","./PolygonGeometryLibrary-887a96e9"],(function(e,t,a,n,r,o,i,l,s,p,y,c,u,m,d,g,b,v,f,h,C,x,P,A,w,F,G,L,E,T,D){"use strict";var _=new a.Cartesian3,k=new P.BoundingRectangle,V=new n.Cartesian2,R=new n.Cartesian2,B=new a.Cartesian3,I=new a.Cartesian3,M=new a.Cartesian3,H=new a.Cartesian3,O=new a.Cartesian3,S=new a.Cartesian3,z=new o.Quaternion,N=new i.Matrix3,Q=new i.Matrix3,j=new a.Cartesian3;function U(e,t,r,l,s,m,d,g){var v=e.positions,f=T.PolygonPipeline.triangulate(e.positions2D,e.holes);f.length<3&&(f=[0,1,2]);var h=b.IndexDatatype.createTypedArray(v.length,f.length);h.set(f);var C=N;if(0!==l){var x=o.Quaternion.fromAxisAngle(m,l,z);if(C=i.Matrix3.fromQuaternion(x,C),t.tangent||t.bitangent){x=o.Quaternion.fromAxisAngle(m,-l,z);var P=i.Matrix3.fromQuaternion(x,Q);d=a.Cartesian3.normalize(i.Matrix3.multiplyByVector(P,d,d),d),t.bitangent&&(g=a.Cartesian3.normalize(a.Cartesian3.cross(m,d,g),g))}}else C=i.Matrix3.clone(i.Matrix3.IDENTITY,C);var A=R;t.st&&(A.x=r.x,A.y=r.y);for(var w=v.length,F=3*w,G=new Float64Array(F),L=t.normal?new Float32Array(F):void 0,E=t.tangent?new Float32Array(F):void 0,D=t.bitangent?new Float32Array(F):void 0,k=t.st?new Float32Array(2*w):void 0,B=0,I=0,M=0,H=0,O=0,S=0;S<w;S++){var j=v[S];if(G[B++]=j.x,G[B++]=j.y,G[B++]=j.z,t.st){var U=s(i.Matrix3.multiplyByVector(C,j,_),V);n.Cartesian2.subtract(U,A,U);var Y=a.CesiumMath.clamp(U.x/r.width,0,1),q=a.CesiumMath.clamp(U.y/r.height,0,1);k[O++]=Y,k[O++]=q}t.normal&&(L[I++]=m.x,L[I++]=m.y,L[I++]=m.z),t.tangent&&(E[H++]=d.x,E[H++]=d.y,E[H++]=d.z),t.bitangent&&(D[M++]=g.x,D[M++]=g.y,D[M++]=g.z)}var J=new u.GeometryAttributes;return t.position&&(J.position=new y.GeometryAttribute({componentDatatype:p.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:G})),t.normal&&(J.normal=new y.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:L})),t.tangent&&(J.tangent=new y.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:E})),t.bitangent&&(J.bitangent=new y.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:D})),t.st&&(J.st=new y.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:k})),new y.Geometry({attributes:J,indices:h,primitiveType:c.PrimitiveType.TRIANGLES})}function Y(t){var a=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).polygonHierarchy,r=e.defaultValue(t.vertexFormat,h.VertexFormat.DEFAULT);this._vertexFormat=h.VertexFormat.clone(r),this._polygonHierarchy=a,this._stRotation=e.defaultValue(t.stRotation,0),this._ellipsoid=n.Ellipsoid.clone(e.defaultValue(t.ellipsoid,n.Ellipsoid.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=D.PolygonGeometryLibrary.computeHierarchyPackedLength(a)+h.VertexFormat.packedLength+n.Ellipsoid.packedLength+2}Y.fromPositions=function(t){return new Y({polygonHierarchy:{positions:(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).positions},vertexFormat:t.vertexFormat,stRotation:t.stRotation,ellipsoid:t.ellipsoid})},Y.pack=function(t,a,r){return r=e.defaultValue(r,0),r=D.PolygonGeometryLibrary.packPolygonHierarchy(t._polygonHierarchy,a,r),n.Ellipsoid.pack(t._ellipsoid,a,r),r+=n.Ellipsoid.packedLength,h.VertexFormat.pack(t._vertexFormat,a,r),r+=h.VertexFormat.packedLength,a[r++]=t._stRotation,a[r]=t.packedLength,a};var q=n.Ellipsoid.clone(n.Ellipsoid.UNIT_SPHERE),J=new h.VertexFormat,W={polygonHierarchy:{}};return Y.unpack=function(t,a,r){a=e.defaultValue(a,0);var o=D.PolygonGeometryLibrary.unpackPolygonHierarchy(t,a);a=o.startingIndex,delete o.startingIndex;var i=n.Ellipsoid.unpack(t,a,q);a+=n.Ellipsoid.packedLength;var l=h.VertexFormat.unpack(t,a,J);a+=h.VertexFormat.packedLength;var s=t[a++],p=t[a];return e.defined(r)||(r=new Y(W)),r._polygonHierarchy=o,r._ellipsoid=n.Ellipsoid.clone(i,r._ellipsoid),r._vertexFormat=h.VertexFormat.clone(l,r._vertexFormat),r._stRotation=s,r.packedLength=p,r},Y.createGeometry=function(e){var t=e._vertexFormat,n=e._polygonHierarchy,o=e._stRotation,i=n.positions;if(!((i=x.arrayRemoveDuplicates(i,a.Cartesian3.equalsEpsilon,!0)).length<3)){var l=B,s=I,p=M,c=O,u=S;if(G.CoplanarPolygonGeometryLibrary.computeProjectTo2DArguments(i,H,c,u)){if(l=a.Cartesian3.cross(c,u,l),l=a.Cartesian3.normalize(l,l),!a.Cartesian3.equalsEpsilon(H,a.Cartesian3.ZERO,a.CesiumMath.EPSILON6)){var m=e._ellipsoid.geodeticSurfaceNormal(H,j);a.Cartesian3.dot(l,m)<0&&(l=a.Cartesian3.negate(l,l),c=a.Cartesian3.negate(c,c))}var g=G.CoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction(H,c,u),v=G.CoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction(H,c,u);t.tangent&&(s=a.Cartesian3.clone(c,s)),t.bitangent&&(p=a.Cartesian3.clone(u,p));var f=D.PolygonGeometryLibrary.polygonsFromHierarchy(n,g,!1),h=f.hierarchy,P=f.polygons;if(0!==h.length){i=h[0].outerRing;for(var A=r.BoundingSphere.fromPoints(i),w=D.PolygonGeometryLibrary.computeBoundingRectangle(l,v,i,o,k),F=[],L=0;L<P.length;L++){var E=new C.GeometryInstance({geometry:U(P[L],t,w,o,v,l,s,p)});F.push(E)}var T=d.GeometryPipeline.combineInstances(F)[0];T.attributes.position.values=new Float64Array(T.attributes.position.values),T.indices=b.IndexDatatype.createTypedArray(T.attributes.position.values.length/3,T.indices);var _=T.attributes;return t.position||delete _.position,new y.Geometry({attributes:_,indices:T.indices,primitiveType:T.primitiveType,boundingSphere:A})}}}},function(t,a){return e.defined(a)&&(t=Y.unpack(t,a)),Y.createGeometry(t)}}));