define(["./when-45f3d25d","./Check-34538dad","./Cartesian3-eab74dc0","./Cartesian2-174fefc1","./BoundingSphere-9db3442e","./Transforms-3e7152f2","./Matrix4-22b96d31","./RuntimeError-86da6af2","./WebGLConstants-3660bc8f","./ComponentDatatype-86703c58","./GeometryAttribute-98a8cf59","./PrimitiveType-30fa6f85","./GeometryAttributes-9d45f9e2","./AttributeCompression-6e02a904","./GeometryPipeline-f896c235","./EncodedCartesian3-ceea15a0","./IndexDatatype-cb635cbc","./IntersectionTests-4fa5e272","./Plane-99a0ae01","./VertexFormat-a00562ee","./GeometryInstance-9936ce9d","./arrayRemoveDuplicates-8b568181","./BoundingRectangle-a7c9e6fd","./AxisAlignedBoundingBox-1aaa0e65","./EllipsoidTangentPlane-a1163ec8","./OrientedBoundingBox-b28ad40e","./CoplanarPolygonGeometryLibrary-77d7922a","./ArcType-39be7a32","./EllipsoidRhumbLine-de5cdc57","./PolygonPipeline-05839d65","./PolygonGeometryLibrary-3b97810b"],(function(e,t,a,n,r,o,i,s,l,p,c,y,u,d,m,g,h,v,f,b,C,x,P,A,w,F,G,L,E,T,k){"use strict";var D=new a.Cartesian3,_=new P.BoundingRectangle,V=new n.Cartesian2,R=new n.Cartesian2,B=new a.Cartesian3,I=new a.Cartesian3,M=new a.Cartesian3,H=new a.Cartesian3,O=new a.Cartesian3,S=new a.Cartesian3,z=new o.Quaternion,N=new i.Matrix3,Q=new i.Matrix3,j=new a.Cartesian3;function U(e,t,r,s,l,d,m,g){var v=e.positions,f=T.PolygonPipeline.triangulate(e.positions2D,e.holes);f.length<3&&(f=[0,1,2]);var b=h.IndexDatatype.createTypedArray(v.length,f.length);b.set(f);var C=N;if(0!==s){var x=o.Quaternion.fromAxisAngle(d,s,z);if(C=i.Matrix3.fromQuaternion(x,C),t.tangent||t.bitangent){x=o.Quaternion.fromAxisAngle(d,-s,z);var P=i.Matrix3.fromQuaternion(x,Q);m=a.Cartesian3.normalize(i.Matrix3.multiplyByVector(P,m,m),m),t.bitangent&&(g=a.Cartesian3.normalize(a.Cartesian3.cross(d,m,g),g))}}else C=i.Matrix3.clone(i.Matrix3.IDENTITY,C);var A=R;t.st&&(A.x=r.x,A.y=r.y);for(var w=v.length,F=3*w,G=new Float64Array(F),L=t.normal?new Float32Array(F):void 0,E=t.tangent?new Float32Array(F):void 0,k=t.bitangent?new Float32Array(F):void 0,_=t.st?new Float32Array(2*w):void 0,B=0,I=0,M=0,H=0,O=0,S=0;S<w;S++){var j=v[S];if(G[B++]=j.x,G[B++]=j.y,G[B++]=j.z,t.st){var U=i.Matrix3.multiplyByVector(C,j,D),Y=l(U,V);n.Cartesian2.subtract(Y,A,Y);var q=a.CesiumMath.clamp(Y.x/r.width,0,1),J=a.CesiumMath.clamp(Y.y/r.height,0,1);_[O++]=q,_[O++]=J}t.normal&&(L[I++]=d.x,L[I++]=d.y,L[I++]=d.z),t.tangent&&(E[H++]=m.x,E[H++]=m.y,E[H++]=m.z),t.bitangent&&(k[M++]=g.x,k[M++]=g.y,k[M++]=g.z)}var W=new u.GeometryAttributes;return t.position&&(W.position=new c.GeometryAttribute({componentDatatype:p.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:G})),t.normal&&(W.normal=new c.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:L})),t.tangent&&(W.tangent=new c.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:E})),t.bitangent&&(W.bitangent=new c.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:k})),t.st&&(W.st=new c.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:_})),new c.Geometry({attributes:W,indices:b,primitiveType:y.PrimitiveType.TRIANGLES})}function Y(a){a=e.defaultValue(a,e.defaultValue.EMPTY_OBJECT);var r=a.polygonHierarchy;t.Check.defined("options.polygonHierarchy",r);var o=e.defaultValue(a.vertexFormat,b.VertexFormat.DEFAULT);this._vertexFormat=b.VertexFormat.clone(o),this._polygonHierarchy=r,this._stRotation=e.defaultValue(a.stRotation,0),this._ellipsoid=n.Ellipsoid.clone(e.defaultValue(a.ellipsoid,n.Ellipsoid.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=k.PolygonGeometryLibrary.computeHierarchyPackedLength(r)+b.VertexFormat.packedLength+n.Ellipsoid.packedLength+2}Y.fromPositions=function(a){a=e.defaultValue(a,e.defaultValue.EMPTY_OBJECT),t.Check.defined("options.positions",a.positions);var n={polygonHierarchy:{positions:a.positions},vertexFormat:a.vertexFormat,stRotation:a.stRotation,ellipsoid:a.ellipsoid};return new Y(n)},Y.pack=function(a,r,o){return t.Check.typeOf.object("value",a),t.Check.defined("array",r),o=e.defaultValue(o,0),o=k.PolygonGeometryLibrary.packPolygonHierarchy(a._polygonHierarchy,r,o),n.Ellipsoid.pack(a._ellipsoid,r,o),o+=n.Ellipsoid.packedLength,b.VertexFormat.pack(a._vertexFormat,r,o),o+=b.VertexFormat.packedLength,r[o++]=a._stRotation,r[o]=a.packedLength,r};var q=n.Ellipsoid.clone(n.Ellipsoid.UNIT_SPHERE),J=new b.VertexFormat,W={polygonHierarchy:{}};function Z(t,a){return e.defined(a)&&(t=Y.unpack(t,a)),Y.createGeometry(t)}return Y.unpack=function(a,r,o){t.Check.defined("array",a),r=e.defaultValue(r,0);var i=k.PolygonGeometryLibrary.unpackPolygonHierarchy(a,r);r=i.startingIndex,delete i.startingIndex;var s=n.Ellipsoid.unpack(a,r,q);r+=n.Ellipsoid.packedLength;var l=b.VertexFormat.unpack(a,r,J);r+=b.VertexFormat.packedLength;var p=a[r++],c=a[r];return e.defined(o)||(o=new Y(W)),o._polygonHierarchy=i,o._ellipsoid=n.Ellipsoid.clone(s,o._ellipsoid),o._vertexFormat=b.VertexFormat.clone(l,o._vertexFormat),o._stRotation=p,o.packedLength=c,o},Y.createGeometry=function(e){var t=e._vertexFormat,n=e._polygonHierarchy,o=e._stRotation,i=n.positions;if(i=x.arrayRemoveDuplicates(i,a.Cartesian3.equalsEpsilon,!0),!(i.length<3)){var s=B,l=I,p=M,y=O,u=S,d=G.CoplanarPolygonGeometryLibrary.computeProjectTo2DArguments(i,H,y,u);if(d){if(s=a.Cartesian3.cross(y,u,s),s=a.Cartesian3.normalize(s,s),!a.Cartesian3.equalsEpsilon(H,a.Cartesian3.ZERO,a.CesiumMath.EPSILON6)){var g=e._ellipsoid.geodeticSurfaceNormal(H,j);a.Cartesian3.dot(s,g)<0&&(s=a.Cartesian3.negate(s,s),y=a.Cartesian3.negate(y,y))}var v=G.CoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction(H,y,u),f=G.CoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction(H,y,u);t.tangent&&(l=a.Cartesian3.clone(y,l)),t.bitangent&&(p=a.Cartesian3.clone(u,p));var b=k.PolygonGeometryLibrary.polygonsFromHierarchy(n,v,!1),P=b.hierarchy,A=b.polygons;if(0!==P.length){i=P[0].outerRing;for(var w=r.BoundingSphere.fromPoints(i),F=k.PolygonGeometryLibrary.computeBoundingRectangle(s,f,i,o,_),L=[],E=0;E<A.length;E++){var T=new C.GeometryInstance({geometry:U(A[E],t,F,o,f,s,l,p)});L.push(T)}var D=m.GeometryPipeline.combineInstances(L)[0];D.attributes.position.values=new Float64Array(D.attributes.position.values),D.indices=h.IndexDatatype.createTypedArray(D.attributes.position.values.length/3,D.indices);var V=D.attributes;return t.position||delete V.position,new c.Geometry({attributes:V,indices:D.indices,primitiveType:D.primitiveType,boundingSphere:w})}}}},Z}));