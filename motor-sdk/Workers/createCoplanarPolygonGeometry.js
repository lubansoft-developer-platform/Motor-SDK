define(["./when-45f3d25d","./Check-34538dad","./Cartesian3-e69091b9","./Cartesian2-7a44370a","./BoundingSphere-bacc5cb6","./Matrix4-c65e6a1b","./RuntimeError-86da6af2","./Rectangle-c7d55cfa","./WebGLConstants-3660bc8f","./ComponentDatatype-86703c58","./GeometryAttribute-4777d9f4","./PrimitiveType-30fa6f85","./Transforms-68229cf3","./GeometryAttributes-9d45f9e2","./AttributeCompression-1e177d5e","./GeometryPipeline-fd2a775d","./EncodedCartesian3-7b803d4a","./IndexDatatype-e52361bd","./IntersectionTests-e782669d","./Plane-18e7e6e4","./VertexFormat-a00562ee","./GeometryInstance-734856d8","./arrayRemoveDuplicates-24a803e7","./BoundingRectangle-c7afec11","./EllipsoidTangentPlane-c9b5e9c5","./OrientedBoundingBox-1e79d8b2","./CoplanarPolygonGeometryLibrary-53dfda51","./ArcType-39be7a32","./EllipsoidRhumbLine-4bc7760a","./PolygonPipeline-d8c5b0db","./PolygonGeometryLibrary-a240210e"],(function(e,t,a,n,r,o,i,s,l,p,c,y,d,u,m,g,h,v,b,f,C,x,P,w,A,F,G,L,E,T,k){"use strict";var D=new a.Cartesian3,_=new w.BoundingRectangle,V=new n.Cartesian2,R=new n.Cartesian2,I=new a.Cartesian3,M=new a.Cartesian3,H=new a.Cartesian3,B=new a.Cartesian3,O=new a.Cartesian3,S=new a.Cartesian3,z=new d.Quaternion,N=new o.Matrix3,Q=new o.Matrix3,j=new a.Cartesian3;function U(e,t,r,i,s,l,m,g){var h=e.positions,b=T.PolygonPipeline.triangulate(e.positions2D,e.holes);b.length<3&&(b=[0,1,2]);var f=v.IndexDatatype.createTypedArray(h.length,b.length);f.set(b);var C=N;if(0!==i){var x=d.Quaternion.fromAxisAngle(l,i,z);if(C=o.Matrix3.fromQuaternion(x,C),t.tangent||t.bitangent){x=d.Quaternion.fromAxisAngle(l,-i,z);var P=o.Matrix3.fromQuaternion(x,Q);m=a.Cartesian3.normalize(o.Matrix3.multiplyByVector(P,m,m),m),t.bitangent&&(g=a.Cartesian3.normalize(a.Cartesian3.cross(l,m,g),g))}}else C=o.Matrix3.clone(o.Matrix3.IDENTITY,C);var w=R;t.st&&(w.x=r.x,w.y=r.y);for(var A=h.length,F=3*A,G=new Float64Array(F),L=t.normal?new Float32Array(F):void 0,E=t.tangent?new Float32Array(F):void 0,k=t.bitangent?new Float32Array(F):void 0,_=t.st?new Float32Array(2*A):void 0,I=0,M=0,H=0,B=0,O=0,S=0;S<A;S++){var j=h[S];if(G[I++]=j.x,G[I++]=j.y,G[I++]=j.z,t.st){var U=o.Matrix3.multiplyByVector(C,j,D),Y=s(U,V);n.Cartesian2.subtract(Y,w,Y);var q=a.CesiumMath.clamp(Y.x/r.width,0,1),J=a.CesiumMath.clamp(Y.y/r.height,0,1);_[O++]=q,_[O++]=J}t.normal&&(L[M++]=l.x,L[M++]=l.y,L[M++]=l.z),t.tangent&&(E[B++]=m.x,E[B++]=m.y,E[B++]=m.z),t.bitangent&&(k[H++]=g.x,k[H++]=g.y,k[H++]=g.z)}var W=new u.GeometryAttributes;return t.position&&(W.position=new c.GeometryAttribute({componentDatatype:p.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:G})),t.normal&&(W.normal=new c.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:L})),t.tangent&&(W.tangent=new c.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:E})),t.bitangent&&(W.bitangent=new c.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:k})),t.st&&(W.st=new c.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:_})),new c.Geometry({attributes:W,indices:f,primitiveType:y.PrimitiveType.TRIANGLES})}function Y(a){a=e.defaultValue(a,e.defaultValue.EMPTY_OBJECT);var r=a.polygonHierarchy;t.Check.defined("options.polygonHierarchy",r);var o=e.defaultValue(a.vertexFormat,C.VertexFormat.DEFAULT);this._vertexFormat=C.VertexFormat.clone(o),this._polygonHierarchy=r,this._stRotation=e.defaultValue(a.stRotation,0),this._ellipsoid=n.Ellipsoid.clone(e.defaultValue(a.ellipsoid,n.Ellipsoid.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=k.PolygonGeometryLibrary.computeHierarchyPackedLength(r)+C.VertexFormat.packedLength+n.Ellipsoid.packedLength+2}Y.fromPositions=function(a){a=e.defaultValue(a,e.defaultValue.EMPTY_OBJECT),t.Check.defined("options.positions",a.positions);var n={polygonHierarchy:{positions:a.positions},vertexFormat:a.vertexFormat,stRotation:a.stRotation,ellipsoid:a.ellipsoid};return new Y(n)},Y.pack=function(a,r,o){return t.Check.typeOf.object("value",a),t.Check.defined("array",r),o=e.defaultValue(o,0),o=k.PolygonGeometryLibrary.packPolygonHierarchy(a._polygonHierarchy,r,o),n.Ellipsoid.pack(a._ellipsoid,r,o),o+=n.Ellipsoid.packedLength,C.VertexFormat.pack(a._vertexFormat,r,o),o+=C.VertexFormat.packedLength,r[o++]=a._stRotation,r[o]=a.packedLength,r};var q=n.Ellipsoid.clone(n.Ellipsoid.UNIT_SPHERE),J=new C.VertexFormat,W={polygonHierarchy:{}};function Z(t,a){return e.defined(a)&&(t=Y.unpack(t,a)),Y.createGeometry(t)}return Y.unpack=function(a,r,o){t.Check.defined("array",a),r=e.defaultValue(r,0);var i=k.PolygonGeometryLibrary.unpackPolygonHierarchy(a,r);r=i.startingIndex,delete i.startingIndex;var s=n.Ellipsoid.unpack(a,r,q);r+=n.Ellipsoid.packedLength;var l=C.VertexFormat.unpack(a,r,J);r+=C.VertexFormat.packedLength;var p=a[r++],c=a[r];return e.defined(o)||(o=new Y(W)),o._polygonHierarchy=i,o._ellipsoid=n.Ellipsoid.clone(s,o._ellipsoid),o._vertexFormat=C.VertexFormat.clone(l,o._vertexFormat),o._stRotation=p,o.packedLength=c,o},Y.createGeometry=function(e){var t=e._vertexFormat,n=e._polygonHierarchy,o=e._stRotation,i=n.positions;if(i=P.arrayRemoveDuplicates(i,a.Cartesian3.equalsEpsilon,!0),!(i.length<3)){var s=I,l=M,p=H,y=O,d=S,u=G.CoplanarPolygonGeometryLibrary.computeProjectTo2DArguments(i,B,y,d);if(u){if(s=a.Cartesian3.cross(y,d,s),s=a.Cartesian3.normalize(s,s),!a.Cartesian3.equalsEpsilon(B,a.Cartesian3.ZERO,a.CesiumMath.EPSILON6)){var m=e._ellipsoid.geodeticSurfaceNormal(B,j);a.Cartesian3.dot(s,m)<0&&(s=a.Cartesian3.negate(s,s),y=a.Cartesian3.negate(y,y))}var h=G.CoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction(B,y,d),b=G.CoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction(B,y,d);t.tangent&&(l=a.Cartesian3.clone(y,l)),t.bitangent&&(p=a.Cartesian3.clone(d,p));var f=k.PolygonGeometryLibrary.polygonsFromHierarchy(n,h,!1),C=f.hierarchy,w=f.polygons;if(0!==C.length){i=C[0].outerRing;for(var A=r.BoundingSphere.fromPoints(i),F=k.PolygonGeometryLibrary.computeBoundingRectangle(s,b,i,o,_),L=[],E=0;E<w.length;E++){var T=new x.GeometryInstance({geometry:U(w[E],t,F,o,b,s,l,p)});L.push(T)}var D=g.GeometryPipeline.combineInstances(L)[0];D.attributes.position.values=new Float64Array(D.attributes.position.values),D.indices=v.IndexDatatype.createTypedArray(D.attributes.position.values.length/3,D.indices);var V=D.attributes;return t.position||delete V.position,new c.Geometry({attributes:V,indices:D.indices,primitiveType:D.primitiveType,boundingSphere:A})}}}},Z}));