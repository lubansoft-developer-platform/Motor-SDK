define(["./when-45f3d25d","./Check-34538dad","./Cartesian3-ef6ea826","./Cartesian2-a652b463","./BoundingSphere-038d5fbc","./Transforms-c8a82813","./Matrix4-f54b529f","./RuntimeError-86da6af2","./WebGLConstants-3660bc8f","./ComponentDatatype-d28c2e26","./AttributeCompression-20de7c5b","./IntersectionTests-b186d985","./Plane-a0c58786","./WebMercatorProjection-cf88bfd1","./createTaskProcessorWorker","./AxisAlignedBoundingBox-9187558e","./EllipsoidTangentPlane-dd3d1016","./OrientedBoundingBox-91354f3d","./TerrainEncoding-c24a22bc"],(function(e,t,i,n,a,r,o,s,u,h,d,c,g,l,m,p,v,I,f){"use strict";var E=Uint16Array.BYTES_PER_ELEMENT,T=Int32Array.BYTES_PER_ELEMENT,C=Uint32Array.BYTES_PER_ELEMENT,M=Float32Array.BYTES_PER_ELEMENT,x=Float64Array.BYTES_PER_ELEMENT;function N(t,n,a){a=e.defaultValue(a,i.CesiumMath);for(var r=t.length,o=0;o<r;++o)if(a.equalsEpsilon(t[o],n,i.CesiumMath.EPSILON12))return o;return-1}var b=new n.Cartographic,S=new i.Cartesian3,B=new i.Cartesian3,w=new i.Cartesian3,P=new o.Matrix4;function A(t,a,r,s,u,h,d,c,g,l){for(var m=d.length,p=0;p<m;++p){var v=d[p],I=v.cartographic,f=v.index,E=t.length,T=I.longitude,C=I.latitude;C=i.CesiumMath.clamp(C,-i.CesiumMath.PI_OVER_TWO,i.CesiumMath.PI_OVER_TWO);var M=I.height-h.skirtHeight;h.hMin=Math.min(h.hMin,M),n.Cartographic.fromRadians(T,C,M,b),g&&(b.longitude+=c),g?p===m-1?b.latitude+=l:0===p&&(b.latitude-=l):b.latitude+=c;var x=h.ellipsoid.cartographicToCartesian(b);t.push(x),a.push(M),r.push(n.Cartesian2.clone(r[f])),s.length>0&&s.push(s[f]),o.Matrix4.multiplyByPoint(h.toENU,x,S);var N=h.minimum,B=h.maximum;i.Cartesian3.minimumByComponent(S,N,N),i.Cartesian3.maximumByComponent(S,B,B);var w=h.lastBorderPoint;if(e.defined(w)){var P=w.index;u.push(P,E-1,E,E,f,P)}h.lastBorderPoint=v}}return m((function(t,u){t.ellipsoid=n.Ellipsoid.clone(t.ellipsoid),t.rectangle=n.Rectangle.clone(t.rectangle);var h=function(t,u,h,d,c,g,m,v,y,R){var _,W,F,O,Y,k;e.defined(d)?(_=d.west,W=d.south,F=d.east,O=d.north,Y=d.width,k=d.height):(_=i.CesiumMath.toRadians(c.west),W=i.CesiumMath.toRadians(c.south),F=i.CesiumMath.toRadians(c.east),O=i.CesiumMath.toRadians(c.north),Y=i.CesiumMath.toRadians(d.width),k=i.CesiumMath.toRadians(d.height));var U,V,H=[W,O],L=[_,F],D=r.Transforms.eastNorthUpToFixedFrame(u,h),G=o.Matrix4.inverseTransformation(D,P);v&&(U=l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(W),V=1/(l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(O)-U));var j=new DataView(t),z=Number.POSITIVE_INFINITY,q=Number.NEGATIVE_INFINITY,J=B;J.x=Number.POSITIVE_INFINITY,J.y=Number.POSITIVE_INFINITY,J.z=Number.POSITIVE_INFINITY;var K=w;K.x=Number.NEGATIVE_INFINITY,K.y=Number.NEGATIVE_INFINITY,K.z=Number.NEGATIVE_INFINITY;var Q,X,Z=0,$=0,ee=0;for(X=0;X<4;++X){var te=Z;Q=j.getUint32(te,!0),te+=C;var ie=i.CesiumMath.toRadians(180*j.getFloat64(te,!0));te+=x,-1===N(L,ie)&&L.push(ie);var ne=i.CesiumMath.toRadians(180*j.getFloat64(te,!0));te+=x,-1===N(H,ne)&&H.push(ne),te+=2*x;var ae=j.getInt32(te,!0);te+=T,$+=ae,ae=j.getInt32(te,!0),ee+=3*ae,Z+=Q+C}var re=[],oe=[],se=new Array($),ue=new Array($),he=new Array($),de=v?new Array($):[],ce=new Array(ee),ge=[],le=[],me=[],pe=[],ve=0,Ie=0;for(Z=0,X=0;X<4;++X){Q=j.getUint32(Z,!0);var fe=Z+=C,Ee=i.CesiumMath.toRadians(180*j.getFloat64(Z,!0));Z+=x;var Te=i.CesiumMath.toRadians(180*j.getFloat64(Z,!0));Z+=x;var Ce=i.CesiumMath.toRadians(180*j.getFloat64(Z,!0)),Me=.5*Ce;Z+=x;var xe=i.CesiumMath.toRadians(180*j.getFloat64(Z,!0)),Ne=.5*xe;Z+=x;var be=j.getInt32(Z,!0);Z+=T;var Se=j.getInt32(Z,!0);Z+=T,Z+=T;for(var Be=new Array(be),we=0;we<be;++we){var Pe=Ee+j.getUint8(Z++)*Ce;b.longitude=Pe;var Ae=Te+j.getUint8(Z++)*xe;b.latitude=Ae;var ye=j.getFloat32(Z,!0);if(Z+=M,0!==ye&&ye<R&&(ye*=-Math.pow(2,y)),ye*=6371010*g,b.height=ye,-1!==N(L,Pe)||-1!==N(H,Ae)){var Re=N(re,b,n.Cartographic);if(-1!==Re){Be[we]=oe[Re];continue}re.push(n.Cartographic.clone(b)),oe.push(ve)}Be[we]=ve,Math.abs(Pe-_)<Me?ge.push({index:ve,cartographic:n.Cartographic.clone(b)}):Math.abs(Pe-F)<Me?me.push({index:ve,cartographic:n.Cartographic.clone(b)}):Math.abs(Ae-W)<Ne?le.push({index:ve,cartographic:n.Cartographic.clone(b)}):Math.abs(Ae-O)<Ne&&pe.push({index:ve,cartographic:n.Cartographic.clone(b)}),z=Math.min(ye,z),q=Math.max(ye,q),he[ve]=ye;var _e=h.cartographicToCartesian(b);se[ve]=_e,v&&(de[ve]=(l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(Ae)-U)*V),o.Matrix4.multiplyByPoint(G,_e,S),i.Cartesian3.minimumByComponent(S,J,J),i.Cartesian3.maximumByComponent(S,K,K);var We=(Pe-_)/(F-_);We=i.CesiumMath.clamp(We,0,1);var Fe=(Ae-W)/(O-W);Fe=i.CesiumMath.clamp(Fe,0,1),ue[ve]=new n.Cartesian2(We,Fe),++ve}for(var Oe=3*Se,Ye=0;Ye<Oe;++Ye,++Ie)ce[Ie]=Be[j.getUint16(Z,!0)],Z+=E;if(Q!==Z-fe)throw new s.RuntimeError("Invalid terrain tile.")}se.length=ve,ue.length=ve,he.length=ve,v&&(de.length=ve);var ke=ve,Ue=Ie,Ve={hMin:z,lastBorderPoint:void 0,skirtHeight:m,toENU:G,ellipsoid:h,minimum:J,maximum:K};if(ge.sort((function(e,t){return t.cartographic.latitude-e.cartographic.latitude})),le.sort((function(e,t){return e.cartographic.longitude-t.cartographic.longitude})),me.sort((function(e,t){return e.cartographic.latitude-t.cartographic.latitude})),pe.sort((function(e,t){return t.cartographic.longitude-e.cartographic.longitude})),A(se,he,ue,de,ce,Ve,ge,-1e-5*Y,!0,-1e-5*k),A(se,he,ue,de,ce,Ve,le,-1e-5*k,!1),A(se,he,ue,de,ce,Ve,me,1e-5*Y,!0,1e-5*k),A(se,he,ue,de,ce,Ve,pe,1e-5*k,!1),ge.length>0&&pe.length>0){var He=ge[0].index,Le=ke,De=pe[pe.length-1].index,Ge=se.length-1;ce.push(De,Ge,Le,Le,He,De)}$=se.length;var je,ze=a.BoundingSphere.fromPoints(se);e.defined(d)&&(je=I.OrientedBoundingBox.fromRectangle(d,z,q,h));for(var qe=new f.EllipsoidalOccluder(h).computeHorizonCullingPointPossiblyUnderEllipsoid(u,se,z),Je=new p.AxisAlignedBoundingBox(J,K,u),Ke=new f.TerrainEncoding(Je,Ve.hMin,q,D,!1,v),Qe=new Float32Array($*Ke.getStride()),Xe=0,Ze=0;Ze<$;++Ze)Xe=Ke.encode(Qe,Xe,se[Ze],ue[Ze],he[Ze],void 0,de[Ze]);var $e=ge.map((function(e){return e.index})).reverse(),et=le.map((function(e){return e.index})).reverse(),tt=me.map((function(e){return e.index})).reverse(),it=pe.map((function(e){return e.index})).reverse();return et.unshift(tt[tt.length-1]),et.push($e[0]),it.unshift($e[$e.length-1]),it.push(tt[0]),{vertices:Qe,indices:new Uint16Array(ce),maximumHeight:q,minimumHeight:z,encoding:Ke,boundingSphere3D:ze,orientedBoundingBox:je,occludeePointInScaledSpace:qe,vertexCountWithoutSkirts:ke,indexCountWithoutSkirts:Ue,westIndicesSouthToNorth:$e,southIndicesEastToWest:et,eastIndicesNorthToSouth:tt,northIndicesWestToEast:it}}(t.buffer,t.relativeToCenter,t.ellipsoid,t.rectangle,t.nativeRectangle,t.exaggeration,t.skirtHeight,t.includeWebMercatorT,t.negativeAltitudeExponentBias,t.negativeElevationThreshold),d=h.vertices;u.push(d.buffer);var c=h.indices;return u.push(c.buffer),{vertices:d.buffer,indices:c.buffer,numberOfAttributes:h.encoding.getStride(),minimumHeight:h.minimumHeight,maximumHeight:h.maximumHeight,boundingSphere3D:h.boundingSphere3D,orientedBoundingBox:h.orientedBoundingBox,occludeePointInScaledSpace:h.occludeePointInScaledSpace,encoding:h.encoding,vertexCountWithoutSkirts:h.vertexCountWithoutSkirts,indexCountWithoutSkirts:h.indexCountWithoutSkirts,westIndicesSouthToNorth:h.westIndicesSouthToNorth,southIndicesEastToWest:h.southIndicesEastToWest,eastIndicesNorthToSouth:h.eastIndicesNorthToSouth,northIndicesWestToEast:h.northIndicesWestToEast}}))}));