define(["exports","./when-45f3d25d","./Check-34538dad","./Cartesian3-ef6ea826","./Cartesian2-a652b463","./Transforms-c8a82813","./Matrix4-f54b529f","./IntersectionTests-b186d985","./Plane-a0c58786","./AxisAlignedBoundingBox-9187558e"],(function(e,t,n,i,r,a,o,s,l,d){"use strict";var c=new o.Cartesian4;function f(e,n){e=(n=t.defaultValue(n,r.Ellipsoid.WGS84)).scaleToGeodeticSurface(e);var s=a.Transforms.eastNorthUpToFixedFrame(e,n);this._ellipsoid=n,this._origin=e,this._xAxis=i.Cartesian3.fromCartesian4(o.Matrix4.getColumn(s,0,c)),this._yAxis=i.Cartesian3.fromCartesian4(o.Matrix4.getColumn(s,1,c));var d=i.Cartesian3.fromCartesian4(o.Matrix4.getColumn(s,2,c));this._plane=l.Plane.fromPointNormal(e,d)}Object.defineProperties(f.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},origin:{get:function(){return this._origin}},plane:{get:function(){return this._plane}},xAxis:{get:function(){return this._xAxis}},yAxis:{get:function(){return this._yAxis}},zAxis:{get:function(){return this._plane.normal}}});var p=new d.AxisAlignedBoundingBox;f.fromPoints=function(e,t){return new f(d.AxisAlignedBoundingBox.fromPoints(e,p).center,t)};var u=new s.Ray,h=new i.Cartesian3;f.prototype.projectPointOntoPlane=function(e,n){var a=u;a.origin=e,i.Cartesian3.normalize(e,a.direction);var o=s.IntersectionTests.rayPlane(a,this._plane,h);if(t.defined(o)||(i.Cartesian3.negate(a.direction,a.direction),o=s.IntersectionTests.rayPlane(a,this._plane,h)),t.defined(o)){var l=i.Cartesian3.subtract(o,this._origin,o),d=i.Cartesian3.dot(this._xAxis,l),c=i.Cartesian3.dot(this._yAxis,l);return t.defined(n)?(n.x=d,n.y=c,n):new r.Cartesian2(d,c)}},f.prototype.projectPointsOntoPlane=function(e,n){t.defined(n)||(n=[]);for(var i=0,r=e.length,a=0;a<r;a++){var o=this.projectPointOntoPlane(e[a],n[i]);t.defined(o)&&(n[i]=o,i++)}return n.length=i,n},f.prototype.projectPointToNearestOnPlane=function(e,n){t.defined(n)||(n=new r.Cartesian2);var a=u;a.origin=e,i.Cartesian3.clone(this._plane.normal,a.direction);var o=s.IntersectionTests.rayPlane(a,this._plane,h);t.defined(o)||(i.Cartesian3.negate(a.direction,a.direction),o=s.IntersectionTests.rayPlane(a,this._plane,h));var l=i.Cartesian3.subtract(o,this._origin,o),d=i.Cartesian3.dot(this._xAxis,l),c=i.Cartesian3.dot(this._yAxis,l);return n.x=d,n.y=c,n},f.prototype.projectPointsToNearestOnPlane=function(e,n){t.defined(n)||(n=[]);var i=e.length;n.length=i;for(var r=0;r<i;r++)n[r]=this.projectPointToNearestOnPlane(e[r],n[r]);return n};var x=new i.Cartesian3;f.prototype.projectPointOntoEllipsoid=function(e,n){t.defined(n)||(n=new i.Cartesian3);var r=this._ellipsoid,a=this._origin,o=this._xAxis,s=this._yAxis,l=x;return i.Cartesian3.multiplyByScalar(o,e.x,l),n=i.Cartesian3.add(a,l,n),i.Cartesian3.multiplyByScalar(s,e.y,l),i.Cartesian3.add(n,l,n),r.scaleToGeocentricSurface(n,n),n},f.prototype.projectPointsOntoEllipsoid=function(e,n){var i=e.length;t.defined(n)?n.length=i:n=new Array(i);for(var r=0;r<i;++r)n[r]=this.projectPointOntoEllipsoid(e[r],n[r]);return n},e.EllipsoidTangentPlane=f}));