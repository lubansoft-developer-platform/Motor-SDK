define(["./when-45f3d25d","./Check-34538dad","./Cartesian3-ef6ea826","./Matrix4-f54b529f","./RuntimeError-86da6af2","./WebGLConstants-3660bc8f","./PrimitiveType-30fa6f85","./createTaskProcessorWorker","./CreatePhysicalArray-2cb6a1d4","./materem-cccd3124","./EmWrapperManager-83011cae"],(function(e,t,i,r,a,n,o,l,s,f,d){"use strict";var P,c,m,v,y,u,M,x=Object.freeze({ADD_PRIMITIVE:0,UPDATE:1,PICK_FROM_RAY:2,UPDATE_INSTANCE_MATRIX:3,UPDATE_PRIMITIVE_MATRIX:4}),I={X:0,Y:1,Z:2,Y_UP_TO_Z_UP:r.Matrix4.fromRotationTranslation(r.Matrix3.fromRotationX(i.CesiumMath.PI_OVER_TWO)),Z_UP_TO_Y_UP:r.Matrix4.fromRotationTranslation(r.Matrix3.fromRotationX(-i.CesiumMath.PI_OVER_TWO)),X_UP_TO_Z_UP:r.Matrix4.fromRotationTranslation(r.Matrix3.fromRotationY(-i.CesiumMath.PI_OVER_TWO)),Z_UP_TO_X_UP:r.Matrix4.fromRotationTranslation(r.Matrix3.fromRotationY(i.CesiumMath.PI_OVER_TWO)),X_UP_TO_Y_UP:r.Matrix4.fromRotationTranslation(r.Matrix3.fromRotationZ(i.CesiumMath.PI_OVER_TWO)),Y_UP_TO_X_UP:r.Matrix4.fromRotationTranslation(r.Matrix3.fromRotationZ(-i.CesiumMath.PI_OVER_TWO)),fromName:function(e){return I[e]}},_=Object.freeze(I),p=r.Matrix4.toArray(_.Y_UP_TO_Z_UP),A=new r.Matrix4,T=new r.Matrix4,h=new r.Matrix4;function R(i){switch(i.logicType){case x.UPDATE_INSTANCE_MATRIX:!function(e){var t=e.instanceMatrixArray;for(var i of t){var r=i.modelId,a=i.instanceMatrixTypeArray;if(m.has(r))for(var n=m.get(r),o=0;o<n.length;++o){var l=n[o],s=c.GetPrimitiveCluster(l);0!==s.ptr&&(s.RemoveAllMatrix(),E(s,void 0,p,a,!0))}}}(i);break;case x.ADD_PRIMITIVE:!function(t){var i=t.primitives,r=t.modelId;if(i.length>0&&e.defined(r))for(var a of i)g(r,a)}(i);break;case x.UPDATE_PRIMITIVE_MATRIX:!function(e){var t=e.primitiveMatrixArray;if(t.length>0)for(var i of t){var r=i.modelId,a=i.primitiveMatrixTypeArray;if(m.has(r))for(var n=m.get(r),o=0;o<n.length;++o)G(n[o],a)}}(i);break;case x.UPDATE:c.EnableAllPrimitiveSelected(!1),function(t){if(e.defined(t)&&t.length>0)for(var i=0;i<t.length;++i){var r=t[i];if(m.has(r)){var a=m.get(r);for(var n of a)c.EnablePrimitiveSelected(n,!0)}}}(i.selectedModelIdArray),function(t){if(e.defined(t)&&t.length>0)for(var i=0;i<t.length;++i){var r=t[i].modelId,a=t[i].unSelectedIndexArray;if(m.has(r)){var n=m.get(r);for(var o of n){c.EnablePrimitiveSelected(o,!0);var l=c.GetPrimitiveCluster(o);if(0!==l.ptr){l.EnableAllIndexSelected(!0);for(let e=0;e<a.length;e++)l.EnableIndexSelected(a[e],!1)}}}}}(i.selectedModelIdIndexArray),function(t){if(e.defined(t)&&t.length>0)for(var i=0;i<t.length;++i){var r=t[i];if(m.has(r)){var a=m.get(r);for(var n of a)c.RemovePrimitiveSpatial(n),v.delete(n);m.delete(r)}}}(i.removedModelIdArray);break;case x.PICK_FROM_RAY:return function(t){var i={},r=t.ray,a=t.triangleMode,n=t.lineMode,o=e.defined(t.maxDist)?t.maxDist:.1;if(u.SetRay(r[0],r[1],r[2],r[3],r[4],r[5],o,a,n),c.Select(u,M)){if(a){i.triPrimitives=[];for(let e=0;e<M.GetTriResultElemSize();++e){const t={};C(M.GetTriResultElem(e),t),i.triPrimitives.push(t)}}if(n){i.segPrimitives=[];for(let e=0;e<M.GetSegResultElemSize();++e){const t={};b(M.GetSegResultElem(e),t),i.segPrimitives.push(t)}}}return M.ClearAll(),i}(i);default:throw new t.DeveloperError("physicalLogicType is not a valid value.")}return!0}function g(t,i){var r,a,n=i.physicalArray,o=i.physicalArrayOptions,l=i.projectCenterMatrixArray;if(e.defined(n)){var f=new P.LBSpaSerial,d=P._malloc(n.byteLength);P.HEAPU8.set(n,d),a=f.ReadSpatial(d,n.byteLength),P._free(d),P.destroy(f)}if(e.defined(o)){var y=o.pPtAry,u=o.pBatchIdAry,M=o.pIndexAry,x=o.pEdgeCheckAry,I=o.primitiveMode;a=s.CreatePhysicalArray.createSpaPrimitive(P,c,I,y,u,M,x)}if(e.defined(i.instanceMatrixTypeArray)||e.defined(i.lodInstanceMatrixTypeArray)){var _=c.CreatePrimitiveCluster(a);r=c.AddPrimitiveSpatial(_);var A=e.defined(i.lodInstanceMatrixTypeArray);E(_,l,A?p:void 0,A?i.lodInstanceMatrixTypeArray:i.instanceMatrixTypeArray,A)}else G(r=c.AddPrimitiveSpatial(a),l);return function(e,t){var i;m.has(e)?(i=m.get(e)).push(t):((i=[]).push(t),m.set(e,i)),v.set(t,e)}(t,r),r}function G(t,i){e.defined(i)&&(S(i,y),c.SetPrimitiveSpatialMat(t,y))}function E(t,i,a,n,o){e.defined(i)&&r.Matrix4.fromArray(i,0,A),e.defined(a)&&r.Matrix4.fromArray(a,0,T);for(var l=0;l<n.length;l+=16)r.Matrix4.fromArray(n,l,h),e.defined(a)&&r.Matrix4.multiply(h,T,h),!o&&e.defined(i)&&r.Matrix4.multiply(A,h,h),S(h,y),t.SetIndexMatrix(l/16,y)}function S(e,t){for(var i=0;i<4;++i){var r=t.At(i);r.x=e[4*i],r.y=e[4*i+1],r.z=e[4*i+2],r.w=e[4*i+3]}}function C(e,t){t.modelId=v.get(e.GetResultId().iPrimitiveId),t.isCluster=e.GetResultId().bCluster,t.batchId=e.GetResultId().iBatchId,t.vertices=[{x:e.GetPt0().x,y:e.GetPt0().y,z:e.GetPt0().z},{x:e.GetPt1().x,y:e.GetPt1().y,z:e.GetPt1().z},{x:e.GetPt2().x,y:e.GetPt2().y,z:e.GetPt2().z}],t.pickPt={x:e.GetPickPt().x,y:e.GetPickPt().y,z:e.GetPickPt().z},t.pickDist=e.GetPickDist()}function b(e,t){t.modelId=v.get(e.GetResultId().iPrimitiveId),t.isCluster=e.GetResultId().bCluster,t.batchId=e.GetResultId().iBatchId,t.vertices=[{x:e.GetPt0().x,y:e.GetPt0().y,z:e.GetPt0().z},{x:e.GetPt1().x,y:e.GetPt1().y,z:e.GetPt1().z}],t.segPt={x:e.GetSegPt().x,y:e.GetSegPt().y,z:e.GetSegPt().z},t.pickPt={x:e.GetPickPt().x,y:e.GetPickPt().y,z:e.GetPickPt().z},t.pickDist=e.GetPickDist()}function O(){c=new P.LBSpaMgr,m=new Map,v=new Map,y=new P.LBSpaMat,u=new P.LBSpaSelectCondition,M=new P.LBSpaSelectResult}return function(t){var i=t.data.webAssemblyConfig;if(e.defined(i)){if(e.defined(i.debug))return require([i.debug],(function(e){P=e(),O(),self.onmessage=l(R),self.postMessage(!0)}));d.EmWrapperManager.initWebAssembly(i.wasmBinaryFileES6).then((function(){P=d.emMod,O(),self.onmessage=l(R),self.postMessage(!0)}))}}}));