define(["./when-45f3d25d","./Check-34538dad","./Cartesian3-e69091b9","./Cartesian2-7a44370a","./BoundingSphere-bacc5cb6","./Matrix4-c65e6a1b","./RuntimeError-86da6af2","./Rectangle-c7d55cfa","./WebGLConstants-3660bc8f","./ComponentDatatype-86703c58","./GeometryAttribute-4777d9f4","./PrimitiveType-30fa6f85","./Transforms-68229cf3","./EncodedCartesian3-7b803d4a","./IntersectionTests-e782669d","./Plane-18e7e6e4","./WebMercatorProjection-c32b7757","./arrayRemoveDuplicates-24a803e7","./ArcType-39be7a32","./EllipsoidRhumbLine-4bc7760a","./EllipsoidGeodesic-1d7258d7"],(function(e,a,t,n,r,i,s,o,l,u,c,C,p,d,h,g,f,m,w,y,v){"use strict";function T(a){a=e.defaultValue(a,e.defaultValue.EMPTY_OBJECT),this._ellipsoid=e.defaultValue(a.ellipsoid,n.Ellipsoid.WGS84),this._rectangle=e.defaultValue(a.rectangle,o.Rectangle.MAX_VALUE),this._projection=new r.GeographicProjection(this._ellipsoid),this._numberOfLevelZeroTilesX=e.defaultValue(a.numberOfLevelZeroTilesX,2),this._numberOfLevelZeroTilesY=e.defaultValue(a.numberOfLevelZeroTilesY,1)}Object.defineProperties(T.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}}),T.prototype.getNumberOfXTilesAtLevel=function(e){return this._numberOfLevelZeroTilesX<<e},T.prototype.getNumberOfYTilesAtLevel=function(e){return this._numberOfLevelZeroTilesY<<e},T.prototype.rectangleToNativeRectangle=function(n,r){a.Check.defined("rectangle",n);var i=t.CesiumMath.toDegrees(n.west),s=t.CesiumMath.toDegrees(n.south),l=t.CesiumMath.toDegrees(n.east),u=t.CesiumMath.toDegrees(n.north);return e.defined(r)?(r.west=i,r.south=s,r.east=l,r.north=u,r):new o.Rectangle(i,s,l,u)},T.prototype.tileXYToNativeRectangle=function(e,a,n,r){var i=this.tileXYToRectangle(e,a,n,r);return i.west=t.CesiumMath.toDegrees(i.west),i.south=t.CesiumMath.toDegrees(i.south),i.east=t.CesiumMath.toDegrees(i.east),i.north=t.CesiumMath.toDegrees(i.north),i},T.prototype.tileXYToRectangle=function(a,t,n,r){var i=this._rectangle,s=this.getNumberOfXTilesAtLevel(n),l=this.getNumberOfYTilesAtLevel(n),u=i.width/s,c=a*u+i.west,C=(a+1)*u+i.west,p=i.height/l,d=i.north-t*p,h=i.north-(t+1)*p;return e.defined(r)||(r=new o.Rectangle(c,h,C,d)),r.west=c,r.south=h,r.east=C,r.north=d,r},T.prototype.positionToTileXY=function(a,r,i){var s=this._rectangle;if(o.Rectangle.contains(s,a)){var l=this.getNumberOfXTilesAtLevel(r),u=this.getNumberOfYTilesAtLevel(r),c=s.width/l,C=s.height/u,p=a.longitude;s.east<s.west&&(p+=t.CesiumMath.TWO_PI);var d=(p-s.west)/c|0;d>=l&&(d=l-1);var h=(s.north-a.latitude)/C|0;return h>=u&&(h=u-1),e.defined(i)?(i.x=d,i.y=h,i):new n.Cartesian2(d,h)}};var E=new t.Cartesian3,M=new t.Cartesian3,A=new n.Cartographic,_=new t.Cartesian3,b=new t.Cartesian3,O=new r.BoundingSphere,k=new T,P=[new n.Cartographic,new n.Cartographic,new n.Cartographic,new n.Cartographic],D=new n.Cartesian2,L={};function S(e){n.Cartographic.fromRadians(e.east,e.north,0,P[0]),n.Cartographic.fromRadians(e.west,e.north,0,P[1]),n.Cartographic.fromRadians(e.east,e.south,0,P[2]),n.Cartographic.fromRadians(e.west,e.south,0,P[3]);var a,t=0,r=0,i=0,s=0,o=L._terrainHeightsMaxLevel;for(a=0;a<=o;++a){for(var l=!1,u=0;u<4;++u){var c=P[u];if(k.positionToTileXY(c,a,D),0===u)i=D.x,s=D.y;else if(i!==D.x||s!==D.y){l=!0;break}}if(l)break;t=i,r=s}if(0!==a)return{x:t,y:r,level:a>o?o:a-1}}L.initialize=function(){var a=L._initPromise;return e.defined(a)||(a=p.Resource.fetchJson(p.buildModuleUrl("Assets/approximateTerrainHeights.json")).then((function(e){L._terrainHeights=e})),L._initPromise=a),a},L.getMinimumMaximumHeights=function(r,i){if(a.Check.defined("rectangle",r),!e.defined(L._terrainHeights))throw new a.DeveloperError("You must call ApproximateTerrainHeights.initialize and wait for the promise to resolve before using this function");i=e.defaultValue(i,n.Ellipsoid.WGS84);var s=S(r),l=L._defaultMinTerrainHeight,u=L._defaultMaxTerrainHeight;if(e.defined(s)){var c=s.level+"-"+s.x+"-"+s.y,C=L._terrainHeights[c];e.defined(C)&&(l=C[0],u=C[1]),i.cartographicToCartesian(o.Rectangle.northeast(r,A),E),i.cartographicToCartesian(o.Rectangle.southwest(r,A),M),t.Cartesian3.midpoint(M,E,_);var p=i.scaleToGeodeticSurface(_,b);if(e.defined(p)){var d=t.Cartesian3.distance(_,p);l=Math.min(l,-d)}else l=L._defaultMinTerrainHeight}return l=Math.max(L._defaultMinTerrainHeight,l),{minimumTerrainHeight:l,maximumTerrainHeight:u}},L.getBoundingSphere=function(t,i){if(a.Check.defined("rectangle",t),!e.defined(L._terrainHeights))throw new a.DeveloperError("You must call ApproximateTerrainHeights.initialize and wait for the promise to resolve before using this function");i=e.defaultValue(i,n.Ellipsoid.WGS84);var s=S(t),o=L._defaultMaxTerrainHeight;if(e.defined(s)){var l=s.level+"-"+s.x+"-"+s.y,u=L._terrainHeights[l];e.defined(u)&&(o=u[1])}var c=r.BoundingSphere.fromRectangle3D(t,i,0);return r.BoundingSphere.fromRectangle3D(t,i,o,O),r.BoundingSphere.union(c,O,c)},L._terrainHeightsMaxLevel=6,L._defaultMaxTerrainHeight=9e3,L._defaultMinTerrainHeight=-1e5,L._terrainHeights=void 0,L._initPromise=void 0,Object.defineProperties(L,{initialized:{get:function(){return e.defined(L._terrainHeights)}}});var I=[r.GeographicProjection,f.WebMercatorProjection],R=I.length,x=Math.cos(t.CesiumMath.toRadians(30)),N=Math.cos(t.CesiumMath.toRadians(150)),G=0,H=1e3;function z(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT);var r=t.positions;if(!e.defined(r)||r.length<2)throw new a.DeveloperError("At least two positions are required.");if(e.defined(t.arcType)&&t.arcType!==w.ArcType.GEODESIC&&t.arcType!==w.ArcType.RHUMB)throw new a.DeveloperError("Valid options for arcType are ArcType.GEODESIC and ArcType.RHUMB.");this.width=e.defaultValue(t.width,1),this._positions=r,this.granularity=e.defaultValue(t.granularity,9999),this.loop=e.defaultValue(t.loop,!1),this.arcType=e.defaultValue(t.arcType,w.ArcType.GEODESIC),this._ellipsoid=n.Ellipsoid.WGS84,this._projectionIndex=0,this._planeMode=e.defaultValue(t.isPlaneMode,!1),this._workerName="createGroundPolylineGeometry",this._scene3DOnly=!1}Object.defineProperties(z.prototype,{packedLength:{get:function(){return 1+3*this._positions.length+1+1+1+n.Ellipsoid.packedLength+1+1}}}),z.setProjectionAndEllipsoid=function(e,a){for(var t=0,n=0;n<R;n++)if(a instanceof I[n]){t=n;break}e._projectionIndex=t,e._ellipsoid=a.ellipsoid};var B=new t.Cartesian3,V=new t.Cartesian3,j=new t.Cartesian3;function F(e,a,n,r,i){var s=J(r,e,0,B),o=J(r,e,n,V),l=J(r,a,0,j),u=Q(o,s,V),c=Q(l,s,j);return t.Cartesian3.cross(c,u,i),t.Cartesian3.normalize(i,i)}var Y=new n.Cartographic,U=new t.Cartesian3,q=new t.Cartesian3,W=new t.Cartesian3;function X(e,a,n,r,i,s,o,l,u,c,C){if(0!==i){var p;s===w.ArcType.GEODESIC?p=new v.EllipsoidGeodesic(e,a,o):s===w.ArcType.RHUMB&&(p=new y.EllipsoidRhumbLine(e,a,o));var d=p.surfaceDistance;if(!(d<i))for(var h=F(e,a,r,o,W),g=Math.ceil(d/i),f=d/g,m=f,T=g-1,E=l.length,M=0;M<T;M++){var A=p.interpolateUsingSurfaceDistance(m,Y),_=J(o,A,n,U),b=J(o,A,r,q);t.Cartesian3.pack(h,l,E),t.Cartesian3.pack(_,u,E),t.Cartesian3.pack(b,c,E),C.push(A.latitude),C.push(A.longitude),E+=3,m+=f}}}var Z=new n.Cartographic;function J(e,a,t,r){return n.Cartographic.clone(a,Z),Z.height=t,n.Cartographic.toCartesian(Z,e,r)}function Q(e,a,n){return t.Cartesian3.subtract(e,a,n),t.Cartesian3.normalize(n,n),n}function K(e,a,n,r){return r=Q(e,a,r),r=t.Cartesian3.cross(r,n,r),r=t.Cartesian3.normalize(r,r),r=t.Cartesian3.cross(n,r,r),r}z.pack=function(r,i,s){a.Check.typeOf.object("value",r),a.Check.defined("array",i);var o=e.defaultValue(s,0),l=r._positions,u=l.length;i[o++]=u;for(var c=0;c<u;++c){var C=l[c];t.Cartesian3.pack(C,i,o),o+=3}return i[o++]=r.granularity,i[o++]=r.loop?1:0,i[o++]=r.arcType,n.Ellipsoid.pack(r._ellipsoid,i,o),r._isPlaneMode?(i[o++]=0,i[o++]=0,i[o++]=0):o+=n.Ellipsoid.packedLength,i[o++]=r._projectionIndex,i[o++]=r._scene3DOnly?1:0,i},z.unpack=function(r,i,s){a.Check.defined("array",r);for(var o=e.defaultValue(i,0),l=r[o++],u=new Array(l),c=0;c<l;c++)u[c]=t.Cartesian3.unpack(r,o),o+=3;var C=r[o++],p=1===r[o++],d=r[o++],h=n.Ellipsoid.unpack(r,o);o+=n.Ellipsoid.packedLength;var g=r[o++],f=1===r[o++];return e.defined(s)||(s=new z({positions:u})),t.Cartesian3.equals(h._radii,t.Cartesian3.ZERO)&&(s._planeMode=!0),s._positions=u,s.granularity=C,s.loop=p,s.arcType=d,s._ellipsoid=h,s._projectionIndex=g,s._scene3DOnly=f,s};var $=new t.Cartesian3,ee=new t.Cartesian3,ae=new t.Cartesian3,te=new t.Cartesian3,ne=0,re=-1;function ie(e,a,n,r,i){var s=Q(n,a,te),o=K(e,a,s,$),l=K(r,a,s,ee);if(t.CesiumMath.equalsEpsilon(t.Cartesian3.dot(o,l),re,t.CesiumMath.EPSILON5))return i=t.Cartesian3.cross(s,o,i),i=t.Cartesian3.normalize(i,i),i;i=t.Cartesian3.add(l,o,i),i=t.Cartesian3.normalize(i,i);var u=t.Cartesian3.cross(s,i,ae);return t.Cartesian3.dot(l,u)<ne&&(i=t.Cartesian3.negate(i,i)),i}var se=g.Plane.fromPointNormal(t.Cartesian3.ZERO,t.Cartesian3.UNIT_Y),oe=new t.Cartesian3,le=new t.Cartesian3,ue=new t.Cartesian3,ce=new t.Cartesian3,Ce=new t.Cartesian3,pe=new t.Cartesian3,de=new n.Cartographic,he=new n.Cartographic,ge=new n.Cartographic;z.createGeometry=function(a){if(a._isPlaneMode)return z.createPlaneModeGeometry(a);var r,i,s,o,l,u,c=!a._scene3DOnly,C=a.loop,p=a._ellipsoid,d=a.granularity,g=a.arcType,f=new I[a._projectionIndex](p),v=G,T=H,E=a._positions,M=E.length;2===M&&(C=!1);var A,_,b,O=new y.EllipsoidRhumbLine(void 0,void 0,p),k=[E[0]];for(i=0;i<M-1;i++)s=E[i],o=E[i+1],A=h.IntersectionTests.lineSegmentPlane(s,o,se,pe),!e.defined(A)||t.Cartesian3.equalsEpsilon(A,s,t.CesiumMath.EPSILON7)||t.Cartesian3.equalsEpsilon(A,o,t.CesiumMath.EPSILON7)||(a.arcType===w.ArcType.GEODESIC?k.push(t.Cartesian3.clone(A)):a.arcType===w.ArcType.RHUMB&&(b=p.cartesianToCartographic(A,de).longitude,l=p.cartesianToCartographic(s,de),u=p.cartesianToCartographic(o,he),O.setEndPoints(l,u),_=O.findIntersectionWithLongitude(b,ge),A=p.cartographicToCartesian(_,pe),!e.defined(A)||t.Cartesian3.equalsEpsilon(A,s,t.CesiumMath.EPSILON7)||t.Cartesian3.equalsEpsilon(A,o,t.CesiumMath.EPSILON7)||k.push(t.Cartesian3.clone(A)))),k.push(o);C&&(s=E[M-1],o=E[0],A=h.IntersectionTests.lineSegmentPlane(s,o,se,pe),!e.defined(A)||t.Cartesian3.equalsEpsilon(A,s,t.CesiumMath.EPSILON7)||t.Cartesian3.equalsEpsilon(A,o,t.CesiumMath.EPSILON7)||(a.arcType===w.ArcType.GEODESIC?k.push(t.Cartesian3.clone(A)):a.arcType===w.ArcType.RHUMB&&(b=p.cartesianToCartographic(A,de).longitude,l=p.cartesianToCartographic(s,de),u=p.cartesianToCartographic(o,he),O.setEndPoints(l,u),_=O.findIntersectionWithLongitude(b,ge),A=p.cartographicToCartesian(_,pe),!e.defined(A)||t.Cartesian3.equalsEpsilon(A,s,t.CesiumMath.EPSILON7)||t.Cartesian3.equalsEpsilon(A,o,t.CesiumMath.EPSILON7)||k.push(t.Cartesian3.clone(A)))));var P=k.length,D=new Array(P);for(i=0;i<P;i++){var L=n.Cartographic.fromCartesian(k[i],p);L.height=0,D[i]=L}if(D=m.arrayRemoveDuplicates(D,n.Cartographic.equalsEpsilon),P=D.length,!(P<2)){var S=[],R=[],x=[],N=[],B=oe,V=le,j=ue,Y=ce,U=Ce,q=D[0],W=D[1],Z=D[P-1];for(B=J(p,Z,v,B),Y=J(p,W,v,Y),V=J(p,q,v,V),j=J(p,q,T,j),U=C?ie(B,V,j,Y,U):F(q,W,T,p,U),t.Cartesian3.pack(U,R,0),t.Cartesian3.pack(V,x,0),t.Cartesian3.pack(j,N,0),S.push(q.latitude),S.push(q.longitude),X(q,W,v,T,d,g,p,R,x,N,S),i=1;i<P-1;++i){B=t.Cartesian3.clone(V,B),V=t.Cartesian3.clone(Y,V);var Q=D[i];J(p,Q,T,j),J(p,D[i+1],v,Y),ie(B,V,j,Y,U),r=R.length,t.Cartesian3.pack(U,R,r),t.Cartesian3.pack(V,x,r),t.Cartesian3.pack(j,N,r),S.push(Q.latitude),S.push(Q.longitude),X(D[i],D[i+1],v,T,d,g,p,R,x,N,S)}var K=D[P-1],$=D[P-2];if(V=J(p,K,v,V),j=J(p,K,T,j),C){var ee=D[0];B=J(p,$,v,B),Y=J(p,ee,v,Y),U=ie(B,V,j,Y,U)}else U=F($,K,T,p,U);if(r=R.length,t.Cartesian3.pack(U,R,r),t.Cartesian3.pack(V,x,r),t.Cartesian3.pack(j,N,r),S.push(K.latitude),S.push(K.longitude),C){for(X(K,q,v,T,d,g,p,R,x,N,S),r=R.length,i=0;i<3;++i)R[r+i]=R[i],x[r+i]=x[i],N[r+i]=N[i];S.push(q.latitude),S.push(q.longitude)}return Ca(C,f,x,N,R,S,c)}};let fe=[2,3,6,7],me=new t.Cartesian3,we=new t.Cartesian3,ye=new t.Cartesian3;z.createPlaneModeGeometry=function(e){let a=e._positions,n=e.width,r=a[0],i=a[1],s=t.Cartesian3.UNIT_Z,o=t.Cartesian3.subtract(i,r,ae),l=t.Cartesian3.cross(o,s,me);t.Cartesian3.normalize(l,l);let p=t.Cartesian3.add(r,t.Cartesian3.ZERO,we),d=t.Cartesian3.add(i,t.Cartesian3.ZERO,ye),h=new Float32Array(24),g=new Float32Array(24),f=new Float32Array(24),m=new Float32Array(32),w=new Float32Array(16);t.Cartesian3.pack(r,h,0),t.Cartesian3.pack(i,h,3),t.Cartesian3.pack(d,h,6),t.Cartesian3.pack(p,h,9),t.Cartesian3.pack(r,h,12),t.Cartesian3.pack(i,h,15),t.Cartesian3.pack(d,h,18),t.Cartesian3.pack(p,h,21);let y=[0,1,2,0,2,3,4,7,6,4,6,5,4,0,3,4,3,7,5,6,2,5,2,1,7,3,2,7,2,6,4,5,1,4,1,0];for(let u=0;u<8;u++)t.Cartesian3.pack(r,g,3*u),t.Cartesian3.pack(i,f,3*u),t.Cartesian3.pack(l,m,4*u),m[4*u+3]=n,w[2*u]=fe.includes(u)?1:-1,w[2*u+1]=u<4?1:-1;let v=new c.Geometry({attributes:{position:new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:h}),startPosition:new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:g}),endPosition:new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:f}),rightDirectionAndWidth:new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:4,values:m}),isTopRight:new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:w})},indices:new Uint16Array(y),primitiveType:C.PrimitiveType.TRIANGLES});return v};var ve=new t.Cartesian3,Te=new i.Matrix3,Ee=new p.Quaternion;function Me(e,a,n,r){var s=Q(n,a,ve),o=t.Cartesian3.dot(s,e);if(o>x||o<N){var l=Q(r,n,te),u=o<N?t.CesiumMath.PI_OVER_TWO:-t.CesiumMath.PI_OVER_TWO,c=p.Quaternion.fromAxisAngle(l,u,Ee),C=i.Matrix3.fromQuaternion(c,Te);return i.Matrix3.multiplyByVector(C,e,e),!0}return!1}var Ae=new n.Cartographic,_e=new t.Cartesian3,be=new t.Cartesian3;function Oe(e,a,r,i,s){var o=n.Cartographic.toCartesian(a,e._ellipsoid,_e),l=t.Cartesian3.add(o,r,be),u=!1,c=e._ellipsoid,C=c.cartesianToCartographic(l,Ae);Math.abs(a.longitude-C.longitude)>t.CesiumMath.PI_OVER_TWO&&(u=!0,l=t.Cartesian3.subtract(o,r,be),C=c.cartesianToCartographic(l,Ae)),C.height=0;var p=e.project(C,s);return s=t.Cartesian3.subtract(p,i,s),s.z=0,s=t.Cartesian3.normalize(s,s),u&&t.Cartesian3.negate(s,s),s}var ke=new t.Cartesian3,Pe=new t.Cartesian3;function De(e,a,n,r,i,s){var o=t.Cartesian3.subtract(a,e,ke);t.Cartesian3.normalize(o,o);var l=n-G,u=t.Cartesian3.multiplyByScalar(o,l,Pe);t.Cartesian3.add(e,u,i);var c=r-H;u=t.Cartesian3.multiplyByScalar(o,c,Pe),t.Cartesian3.add(a,u,s)}var Le=new t.Cartesian3;function Se(e,a){var n=g.Plane.getPointDistance(se,e),r=g.Plane.getPointDistance(se,a),i=Le;t.CesiumMath.equalsEpsilon(n,0,t.CesiumMath.EPSILON2)?(i=Q(a,e,i),t.Cartesian3.multiplyByScalar(i,t.CesiumMath.EPSILON2,i),t.Cartesian3.add(e,i,e)):t.CesiumMath.equalsEpsilon(r,0,t.CesiumMath.EPSILON2)&&(i=Q(e,a,i),t.Cartesian3.multiplyByScalar(i,t.CesiumMath.EPSILON2,i),t.Cartesian3.add(a,i,a))}function Ie(e,a){var n=Math.abs(e.longitude),r=Math.abs(a.longitude);if(t.CesiumMath.equalsEpsilon(n,t.CesiumMath.PI,t.CesiumMath.EPSILON11)){var i=t.CesiumMath.sign(a.longitude);return e.longitude=i*(n-t.CesiumMath.EPSILON11),1}if(t.CesiumMath.equalsEpsilon(r,t.CesiumMath.PI,t.CesiumMath.EPSILON11)){var s=t.CesiumMath.sign(e.longitude);return a.longitude=s*(r-t.CesiumMath.EPSILON11),2}return 0}var Re=new n.Cartographic,xe=new n.Cartographic,Ne=new t.Cartesian3,Ge=new t.Cartesian3,He=new t.Cartesian3,ze=new t.Cartesian3,Be=new t.Cartesian3,Ve=new t.Cartesian3,je=[Re,xe],Fe=new o.Rectangle,Ye=new t.Cartesian3,Ue=new t.Cartesian3,qe=new t.Cartesian3,We=new t.Cartesian3,Xe=new t.Cartesian3,Ze=new t.Cartesian3,Je=new t.Cartesian3,Qe=new t.Cartesian3,Ke=new t.Cartesian3,$e=new t.Cartesian3,ea=new t.Cartesian3,aa=new t.Cartesian3,ta=new t.Cartesian3,na=new d.EncodedCartesian3,ra=new d.EncodedCartesian3,ia=new t.Cartesian3,sa=new t.Cartesian3,oa=new t.Cartesian3,la=[new r.BoundingSphere,new r.BoundingSphere],ua=[0,2,1,0,3,2,0,7,3,0,4,7,0,5,4,0,1,5,5,7,4,5,6,7,5,2,6,5,1,2,3,6,2,3,7,6],ca=ua.length;function Ca(e,a,n,i,s,l,C){var p,h,g,f,m,w,y=a._ellipsoid,v=n.length/3-1,T=8*v,E=4*T,M=36*v,A=T>65535?new Uint32Array(M):new Uint16Array(M),_=new Float64Array(3*T),b=new Float32Array(E),O=new Float32Array(E),k=new Float32Array(E),P=new Float32Array(E),D=new Float32Array(E);C&&(g=new Float32Array(E),f=new Float32Array(E),m=new Float32Array(E),w=new Float32Array(2*T));var S=l.length/2,I=0,R=Re;R.height=0;var N=xe;N.height=0;var G=Ne,H=Ge;if(C)for(h=0,p=1;p<S;p++)R.latitude=l[h],R.longitude=l[h+1],N.latitude=l[h+2],N.longitude=l[h+3],G=a.project(R,G),H=a.project(N,H),I+=t.Cartesian3.distance(G,H),h+=2;var z=i.length/3;H=t.Cartesian3.unpack(i,0,H);var B,V=0;for(h=3,p=1;p<z;p++)G=t.Cartesian3.clone(H,G),H=t.Cartesian3.unpack(i,h,H),V+=t.Cartesian3.distance(G,H),h+=3;h=3;var j=0,F=0,Y=0,U=0,q=!1,W=t.Cartesian3.unpack(n,0,ze),X=t.Cartesian3.unpack(i,0,Ge),Z=t.Cartesian3.unpack(s,0,Ve);if(e){var J=t.Cartesian3.unpack(n,n.length-6,He);Me(Z,J,W,X)&&(Z=t.Cartesian3.negate(Z,Z))}var K=0,$=0,ee=0;for(p=0;p<v;p++){var ae,te,ne,re,ie=t.Cartesian3.clone(W,He),se=t.Cartesian3.clone(X,Ne),oe=t.Cartesian3.clone(Z,Be);if(q&&(oe=t.Cartesian3.negate(oe,oe)),W=t.Cartesian3.unpack(n,h,ze),X=t.Cartesian3.unpack(i,h,Ge),Z=t.Cartesian3.unpack(s,h,Ve),q=Me(Z,ie,W,X),R.latitude=l[j],R.longitude=l[j+1],N.latitude=l[j+2],N.longitude=l[j+3],C){var le=Ie(R,N);ae=a.project(R,Xe),te=a.project(N,Ze);var ue=Q(te,ae,ia);ue.y=Math.abs(ue.y),ne=Je,re=Qe,0===le||t.Cartesian3.dot(ue,t.Cartesian3.UNIT_Y)>x?(ne=Oe(a,R,oe,ae,Je),re=Oe(a,N,Z,te,Qe)):1===le?(re=Oe(a,N,Z,te,Qe),ne.x=0,ne.y=t.CesiumMath.sign(R.longitude-Math.abs(N.longitude)),ne.z=0):(ne=Oe(a,R,oe,ae,Je),re.x=0,re.y=t.CesiumMath.sign(R.longitude-N.longitude),re.z=0)}var ce=t.Cartesian3.distance(se,X),Ce=d.EncodedCartesian3.fromCartesian(ie,na),pe=t.Cartesian3.subtract(W,ie,Ke),de=t.Cartesian3.normalize(pe,me),he=t.Cartesian3.subtract(se,ie,$e);he=t.Cartesian3.normalize(he,he);var ge=t.Cartesian3.cross(de,he,me);ge=t.Cartesian3.normalize(ge,ge);var fe=t.Cartesian3.cross(he,oe,aa);fe=t.Cartesian3.normalize(fe,fe);var we=t.Cartesian3.subtract(X,W,ea);we=t.Cartesian3.normalize(we,we);var ye=t.Cartesian3.cross(Z,we,ta);ye=t.Cartesian3.normalize(ye,ye);var ve,Te,Ee,Ae=ce/V,_e=K/V,be=0,ke=0,Pe=0;if(C){be=t.Cartesian3.distance(ae,te),ve=d.EncodedCartesian3.fromCartesian(ae,ra),Te=t.Cartesian3.subtract(te,ae,ia),Ee=t.Cartesian3.normalize(Te,sa);var Le=Ee.x;Ee.x=Ee.y,Ee.y=-Le,ke=be/I,Pe=$/I}for(B=0;B<8;B++){var Ca=U+4*B,da=F+2*B,ha=Ca+3,ga=B<4?1:-1,fa=2===B||3===B||6===B||7===B?1:-1;t.Cartesian3.pack(Ce.high,b,Ca),b[ha]=pe.x,t.Cartesian3.pack(Ce.low,O,Ca),O[ha]=pe.y,t.Cartesian3.pack(fe,k,Ca),k[ha]=pe.z,t.Cartesian3.pack(ye,P,Ca),P[ha]=Ae*ga,t.Cartesian3.pack(ge,D,Ca);var ma=_e*fa;0===ma&&fa<0&&(ma=9),D[ha]=ma,C&&(g[Ca]=ve.high.x,g[Ca+1]=ve.high.y,g[Ca+2]=ve.low.x,g[Ca+3]=ve.low.y,m[Ca]=-ne.y,m[Ca+1]=ne.x,m[Ca+2]=re.y,m[Ca+3]=-re.x,f[Ca]=Te.x,f[Ca+1]=Te.y,f[Ca+2]=Ee.x,f[Ca+3]=Ee.y,w[da]=ke*ga,ma=Pe*fa,0===ma&&fa<0&&(ma=9),w[da+1]=ma)}var wa=qe,ya=We,va=Ye,Ta=Ue,Ea=o.Rectangle.fromCartographicArray(je,Fe),Ma=L.getMinimumMaximumHeights(Ea,y),Aa=Ma.minimumTerrainHeight,_a=Ma.maximumTerrainHeight;ee+=Aa,ee+=_a,De(ie,se,Aa,_a,wa,va),De(W,X,Aa,_a,ya,Ta);var ba=t.Cartesian3.multiplyByScalar(ge,t.CesiumMath.EPSILON5,oa);t.Cartesian3.add(wa,ba,wa),t.Cartesian3.add(ya,ba,ya),t.Cartesian3.add(va,ba,va),t.Cartesian3.add(Ta,ba,Ta),Se(wa,ya),Se(va,Ta),t.Cartesian3.pack(wa,_,Y),t.Cartesian3.pack(ya,_,Y+3),t.Cartesian3.pack(Ta,_,Y+6),t.Cartesian3.pack(va,_,Y+9),ba=t.Cartesian3.multiplyByScalar(ge,-2*t.CesiumMath.EPSILON5,oa),t.Cartesian3.add(wa,ba,wa),t.Cartesian3.add(ya,ba,ya),t.Cartesian3.add(va,ba,va),t.Cartesian3.add(Ta,ba,Ta),Se(wa,ya),Se(va,Ta),t.Cartesian3.pack(wa,_,Y+12),t.Cartesian3.pack(ya,_,Y+15),t.Cartesian3.pack(Ta,_,Y+18),t.Cartesian3.pack(va,_,Y+21),j+=2,h+=3,F+=16,Y+=24,U+=32,K+=ce,$+=be}h=0;var Oa=0;for(p=0;p<v;p++){for(B=0;B<ca;B++)A[h+B]=ua[B]+Oa;Oa+=8,h+=ca}var ka=la;r.BoundingSphere.fromVertices(n,t.Cartesian3.ZERO,3,ka[0]),r.BoundingSphere.fromVertices(i,t.Cartesian3.ZERO,3,ka[1]);var Pa=r.BoundingSphere.fromBoundingSpheres(ka);Pa.radius+=ee/(2*v);var Da={position:new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.DOUBLE,componentsPerAttribute:3,normalize:!1,values:_}),startHiAndForwardOffsetX:pa(b),startLoAndForwardOffsetY:pa(O),startNormalAndForwardOffsetZ:pa(k),endNormalAndTextureCoordinateNormalizationX:pa(P),rightNormalAndTextureCoordinateNormalizationY:pa(D)};return C&&(Da.startHiLo2D=pa(g),Da.offsetAndRight2D=pa(f),Da.startEndNormals2D=pa(m),Da.texcoordNormalization2D=new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:2,normalize:!1,values:w})),new c.Geometry({attributes:Da,indices:A,boundingSphere:Pa})}function pa(e){return new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:4,normalize:!1,values:e})}function da(a,t){return L.initialize().then((function(){return e.defined(t)&&(a=z.unpack(a,t)),z.createGeometry(a)}))}return z._projectNormal=Oe,da}));