define(["./when-45f3d25d","./Check-34538dad","./Cartesian3-ef6ea826","./Cartesian2-a652b463","./BoundingSphere-038d5fbc","./Transforms-c8a82813","./Matrix4-f54b529f","./RuntimeError-86da6af2","./WebGLConstants-3660bc8f","./ComponentDatatype-d28c2e26","./GeometryAttribute-dfebcc43","./PrimitiveType-30fa6f85","./GeometryAttributes-9d45f9e2","./AttributeCompression-20de7c5b","./GeometryPipeline-f4ca2db7","./EncodedCartesian3-f0b88724","./IndexDatatype-6d2070e9","./IntersectionTests-b186d985","./Plane-a0c58786","./GeometryOffsetAttribute-dae9c424","./GeometryInstance-0849bfce","./arrayRemoveDuplicates-e5b24eaf","./AxisAlignedBoundingBox-9187558e","./EllipsoidTangentPlane-dd3d1016","./ArcType-39be7a32","./EllipsoidRhumbLine-0c6cd7c8","./PolygonPipeline-28c8c9d7","./PolygonGeometryLibrary-887a96e9"],(function(e,t,i,r,o,n,a,l,s,y,u,d,p,f,c,g,m,h,b,P,v,_,E,A,G,T,L,H){"use strict";var C=[],O=[];function x(e,t,r,o,n,a){var l,s,f;l=(a?b.Plane.fromPointNormal(t[0],i.Cartesian3.UNIT_Z):A.EllipsoidTangentPlane.fromPoints(t,e)).projectPointsOntoPlane(t,C),L.PolygonPipeline.computeWindingOrder2D(l)===L.WindingOrder.CLOCKWISE&&(l.reverse(),t=t.slice().reverse());var c=t.length,g=0;if(o||a)for(s=new Float64Array(2*c*3),f=0;f<c;f++){var h=t[f],P=t[(f+1)%c];s[g++]=h.x,s[g++]=h.y,s[g++]=o?h.z:0,s[g++]=P.x,s[g++]=P.y,s[g++]=o?h.z:0}else if(!o){var _=0;if(n===G.ArcType.GEODESIC)for(f=0;f<c;f++)_+=H.PolygonGeometryLibrary.subdivideLineCount(t[f],t[(f+1)%c],r);else if(n===G.ArcType.RHUMB)for(f=0;f<c;f++)_+=H.PolygonGeometryLibrary.subdivideRhumbLineCount(e,t[f],t[(f+1)%c],r);for(s=new Float64Array(3*_),f=0;f<c;f++){var E;n===G.ArcType.GEODESIC?E=H.PolygonGeometryLibrary.subdivideLine(t[f],t[(f+1)%c],r,O):n===G.ArcType.RHUMB&&(E=H.PolygonGeometryLibrary.subdivideRhumbLine(e,t[f],t[(f+1)%c],r,O));for(var T=E.length,x=0;x<T;++x)s[g++]=E[x]}}var D=2*(c=s.length/3),I=m.IndexDatatype.createTypedArray(c,D);for(g=0,f=0;f<c-1;f++)I[g++]=f,I[g++]=f+1;return I[g++]=c-1,I[g++]=0,new v.GeometryInstance({geometry:new u.Geometry({attributes:new p.GeometryAttributes({position:new u.GeometryAttribute({componentDatatype:y.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:s})}),indices:I,primitiveType:d.PrimitiveType.LINES})})}function D(e,t,r,o,n,a){var l,s,f;l=(a?b.Plane.fromPointNormal(t[0],i.Cartesian3.UNIT_Z):A.EllipsoidTangentPlane.fromPoints(t,e)).projectPointsOntoPlane(t,C),L.PolygonPipeline.computeWindingOrder2D(l)===L.WindingOrder.CLOCKWISE&&(l.reverse(),t=t.slice().reverse());var c=t.length,g=new Array(c),h=0;if(o||a)for(s=new Float64Array(2*c*3*2),f=0;f<c;++f){g[f]=h/3;var P=t[f],_=t[(f+1)%c];s[h++]=P.x,s[h++]=P.y,s[h++]=o?P.z:0,s[h++]=_.x,s[h++]=_.y,s[h++]=o?_.z:0}else if(!o){var E=0;if(n===G.ArcType.GEODESIC)for(f=0;f<c;f++)E+=H.PolygonGeometryLibrary.subdivideLineCount(t[f],t[(f+1)%c],r);else if(n===G.ArcType.RHUMB)for(f=0;f<c;f++)E+=H.PolygonGeometryLibrary.subdivideRhumbLineCount(e,t[f],t[(f+1)%c],r);for(s=new Float64Array(3*E*2),f=0;f<c;++f){var T;g[f]=h/3,n===G.ArcType.GEODESIC?T=H.PolygonGeometryLibrary.subdivideLine(t[f],t[(f+1)%c],r,O):n===G.ArcType.RHUMB&&(T=H.PolygonGeometryLibrary.subdivideRhumbLine(e,t[f],t[(f+1)%c],r,O));for(var x=T.length,D=0;D<x;++D)s[h++]=T[D]}}c=s.length/6;var I=g.length,w=2*(2*c+I),N=m.IndexDatatype.createTypedArray(c+I,w);for(h=0,f=0;f<c;++f)N[h++]=f,N[h++]=(f+1)%c,N[h++]=f+c,N[h++]=(f+1)%c+c;for(f=0;f<I;f++){var S=g[f];N[h++]=S,N[h++]=S+c}return new v.GeometryInstance({geometry:new u.Geometry({attributes:new p.GeometryAttributes({position:new u.GeometryAttribute({componentDatatype:y.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:s})}),indices:N,primitiveType:d.PrimitiveType.LINES})})}function I(t){var o=t.polygonHierarchy,n=e.defaultValue(t.ellipsoid,r.Ellipsoid.WGS84),a=e.defaultValue(t.granularity,i.CesiumMath.RADIANS_PER_DEGREE),l=e.defaultValue(t.perPositionHeight,!1),s=l&&e.defined(t.extrudedHeight),y=e.defaultValue(t.arcType,G.ArcType.GEODESIC),u=e.defaultValue(t.height,0),d=e.defaultValue(t.extrudedHeight,u);if(!s){var p=Math.max(u,d);d=Math.min(u,d),u=p}this._ellipsoid=r.Ellipsoid.clone(n),this._granularity=a,this._height=u,this._extrudedHeight=d,this._arcType=y,this._polygonHierarchy=o,this._perPositionHeight=l,this._perPositionHeightExtrude=s,this._offsetAttribute=t.offsetAttribute,this._workerName="createPolygonOutlineGeometry",this.packedLength=H.PolygonGeometryLibrary.computeHierarchyPackedLength(o)+r.Ellipsoid.packedLength+8}I.pack=function(t,i,o){return o=e.defaultValue(o,0),o=H.PolygonGeometryLibrary.packPolygonHierarchy(t._polygonHierarchy,i,o),r.Ellipsoid.pack(t._ellipsoid,i,o),I.isPlaneMode?(i[o++]=0,i[o++]=0,i[o++]=1):o+=r.Ellipsoid.packedLength,i[o++]=t._height,i[o++]=t._extrudedHeight,i[o++]=t._granularity,i[o++]=t._perPositionHeightExtrude?1:0,i[o++]=t._perPositionHeight?1:0,i[o++]=t._arcType,i[o++]=e.defaultValue(t._offsetAttribute,-1),i[o]=t.packedLength,i};var w=r.Ellipsoid.clone(r.Ellipsoid.UNIT_SPHERE),N={polygonHierarchy:{}};return I.unpack=function(t,i,o){i=e.defaultValue(i,0);var n=H.PolygonGeometryLibrary.unpackPolygonHierarchy(t,i);i=n.startingIndex,delete n.startingIndex;let a=0===t[i+1];var l=r.Ellipsoid.unpack(t,i,w);i+=r.Ellipsoid.packedLength;var s=t[i++],y=t[i++],u=t[i++],d=1===t[i++],p=1===t[i++],f=t[i++],c=t[i++],g=t[i];return e.defined(o)||(o=new I(N)),o._polygonHierarchy=n,o._ellipsoid=r.Ellipsoid.clone(l,o._ellipsoid),o._height=s,o._extrudedHeight=y,o._granularity=u,o._perPositionHeight=p,o._perPositionHeightExtrude=d,o._arcType=f,o._isPlaneMode=a,o._offsetAttribute=-1===c?void 0:c,o.packedLength=g,o},I.fromPositions=function(t){return new I({polygonHierarchy:{positions:(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).positions},height:t.height,extrudedHeight:t.extrudedHeight,ellipsoid:t.ellipsoid,granularity:t.granularity,perPositionHeight:t.perPositionHeight,arcType:t.arcType,offsetAttribute:t.offsetAttribute})},I.createGeometry=function(t){var r=t._ellipsoid,n=t._granularity,a=t._polygonHierarchy,l=t._perPositionHeight,s=t._arcType;let d=t._isPlaneMode;var p=H.PolygonGeometryLibrary.polygonOutlinesFromHierarchy(a,!l,r,d);if(0!==p.length){var f,g,m,h=[],b=i.CesiumMath.chordLength(n,r.maximumRadius),v=t._height,_=t._extrudedHeight;if(t._perPositionHeightExtrude||!i.CesiumMath.equalsEpsilon(v,_,0,i.CesiumMath.EPSILON2))for(m=0;m<p.length;m++){if((f=D(r,p[m],b,l,s,d)).geometry=H.PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(f.geometry,v,_,r,l,d),e.defined(t._offsetAttribute)){var E=f.geometry.attributes.position.values.length/3,A=new Uint8Array(E);t._offsetAttribute===P.GeometryOffsetAttribute.TOP?A=P.arrayFill(A,1,0,E/2):(g=t._offsetAttribute===P.GeometryOffsetAttribute.NONE?0:1,A=P.arrayFill(A,g)),f.geometry.attributes.applyOffset=new u.GeometryAttribute({componentDatatype:y.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:A})}h.push(f)}else for(m=0;m<p.length;m++){if((f=x(r,p[m],b,l,s,d)).geometry.attributes.position.values=L.PolygonPipeline.scaleToGeodeticHeight(f.geometry.attributes.position.values,v,r,!l,d),e.defined(t._offsetAttribute)){var G=f.geometry.attributes.position.values.length,T=new Uint8Array(G/3);g=t._offsetAttribute===P.GeometryOffsetAttribute.NONE?0:1,P.arrayFill(T,g),f.geometry.attributes.applyOffset=new u.GeometryAttribute({componentDatatype:y.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:T})}h.push(f)}var C=c.GeometryPipeline.combineInstances(h)[0],O=o.BoundingSphere.fromVertices(C.attributes.position.values);return new u.Geometry({attributes:C.attributes,indices:C.indices,primitiveType:C.primitiveType,boundingSphere:O,offsetAttribute:t._offsetAttribute})}},function(t,i){return e.defined(i)&&(t=I.unpack(t,i)),t._ellipsoid=r.Ellipsoid.clone(t._ellipsoid),I.createGeometry(t)}}));