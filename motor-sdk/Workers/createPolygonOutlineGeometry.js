define(["./when-45f3d25d","./Check-34538dad","./Cartesian3-e69091b9","./Cartesian2-7a44370a","./BoundingSphere-bacc5cb6","./Matrix4-c65e6a1b","./RuntimeError-86da6af2","./Rectangle-c7d55cfa","./WebGLConstants-3660bc8f","./ComponentDatatype-86703c58","./GeometryAttribute-70b679fd","./PrimitiveType-30fa6f85","./Transforms-7d49a8ab","./GeometryAttributes-9d45f9e2","./AttributeCompression-1e177d5e","./GeometryPipeline-7ef9305b","./EncodedCartesian3-7b803d4a","./IndexDatatype-e52361bd","./IntersectionTests-6b77277e","./Plane-b4c954eb","./GeometryOffsetAttribute-f755a5cb","./GeometryInstance-734856d8","./arrayRemoveDuplicates-24a803e7","./EllipsoidTangentPlane-c567cc9c","./ArcType-39be7a32","./EllipsoidRhumbLine-4bc7760a","./PolygonPipeline-ac4549dc","./PolygonGeometryLibrary-e32c0cb3"],(function(e,t,i,r,o,n,a,l,s,y,p,d,u,c,f,g,h,m,b,P,v,E,A,_,G,T,H,C){"use strict";var L=[],O=[];function D(e,t,r,o,n,a){var l,s;l=a?P.Plane.fromPointNormal(t[0],i.Cartesian3.UNIT_Z):_.EllipsoidTangentPlane.fromPoints(t,e),s=l.projectPointsOntoPlane(t,L);var u,f,g=H.PolygonPipeline.computeWindingOrder2D(s);g===H.WindingOrder.CLOCKWISE&&(s.reverse(),t=t.slice().reverse());var h=t.length,b=0;if(o||a)for(u=new Float64Array(2*h*3),f=0;f<h;f++){var v=t[f],A=t[(f+1)%h];u[b++]=v.x,u[b++]=v.y,u[b++]=o?v.z:0,u[b++]=A.x,u[b++]=A.y,u[b++]=o?v.z:0}else if(!o){var T=0;if(n===G.ArcType.GEODESIC)for(f=0;f<h;f++)T+=C.PolygonGeometryLibrary.subdivideLineCount(t[f],t[(f+1)%h],r);else if(n===G.ArcType.RHUMB)for(f=0;f<h;f++)T+=C.PolygonGeometryLibrary.subdivideRhumbLineCount(e,t[f],t[(f+1)%h],r);for(u=new Float64Array(3*T),f=0;f<h;f++){var D;n===G.ArcType.GEODESIC?D=C.PolygonGeometryLibrary.subdivideLine(t[f],t[(f+1)%h],r,O):n===G.ArcType.RHUMB&&(D=C.PolygonGeometryLibrary.subdivideRhumbLine(e,t[f],t[(f+1)%h],r,O));for(var I=D.length,w=0;w<I;++w)u[b++]=D[w]}}h=u.length/3;var x=2*h,k=m.IndexDatatype.createTypedArray(h,x);for(b=0,f=0;f<h-1;f++)k[b++]=f,k[b++]=f+1;return k[b++]=h-1,k[b++]=0,new E.GeometryInstance({geometry:new p.Geometry({attributes:new c.GeometryAttributes({position:new p.GeometryAttribute({componentDatatype:y.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:u})}),indices:k,primitiveType:d.PrimitiveType.LINES})})}function I(e,t,r,o,n,a){var l,s;l=a?P.Plane.fromPointNormal(t[0],i.Cartesian3.UNIT_Z):_.EllipsoidTangentPlane.fromPoints(t,e),s=l.projectPointsOntoPlane(t,L);var u,f,g=H.PolygonPipeline.computeWindingOrder2D(s);g===H.WindingOrder.CLOCKWISE&&(s.reverse(),t=t.slice().reverse());var h=t.length,b=new Array(h),v=0;if(o||a)for(u=new Float64Array(2*h*3*2),f=0;f<h;++f){b[f]=v/3;var A=t[f],T=t[(f+1)%h];u[v++]=A.x,u[v++]=A.y,u[v++]=o?A.z:0,u[v++]=T.x,u[v++]=T.y,u[v++]=o?T.z:0}else if(!o){var D=0;if(n===G.ArcType.GEODESIC)for(f=0;f<h;f++)D+=C.PolygonGeometryLibrary.subdivideLineCount(t[f],t[(f+1)%h],r);else if(n===G.ArcType.RHUMB)for(f=0;f<h;f++)D+=C.PolygonGeometryLibrary.subdivideRhumbLineCount(e,t[f],t[(f+1)%h],r);for(u=new Float64Array(3*D*2),f=0;f<h;++f){var I;b[f]=v/3,n===G.ArcType.GEODESIC?I=C.PolygonGeometryLibrary.subdivideLine(t[f],t[(f+1)%h],r,O):n===G.ArcType.RHUMB&&(I=C.PolygonGeometryLibrary.subdivideRhumbLine(e,t[f],t[(f+1)%h],r,O));for(var w=I.length,x=0;x<w;++x)u[v++]=I[x]}}h=u.length/6;var k=b.length,S=2*(2*h+k),R=m.IndexDatatype.createTypedArray(h+k,S);for(v=0,f=0;f<h;++f)R[v++]=f,R[v++]=(f+1)%h,R[v++]=f+h,R[v++]=(f+1)%h+h;for(f=0;f<k;f++){var N=b[f];R[v++]=N,R[v++]=N+h}return new E.GeometryInstance({geometry:new p.Geometry({attributes:new c.GeometryAttributes({position:new p.GeometryAttribute({componentDatatype:y.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:u})}),indices:R,primitiveType:d.PrimitiveType.LINES})})}function w(o){if(t.Check.typeOf.object("options",o),t.Check.typeOf.object("options.polygonHierarchy",o.polygonHierarchy),o.perPositionHeight&&e.defined(o.height))throw new t.DeveloperError("Cannot use both options.perPositionHeight and options.height");if(e.defined(o.arcType)&&o.arcType!==G.ArcType.GEODESIC&&o.arcType!==G.ArcType.RHUMB)throw new t.DeveloperError("Invalid arcType. Valid options are ArcType.GEODESIC and ArcType.RHUMB.");var n=o.polygonHierarchy,a=e.defaultValue(o.ellipsoid,r.Ellipsoid.WGS84),l=e.defaultValue(o.granularity,i.CesiumMath.RADIANS_PER_DEGREE),s=e.defaultValue(o.perPositionHeight,!1),y=s&&e.defined(o.extrudedHeight),p=e.defaultValue(o.arcType,G.ArcType.GEODESIC),d=e.defaultValue(o.height,0),u=e.defaultValue(o.extrudedHeight,d);if(!y){var c=Math.max(d,u);u=Math.min(d,u),d=c}this._ellipsoid=r.Ellipsoid.clone(a),this._granularity=l,this._height=d,this._extrudedHeight=u,this._arcType=p,this._polygonHierarchy=n,this._perPositionHeight=s,this._perPositionHeightExtrude=y,this._offsetAttribute=o.offsetAttribute,this._workerName="createPolygonOutlineGeometry",this.packedLength=C.PolygonGeometryLibrary.computeHierarchyPackedLength(n)+r.Ellipsoid.packedLength+8}w.pack=function(i,o,n){return t.Check.typeOf.object("value",i),t.Check.defined("array",o),n=e.defaultValue(n,0),n=C.PolygonGeometryLibrary.packPolygonHierarchy(i._polygonHierarchy,o,n),r.Ellipsoid.pack(i._ellipsoid,o,n),w.isPlaneMode?(o[n++]=0,o[n++]=0,o[n++]=1):n+=r.Ellipsoid.packedLength,o[n++]=i._height,o[n++]=i._extrudedHeight,o[n++]=i._granularity,o[n++]=i._perPositionHeightExtrude?1:0,o[n++]=i._perPositionHeight?1:0,o[n++]=i._arcType,o[n++]=e.defaultValue(i._offsetAttribute,-1),o[n]=i.packedLength,o};var x=r.Ellipsoid.clone(r.Ellipsoid.UNIT_SPHERE),k={polygonHierarchy:{}};function S(t,i){return e.defined(i)&&(t=w.unpack(t,i)),t._ellipsoid=r.Ellipsoid.clone(t._ellipsoid),w.createGeometry(t)}return w.unpack=function(i,o,n){t.Check.defined("array",i),o=e.defaultValue(o,0);var a=C.PolygonGeometryLibrary.unpackPolygonHierarchy(i,o);o=a.startingIndex,delete a.startingIndex;let l=0===i[o+1];var s=r.Ellipsoid.unpack(i,o,x);o+=r.Ellipsoid.packedLength;var y=i[o++],p=i[o++],d=i[o++],u=1===i[o++],c=1===i[o++],f=i[o++],g=i[o++],h=i[o];return e.defined(n)||(n=new w(k)),n._polygonHierarchy=a,n._ellipsoid=r.Ellipsoid.clone(s,n._ellipsoid),n._height=y,n._extrudedHeight=p,n._granularity=d,n._perPositionHeight=c,n._perPositionHeightExtrude=u,n._arcType=f,n._isPlaneMode=l,n._offsetAttribute=-1===g?void 0:g,n.packedLength=h,n},w.fromPositions=function(i){i=e.defaultValue(i,e.defaultValue.EMPTY_OBJECT),t.Check.defined("options.positions",i.positions);var r={polygonHierarchy:{positions:i.positions},height:i.height,extrudedHeight:i.extrudedHeight,ellipsoid:i.ellipsoid,granularity:i.granularity,perPositionHeight:i.perPositionHeight,arcType:i.arcType,offsetAttribute:i.offsetAttribute};return new w(r)},w.createGeometry=function(t){var r=t._ellipsoid,n=t._granularity,a=t._polygonHierarchy,l=t._perPositionHeight,s=t._arcType;let d=t._isPlaneMode;var u=C.PolygonGeometryLibrary.polygonOutlinesFromHierarchy(a,!l,r,d);if(0!==u.length){var c,f,h,m=[],b=i.CesiumMath.chordLength(n,r.maximumRadius),P=t._height,E=t._extrudedHeight,A=t._perPositionHeightExtrude||!i.CesiumMath.equalsEpsilon(P,E,0,i.CesiumMath.EPSILON2);if(A)for(h=0;h<u.length;h++){if(c=I(r,u[h],b,l,s,d),c.geometry=C.PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(c.geometry,P,E,r,l,d),e.defined(t._offsetAttribute)){var _=c.geometry.attributes.position.values.length/3,G=new Uint8Array(_);t._offsetAttribute===v.GeometryOffsetAttribute.TOP?G=v.arrayFill(G,1,0,_/2):(f=t._offsetAttribute===v.GeometryOffsetAttribute.NONE?0:1,G=v.arrayFill(G,f)),c.geometry.attributes.applyOffset=new p.GeometryAttribute({componentDatatype:y.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:G})}m.push(c)}else for(h=0;h<u.length;h++){if(c=D(r,u[h],b,l,s,d),c.geometry.attributes.position.values=H.PolygonPipeline.scaleToGeodeticHeight(c.geometry.attributes.position.values,P,r,!l,d),e.defined(t._offsetAttribute)){var T=c.geometry.attributes.position.values.length,L=new Uint8Array(T/3);f=t._offsetAttribute===v.GeometryOffsetAttribute.NONE?0:1,v.arrayFill(L,f),c.geometry.attributes.applyOffset=new p.GeometryAttribute({componentDatatype:y.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:L})}m.push(c)}var O=g.GeometryPipeline.combineInstances(m)[0],w=o.BoundingSphere.fromVertices(O.attributes.position.values);return new p.Geometry({attributes:O.attributes,indices:O.indices,primitiveType:O.primitiveType,boundingSphere:w,offsetAttribute:t._offsetAttribute})}},S}));