define(["exports","./when-45f3d25d","./Check-34538dad","./Cartesian3-ef6ea826","./Cartesian2-a652b463","./BoundingSphere-038d5fbc","./Transforms-c8a82813","./Matrix4-f54b529f","./ComponentDatatype-d28c2e26","./GeometryAttribute-dfebcc43","./PrimitiveType-30fa6f85","./AttributeCompression-20de7c5b","./EncodedCartesian3-f0b88724","./IndexDatatype-6d2070e9","./IntersectionTests-b186d985","./Plane-a0c58786"],(function(e,t,r,a,i,n,s,o,u,p,d,l,y,v,f,c){"use strict";var m=new a.Cartesian3,C=new a.Cartesian3,h=new a.Cartesian3,b={calculateACMR:function(e){var r=(e=t.defaultValue(e,t.defaultValue.EMPTY_OBJECT)).indices,a=e.maximumIndex,i=t.defaultValue(e.cacheSize,24),n=r.length;if(!t.defined(a)){a=0;for(var s=0,o=r[s];s<n;)o>a&&(a=o),o=r[++s]}for(var u=[],p=0;p<a+1;p++)u[p]=0;for(var d=i+1,l=0;l<n;++l)d-u[r[l]]>i&&(u[r[l]]=d,++d);return(d-i+1)/(n/3)},tipsify:function(e){var r,a=(e=t.defaultValue(e,t.defaultValue.EMPTY_OBJECT)).indices,i=e.maximumIndex,n=t.defaultValue(e.cacheSize,24);function s(e,t,a,i,n,s,o){for(var u,p=-1,d=-1,l=0;l<a.length;){var y=a[l];i[y].numLiveTriangles&&(u=0,n-i[y].timeStamp+2*i[y].numLiveTriangles<=t&&(u=n-i[y].timeStamp),(u>d||-1===d)&&(d=u,p=y)),++l}return-1===p?function(e,t,a,i){for(;t.length>=1;){var n=t[t.length-1];if(t.splice(t.length-1,1),e[n].numLiveTriangles>0)return n}for(;r<i;){if(e[r].numLiveTriangles>0)return++r-1;++r}return-1}(i,s,0,o):p}var o=a.length,u=0,p=0,d=a[p],l=o;if(t.defined(i))u=i+1;else{for(;p<l;)d>u&&(u=d),d=a[++p];if(-1===u)return 0;++u}var y,v=[];for(y=0;y<u;y++)v[y]={numLiveTriangles:0,timeStamp:0,vertexTriangles:[]};p=0;for(var f=0;p<l;)v[a[p]].vertexTriangles.push(f),++v[a[p]].numLiveTriangles,v[a[p+1]].vertexTriangles.push(f),++v[a[p+1]].numLiveTriangles,v[a[p+2]].vertexTriangles.push(f),++v[a[p+2]].numLiveTriangles,++f,p+=3;var c=0,m=n+1;r=1;var C,h,b,g,A=[],T=[],x=0,P=[],w=o/3,S=[];for(y=0;y<w;y++)S[y]=!1;for(;-1!==c;){A=[],g=(h=v[c]).vertexTriangles.length;for(var I=0;I<g;++I)if(!S[f=h.vertexTriangles[I]]){S[f]=!0,p=f+f+f;for(var O=0;O<3;++O)b=a[p],A.push(b),T.push(b),P[x]=b,++x,--(C=v[b]).numLiveTriangles,m-C.timeStamp>n&&(C.timeStamp=m,++m),++p}c=s(0,n,A,v,m,T,u)}return P}},g={};function A(e,t,r,a,i){e[t++]=r,e[t++]=a,e[t++]=a,e[t++]=i,e[t++]=i,e[t]=r}function T(e){var r={};for(var a in e)if(e.hasOwnProperty(a)&&t.defined(e[a])&&t.defined(e[a].values)){var i=e[a];r[a]=new p.GeometryAttribute({componentDatatype:i.componentDatatype,componentsPerAttribute:i.componentsPerAttribute,normalize:i.normalize,values:[]})}return r}function x(e,r,a){for(var i in r)if(r.hasOwnProperty(i)&&t.defined(r[i])&&t.defined(r[i].values))for(var n=r[i],s=0;s<n.componentsPerAttribute;++s)e[i].values.push(n.values[a*n.componentsPerAttribute+s])}g.toWireframe=function(e){var r=e.indices;if(t.defined(r)){switch(e.primitiveType){case d.PrimitiveType.TRIANGLES:e.indices=function(e){for(var t=e.length,r=t/3*6,a=v.IndexDatatype.createTypedArray(t,r),i=0,n=0;n<t;n+=3,i+=6)A(a,i,e[n],e[n+1],e[n+2]);return a}(r);break;case d.PrimitiveType.TRIANGLE_STRIP:e.indices=function(e){var t=e.length;if(t>=3){var r=6*(t-2),a=v.IndexDatatype.createTypedArray(t,r);A(a,0,e[0],e[1],e[2]);for(var i=6,n=3;n<t;++n,i+=6)A(a,i,e[n-1],e[n],e[n-2]);return a}return new Uint16Array}(r);break;case d.PrimitiveType.TRIANGLE_FAN:e.indices=function(e){if(e.length>0){for(var t=e.length-1,r=6*(t-1),a=v.IndexDatatype.createTypedArray(t,r),i=e[0],n=0,s=1;s<t;++s,n+=6)A(a,n,i,e[s],e[s+1]);return a}return new Uint16Array}(r)}e.primitiveType=d.PrimitiveType.LINES}return e},g.createLineSegmentsForVectors=function(e,r,a){r=t.defaultValue(r,"normal"),a=t.defaultValue(a,1e4);for(var i,s=e.attributes.position.values,o=e.attributes[r].values,l=s.length,y=new Float64Array(2*l),v=0,f=0;f<l;f+=3)y[v++]=s[f],y[v++]=s[f+1],y[v++]=s[f+2],y[v++]=s[f]+o[f]*a,y[v++]=s[f+1]+o[f+1]*a,y[v++]=s[f+2]+o[f+2]*a;var c=e.boundingSphere;return t.defined(c)&&(i=new n.BoundingSphere(c.center,c.radius+a)),new p.Geometry({attributes:{position:new p.GeometryAttribute({componentDatatype:u.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:y})},primitiveType:d.PrimitiveType.LINES,boundingSphere:i})},g.createAttributeLocations=function(e){var r,a=["position","positionHigh","positionLow","position3DHigh","position3DLow","position2DHigh","position2DLow","pickColor","normal","st","tangent","bitangent","extrudeDirection","compressedAttributes"],i=e.attributes,n={},s=0,o=a.length;for(r=0;r<o;++r){var u=a[r];t.defined(i[u])&&(n[u]=s++)}for(var p in i)i.hasOwnProperty(p)&&!t.defined(n[p])&&(n[p]=s++);return n},g.reorderForPreVertexCache=function(e){var r=p.Geometry.computeNumberOfVertices(e),a=e.indices;if(t.defined(a)){for(var i=new Int32Array(r),n=0;n<r;n++)i[n]=-1;for(var s,o=a,d=o.length,l=v.IndexDatatype.createTypedArray(r,d),y=0,f=0,c=0;y<d;)-1!==(s=i[o[y]])?l[f]=s:(i[s=o[y]]=c,l[f]=c,++c),++y,++f;e.indices=l;var m=e.attributes;for(var C in m)if(m.hasOwnProperty(C)&&t.defined(m[C])&&t.defined(m[C].values)){for(var h=m[C],b=h.values,g=0,A=h.componentsPerAttribute,T=u.ComponentDatatype.createTypedArray(h.componentDatatype,c*A);g<r;){var x=i[g];if(-1!==x)for(var P=0;P<A;P++)T[A*x+P]=b[A*g+P];++g}h.values=T}}return e},g.reorderForPostVertexCache=function(e,r){var a=e.indices;if(e.primitiveType===d.PrimitiveType.TRIANGLES&&t.defined(a)){for(var i=a.length,n=0,s=0;s<i;s++)a[s]>n&&(n=a[s]);e.indices=b.tipsify({indices:a,maximumIndex:n,cacheSize:r})}return e},g.fitToUnsignedShortIndices=function(e){var r=[],i=p.Geometry.computeNumberOfVertices(e);if(t.defined(e.indices)&&i>=a.CesiumMath.SIXTY_FOUR_KILOBYTES){var n,s=[],o=[],u=0,l=T(e.attributes),y=e.indices,v=y.length;e.primitiveType===d.PrimitiveType.TRIANGLES?n=3:e.primitiveType===d.PrimitiveType.LINES?n=2:e.primitiveType===d.PrimitiveType.POINTS&&(n=1);for(var f=0;f<v;f+=n){for(var c=0;c<n;++c){var m=y[f+c],C=s[m];t.defined(C)||(C=u++,s[m]=C,x(l,e.attributes,m)),o.push(C)}u+n>=a.CesiumMath.SIXTY_FOUR_KILOBYTES&&(r.push(new p.Geometry({attributes:l,indices:o,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV})),s=[],o=[],u=0,l=T(e.attributes))}0!==o.length&&r.push(new p.Geometry({attributes:l,indices:o,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV}))}else r.push(e);return r};var P=new a.Cartesian3,w=new i.Cartographic;g.projectTo2D=function(e,r,i,s,o){for(var d=e.attributes[r],l=(o=t.defined(o)?o:new n.GeographicProjection).ellipsoid,y=d.values,v=new Float64Array(y.length),f=0,c=0;c<y.length;c+=3){var m=a.Cartesian3.fromArray(y,c,P),C=l.cartesianToCartographic(m,w),h=o.project(C,P);v[f++]=h.x,v[f++]=h.y,v[f++]=h.z}return e.attributes[i]=d,e.attributes[s]=new p.GeometryAttribute({componentDatatype:u.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:v}),delete e.attributes[r],e};var S={high:0,low:0};g.encodeAttribute=function(e,t,r,a){for(var i=e.attributes[t],n=i.values,s=n.length,o=new Float32Array(s),d=new Float32Array(s),l=0;l<s;++l)y.EncodedCartesian3.encode(n[l],S),o[l]=S.high,d[l]=S.low;var v=i.componentsPerAttribute;return e.attributes[r]=new p.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:v,values:o}),e.attributes[a]=new p.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:v,values:d}),delete e.attributes[t],e};var I=new a.Cartesian3;function O(e,r){if(t.defined(r))for(var i=r.values,n=i.length,s=0;s<n;s+=3)a.Cartesian3.unpack(i,s,I),o.Matrix4.multiplyByPoint(e,I,I),a.Cartesian3.pack(I,i,s)}function E(e,r){if(t.defined(r))for(var i=r.values,n=i.length,s=0;s<n;s+=3)a.Cartesian3.unpack(i,s,I),o.Matrix3.multiplyByVector(e,I,I),I=a.Cartesian3.normalize(I,I),a.Cartesian3.pack(I,i,s)}var N=new o.Matrix4,L=new o.Matrix3;g.transformToWorldCoordinates=function(e){var r=e.modelMatrix;if(o.Matrix4.equals(r,o.Matrix4.IDENTITY))return e;var a=e.geometry.attributes;O(r,a.position),O(r,a.prevPosition),O(r,a.nextPosition),(t.defined(a.normal)||t.defined(a.tangent)||t.defined(a.bitangent))&&(o.Matrix4.inverse(r,N),o.Matrix4.transpose(N,N),o.Matrix4.getMatrix3(N,L),E(L,a.normal),E(L,a.tangent),E(L,a.bitangent));var i=e.geometry.boundingSphere;return t.defined(i)&&(e.geometry.boundingSphere=n.BoundingSphere.transform(i,r,i)),e.modelMatrix=o.Matrix4.clone(o.Matrix4.IDENTITY),e};var z=new a.Cartesian3;function D(e,r){var i,s,o,l,y,f,c,m,C=e.length,h=(e[0].modelMatrix,t.defined(e[0][r].indices)),b=e[0][r].primitiveType,g=function(e,r){var a,i=e.length,n={},s=e[0][r].attributes;for(a in s)if(s.hasOwnProperty(a)&&t.defined(s[a])&&t.defined(s[a].values)){for(var o=s[a],d=o.values.length,l=!0,y=1;y<i;++y){var v=e[y][r].attributes[a];if(!t.defined(v)||o.componentDatatype!==v.componentDatatype||o.componentsPerAttribute!==v.componentsPerAttribute||o.normalize!==v.normalize){l=!1;break}d+=v.values.length}l&&(n[a]=new p.GeometryAttribute({componentDatatype:o.componentDatatype,componentsPerAttribute:o.componentsPerAttribute,normalize:o.normalize,values:u.ComponentDatatype.createTypedArray(o.componentDatatype,d)}))}return n}(e,r);for(i in g)if(g.hasOwnProperty(i))for(y=g[i].values,l=0,s=0;s<C;++s)for(c=(f=e[s][r].attributes[i].values).length,o=0;o<c;++o)y[l++]=f[o];if(h){var A=0;for(s=0;s<C;++s)A+=e[s][r].indices.length;var T=p.Geometry.computeNumberOfVertices(new p.Geometry({attributes:g,primitiveType:d.PrimitiveType.POINTS})),x=v.IndexDatatype.createTypedArray(T,A),P=0,w=0;for(s=0;s<C;++s){var S=e[s][r].indices,I=S.length;for(l=0;l<I;++l)x[P++]=w+S[l];w+=p.Geometry.computeNumberOfVertices(e[s][r])}m=x}var O,E=new a.Cartesian3,N=0;for(s=0;s<C;++s){if(O=e[s][r].boundingSphere,!t.defined(O)){E=void 0;break}a.Cartesian3.add(O.center,E,E)}if(t.defined(E))for(a.Cartesian3.divideByScalar(E,C,E),s=0;s<C;++s){O=e[s][r].boundingSphere;var L=a.Cartesian3.magnitude(a.Cartesian3.subtract(O.center,E,z))+O.radius;L>N&&(N=L)}return new p.Geometry({attributes:g,indices:m,primitiveType:b,boundingSphere:t.defined(E)?new n.BoundingSphere(E,N):void 0})}g.combineInstances=function(e){for(var r=[],a=[],i=e.length,n=0;n<i;++n){var s=e[n];t.defined(s.geometry)?r.push(s):t.defined(s.westHemisphereGeometry)&&t.defined(s.eastHemisphereGeometry)&&a.push(s)}var o=[];return r.length>0&&o.push(D(r,"geometry")),a.length>0&&(o.push(D(a,"westHemisphereGeometry")),o.push(D(a,"eastHemisphereGeometry"))),o};var M=new a.Cartesian3,G=new a.Cartesian3,R=new a.Cartesian3,V=new a.Cartesian3;g.computeNormal=function(e){var t,r=e.indices,i=e.attributes,n=i.position.values,s=i.position.values.length/3,o=r.length,d=new Array(s),l=new Array(o/3),y=new Array(o);for(t=0;t<s;t++)d[t]={indexOffset:0,count:0,currentCount:0};var v=0;for(t=0;t<o;t+=3){var f=r[t],c=r[t+1],m=r[t+2],C=3*f,h=3*c,b=3*m;G.x=n[C],G.y=n[C+1],G.z=n[C+2],R.x=n[h],R.y=n[h+1],R.z=n[h+2],V.x=n[b],V.y=n[b+1],V.z=n[b+2],d[f].count++,d[c].count++,d[m].count++,a.Cartesian3.subtract(R,G,R),a.Cartesian3.subtract(V,G,V),l[v]=a.Cartesian3.cross(R,V,new a.Cartesian3),v++}var g,A=0;for(t=0;t<s;t++)d[t].indexOffset+=A,A+=d[t].count;for(v=0,t=0;t<o;t+=3){var T=(g=d[r[t]]).indexOffset+g.currentCount;y[T]=v,g.currentCount++,y[T=(g=d[r[t+1]]).indexOffset+g.currentCount]=v,g.currentCount++,y[T=(g=d[r[t+2]]).indexOffset+g.currentCount]=v,g.currentCount++,v++}var x=new Float32Array(3*s);for(t=0;t<s;t++){var P=3*t;if(g=d[t],a.Cartesian3.clone(a.Cartesian3.ZERO,M),g.count>0){for(v=0;v<g.count;v++)a.Cartesian3.add(M,l[y[g.indexOffset+v]],M);a.Cartesian3.equalsEpsilon(a.Cartesian3.ZERO,M,a.CesiumMath.EPSILON10)&&a.Cartesian3.clone(l[y[g.indexOffset]],M)}a.Cartesian3.equalsEpsilon(a.Cartesian3.ZERO,M,a.CesiumMath.EPSILON10)&&(M.z=1),a.Cartesian3.normalize(M,M),x[P]=M.x,x[P+1]=M.y,x[P+2]=M.z}return e.attributes.normal=new p.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:x}),e};var B=new a.Cartesian3,F=new a.Cartesian3,k=new a.Cartesian3;g.computeTangentAndBitangent=function(e){e.attributes;var t,r,i,n,s=e.indices,o=e.attributes.position.values,d=e.attributes.normal.values,l=e.attributes.st.values,y=e.attributes.position.values.length/3,v=s.length,f=new Array(3*y);for(t=0;t<f.length;t++)f[t]=0;for(t=0;t<v;t+=3){var c=s[t],m=s[t+1],C=s[t+2];i=3*m,n=3*C;var h=2*c,b=2*m,g=2*C,A=o[r=3*c],T=o[r+1],x=o[r+2],P=l[h],w=l[h+1],S=l[b+1]-w,I=l[g+1]-w,O=1/((l[b]-P)*I-(l[g]-P)*S),E=(I*(o[i]-A)-S*(o[n]-A))*O,N=(I*(o[i+1]-T)-S*(o[n+1]-T))*O,L=(I*(o[i+2]-x)-S*(o[n+2]-x))*O;f[r]+=E,f[r+1]+=N,f[r+2]+=L,f[i]+=E,f[i+1]+=N,f[i+2]+=L,f[n]+=E,f[n+1]+=N,f[n+2]+=L}var z=new Float32Array(3*y),D=new Float32Array(3*y);for(t=0;t<y;t++){i=1+(r=3*t),n=r+2;var M=a.Cartesian3.fromArray(d,r,B),G=a.Cartesian3.fromArray(f,r,k),R=a.Cartesian3.dot(M,G);a.Cartesian3.multiplyByScalar(M,R,F),a.Cartesian3.normalize(a.Cartesian3.subtract(G,F,G),G),z[r]=G.x,z[i]=G.y,z[n]=G.z,a.Cartesian3.normalize(a.Cartesian3.cross(M,G,G),G),D[r]=G.x,D[i]=G.y,D[n]=G.z}return e.attributes.tangent=new p.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:z}),e.attributes.bitangent=new p.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:D}),e};var _=new i.Cartesian2,q=new a.Cartesian3,U=new a.Cartesian3,Y=new a.Cartesian3,Z=new i.Cartesian2;function H(e){switch(e.primitiveType){case d.PrimitiveType.TRIANGLE_FAN:return function(e){var t=p.Geometry.computeNumberOfVertices(e),r=v.IndexDatatype.createTypedArray(t,3*(t-2));r[0]=1,r[1]=0,r[2]=2;for(var a=3,i=3;i<t;++i)r[a++]=i-1,r[a++]=0,r[a++]=i;return e.indices=r,e.primitiveType=d.PrimitiveType.TRIANGLES,e}(e);case d.PrimitiveType.TRIANGLE_STRIP:return function(e){var t=p.Geometry.computeNumberOfVertices(e),r=v.IndexDatatype.createTypedArray(t,3*(t-2));r[0]=0,r[1]=1,r[2]=2,t>3&&(r[3]=0,r[4]=2,r[5]=3);for(var a=6,i=3;i<t-1;i+=2)r[a++]=i,r[a++]=i-1,r[a++]=i+1,i+2<t&&(r[a++]=i,r[a++]=i+1,r[a++]=i+2);return e.indices=r,e.primitiveType=d.PrimitiveType.TRIANGLES,e}(e);case d.PrimitiveType.TRIANGLES:return function(e){if(t.defined(e.indices))return e;for(var r=p.Geometry.computeNumberOfVertices(e),a=v.IndexDatatype.createTypedArray(r,r),i=0;i<r;++i)a[i]=i;return e.indices=a,e}(e);case d.PrimitiveType.LINE_STRIP:return function(e){var t=p.Geometry.computeNumberOfVertices(e),r=v.IndexDatatype.createTypedArray(t,2*(t-1));r[0]=0,r[1]=1;for(var a=2,i=2;i<t;++i)r[a++]=i-1,r[a++]=i;return e.indices=r,e.primitiveType=d.PrimitiveType.LINES,e}(e);case d.PrimitiveType.LINE_LOOP:return function(e){var t=p.Geometry.computeNumberOfVertices(e),r=v.IndexDatatype.createTypedArray(t,2*t);r[0]=0,r[1]=1;for(var a=2,i=2;i<t;++i)r[a++]=i-1,r[a++]=i;return r[a++]=t-1,r[a]=0,e.indices=r,e.primitiveType=d.PrimitiveType.LINES,e}(e);case d.PrimitiveType.LINES:return function(e){if(t.defined(e.indices))return e;for(var r=p.Geometry.computeNumberOfVertices(e),a=v.IndexDatatype.createTypedArray(r,r),i=0;i<r;++i)a[i]=i;return e.indices=a,e}(e)}return e}function W(e,t){Math.abs(e.y)<a.CesiumMath.EPSILON6&&(e.y=t?-a.CesiumMath.EPSILON6:a.CesiumMath.EPSILON6)}g.compressVertices=function(e){var r,n,s=e.attributes.extrudeDirection;if(t.defined(s)){var o=s.values;n=o.length/3;var d=new Float32Array(2*n),y=0;for(r=0;r<n;++r)a.Cartesian3.fromArray(o,3*r,q),a.Cartesian3.equals(q,a.Cartesian3.ZERO)?y+=2:(Z=l.AttributeCompression.octEncodeInRange(q,65535,Z),d[y++]=Z.x,d[y++]=Z.y);return e.attributes.compressedAttributes=new p.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:d}),delete e.attributes.extrudeDirection,e}var v=e.attributes.normal,f=e.attributes.st,c=t.defined(v),m=t.defined(f);if(!c&&!m)return e;var C,h,b,g,A=e.attributes.tangent,T=e.attributes.bitangent,x=t.defined(A),P=t.defined(T);c&&(C=v.values),m&&(h=f.values),x&&(b=A.values),P&&(g=T.values);var w=n=(c?C.length:h.length)/(c?3:2),S=m&&c?2:1;S+=x||P?1:0;var I=new Float32Array(w*=S),O=0;for(r=0;r<n;++r){m&&(i.Cartesian2.fromArray(h,2*r,_),I[O++]=l.AttributeCompression.compressTextureCoordinates(_));var E=3*r;c&&t.defined(b)&&t.defined(g)?(a.Cartesian3.fromArray(C,E,q),a.Cartesian3.fromArray(b,E,U),a.Cartesian3.fromArray(g,E,Y),l.AttributeCompression.octPack(q,U,Y,_),I[O++]=_.x,I[O++]=_.y):(c&&(a.Cartesian3.fromArray(C,E,q),I[O++]=l.AttributeCompression.octEncodeFloat(q)),x&&(a.Cartesian3.fromArray(b,E,q),I[O++]=l.AttributeCompression.octEncodeFloat(q)),P&&(a.Cartesian3.fromArray(g,E,q),I[O++]=l.AttributeCompression.octEncodeFloat(q)))}return e.attributes.compressedAttributes=new p.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:S,values:I}),c&&delete e.attributes.normal,m&&delete e.attributes.st,P&&delete e.attributes.bitangent,x&&delete e.attributes.tangent,e};var X=new a.Cartesian3;function j(e,t,r,i){a.Cartesian3.add(e,a.Cartesian3.multiplyByScalar(a.Cartesian3.subtract(t,e,X),e.y/(e.y-t.y),X),r),a.Cartesian3.clone(r,i),W(r,!0),W(i,!1)}var J=new a.Cartesian3,K=new a.Cartesian3,Q=new a.Cartesian3,$=new a.Cartesian3,ee={positions:new Array(7),indices:new Array(9)};function te(e,t,r){if(!(e.x>=0||t.x>=0||r.x>=0)){!function(e,t,r){if(0!==e.y&&0!==t.y&&0!==r.y)return W(e,e.y<0),W(t,t.y<0),void W(r,r.y<0);var i=Math.abs(e.y),n=Math.abs(t.y),s=Math.abs(r.y),o=(i>n?i>s?a.CesiumMath.sign(e.y):a.CesiumMath.sign(r.y):n>s?a.CesiumMath.sign(t.y):a.CesiumMath.sign(r.y))<0;W(e,o),W(t,o),W(r,o)}(e,t,r);var i=e.y<0,n=t.y<0,s=r.y<0,o=0;o+=i?1:0,o+=n?1:0;var u=ee.indices;1===(o+=s?1:0)?(u[1]=3,u[2]=4,u[5]=6,u[7]=6,u[8]=5,i?(j(e,t,J,Q),j(e,r,K,$),u[0]=0,u[3]=1,u[4]=2,u[6]=1):n?(j(t,r,J,Q),j(t,e,K,$),u[0]=1,u[3]=2,u[4]=0,u[6]=2):s&&(j(r,e,J,Q),j(r,t,K,$),u[0]=2,u[3]=0,u[4]=1,u[6]=0)):2===o&&(u[2]=4,u[4]=4,u[5]=3,u[7]=5,u[8]=6,i?n?s||(j(r,e,J,Q),j(r,t,K,$),u[0]=0,u[1]=1,u[3]=0,u[6]=2):(j(t,r,J,Q),j(t,e,K,$),u[0]=2,u[1]=0,u[3]=2,u[6]=1):(j(e,t,J,Q),j(e,r,K,$),u[0]=1,u[1]=2,u[3]=1,u[6]=0));var p=ee.positions;return p[0]=e,p[1]=t,p[2]=r,p.length=3,1!==o&&2!==o||(p[3]=J,p[4]=K,p[5]=Q,p[6]=$,p.length=7),ee}}function re(e,r){var a=e.attributes;if(0!==a.position.values.length){for(var i in a)if(a.hasOwnProperty(i)&&t.defined(a[i])&&t.defined(a[i].values)){var s=a[i];s.values=u.ComponentDatatype.createTypedArray(s.componentDatatype,s.values)}var o=p.Geometry.computeNumberOfVertices(e);return e.indices=v.IndexDatatype.createTypedArray(o,e.indices),r&&(e.boundingSphere=n.BoundingSphere.fromVertices(a.position.values)),e}}function ae(e){var r=e.attributes,a={};for(var i in r)if(r.hasOwnProperty(i)&&t.defined(r[i])&&t.defined(r[i].values)){var n=r[i];a[i]=new p.GeometryAttribute({componentDatatype:n.componentDatatype,componentsPerAttribute:n.componentsPerAttribute,normalize:n.normalize,values:[]})}return new p.Geometry({attributes:a,indices:[],primitiveType:e.primitiveType})}function ie(e,r,a){var i=t.defined(e.geometry.boundingSphere);r=re(r,i),a=re(a,i),t.defined(a)&&!t.defined(r)?e.geometry=a:!t.defined(a)&&t.defined(r)?e.geometry=r:(e.westHemisphereGeometry=r,e.eastHemisphereGeometry=a,e.geometry=void 0)}function ne(e,t){var r=new e,a=new e,i=new e;return function(n,s,o,u,p,d,l,y){var v=e.fromArray(p,n*t,r),f=e.fromArray(p,s*t,a),c=e.fromArray(p,o*t,i);e.multiplyByScalar(v,u.x,v),e.multiplyByScalar(f,u.y,f),e.multiplyByScalar(c,u.z,c);var m=e.add(v,f,v);e.add(m,c,m),y&&e.normalize(m,m),e.pack(m,d,l*t)}}var se=ne(o.Cartesian4,4),oe=ne(a.Cartesian3,3),ue=ne(i.Cartesian2,2),pe=new a.Cartesian3,de=new a.Cartesian3,le=new a.Cartesian3,ye=new a.Cartesian3;function ve(e,r,n,s,o,u,p,d,l,y,v,f,c,b,g,A){if(t.defined(u)||t.defined(p)||t.defined(d)||t.defined(l)||t.defined(y)||0!==b){var T=function(e,r,n,s,o){var u,p,d,l,y,v,f,c;if(t.defined(o)||(o=new a.Cartesian3),t.defined(r.z)){if(a.Cartesian3.equalsEpsilon(e,r,a.CesiumMath.EPSILON14))return a.Cartesian3.clone(a.Cartesian3.UNIT_X,o);if(a.Cartesian3.equalsEpsilon(e,n,a.CesiumMath.EPSILON14))return a.Cartesian3.clone(a.Cartesian3.UNIT_Y,o);if(a.Cartesian3.equalsEpsilon(e,s,a.CesiumMath.EPSILON14))return a.Cartesian3.clone(a.Cartesian3.UNIT_Z,o);u=a.Cartesian3.subtract(n,r,m),p=a.Cartesian3.subtract(s,r,C),d=a.Cartesian3.subtract(e,r,h),l=a.Cartesian3.dot(u,u),y=a.Cartesian3.dot(u,p),v=a.Cartesian3.dot(u,d),f=a.Cartesian3.dot(p,p),c=a.Cartesian3.dot(p,d)}else{if(i.Cartesian2.equalsEpsilon(e,r,a.CesiumMath.EPSILON14))return a.Cartesian3.clone(a.Cartesian3.UNIT_X,o);if(i.Cartesian2.equalsEpsilon(e,n,a.CesiumMath.EPSILON14))return a.Cartesian3.clone(a.Cartesian3.UNIT_Y,o);if(i.Cartesian2.equalsEpsilon(e,s,a.CesiumMath.EPSILON14))return a.Cartesian3.clone(a.Cartesian3.UNIT_Z,o);u=i.Cartesian2.subtract(n,r,m),p=i.Cartesian2.subtract(s,r,C),d=i.Cartesian2.subtract(e,r,h),l=i.Cartesian2.dot(u,u),y=i.Cartesian2.dot(u,p),v=i.Cartesian2.dot(u,d),f=i.Cartesian2.dot(p,p),c=i.Cartesian2.dot(p,d)}o.y=f*v-y*c,o.z=l*c-y*v;var b=l*f-y*y;return 0!==o.y&&(o.y/=b),0!==o.z&&(o.z/=b),o.x=1-o.y-o.z,o}(s,a.Cartesian3.fromArray(o,3*e,pe),a.Cartesian3.fromArray(o,3*r,de),a.Cartesian3.fromArray(o,3*n,le),ye);if(t.defined(u)&&oe(e,r,n,T,u,f.normal.values,A,!0),t.defined(y)){var x,P=a.Cartesian3.fromArray(y,3*e,pe),w=a.Cartesian3.fromArray(y,3*r,de),S=a.Cartesian3.fromArray(y,3*n,le);a.Cartesian3.multiplyByScalar(P,T.x,P),a.Cartesian3.multiplyByScalar(w,T.y,w),a.Cartesian3.multiplyByScalar(S,T.z,S),a.Cartesian3.equals(P,a.Cartesian3.ZERO)&&a.Cartesian3.equals(w,a.Cartesian3.ZERO)&&a.Cartesian3.equals(S,a.Cartesian3.ZERO)?((x=pe).x=0,x.y=0,x.z=0):(x=a.Cartesian3.add(P,w,P),a.Cartesian3.add(x,S,x),a.Cartesian3.normalize(x,x)),a.Cartesian3.pack(x,f.extrudeDirection.values,3*A)}if(t.defined(v)&&function(e,t,r,i,n,s,o){var u=n[e]*i.x,p=n[t]*i.y,d=n[r]*i.z;s[o]=u+p+d>a.CesiumMath.EPSILON6?1:0}(e,r,n,T,v,f.applyOffset.values,A),t.defined(p)&&oe(e,r,n,T,p,f.tangent.values,A,!0),t.defined(d)&&oe(e,r,n,T,d,f.bitangent.values,A,!0),t.defined(l)&&ue(e,r,n,T,l,f.st.values,A),b>0)for(var I=0;I<b;I++){var O=c[I];fe(e,r,n,T,A,g[O],f[O])}}}function fe(e,t,r,a,i,n,s){var o=n.componentsPerAttribute,u=n.values,p=s.values;switch(o){case 4:se(e,t,r,a,u,p,i,!1);break;case 3:oe(e,t,r,a,u,p,i,!1);break;case 2:ue(e,t,r,a,u,p,i,!1);break;default:p[i]=u[e]*a.x+u[t]*a.y+u[r]*a.z}}function ce(e,t,r,a,i,n){var s=e.position.values.length/3;if(-1!==i){var o=a[i],u=r[o];return-1===u?(r[o]=s,e.position.values.push(n.x,n.y,n.z),t.push(s),s):(t.push(u),u)}return e.position.values.push(n.x,n.y,n.z),t.push(s),s}var me={position:!0,normal:!0,bitangent:!0,tangent:!0,st:!0,extrudeDirection:!0,applyOffset:!0};function Ce(e){var r=e.geometry,i=r.attributes,n=i.position.values,s=t.defined(i.normal)?i.normal.values:void 0,o=t.defined(i.bitangent)?i.bitangent.values:void 0,u=t.defined(i.tangent)?i.tangent.values:void 0,p=t.defined(i.st)?i.st.values:void 0,d=t.defined(i.extrudeDirection)?i.extrudeDirection.values:void 0,l=t.defined(i.applyOffset)?i.applyOffset.values:void 0,y=r.indices,v=[];for(var f in i)i.hasOwnProperty(f)&&!me[f]&&t.defined(i[f])&&v.push(f);var c,m,C,h,b=v.length,g=ae(r),A=ae(r),T=[];T.length=n.length/3;var x=[];for(x.length=n.length/3,h=0;h<T.length;++h)T[h]=-1,x[h]=-1;var P=y.length;for(h=0;h<P;h+=3){var w=y[h],S=y[h+1],I=y[h+2],O=a.Cartesian3.fromArray(n,3*w),E=a.Cartesian3.fromArray(n,3*S),N=a.Cartesian3.fromArray(n,3*I),L=te(O,E,N);if(t.defined(L)&&L.positions.length>3)for(var z=L.positions,D=L.indices,M=D.length,G=0;G<M;++G){var R=D[G],V=z[R];V.y<0?(c=A.attributes,m=A.indices,C=T):(c=g.attributes,m=g.indices,C=x),ve(w,S,I,V,n,s,u,o,p,d,l,c,v,b,i,ce(c,m,C,y,R<3?h+R:-1,V))}else t.defined(L)&&(O=L.positions[0],E=L.positions[1],N=L.positions[2]),O.y<0?(c=A.attributes,m=A.indices,C=T):(c=g.attributes,m=g.indices,C=x),ve(w,S,I,O,n,s,u,o,p,d,l,c,v,b,i,ce(c,m,C,y,h,O)),ve(w,S,I,E,n,s,u,o,p,d,l,c,v,b,i,ce(c,m,C,y,h+1,E)),ve(w,S,I,N,n,s,u,o,p,d,l,c,v,b,i,ce(c,m,C,y,h+2,N))}ie(e,A,g)}var he=c.Plane.fromPointNormal(a.Cartesian3.ZERO,a.Cartesian3.UNIT_Y),be=new a.Cartesian3,ge=new a.Cartesian3;function Ae(e,r,i,n,s,o,u){if(t.defined(u)){var p=a.Cartesian3.fromArray(n,3*e,pe);a.Cartesian3.equalsEpsilon(p,i,a.CesiumMath.EPSILON10)?o.applyOffset.values[s]=u[e]:o.applyOffset.values[s]=u[r]}}function Te(e){var r,i=e.geometry,n=i.attributes,s=n.position.values,o=t.defined(n.applyOffset)?n.applyOffset.values:void 0,u=i.indices,p=ae(i),d=ae(i),l=u.length,y=[];y.length=s.length/3;var v=[];for(v.length=s.length/3,r=0;r<y.length;++r)y[r]=-1,v[r]=-1;for(r=0;r<l;r+=2){var c=u[r],m=u[r+1],C=a.Cartesian3.fromArray(s,3*c,pe),h=a.Cartesian3.fromArray(s,3*m,de);Math.abs(C.y)<a.CesiumMath.EPSILON6&&(C.y<0?C.y=-a.CesiumMath.EPSILON6:C.y=a.CesiumMath.EPSILON6),Math.abs(h.y)<a.CesiumMath.EPSILON6&&(h.y<0?h.y=-a.CesiumMath.EPSILON6:h.y=a.CesiumMath.EPSILON6);var b=p.attributes,g=p.indices,A=v,T=d.attributes,x=d.indices,P=y,w=f.IntersectionTests.lineSegmentPlane(C,h,he,le);if(t.defined(w)){var S=a.Cartesian3.multiplyByScalar(a.Cartesian3.UNIT_Y,5*a.CesiumMath.EPSILON9,be);C.y<0&&(a.Cartesian3.negate(S,S),b=d.attributes,g=d.indices,A=y,T=p.attributes,x=p.indices,P=v);var I=a.Cartesian3.add(w,S,ge);Ae(c,m,C,s,ce(b,g,A,u,r,C),b,o),Ae(c,m,I,s,ce(b,g,A,u,-1,I),b,o),a.Cartesian3.negate(S,S),a.Cartesian3.add(w,S,I),Ae(c,m,I,s,ce(T,x,P,u,-1,I),T,o),Ae(c,m,h,s,ce(T,x,P,u,r+1,h),T,o)}else{var O,E,N;C.y<0?(O=d.attributes,E=d.indices,N=y):(O=p.attributes,E=p.indices,N=v),Ae(c,m,C,s,ce(O,E,N,u,r,C),O,o),Ae(c,m,h,s,ce(O,E,N,u,r+1,h),O,o)}}ie(e,d,p)}var xe=new i.Cartesian2,Pe=new i.Cartesian2,we=new a.Cartesian3,Se=new a.Cartesian3,Ie=new a.Cartesian3,Oe=new a.Cartesian3,Ee=new a.Cartesian3,Ne=new a.Cartesian3,Le=new o.Cartesian4;function ze(e){for(var t=e.attributes,r=t.position.values,i=t.prevPosition.values,n=t.nextPosition.values,s=r.length,o=0;o<s;o+=3){var u=a.Cartesian3.unpack(r,o,we);if(!(u.x>0)){var p=a.Cartesian3.unpack(i,o,Se);(u.y<0&&p.y>0||u.y>0&&p.y<0)&&(o-3>0?(i[o]=r[o-3],i[o+1]=r[o-2],i[o+2]=r[o-1]):a.Cartesian3.pack(u,i,o));var d=a.Cartesian3.unpack(n,o,Ie);(u.y<0&&d.y>0||u.y>0&&d.y<0)&&(o+3<s?(n[o]=r[o+3],n[o+1]=r[o+4],n[o+2]=r[o+5]):a.Cartesian3.pack(u,n,o))}}}var De=5*a.CesiumMath.EPSILON9,Me=a.CesiumMath.EPSILON6;g.splitLongitude=function(e){var r=e.geometry,u=r.boundingSphere;if(t.defined(u)&&(u.center.x-u.radius>0||n.BoundingSphere.intersectPlane(u,c.Plane.ORIGIN_ZX_PLANE)!==s.Intersect.INTERSECTING))return e;if(r.geometryType!==p.GeometryType.NONE)switch(r.geometryType){case p.GeometryType.POLYLINES:!function(e){var r,n,s,u=e.geometry,p=u.attributes,d=p.position.values,l=p.prevPosition.values,y=p.nextPosition.values,v=p.expandAndWidth.values,c=t.defined(p.st)?p.st.values:void 0,m=t.defined(p.color)?p.color.values:void 0,C=ae(u),h=ae(u),b=!1,g=d.length/3;for(r=0;r<g;r+=4){var A=r,T=r+2,x=a.Cartesian3.fromArray(d,3*A,we),P=a.Cartesian3.fromArray(d,3*T,Se);if(Math.abs(x.y)<Me)for(x.y=Me*(P.y<0?-1:1),d[3*r+1]=x.y,d[3*(r+1)+1]=x.y,n=3*A;n<3*A+12;n+=3)l[n]=d[3*r],l[n+1]=d[3*r+1],l[n+2]=d[3*r+2];if(Math.abs(P.y)<Me)for(P.y=Me*(x.y<0?-1:1),d[3*(r+2)+1]=P.y,d[3*(r+3)+1]=P.y,n=3*A;n<3*A+12;n+=3)y[n]=d[3*(r+2)],y[n+1]=d[3*(r+2)+1],y[n+2]=d[3*(r+2)+2];var w=C.attributes,S=C.indices,I=h.attributes,O=h.indices,E=f.IntersectionTests.lineSegmentPlane(x,P,he,Oe);if(t.defined(E)){b=!0;var N=a.Cartesian3.multiplyByScalar(a.Cartesian3.UNIT_Y,De,Ee);x.y<0&&(a.Cartesian3.negate(N,N),w=h.attributes,S=h.indices,I=C.attributes,O=C.indices);var L=a.Cartesian3.add(E,N,Ne);w.position.values.push(x.x,x.y,x.z,x.x,x.y,x.z),w.position.values.push(L.x,L.y,L.z),w.position.values.push(L.x,L.y,L.z),w.prevPosition.values.push(l[3*A],l[3*A+1],l[3*A+2]),w.prevPosition.values.push(l[3*A+3],l[3*A+4],l[3*A+5]),w.prevPosition.values.push(x.x,x.y,x.z,x.x,x.y,x.z),w.nextPosition.values.push(L.x,L.y,L.z),w.nextPosition.values.push(L.x,L.y,L.z),w.nextPosition.values.push(L.x,L.y,L.z),w.nextPosition.values.push(L.x,L.y,L.z),a.Cartesian3.negate(N,N),a.Cartesian3.add(E,N,L),I.position.values.push(L.x,L.y,L.z),I.position.values.push(L.x,L.y,L.z),I.position.values.push(P.x,P.y,P.z,P.x,P.y,P.z),I.prevPosition.values.push(L.x,L.y,L.z),I.prevPosition.values.push(L.x,L.y,L.z),I.prevPosition.values.push(L.x,L.y,L.z),I.prevPosition.values.push(L.x,L.y,L.z),I.nextPosition.values.push(P.x,P.y,P.z,P.x,P.y,P.z),I.nextPosition.values.push(y[3*T],y[3*T+1],y[3*T+2]),I.nextPosition.values.push(y[3*T+3],y[3*T+4],y[3*T+5]);var z=i.Cartesian2.fromArray(v,2*A,xe),D=Math.abs(z.y);w.expandAndWidth.values.push(-1,D,1,D),w.expandAndWidth.values.push(-1,-D,1,-D),I.expandAndWidth.values.push(-1,D,1,D),I.expandAndWidth.values.push(-1,-D,1,-D);var M=a.Cartesian3.magnitudeSquared(a.Cartesian3.subtract(E,x,Ie));if(M/=a.Cartesian3.magnitudeSquared(a.Cartesian3.subtract(P,x,Ie)),t.defined(m)){var G=o.Cartesian4.fromArray(m,4*A,Le),R=o.Cartesian4.fromArray(m,4*T,Le),V=a.CesiumMath.lerp(G.x,R.x,M),B=a.CesiumMath.lerp(G.y,R.y,M),F=a.CesiumMath.lerp(G.z,R.z,M),k=a.CesiumMath.lerp(G.w,R.w,M);for(n=4*A;n<4*A+8;++n)w.color.values.push(m[n]);for(w.color.values.push(V,B,F,k),w.color.values.push(V,B,F,k),I.color.values.push(V,B,F,k),I.color.values.push(V,B,F,k),n=4*T;n<4*T+8;++n)I.color.values.push(m[n])}if(t.defined(c)){var _=i.Cartesian2.fromArray(c,2*A,xe),q=i.Cartesian2.fromArray(c,2*(r+3),Pe),U=a.CesiumMath.lerp(_.x,q.x,M);for(n=2*A;n<2*A+4;++n)w.st.values.push(c[n]);for(w.st.values.push(U,_.y),w.st.values.push(U,q.y),I.st.values.push(U,_.y),I.st.values.push(U,q.y),n=2*T;n<2*T+4;++n)I.st.values.push(c[n])}s=w.position.values.length/3-4,S.push(s,s+2,s+1),S.push(s+1,s+2,s+3),s=I.position.values.length/3-4,O.push(s,s+2,s+1),O.push(s+1,s+2,s+3)}else{var Y,Z;for(x.y<0?(Y=h.attributes,Z=h.indices):(Y=C.attributes,Z=C.indices),Y.position.values.push(x.x,x.y,x.z),Y.position.values.push(x.x,x.y,x.z),Y.position.values.push(P.x,P.y,P.z),Y.position.values.push(P.x,P.y,P.z),n=3*r;n<3*r+12;++n)Y.prevPosition.values.push(l[n]),Y.nextPosition.values.push(y[n]);for(n=2*r;n<2*r+8;++n)Y.expandAndWidth.values.push(v[n]),t.defined(c)&&Y.st.values.push(c[n]);if(t.defined(m))for(n=4*r;n<4*r+16;++n)Y.color.values.push(m[n]);s=Y.position.values.length/3-4,Z.push(s,s+2,s+1),Z.push(s+1,s+2,s+3)}}b&&(ze(h),ze(C)),ie(e,h,C)}(e);break;case p.GeometryType.TRIANGLES:Ce(e);break;case p.GeometryType.LINES:Te(e)}else H(r),r.primitiveType===d.PrimitiveType.TRIANGLES?Ce(e):r.primitiveType===d.PrimitiveType.LINES&&Te(e);return e},e.GeometryPipeline=g}));