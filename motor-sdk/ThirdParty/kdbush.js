function kdbush(t,s,h,e,i){return new KDBush(t,s,h,e,i)}function KDBush(t,s,h,e,i){s=s||defaultGetX,h=h||defaultGetY,i=i||Array,this.nodeSize=e||64,this.points=t,this.ids=new i(t.length),this.coords=new i(2*t.length);for(var r=0;r<t.length;r++)this.ids[r]=r,this.coords[2*r]=s(t[r]),this.coords[2*r+1]=h(t[r]);sort(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function defaultGetX(t){return t[0]}function defaultGetY(t){return t[1]}function range(t,s,h,e,i,r,n){var o,u,a=[0,t.length-1,0],p=[];while(a.length){var f=a.pop(),l=a.pop(),d=a.pop();if(l-d<=n)for(var c=d;c<=l;c++)o=s[2*c],u=s[2*c+1],o>=h&&o<=i&&u>=e&&u<=r&&p.push(t[c]);else{var w=Math.floor((d+l)/2);o=s[2*w],u=s[2*w+1],o>=h&&o<=i&&u>=e&&u<=r&&p.push(t[w]);var v=(f+1)%2;(0===f?h<=o:e<=u)&&(a.push(d),a.push(w-1),a.push(v)),(0===f?i>=o:r>=u)&&(a.push(w+1),a.push(l),a.push(v))}}return p}function sort(t,s,h,e,i,r){if(!(i-e<=h)){var n=Math.floor((e+i)/2);select(t,s,n,e,i,r%2),sort(t,s,h,e,n-1,r+1),sort(t,s,h,n+1,i,r+1)}}function select(t,s,h,e,i,r){while(i>e){if(i-e>600){var n=i-e+1,o=h-e+1,u=Math.log(n),a=.5*Math.exp(2*u/3),p=.5*Math.sqrt(u*a*(n-a)/n)*(o-n/2<0?-1:1),f=Math.max(e,Math.floor(h-o*a/n+p)),l=Math.min(i,Math.floor(h+(n-o)*a/n+p));select(t,s,h,f,l,r)}var d=s[2*h+r],c=e,w=i;swapItem(t,s,e,h),s[2*i+r]>d&&swapItem(t,s,e,i);while(c<w){swapItem(t,s,c,w),c++,w--;while(s[2*c+r]<d)c++;while(s[2*w+r]>d)w--}s[2*e+r]===d?swapItem(t,s,e,w):(w++,swapItem(t,s,w,i)),w<=h&&(e=w+1),h<=w&&(i=w-1)}}function swapItem(t,s,h,e){swap(t,h,e),swap(s,2*h,2*e),swap(s,2*h+1,2*e+1)}function swap(t,s,h){var e=t[s];t[s]=t[h],t[h]=e}function within(t,s,h,e,i,r){var n=[0,t.length-1,0],o=[],u=i*i;while(n.length){var a=n.pop(),p=n.pop(),f=n.pop();if(p-f<=r)for(var l=f;l<=p;l++)sqDist(s[2*l],s[2*l+1],h,e)<=u&&o.push(t[l]);else{var d=Math.floor((f+p)/2),c=s[2*d],w=s[2*d+1];sqDist(c,w,h,e)<=u&&o.push(t[d]);var v=(a+1)%2;(0===a?h-i<=c:e-i<=w)&&(n.push(f),n.push(d-1),n.push(v)),(0===a?h+i>=c:e+i>=w)&&(n.push(d+1),n.push(p),n.push(v))}}return o}function sqDist(t,s,h,e){var i=t-h,r=s-e;return i*i+r*r}KDBush.prototype={range:function(t,s,h,e){return range(this.ids,this.coords,t,s,h,e,this.nodeSize)},within:function(t,s,h){return within(this.ids,this.coords,t,s,h,this.nodeSize)}};export default kdbush;