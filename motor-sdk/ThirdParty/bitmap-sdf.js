var INF=1e20;function clamp(a,r,t){return r<t?a<r?r:a>t?t:a:a<t?t:a>r?r:a}function calcSDF(a,r){r||(r={});var t,e,n,i,o,d,w,h,f,l,s,c=null==r.cutoff?.25:r.cutoff,y=null==r.radius?8:r.radius,g=r.channel||0;if(ArrayBuffer.isView(a)||Array.isArray(a)){if(!r.width||!r.height)throw Error("For raw data width and height should be provided by options");t=r.width,e=r.height,i=a,d=r.stride?r.stride:Math.floor(a.length/t/e)}else window.HTMLCanvasElement&&a instanceof window.HTMLCanvasElement?(h=a,w=h.getContext("2d"),t=h.width,e=h.height,f=w.getImageData(0,0,t,e),i=f.data,d=4):window.CanvasRenderingContext2D&&a instanceof window.CanvasRenderingContext2D?(h=a.canvas,w=a,t=h.width,e=h.height,f=w.getImageData(0,0,t,e),i=f.data,d=4):window.ImageData&&a instanceof window.ImageData&&(f=a,t=a.width,e=a.height,i=f.data,d=4);if(n=Math.max(t,e),window.Uint8ClampedArray&&i instanceof window.Uint8ClampedArray||window.Uint8Array&&i instanceof window.Uint8Array)for(o=i,i=Array(t*e),l=0,s=o.length;l<s;l++)i[l]=o[l*d+g]/255;else if(1!==d)throw Error("Raw data can have only 1 value per pixel");var v=Array(t*e),A=Array(t*e),u=Array(n),m=Array(n),p=Array(n+1),F=Array(n);for(l=0,s=t*e;l<s;l++){var I=i[l];v[l]=1===I?0:0===I?INF:Math.pow(Math.max(0,.5-I),2),A[l]=1===I?INF:0===I?0:Math.pow(Math.max(0,I-.5),2)}edt(v,t,e,u,m,F,p),edt(A,t,e,u,m,F,p);var C=window.Float32Array?new Float32Array(t*e):new Array(t*e);for(l=0,s=t*e;l<s;l++)C[l]=clamp(1-((v[l]-A[l])/y+c),0,1);return C}function edt(a,r,t,e,n,i,o){for(var d=0;d<r;d++){for(var w=0;w<t;w++)e[w]=a[w*r+d];for(edt1d(e,n,i,o,t),w=0;w<t;w++)a[w*r+d]=n[w]}for(w=0;w<t;w++){for(d=0;d<r;d++)e[d]=a[w*r+d];for(edt1d(e,n,i,o,r),d=0;d<r;d++)a[w*r+d]=Math.sqrt(n[d])}}function edt1d(a,r,t,e,n){t[0]=0,e[0]=-INF,e[1]=+INF;for(var i=1,o=0;i<n;i++){var d=(a[i]+i*i-(a[t[o]]+t[o]*t[o]))/(2*i-2*t[o]);while(d<=e[o])o--,d=(a[i]+i*i-(a[t[o]]+t[o]*t[o]))/(2*i-2*t[o]);o++,t[o]=i,e[o]=d,e[o+1]=+INF}for(i=0,o=0;i<n;i++){while(e[o+1]<i)o++;r[i]=(i-t[o])*(i-t[o])+a[t[o]]}}export default calcSDF;