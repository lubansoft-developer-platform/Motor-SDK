var reduceArray,slice,undef;function when(e,n,r,t){return resolve(e).then(n,r,t)}function resolve(e){var n,r;return e instanceof Promise?n=e:isPromise(e)?(r=defer(),e.then((function(e){r.resolve(e)}),(function(e){r.reject(e)}),(function(e){r.progress(e)})),n=r.promise):n=fulfilled(e),n}function reject(e){return when(e,rejected)}function Promise(e){this.then=e}function fulfilled(e){var n=new Promise((function(n){try{return resolve(n?n(e):e)}catch(r){return rejected(r)}}));return n}function rejected(e){var n=new Promise((function(n,r){try{return r?resolve(r(e)):rejected(e)}catch(t){return rejected(t)}}));return n}function defer(){var e,n,r,t,o,u,i;return n=new Promise(c),e={then:c,resolve:f,reject:s,progress:h,promise:n,resolver:{resolve:f,reject:s,progress:h}},r=[],t=[],o=function(e,n,o){var u,i;return u=defer(),i="function"===typeof o?function(e){try{u.progress(o(e))}catch(n){u.progress(n)}}:function(e){u.progress(e)},r.push((function(r){r.then(e,n).then(u.resolve,u.reject,i)})),t.push(i),u.promise},u=function(e){return processQueue(t,e),e},i=function(e){return e=resolve(e),o=e.then,i=resolve,u=noop,processQueue(r,e),t=r=undef,e},e;function c(e,n,r){return o(e,n,r)}function f(e){return i(e)}function s(e){return i(rejected(e))}function h(e){return u(e)}}function isPromise(e){return e&&"function"===typeof e.then}function some(e,n,r,t,o){return checkCallbacks(2,arguments),when(e,(function(e){var u,i,c,f,s,h,l,a,p,d;if(p=e.length>>>0,u=Math.max(0,Math.min(n,p)),c=[],i=p-u+1,f=[],s=defer(),u)for(a=s.progress,l=function(e){f.push(e),--i||(h=l=noop,s.reject(f))},h=function(e){c.push(e),--u||(h=l=noop,s.resolve(c))},d=0;d<p;++d)d in e&&when(e[d],v,w,a);else s.resolve(c);return s.then(r,t,o);function w(e){l(e)}function v(e){h(e)}}))}function any(e,n,r,t){function o(e){return n?n(e[0]):e[0]}return some(e,1,o,r,t)}function all(e,n,r,t){return checkCallbacks(1,arguments),map(e,identity).then(n,r,t)}function join(){return map(arguments,identity)}function map(e,n){return when(e,(function(e){var r,t,o,u,i,c;if(o=t=e.length>>>0,r=[],c=defer(),o)for(u=function(e,t){when(e,n).then((function(e){r[t]=e,--o||c.resolve(r)}),c.reject)},i=0;i<t;i++)i in e?u(e[i],i):--o;else c.resolve(r);return c.promise}))}function reduce(e,n){var r=slice.call(arguments,1);return when(e,(function(e){var t;return t=e.length,r[0]=function(e,r,o){return when(e,(function(e){return when(r,(function(r){return n(e,r,o,t)}))}))},reduceArray.apply(e,r)}))}function chain(e,n,r){var t=arguments.length>2;return when(e,(function(e){return e=t?r:e,n.resolve(e),e}),(function(e){return n.reject(e),rejected(e)}),n.progress)}function processQueue(e,n){var r,t=0;while(r=e[t++])r(n)}function checkCallbacks(e,n){var r,t=n.length;while(t>e)if(r=n[--t],null!=r&&"function"!=typeof r)throw new Error("arg "+t+" must be a function")}function noop(){}function identity(e){return e}when.defer=defer,when.resolve=resolve,when.reject=reject,when.join=join,when.all=all,when.map=map,when.reduce=reduce,when.any=any,when.some=some,when.chain=chain,when.isPromise=isPromise,Promise.prototype={always:function(e,n){return this.then(e,e,n)},otherwise:function(e){return this.then(undef,e)},yield:function(e){return this.then((function(){return e}))},spread:function(e){return this.then((function(n){return all(n,(function(n){return e.apply(undef,n)}))}))}},slice=[].slice,reduceArray=[].reduce||function(e){var n,r,t,o,u;if(u=0,n=Object(this),o=n.length>>>0,r=arguments,r.length<=1)for(;;){if(u in n){t=n[u++];break}if(++u>=o)throw new TypeError}else t=r[1];for(;u<o;++u)u in n&&(t=e(t,n[u],u,n));return t};export default when;