define(["./when-52cea266","./Check-abb9b75f","./Cartesian2-7312ebeb","./Rectangle-9e59d921","./BoundingSphere-ff324c2c","./Transforms-f87238cb","./Matrix4-f7d115f5","./RuntimeError-02840484","./WebGLConstants-52779751","./ComponentDatatype-0d64f16b","./GeometryAttribute-55231797","./PrimitiveType-875d1f73","./GeometryAttributes-769ca2c2","./AttributeCompression-8ffd5503","./GeometryPipeline-ce341179","./EncodedCartesian3-e2962ac4","./IndexDatatype-d59649f4","./IntersectionTests-5644043d","./Plane-9b745adc","./VertexFormat-b433634a","./GeometryInstance-f9e3ec48","./arrayRemoveDuplicates-1952d5cf","./BoundingRectangle-e7af9fa3","./AxisAlignedBoundingBox-dabc1f48","./EllipsoidTangentPlane-204e035e","./OrientedBoundingBox-2fac7a15","./CoplanarPolygonGeometryLibrary-6d4e4305","./ArcType-97079e95","./EllipsoidRhumbLine-bfe2f143","./PolygonPipeline-c4c3c8f5","./PolygonGeometryLibrary-51478b1b"],(function(e,t,a,n,r,o,i,s,l,p,c,y,u,m,d,g,f,h,v,b,C,x,P,A,w,F,G,L,E,T,k){"use strict";var D=new a.Cartesian3,_=new P.BoundingRectangle,V=new a.Cartesian2,R=new a.Cartesian2,B=new a.Cartesian3,I=new a.Cartesian3,M=new a.Cartesian3,H=new a.Cartesian3,O=new a.Cartesian3,S=new a.Cartesian3,z=new o.Quaternion,N=new i.Matrix3,Q=new i.Matrix3,j=new a.Cartesian3;function U(e,t,n,r,s,l,m,d){var g=e.positions,h=T.PolygonPipeline.triangulate(e.positions2D,e.holes);h.length<3&&(h=[0,1,2]);var v=f.IndexDatatype.createTypedArray(g.length,h.length);v.set(h);var b=N;if(0!==r){var C=o.Quaternion.fromAxisAngle(l,r,z);if(b=i.Matrix3.fromQuaternion(C,b),t.tangent||t.bitangent){C=o.Quaternion.fromAxisAngle(l,-r,z);var x=i.Matrix3.fromQuaternion(C,Q);m=a.Cartesian3.normalize(i.Matrix3.multiplyByVector(x,m,m),m),t.bitangent&&(d=a.Cartesian3.normalize(a.Cartesian3.cross(l,m,d),d))}}else b=i.Matrix3.clone(i.Matrix3.IDENTITY,b);var P=R;t.st&&(P.x=n.x,P.y=n.y);for(var A=g.length,w=3*A,F=new Float64Array(w),G=t.normal?new Float32Array(w):void 0,L=t.tangent?new Float32Array(w):void 0,E=t.bitangent?new Float32Array(w):void 0,k=t.st?new Float32Array(2*A):void 0,_=0,B=0,I=0,M=0,H=0,O=0;O<A;O++){var S=g[O];if(F[_++]=S.x,F[_++]=S.y,F[_++]=S.z,t.st){var j=i.Matrix3.multiplyByVector(b,S,D),U=s(j,V);a.Cartesian2.subtract(U,P,U);var Y=a.CesiumMath.clamp(U.x/n.width,0,1),q=a.CesiumMath.clamp(U.y/n.height,0,1);k[H++]=Y,k[H++]=q}t.normal&&(G[B++]=l.x,G[B++]=l.y,G[B++]=l.z),t.tangent&&(L[M++]=m.x,L[M++]=m.y,L[M++]=m.z),t.bitangent&&(E[I++]=d.x,E[I++]=d.y,E[I++]=d.z)}var J=new u.GeometryAttributes;return t.position&&(J.position=new c.GeometryAttribute({componentDatatype:p.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:F})),t.normal&&(J.normal=new c.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:G})),t.tangent&&(J.tangent=new c.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:L})),t.bitangent&&(J.bitangent=new c.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:E})),t.st&&(J.st=new c.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:k})),new c.Geometry({attributes:J,indices:v,primitiveType:y.PrimitiveType.TRIANGLES})}function Y(a){a=e.defaultValue(a,e.defaultValue.EMPTY_OBJECT);var r=a.polygonHierarchy;t.Check.defined("options.polygonHierarchy",r);var o=e.defaultValue(a.vertexFormat,b.VertexFormat.DEFAULT);this._vertexFormat=b.VertexFormat.clone(o),this._polygonHierarchy=r,this._stRotation=e.defaultValue(a.stRotation,0),this._ellipsoid=n.Ellipsoid.clone(e.defaultValue(a.ellipsoid,n.Ellipsoid.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=k.PolygonGeometryLibrary.computeHierarchyPackedLength(r)+b.VertexFormat.packedLength+n.Ellipsoid.packedLength+2}Y.fromPositions=function(a){a=e.defaultValue(a,e.defaultValue.EMPTY_OBJECT),t.Check.defined("options.positions",a.positions);var n={polygonHierarchy:{positions:a.positions},vertexFormat:a.vertexFormat,stRotation:a.stRotation,ellipsoid:a.ellipsoid};return new Y(n)},Y.pack=function(a,r,o){return t.Check.typeOf.object("value",a),t.Check.defined("array",r),o=e.defaultValue(o,0),o=k.PolygonGeometryLibrary.packPolygonHierarchy(a._polygonHierarchy,r,o),n.Ellipsoid.pack(a._ellipsoid,r,o),o+=n.Ellipsoid.packedLength,b.VertexFormat.pack(a._vertexFormat,r,o),o+=b.VertexFormat.packedLength,r[o++]=a._stRotation,r[o]=a.packedLength,r};var q=n.Ellipsoid.clone(n.Ellipsoid.UNIT_SPHERE),J=new b.VertexFormat,W={polygonHierarchy:{}};function Z(t,a){return e.defined(a)&&(t=Y.unpack(t,a)),Y.createGeometry(t)}return Y.unpack=function(a,r,o){t.Check.defined("array",a),r=e.defaultValue(r,0);var i=k.PolygonGeometryLibrary.unpackPolygonHierarchy(a,r);r=i.startingIndex,delete i.startingIndex;var s=n.Ellipsoid.unpack(a,r,q);r+=n.Ellipsoid.packedLength;var l=b.VertexFormat.unpack(a,r,J);r+=b.VertexFormat.packedLength;var p=a[r++],c=a[r];return e.defined(o)||(o=new Y(W)),o._polygonHierarchy=i,o._ellipsoid=n.Ellipsoid.clone(s,o._ellipsoid),o._vertexFormat=b.VertexFormat.clone(l,o._vertexFormat),o._stRotation=p,o.packedLength=c,o},Y.createGeometry=function(e){var t=e._vertexFormat,n=e._polygonHierarchy,o=e._stRotation,i=n.positions;if(i=x.arrayRemoveDuplicates(i,a.Cartesian3.equalsEpsilon,!0),!(i.length<3)){var s=B,l=I,p=M,y=O,u=S,m=G.CoplanarPolygonGeometryLibrary.computeProjectTo2DArguments(i,H,y,u);if(m){if(s=a.Cartesian3.cross(y,u,s),s=a.Cartesian3.normalize(s,s),!a.Cartesian3.equalsEpsilon(H,a.Cartesian3.ZERO,a.CesiumMath.EPSILON6)){var g=e._ellipsoid.geodeticSurfaceNormal(H,j);a.Cartesian3.dot(s,g)<0&&(s=a.Cartesian3.negate(s,s),y=a.Cartesian3.negate(y,y))}var h=G.CoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction(H,y,u),v=G.CoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction(H,y,u);t.tangent&&(l=a.Cartesian3.clone(y,l)),t.bitangent&&(p=a.Cartesian3.clone(u,p));var b=k.PolygonGeometryLibrary.polygonsFromHierarchy(n,h,!1),P=b.hierarchy,A=b.polygons;if(0!==P.length){i=P[0].outerRing;for(var w=r.BoundingSphere.fromPoints(i),F=k.PolygonGeometryLibrary.computeBoundingRectangle(s,v,i,o,_),L=[],E=0;E<A.length;E++){var T=new C.GeometryInstance({geometry:U(A[E],t,F,o,v,s,l,p)});L.push(T)}var D=d.GeometryPipeline.combineInstances(L)[0];D.attributes.position.values=new Float64Array(D.attributes.position.values),D.indices=f.IndexDatatype.createTypedArray(D.attributes.position.values.length/3,D.indices);var V=D.attributes;return t.position||delete V.position,new c.Geometry({attributes:V,indices:D.indices,primitiveType:D.primitiveType,boundingSphere:w})}}}},Z}));