define(["./when-52cea266","./Check-abb9b75f","./Cartesian2-7312ebeb","./Rectangle-9e59d921","./BoundingSphere-ff324c2c","./Transforms-f87238cb","./Matrix4-f7d115f5","./RuntimeError-02840484","./WebGLConstants-52779751","./ComponentDatatype-0d64f16b","./AttributeCompression-8ffd5503","./IntersectionTests-5644043d","./Plane-9b745adc","./WebMercatorProjection-2000cd98","./createTaskProcessorWorker","./AxisAlignedBoundingBox-dabc1f48","./EllipsoidTangentPlane-204e035e","./OrientedBoundingBox-2fac7a15","./TerrainEncoding-86876cf6"],(function(e,t,i,n,r,a,o,s,u,h,c,d,g,l,m,p,v,f,I){"use strict";var E=Uint16Array.BYTES_PER_ELEMENT,T=Int32Array.BYTES_PER_ELEMENT,C=Uint32Array.BYTES_PER_ELEMENT,M=Float32Array.BYTES_PER_ELEMENT,x=Float64Array.BYTES_PER_ELEMENT;function N(t,n,r){r=e.defaultValue(r,i.CesiumMath);for(var a=t.length,o=0;o<a;++o)if(r.equalsEpsilon(t[o],n,i.CesiumMath.EPSILON12))return o;return-1}function b(e,t){e.ellipsoid=n.Ellipsoid.clone(e.ellipsoid),e.rectangle=n.Rectangle.clone(e.rectangle);var i=R(e.buffer,e.relativeToCenter,e.ellipsoid,e.rectangle,e.nativeRectangle,e.exaggeration,e.skirtHeight,e.includeWebMercatorT,e.negativeAltitudeExponentBias,e.negativeElevationThreshold),r=i.vertices;t.push(r.buffer);var a=i.indices;return t.push(a.buffer),{vertices:r.buffer,indices:a.buffer,numberOfAttributes:i.encoding.getStride(),minimumHeight:i.minimumHeight,maximumHeight:i.maximumHeight,boundingSphere3D:i.boundingSphere3D,orientedBoundingBox:i.orientedBoundingBox,occludeePointInScaledSpace:i.occludeePointInScaledSpace,encoding:i.encoding,vertexCountWithoutSkirts:i.vertexCountWithoutSkirts,indexCountWithoutSkirts:i.indexCountWithoutSkirts,westIndicesSouthToNorth:i.westIndicesSouthToNorth,southIndicesEastToWest:i.southIndicesEastToWest,eastIndicesNorthToSouth:i.eastIndicesNorthToSouth,northIndicesWestToEast:i.northIndicesWestToEast}}var S=new n.Cartographic,B=new i.Cartesian3,w=new i.Cartesian3,P=new i.Cartesian3,A=new o.Matrix4;function R(t,u,h,c,d,g,m,v,b,R){var _,W,F,O,Y,k;e.defined(c)?(_=c.west,W=c.south,F=c.east,O=c.north,Y=c.width,k=c.height):(_=i.CesiumMath.toRadians(d.west),W=i.CesiumMath.toRadians(d.south),F=i.CesiumMath.toRadians(d.east),O=i.CesiumMath.toRadians(d.north),Y=i.CesiumMath.toRadians(c.width),k=i.CesiumMath.toRadians(c.height));var U,V,H=[W,O],L=[_,F],D=a.Transforms.eastNorthUpToFixedFrame(u,h),G=o.Matrix4.inverseTransformation(D,A);v&&(U=l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(W),V=1/(l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(O)-U));var j=new DataView(t),z=Number.POSITIVE_INFINITY,q=Number.NEGATIVE_INFINITY,J=w;J.x=Number.POSITIVE_INFINITY,J.y=Number.POSITIVE_INFINITY,J.z=Number.POSITIVE_INFINITY;var K=P;K.x=Number.NEGATIVE_INFINITY,K.y=Number.NEGATIVE_INFINITY,K.z=Number.NEGATIVE_INFINITY;var Q,X,Z=0,$=0,ee=0;for(X=0;X<4;++X){var te=Z;Q=j.getUint32(te,!0),te+=C;var ie=i.CesiumMath.toRadians(180*j.getFloat64(te,!0));te+=x,-1===N(L,ie)&&L.push(ie);var ne=i.CesiumMath.toRadians(180*j.getFloat64(te,!0));te+=x,-1===N(H,ne)&&H.push(ne),te+=2*x;var re=j.getInt32(te,!0);te+=T,$+=re,re=j.getInt32(te,!0),ee+=3*re,Z+=Q+C}var ae=[],oe=[],se=new Array($),ue=new Array($),he=new Array($),ce=v?new Array($):[],de=new Array(ee),ge=[],le=[],me=[],pe=[],ve=0,fe=0;for(Z=0,X=0;X<4;++X){Q=j.getUint32(Z,!0),Z+=C;var Ie=Z,Ee=i.CesiumMath.toRadians(180*j.getFloat64(Z,!0));Z+=x;var Te=i.CesiumMath.toRadians(180*j.getFloat64(Z,!0));Z+=x;var Ce=i.CesiumMath.toRadians(180*j.getFloat64(Z,!0)),Me=.5*Ce;Z+=x;var xe=i.CesiumMath.toRadians(180*j.getFloat64(Z,!0)),Ne=.5*xe;Z+=x;var be=j.getInt32(Z,!0);Z+=T;var Se=j.getInt32(Z,!0);Z+=T,Z+=T;for(var Be=new Array(be),we=0;we<be;++we){var Pe=Ee+j.getUint8(Z++)*Ce;S.longitude=Pe;var Ae=Te+j.getUint8(Z++)*xe;S.latitude=Ae;var Re=j.getFloat32(Z,!0);if(Z+=M,0!==Re&&Re<R&&(Re*=-Math.pow(2,b)),Re*=6371010*g,S.height=Re,-1!==N(L,Pe)||-1!==N(H,Ae)){var ye=N(ae,S,n.Cartographic);if(-1!==ye){Be[we]=oe[ye];continue}ae.push(n.Cartographic.clone(S)),oe.push(ve)}Be[we]=ve,Math.abs(Pe-_)<Me?ge.push({index:ve,cartographic:n.Cartographic.clone(S)}):Math.abs(Pe-F)<Me?me.push({index:ve,cartographic:n.Cartographic.clone(S)}):Math.abs(Ae-W)<Ne?le.push({index:ve,cartographic:n.Cartographic.clone(S)}):Math.abs(Ae-O)<Ne&&pe.push({index:ve,cartographic:n.Cartographic.clone(S)}),z=Math.min(Re,z),q=Math.max(Re,q),he[ve]=Re;var _e=h.cartographicToCartesian(S);se[ve]=_e,v&&(ce[ve]=(l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(Ae)-U)*V),o.Matrix4.multiplyByPoint(G,_e,B),i.Cartesian3.minimumByComponent(B,J,J),i.Cartesian3.maximumByComponent(B,K,K);var We=(Pe-_)/(F-_);We=i.CesiumMath.clamp(We,0,1);var Fe=(Ae-W)/(O-W);Fe=i.CesiumMath.clamp(Fe,0,1),ue[ve]=new i.Cartesian2(We,Fe),++ve}for(var Oe=3*Se,Ye=0;Ye<Oe;++Ye,++fe)de[fe]=Be[j.getUint16(Z,!0)],Z+=E;if(Q!==Z-Ie)throw new s.RuntimeError("Invalid terrain tile.")}se.length=ve,ue.length=ve,he.length=ve,v&&(ce.length=ve);var ke=ve,Ue=fe,Ve={hMin:z,lastBorderPoint:void 0,skirtHeight:m,toENU:G,ellipsoid:h,minimum:J,maximum:K};ge.sort((function(e,t){return t.cartographic.latitude-e.cartographic.latitude})),le.sort((function(e,t){return e.cartographic.longitude-t.cartographic.longitude})),me.sort((function(e,t){return e.cartographic.latitude-t.cartographic.latitude})),pe.sort((function(e,t){return t.cartographic.longitude-e.cartographic.longitude}));var He=1e-5;if(y(se,he,ue,ce,de,Ve,ge,-He*Y,!0,-He*k),y(se,he,ue,ce,de,Ve,le,-He*k,!1),y(se,he,ue,ce,de,Ve,me,He*Y,!0,He*k),y(se,he,ue,ce,de,Ve,pe,He*k,!1),ge.length>0&&pe.length>0){var Le=ge[0].index,De=ke,Ge=pe[pe.length-1].index,je=se.length-1;de.push(Ge,je,De,De,Le,Ge)}$=se.length;var ze,qe=r.BoundingSphere.fromPoints(se);e.defined(c)&&(ze=f.OrientedBoundingBox.fromRectangle(c,z,q,h));for(var Je=new I.EllipsoidalOccluder(h),Ke=Je.computeHorizonCullingPointPossiblyUnderEllipsoid(u,se,z),Qe=new p.AxisAlignedBoundingBox(J,K,u),Xe=new I.TerrainEncoding(Qe,Ve.hMin,q,D,!1,v),Ze=new Float32Array($*Xe.getStride()),$e=0,et=0;et<$;++et)$e=Xe.encode(Ze,$e,se[et],ue[et],he[et],void 0,ce[et]);var tt=ge.map((function(e){return e.index})).reverse(),it=le.map((function(e){return e.index})).reverse(),nt=me.map((function(e){return e.index})).reverse(),rt=pe.map((function(e){return e.index})).reverse();return it.unshift(nt[nt.length-1]),it.push(tt[0]),rt.unshift(tt[tt.length-1]),rt.push(nt[0]),{vertices:Ze,indices:new Uint16Array(de),maximumHeight:q,minimumHeight:z,encoding:Xe,boundingSphere3D:qe,orientedBoundingBox:ze,occludeePointInScaledSpace:Ke,vertexCountWithoutSkirts:ke,indexCountWithoutSkirts:Ue,westIndicesSouthToNorth:tt,southIndicesEastToWest:it,eastIndicesNorthToSouth:nt,northIndicesWestToEast:rt}}function y(t,r,a,s,u,h,c,d,g,l){for(var m=c.length,p=0;p<m;++p){var v=c[p],f=v.cartographic,I=v.index,E=t.length,T=f.longitude,C=f.latitude;C=i.CesiumMath.clamp(C,-i.CesiumMath.PI_OVER_TWO,i.CesiumMath.PI_OVER_TWO);var M=f.height-h.skirtHeight;h.hMin=Math.min(h.hMin,M),n.Cartographic.fromRadians(T,C,M,S),g&&(S.longitude+=d),g?p===m-1?S.latitude+=l:0===p&&(S.latitude-=l):S.latitude+=d;var x=h.ellipsoid.cartographicToCartesian(S);t.push(x),r.push(M),a.push(i.Cartesian2.clone(a[I])),s.length>0&&s.push(s[I]),o.Matrix4.multiplyByPoint(h.toENU,x,B);var N=h.minimum,b=h.maximum;i.Cartesian3.minimumByComponent(B,N,N),i.Cartesian3.maximumByComponent(B,b,b);var w=h.lastBorderPoint;if(e.defined(w)){var P=w.index;u.push(P,E-1,E,E,I,P)}h.lastBorderPoint=v}}var _=m(b);return _}));