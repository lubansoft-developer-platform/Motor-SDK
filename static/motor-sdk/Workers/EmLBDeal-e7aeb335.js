define(["exports","./when-52cea266","./Check-abb9b75f","./Cartesian2-7312ebeb","./Transforms-f87238cb","./Matrix4-f7d115f5","./AxisAlignedBoundingBox-dabc1f48","./PolygonPipeline-c4c3c8f5","./EmWrapperManager-0f203c26"],(function(e,t,r,i,a,n,s,o,h){"use strict";class l{constructor(){this._pt2DAry=[],this._under=0,this._height=0,this._matrix=n.Matrix4.clone(n.Matrix4.IDENTITY)}static clone(e){const t=e._under,r=e._height,a=[];e._pt2DAry.forEach((e=>{a.push(new i.Cartesian2(e.x,e.y))}));const s=new l;return s._under=t,s._height=r,s._pt2DAry=a,n.Matrix4.pack(e._matrix,s._matrix),s}getBoundingbox(){const e=[];return this.getPtAry(!0,e),this.getPtAry(!1,e),s.AxisAlignedBoundingBox.fromPoints(e)}createTriangle(e,t){let r=e.length;this.getPtAry(!0,e);let i=e.length-r;this.getPtAry(!1,e);let a=0;for(let s=0;s<i;s++)a=s===i-1?0:s+1,t.push(r+s),t.push(r+a),t.push(r+i+a),t.push(r+s),t.push(r+i+a),t.push(r+i+s);const n=o.PolygonPipeline.triangulate(this._pt2DAry);t.push(...n.map((e=>r+i+e))),t.push(...n.reverse().map((e=>r+e)))}set pt2DAry(e){this._pt2DAry=t.defaultValue(e,[]),this._pt2DAry.length>2&&o.PolygonPipeline.computeWindingOrder2D(this._pt2DAry)===o.WindingOrder.CLOCKWISE&&this._pt2DAry.reverse()}get pt2DAry(){return this._pt2DAry}set under(e){this._under=e}get under(){return this._under}set height(e){this._height=e}get height(){return this._height}set matrix(e){e.clone(this._matrix)}get matrix(){return this._matrix}getPtAry(e,t){this._pt2DAry.forEach((r=>{let a=new i.Cartesian3(r.x,r.y,this._under);e||(a.z+=this._height),n.Matrix4.multiplyByPoint(this._matrix,a,a),t.push(a)}))}transformXOY(e){let t=1e9;for(let r=0;r<this._pt2DAry.length;r++){let a=this._pt2DAry[r],s=new i.Cartesian3(a.x,a.y,this._under);n.Matrix4.multiplyByPoint(e,s,s),a.x=s.x,a.y=s.y,s.z<t&&(t=s.z)}this._under=t<1e9?t:0}}const y=new i.Cartesian3,p=new i.Cartesian3,m=new n.Matrix3,_=new n.Matrix3,d=new n.Matrix4;class A{constructor(){}init(e,s){if(!t.defined(h.emMod))throw new r.DeveloperError("initWebAssembly\u521d\u59cb\u5316\u5c1a\u672a\u5b8c\u6210");return this._LBDeal=new h.emMod.LBDeal,this._LBDeal.Init(e,s.x,s.y,s.z)?(this._centerENMatrix=a.Transforms.eastNorthUpToFixedFrame(i.Cartesian3.fromDegrees(s.x,s.y,s.z)),this._matrixArray=new Float64Array(n.Matrix4.toArray(n.Matrix4.IDENTITY)),this._pMatrixAry=h.emMod._malloc(this._matrixArray.byteLength),this._oneTyped32Array=new Float32Array([0,0,0]),this._pOnePt32Ary=h.emMod._malloc(this._oneTyped32Array.byteLength),this._oneTyped64Array=new Float64Array([0,0,0]),this._pOnePt64Ary=h.emMod._malloc(this._oneTyped64Array.byteLength),this._planishAry=null,!0):(h.emMod.destroy(this._LBDeal),this._LBDeal=void 0,!1)}destroy(){t.defined(this._LBDeal)&&(h.emMod.destroy(this._LBDeal),this._LBDeal=void 0,h.emMod._free(this._pMatrixAry),h.emMod._free(this._pOnePt32Ary),h.emMod._free(this._pOnePt64Ary),t.defined(this._planishAry)&&(h.emMod.destroy(this._planishAry),this._planishAry=null))}setPlanishBorderInfoAry(e){if(Array.isArray(e)){t.defined(this._planishAry)&&h.emMod.destroy(this._planishAry),this._planishAry=new h.emMod.LBPlanishAry,this._planishAry.SetPlanishNum(e.length);for(let t=0;t<e.length;t++){const r=l.clone(e[t]);this._planishAry.SetPlanishBot(t,r.under);const i=r.pt2DAry.length;this._planishAry.SetPlanishPtNum(t,i);for(let e=0;e<i;e++)this._planishAry.SetPlanishPtVal(t,e,r.pt2DAry[e].x,r.pt2DAry[e].y)}}}computeProjToCartesianAry(e,t,r){this.computeProjToCartesianAryImp(r,e,t,!1,this._LBDeal,!1)}computeCartesianToProjAry(e,t,r){this.computeProjToCartesianAryImp(r,e,t,!0,this._LBDeal,!1)}computeProjToCartesian(e,r,a,n){r=t.defaultValue(r,!1);let s=[e.x,e.y,e.z];return this.computeProjToCartesianAryImp(a,s,r,!1,this._LBDeal,!0),t.defined(n)?(n.x=s[0],n.y=s[1],n.z=s[2],n):new i.Cartesian3(s[0],s[1],s[2])}computeCartesianToProj(e,r,a,n){r=t.defaultValue(r,!1);let s=[e.x,e.y,e.z];return this.computeProjToCartesianAryImp(a,s,r,!0,this._LBDeal,!0),t.defined(n)?(n.x=s[0],n.y=s[1],n.z=s[2],n):new i.Cartesian3(s[0],s[1],s[2])}computeDegreeToProjAry(e,t){this.computeDegreeToProjImp(e,t,!1,this._LBDeal,!1)}computeProjToDegreeAry(e,t){this.computeDegreeToProjImp(e,t,!0,this._LBDeal,!1)}computeDegreeToProj(e,r,a){let n=[e.x,e.y,e.z];return this.computeDegreeToProjImp(n,r,!1,this._LBDeal,!0),t.defined(a)?(a.x=n[0],a.y=n[1],a.z=n[2],a):new i.Cartesian3(n[0],n[1],n[2])}computeProjToDegree(e,r,a){let n=[e.x,e.y,e.z];return this.computeDegreeToProjImp(n,r,!0,this._LBDeal,!0),t.defined(a)?(a.x=n[0],a.y=n[1],a.z=n[2],a):new i.Cartesian3(n[0],n[1],n[2])}cvtRelProjMatrixToCartesianMatrix(e,r){return t.defined(r)||(r=new n.Matrix4),n.Matrix4.getTranslation(e,y),n.Matrix4.getScale(e,p),n.Matrix4.getMatrix3(e,m),n.Matrix3.getRotation(m,_),n.Matrix4.fromScale(p,r),n.Matrix4.multiplyByMatrix3(r,_,r),this.computeProjToCartesian(y,!1,void 0,y),n.Matrix4.multiplyByPoint(this._centerENMatrix,y,y),a.Transforms.eastNorthUpToFixedFrame(y,void 0,d),n.Matrix4.multiply(d,r,r),r}computeProjToCartesianAryImp(e,i,a,s,o,l){if(!t.defined(o))throw new r.DeveloperError("\u8bf7\u5148\u6267\u884c init\u8fdb\u884c\u521d\u59cb\u5316");let y,p;l?(y=this._oneTyped32Array,y.set(i),p=this._pOnePt32Ary):(y=new Float32Array(i),p=h.emMod._malloc(y.byteLength)),h.emMod.HEAPF32.set(y,p/4),e=t.defaultValue(e,n.Matrix4.IDENTITY),this._matrixArray.set(n.Matrix4.toArray(e)),h.emMod.HEAPF64.set(this._matrixArray,this._pMatrixAry/8),s?o.ComputeCartesianToProj(p,y.length,this._pMatrixAry,a,this._planishAry):o.ComputeProjToCartesian(p,y.length,this._pMatrixAry,a);for(let t=0;t<i.length;++t)i[t]=h.emMod.HEAPF32[(p>>2)+t];l||h.emMod._free(p)}computeDegreeToProjImp(e,i,a,n,s){if(!t.defined(n))throw new r.DeveloperError("\u8bf7\u5148\u6267\u884c init\u8fdb\u884c\u521d\u59cb\u5316");let o,l;s?(o=this._oneTyped64Array,o.set(e),l=this._pOnePt64Ary):(o=new Float64Array(e),l=h.emMod._malloc(o.byteLength)),h.emMod.HEAPF64.set(o,l/8),a?n.TranformProjToDegree(l,o.length,i):n.TranformDegreeToProj(l,o.length,i);for(let t=0;t<e.length;++t)e[t]=h.emMod.HEAPF64[(l>>3)+t];s||h.emMod._free(l)}}e.BorderInfo=l,e.EmLBDeal=A}));