define(["./when-52cea266","./Check-abb9b75f","./Cartesian2-7312ebeb","./Rectangle-9e59d921","./BoundingSphere-ff324c2c","./Transforms-f87238cb","./Matrix4-f7d115f5","./RuntimeError-02840484","./WebGLConstants-52779751","./ComponentDatatype-0d64f16b","./GeometryAttribute-55231797","./PrimitiveType-875d1f73","./AttributeCompression-8ffd5503","./IndexDatatype-d59649f4","./IntersectionTests-5644043d","./Plane-9b745adc","./createTaskProcessorWorker","./AxisAlignedBoundingBox-dabc1f48","./EllipsoidTangentPlane-204e035e","./OrientedBoundingBox-2fac7a15","./EllipsoidRhumbLine-bfe2f143","./PolygonPipeline-c4c3c8f5","./materem-62ee4902","./EmWrapperManager-0f203c26","./TerrainEncoding-86876cf6","./EmLBDeal-e7aeb335"],(function(e,n,r,t,f,i,u,a,o,s,h,l,d,c,g,B,p,m,v,C,b,w,y,x,E,A){"use strict";var M=32767,P=M/2|0,T=[],O=new t.Cartographic,I=new r.Cartesian3,S=[],W=[],R=[],H=[],k=[],D=new r.Cartesian3,L=new f.BoundingSphere,N=new C.OrientedBoundingBox,z=new r.Cartesian2,U=new r.Cartesian3;function V(n,r,t,f,i){var u=n.uBuffer.length,a=0,o=t[f]-t[i];Math.abs(o)>1e-9&&(a=t[f]/(t[f]-t[i]));var s=n.uBuffer[r[f]],h=n.vBuffer[r[f]],l=n.hBuffer[r[f]],d=n.uBuffer[r[i]],c=n.vBuffer[r[i]],g=n.hBuffer[r[i]];if(d=s+a*(d-s),c=h+a*(c-h),g=l+a*(g-l),n.uBuffer.push(d),n.vBuffer.push(c),n.hBuffer.push(g),e.defined(n.nBuffer)){var B=n.nBuffer[2*r[f]],p=n.nBuffer[2*r[f]+1],m=n.nBuffer[2*r[i]],v=n.nBuffer[2*r[i]+1];m=B+a*(m-B),v=p+a*(v-p),n.nBuffer.push(m),n.nBuffer.push(v)}return u}function j(e,n,r,t,f){var i=0,u=0,a=0,o=[];o.length=32;var s=function(){o[i]=V(e,n,r,a,u),i++},h=function(){o[i]=n[u],i++};if(t>0){u=t,a=u-1,s();while(u<f&&r[u]>=0)h(),u++;u<f?a=u-1:(u=0,a=f-1),s()}else{u=0;while(u<f&&r[u]>=0)h(),u++;a=u-1,s();while(u<f&&r[u]<0)u++;if(u<f){a=u-1,s();while(u<f&&r[u]>=0)h(),u++}else u=0,a=f-1,s()}f=i;for(let l=0;l<i;l++)n[l]=o[l];return f}function F(e,n,r,t){var f=0,i=0,u=-1,a=[];a.length=32;for(let o=0;o<r;o++){const r=n.uBuffer[t[o]],s=n.vBuffer[t[o]],h=n.hBuffer[t[o]];a[o]=r*e.x+s*e.y+h*e.z+e.w,a[o]>1e-9?(f++,u<0&&(u=o)):a[o]<-1e-9&&i++}return 0===f&&i>0?(r=0,r):f>=0&&0===i?r:j(n,t,a,u,r)}function G(e,n,r,t,f,i,a){var o=[new u.Cartesian4(1,0,0,-e),new u.Cartesian4(-1,0,0,r),new u.Cartesian4(0,1,0,-n),new u.Cartesian4(0,-1,0,t)];for(let u=0;u<4;u++)if(a=F(o[u],f,a,i),a<3)return a;return a}function X(n,r,t,f,i,u,a,o){var s=u.length/3,h=[];for(let e=0;e<s;++e){let a=3,o=[];if(o.length=32,o[0]=u[3*e],o[1]=u[3*e+1],o[2]=u[3*e+2],a=G(n,r,t,f,i,o,a),a>=3){let e=a-2;for(let n=1;n<=e;++n)h.push(o[0]),h.push(o[n]),h.push(o[n+1])}}var l=[],d=[];l.length=i.uBuffer.length,d.length=l.length;for(let e=0;e<l.length;e++)l[e]=!0,d[e]=-1;for(let e=0;e<h.length;e++)l[h[e]]=!1;for(let g=0,B=0;g<l.length;++g)l[g]||(d[g]=B,B++,a.uBuffer.push(i.uBuffer[g]),a.vBuffer.push(i.vBuffer[g]),a.hBuffer.push(i.hBuffer[g]),e.defined(i.nBuffer)&&(a.nBuffer.push(i.nBuffer[2*g]),a.nBuffer.push(i.nBuffer[2*g+1])));let c=h.length;for(let e=0;e<c;++e)o.push(d[h[e]])}function Z(n,i){var u=n.isEastChild,a=n.isNorthChild,o=u?P:0,s=u?M:P,h=a?P:0,l=a?M:P,d=S,g=W,B=R,p=k;d.length=0,g.length=0,B.length=0,p.length=0;var m=H;m.length=0;var v=n.vertices,b=n.indices;b=b.subarray(0,n.indexCountWithoutSkirts);var w,y,x,V,j,F=E.TerrainEncoding.clone(n.encoding),G=F.hasVertexNormals,Z=n.exaggeration,_=n.vertexCountWithoutSkirts,Y=n.minimumHeight,q=n.maximumHeight,J=new Array(_),K=new Array(_),Q=new Array(_),$=G?new Array(2*_):void 0,ee=20;for(y=0,x=0;y<_;++y,x+=2){var ne=F.decodeTextureCoordinates(v,y,z);if(w=F.decodeHeight(v,y)/Z,V=r.CesiumMath.clamp(ne.x*M|0,0,M),j=r.CesiumMath.clamp(ne.y*M|0,0,M),Q[y]=r.CesiumMath.clamp((w-Y)/(q-Y)*M|0,0,M),V<ee&&(V=0),j<ee&&(j=0),M-V<ee&&(V=M),M-j<ee&&(j=M),J[y]=V,K[y]=j,G){var re=F.getOctEncodedNormal(v,y,U);$[x]=re.x,$[x+1]=re.y}}var te={uBuffer:J,vBuffer:K,hBuffer:Q,nBuffer:$},fe={uBuffer:d,vBuffer:g,hBuffer:B,nBuffer:p};X(o,h,s,l,te,b,fe,m);var ie=u?-M:0,ue=a?-M:0,ae=[],oe=[],se=[],he=[],le=Number.MAX_VALUE,de=-le,ce=T;ce.length=0;var ge,Be=t.Ellipsoid.clone(n.ellipsoid),pe=t.Rectangle.clone(n.childRectangle),me=pe.north,ve=pe.south,Ce=pe.east,be=pe.west;if(Ce<be&&(Ce+=r.CesiumMath.TWO_PI),n.isPlaneMode){var we=n.projectionString,ye=n.dCenX,xe=n.dCenY,Ee=n.dCenZ;ge=new A.EmLBDeal;var Ae=ge.init(we,new r.Cartesian3(ye,xe,Ee));Ae||(ge.destroy(),ge=void 0)}for(y=0;y<d.length;++y)V=Math.round(d[y]),V<=o?(ae.push(y),V=0):V>=s?(se.push(y),V=M):V=2*V+ie,d[y]=V,j=Math.round(g[y]),j<=h?(oe.push(y),j=0):j>=l?(he.push(y),j=M):j=2*j+ue,g[y]=j,w=r.CesiumMath.lerp(Y,q,B[y]/M),w<le&&(le=w),w>de&&(de=w),B[y]=w,O.longitude=r.CesiumMath.lerp(be,Ce,V/M),O.latitude=r.CesiumMath.lerp(ve,me,j/M),O.height=w,Be.cartographicToCartesian(O,I),e.defined(ge)&&ge.computeCartesianToProj(I,!1,void 0,I),ce.push(I.x),ce.push(I.y),ce.push(I.z);var Me,Pe,Te=f.BoundingSphere.fromVertices(ce,r.Cartesian3.ZERO,3,L);if(e.defined(ge))Me=C.OrientedBoundingBox.fromPoints(Te.getCornerAry()),Pe=new r.Cartesian3;else{Me=C.OrientedBoundingBox.fromRectangle(pe,le,de,Be,N);var Oe=new E.EllipsoidalOccluder(Be);Pe=Oe.computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(Te.center,ce,3,Te.center,le,D)}var Ie=de-le,Se=new Uint16Array(d.length+g.length+B.length);for(y=0;y<d.length;++y)Se[y]=d[y];var We=d.length;for(y=0;y<g.length;++y)Se[We+y]=g[y];for(We+=g.length,y=0;y<B.length;++y)Se[We+y]=M*(B[y]-le)/Ie;var Re,He=c.IndexDatatype.createTypedArray(d.length,m);if(G){var ke=new Uint8Array(p);i.push(Se.buffer,He.buffer,ke.buffer),Re=ke.buffer}else i.push(Se.buffer,He.buffer);return e.defined(ge)&&ge.destroy(),{vertices:Se.buffer,encodedNormals:Re,indices:He.buffer,minimumHeight:le,maximumHeight:de,westIndices:ae,southIndices:oe,eastIndices:se,northIndices:he,boundingSphere:Te,orientedBoundingBox:Me,horizonOcclusionPoint:Pe}}function _(n){var r=n.data,t=r.webAssemblyConfig;e.defined(t)&&x.EmWrapperManager.initWebAssembly(t.wasmBinaryFileES6).then((function(){self.onmessage=p(Z),self.postMessage(!0)}))}return _}));